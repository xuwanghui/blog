<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/blog/2023/08/09/helloworld/</url>
    <content><![CDATA[<p><strong>“永远不要失去浪漫的能力”。</strong></p>
<p>​	 这个浪漫不单单是指恋爱，更多的是：</p>
<p>对于世界的好奇和探索，阅读和书写，天真的想法和骨子里的善良，</p>
<p>对于生活必要的仪式感，以及拥有对恶意和黑暗的事物抱有愤怒和反抗的能力 ~</p>
<p>和这个世界交手多年，渐渐失去了一些耐心，身体劳累，精神也麻木，对什么都提不起兴趣，</p>
<p>把漫长的生命活成同一天，但这样不行，早晚有一天是要发疯的 ~</p>
<span id="more"></span>
<p>还是要一些坚守和浪漫，要一些别人看来非必要的事物来拯救自己 ~</p>
<p>要一些海风，夏天的雨，要低吟的音乐和沉浸的电影，要在心里点燃一盏烛火 ~</p>
<p>停止被这个世界融化，花一些时间在这些事物上，</p>
<p>凝成自己坚固的核，保护好自己闪闪发光的部分，哪怕只是徒劳 ~</p>
<p>觉得难过的时候，记得抬头看看月亮 ~</p>
]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/blog/2024/05/12/vue3%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<h4 id="vue3项目">vue3项目</h4>
<h5 id="项目功能介绍">项目功能介绍</h5>
<p>目标：使用vue3+ts+pinia开发一个移动端Web App</p>
<p><img data-src="image-20240512202723820.png" alt="image-20240512202723820"></p>
<h5 id="项目展示">项目展示</h5>
<p><img data-src="image-20240512203849532.png" alt="image-20240512203849532"></p>
<p><img data-src="image-20240512203905947.png" alt="image-20240512203905947"></p>
<p><img data-src="image-20240512204000494.png" alt="image-20240512204000494"></p>
<h4 id="创建项目">创建项目</h4>
<p><img data-src="image-20240512204334525.png" alt="image-20240512204334525"></p>
<p><img data-src="image-20240512204404914.png" alt="image-20240512204404914"></p>
<p><img data-src="%E3%80%81image-20240512204503604.png" alt="image-20240512204503604"></p>
<h5 id="项目初始化">项目初始化</h5>
<p>今天来带大家从0开始搭建一个vue3项目。一个项目要有统一的规范，需要使用eslint+stylelint+prettier来对我们的代码质量做检测和修复，需要使用husky来做commit拦截，需要使用commitlint来统一提交规范，需要使用preinstall来统一包管理工具。</p>
<p>下面我们就用这一套规范来初始化我们的项目，集成一个规范的模版。</p>
<h5 id="环境准备">环境准备</h5>
<ul>
<li>node v16.14.2</li>
<li>pnpm 8.0.0</li>
</ul>
<h5 id="初始化项目">初始化项目</h5>
<p>本项目使用vite进行构建，vite官方中文文档参考：<a href="https://cn.vitejs.dev/guide/">cn.vitejs.dev/guide/</a></p>
<p><strong>pnpm:performant npm ，意味“高性能的 npm”。<a href="https://so.csdn.net/so/search?q=pnpm&amp;spm=1001.2101.3001.7020">pnpm</a>由npm/yarn衍生而来，解决了npm/yarn内部潜在的bug，极大的优化了性能，扩展了使用场景。被誉为“最先进的包管理工具”</strong></p>
<p>pnpm安装指令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i -g pnpm</span><br></pre></td></tr></table></figure>
<p>项目初始化命令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm create vite</span><br></pre></td></tr></table></figure>
<p>进入到项目根目录pnpm install安装全部依赖.安装完依赖运行程序:pnpm run dev</p>
<p>运行完毕项目跑在http://127.0.0.1:5173/,可以访问你得项目啦</p>
<h4 id="项目配置">项目配置</h4>
<h5 id="eslint配置"><strong>eslint配置</strong></h5>
<p><strong>eslint中文官网:<a href="http://eslint.cn/">http://eslint.cn/</a></strong></p>
<p>ESLint最初是由<a href="http://nczonline.net/">Nicholas C. Zakas</a> 于2013年6月创建的开源项目。它的目标是提供一个插件化的<strong>javascript代码检测工具</strong></p>
<p>首先安装eslint</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm i eslint -D</span><br></pre></td></tr></table></figure>
<p>生成配置文件:.eslint.cjs</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure>
<p><strong>.eslint.cjs配置文件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">   <span class="comment">//运行环境</span></span><br><span class="line">    <span class="string">&quot;env&quot;</span>: &#123; </span><br><span class="line">        <span class="string">&quot;browser&quot;</span>: <span class="literal">true</span>,<span class="comment">//浏览器端</span></span><br><span class="line">        <span class="string">&quot;es2021&quot;</span>: <span class="literal">true</span>,<span class="comment">//es2021</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//规则继承</span></span><br><span class="line">    <span class="string">&quot;extends&quot;</span>: [ </span><br><span class="line">       <span class="comment">//全部规则默认是关闭的,这个配置项开启推荐规则,推荐规则参照文档</span></span><br><span class="line">       <span class="comment">//比如:函数不能重名、对象不能出现重复key</span></span><br><span class="line">        <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">        <span class="comment">//vue3语法规则</span></span><br><span class="line">        <span class="string">&quot;plugin:vue/vue3-essential&quot;</span>,</span><br><span class="line">        <span class="comment">//ts语法规则</span></span><br><span class="line">        <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//要为特定类型的文件指定处理器</span></span><br><span class="line">    <span class="string">&quot;overrides&quot;</span>: [</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//指定解析器:解析器</span></span><br><span class="line">    <span class="comment">//Esprima 默认解析器</span></span><br><span class="line">    <span class="comment">//Babel-ESLint babel解析器</span></span><br><span class="line">    <span class="comment">//@typescript-eslint/parser ts解析器</span></span><br><span class="line">    <span class="string">&quot;parser&quot;</span>: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">    <span class="comment">//指定解析器选项</span></span><br><span class="line">    <span class="string">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ecmaVersion&quot;</span>: <span class="string">&quot;latest&quot;</span>,<span class="comment">//校验ECMA最新版本</span></span><br><span class="line">        <span class="string">&quot;sourceType&quot;</span>: <span class="string">&quot;module&quot;</span><span class="comment">//设置为&quot;script&quot;（默认），或者&quot;module&quot;代码在ECMAScript模块中</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//ESLint支持使用第三方插件。在使用插件之前，您必须使用npm安装它</span></span><br><span class="line">    <span class="comment">//该eslint-plugin-前缀可以从插件名称被省略</span></span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">        <span class="string">&quot;@typescript-eslint&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//eslint规则</span></span><br><span class="line">    <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>vue3环境代码校验插件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 让所有与prettier规则存在冲突的<span class="title class_">Eslint</span> rules失效，并使用prettier进行代码检查</span><br><span class="line"><span class="string">&quot;eslint-config-prettier&quot;</span>: <span class="string">&quot;^8.6.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;eslint-plugin-import&quot;</span>: <span class="string">&quot;^2.27.5&quot;</span>,</span><br><span class="line"><span class="string">&quot;eslint-plugin-node&quot;</span>: <span class="string">&quot;^11.1.0&quot;</span>,</span><br><span class="line"># 运行更漂亮的<span class="title class_">Eslint</span>，使prettier规则优先级更高，<span class="title class_">Eslint</span>优先级低</span><br><span class="line"><span class="string">&quot;eslint-plugin-prettier&quot;</span>: <span class="string">&quot;^4.2.1&quot;</span>,</span><br><span class="line"># vue.<span class="property">js</span>的<span class="title class_">Eslint</span>插件（查找vue语法错误，发现错误指令，查找违规风格指南</span><br><span class="line"><span class="string">&quot;eslint-plugin-vue&quot;</span>: <span class="string">&quot;^9.9.0&quot;</span>,</span><br><span class="line"># 该解析器允许使用<span class="title class_">Eslint</span>校验所有babel code</span><br><span class="line"><span class="string">&quot;@babel/eslint-parser&quot;</span>: <span class="string">&quot;^7.19.1&quot;</span>,</span><br></pre></td></tr></table></figure>
<p>安装指令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install -D eslint-plugin-import eslint-plugin-vue eslint-plugin-node eslint-plugin-prettier eslint-config-prettier eslint-plugin-node @babel/eslint-parser</span><br></pre></td></tr></table></figure>
<p><strong>修改.eslintrc.cjs配置文件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @see https://eslint.bootcss.com/docs/rules/</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">es2021</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">jest</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/* 指定如何解析语法 */</span></span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&#x27;vue-eslint-parser&#x27;</span>,</span><br><span class="line">  <span class="comment">/** 优先级低于 parse 的语法解析配置 */</span></span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="string">&#x27;latest&#x27;</span>,</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">    <span class="attr">parser</span>: <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>,</span><br><span class="line">    <span class="attr">jsxPragma</span>: <span class="string">&#x27;React&#x27;</span>,</span><br><span class="line">    <span class="attr">ecmaFeatures</span>: &#123;</span><br><span class="line">      <span class="attr">jsx</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/* 继承已有的规则 */</span></span><br><span class="line">  <span class="attr">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;eslint:recommended&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:vue/vue3-essential&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:prettier/recommended&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&#x27;vue&#x27;</span>, <span class="string">&#x27;@typescript-eslint&#x27;</span>],</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">   * &quot;off&quot; 或 0    ==&gt;  关闭规则</span></span><br><span class="line"><span class="comment">   * &quot;warn&quot; 或 1   ==&gt;  打开的规则作为警告（不影响代码执行）</span></span><br><span class="line"><span class="comment">   * &quot;error&quot; 或 2  ==&gt;  规则作为一个错误（代码不能执行，界面报错）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// eslint（https://eslint.bootcss.com/docs/rules/）</span></span><br><span class="line">    <span class="string">&#x27;no-var&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="comment">// 要求使用 let 或 const 而不是 var</span></span><br><span class="line">    <span class="string">&#x27;no-multiple-empty-lines&#x27;</span>: [<span class="string">&#x27;warn&#x27;</span>, &#123; <span class="attr">max</span>: <span class="number">1</span> &#125;], <span class="comment">// 不允许多个空行</span></span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-unexpected-multiline&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="comment">// 禁止空余的多行</span></span><br><span class="line">    <span class="string">&#x27;no-useless-escape&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 禁止不必要的转义字符</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// typeScript (https://typescript-eslint.io/rules)</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/no-unused-vars&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="comment">// 禁止定义未使用的变量</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/prefer-ts-expect-error&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="comment">// 禁止使用 @ts-ignore</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/no-explicit-any&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 禁止使用 any 类型</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/no-non-null-assertion&#x27;</span>: <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/no-namespace&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 禁止使用自定义 TypeScript 模块和命名空间。</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/semi&#x27;</span>: <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// eslint-plugin-vue (https://eslint.vuejs.org/rules/)</span></span><br><span class="line">    <span class="string">&#x27;vue/multi-word-component-names&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 要求组件名称始终为 “-” 链接的单词</span></span><br><span class="line">    <span class="string">&#x27;vue/script-setup-uses-vars&#x27;</span>: <span class="string">&#x27;error&#x27;</span>, <span class="comment">// 防止&lt;script setup&gt;使用的变量&lt;template&gt;被标记为未使用</span></span><br><span class="line">    <span class="string">&#x27;vue/no-mutating-props&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 不允许组件 prop的改变</span></span><br><span class="line">    <span class="string">&#x27;vue/attribute-hyphenation&#x27;</span>: <span class="string">&#x27;off&#x27;</span>, <span class="comment">// 对模板中的自定义组件强制执行属性命名样式</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>eslintignore忽略文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dist</span><br><span class="line">node_modules</span><br></pre></td></tr></table></figure>
<p><strong>运行脚本</strong></p>
<p>package.json新增两个运行脚本</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint src&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fix&quot;</span>: <span class="string">&quot;eslint src --fix&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置prettier">配置<strong>prettier</strong></h5>
<p>有了eslint，为什么还要有prettier？eslint针对的是javascript，他是一个检测工具，包含js语法以及少部分格式问题，在eslint看来，语法对了就能保证代码正常运行，格式问题属于其次；</p>
<p>而prettier属于格式化工具，它看不惯格式不统一，所以它就把eslint没干好的事接着干，另外，prettier支持</p>
<p>包含js在内的多种语言。</p>
<p>总结起来，<strong>eslint和prettier这俩兄弟一个保证js代码质量，一个保证代码美观。</strong></p>
<p><strong>安装依赖包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install -D eslint-plugin-prettier prettier eslint-config-prettier</span><br></pre></td></tr></table></figure>
<p><strong>prettierrc.json添加规则</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;semi&quot;: false,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;htmlWhitespaceSensitivity&quot;: &quot;ignore&quot;,</span><br><span class="line">  &quot;endOfLine&quot;: &quot;auto&quot;,</span><br><span class="line">  &quot;trailingComma&quot;: &quot;all&quot;,</span><br><span class="line">  &quot;tabWidth&quot;: 2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>prettierignore忽略文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/dist/*</span><br><span class="line">/html/*</span><br><span class="line">.local</span><br><span class="line">/node_modules/**</span><br><span class="line">**/*.svg</span><br><span class="line">**/*.sh</span><br><span class="line">/public/*</span><br></pre></td></tr></table></figure>
<p><strong>通过pnpm run lint去检测语法，如果出现不规范格式,通过pnpm run fix 修改</strong></p>
<h5 id="配置stylelint">配置stylelint</h5>
<p><a href="https://stylelint.io/">stylelint</a>为css的lint工具。可格式化css代码，检查css语法错误与不合理的写法，指定css书写顺序等。</p>
<p>我们的项目中使用scss作为预处理器，安装以下依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm add sass sass-loader stylelint postcss postcss-scss postcss-html stylelint-config-prettier stylelint-config-recess-order stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-scss stylelint-order stylelint-config-standard-scss -D</span><br></pre></td></tr></table></figure>
<p><strong><code>.stylelintrc.cjs</code>配置文件</strong></p>
<p><strong>官网:<a href="https://stylelint.bootcss.com/">https://stylelint.bootcss.com/</a></strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @see https://stylelint.bootcss.com/</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;stylelint-config-standard&#x27;</span>, <span class="comment">// 配置stylelint拓展插件</span></span><br><span class="line">    <span class="string">&#x27;stylelint-config-html/vue&#x27;</span>, <span class="comment">// 配置 vue 中 template 样式格式化</span></span><br><span class="line">    <span class="string">&#x27;stylelint-config-standard-scss&#x27;</span>, <span class="comment">// 配置stylelint scss插件</span></span><br><span class="line">    <span class="string">&#x27;stylelint-config-recommended-vue/scss&#x27;</span>, <span class="comment">// 配置 vue 中 scss 样式格式化</span></span><br><span class="line">    <span class="string">&#x27;stylelint-config-recess-order&#x27;</span>, <span class="comment">// 配置stylelint css属性书写顺序插件,</span></span><br><span class="line">    <span class="string">&#x27;stylelint-config-prettier&#x27;</span>, <span class="comment">// 配置stylelint和prettier兼容</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">overrides</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">files</span>: [<span class="string">&#x27;**/*.(scss|css|vue|html)&#x27;</span>],</span><br><span class="line">      <span class="attr">customSyntax</span>: <span class="string">&#x27;postcss-scss&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">files</span>: [<span class="string">&#x27;**/*.(html|vue)&#x27;</span>],</span><br><span class="line">      <span class="attr">customSyntax</span>: <span class="string">&#x27;postcss-html&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">ignoreFiles</span>: [</span><br><span class="line">    <span class="string">&#x27;**/*.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.jsx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.tsx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.ts&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.md&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;**/*.yaml&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * null  =&gt; 关闭该规则</span></span><br><span class="line"><span class="comment">   * always =&gt; 必须</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;value-keyword-case&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 在 css 中使用 v-bind，不报错</span></span><br><span class="line">    <span class="string">&#x27;no-descending-specificity&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 禁止在具有较高优先级的选择器后出现被其覆盖的较低优先级的选择器</span></span><br><span class="line">    <span class="string">&#x27;function-url-quotes&#x27;</span>: <span class="string">&#x27;always&#x27;</span>, <span class="comment">// 要求或禁止 URL 的引号 &quot;always(必须加上引号)&quot;|&quot;never(没有引号)&quot;</span></span><br><span class="line">    <span class="string">&#x27;no-empty-source&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 关闭禁止空源码</span></span><br><span class="line">    <span class="string">&#x27;selector-class-pattern&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 关闭强制选择器类名的格式</span></span><br><span class="line">    <span class="string">&#x27;property-no-unknown&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 禁止未知的属性(true 为不允许)</span></span><br><span class="line">    <span class="string">&#x27;block-opening-brace-space-before&#x27;</span>: <span class="string">&#x27;always&#x27;</span>, <span class="comment">//大括号之前必须有一个空格或不能有空白符</span></span><br><span class="line">    <span class="string">&#x27;value-no-vendor-prefix&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 关闭 属性值前缀 --webkit-box</span></span><br><span class="line">    <span class="string">&#x27;property-no-vendor-prefix&#x27;</span>: <span class="literal">null</span>, <span class="comment">// 关闭 属性前缀 -webkit-mask</span></span><br><span class="line">    <span class="string">&#x27;selector-pseudo-class-no-unknown&#x27;</span>: [</span><br><span class="line">      <span class="comment">// 不允许未知的选择器</span></span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">ignorePseudoClasses</span>: [<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;v-deep&#x27;</span>, <span class="string">&#x27;deep&#x27;</span>], <span class="comment">// 忽略属性，修改element默认样式的时候能使用到</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>stylelintignore忽略文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/node_modules/*</span><br><span class="line">/dist/*</span><br><span class="line">/html/*</span><br><span class="line">/public/*</span><br></pre></td></tr></table></figure>
<p><strong>运行脚本</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">	<span class="string">&quot;lint:style&quot;</span>: <span class="string">&quot;stylelint src/**/*.&#123;css,scss,vue&#125; --cache --fix&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后配置统一的prettier来格式化我们的js和css，html代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">   <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite --open&quot;</span>,</span><br><span class="line">   <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-tsc &amp;&amp; vite build&quot;</span>,</span><br><span class="line">   <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span>,</span><br><span class="line">   <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint src&quot;</span>,</span><br><span class="line">   <span class="string">&quot;fix&quot;</span>: <span class="string">&quot;eslint src --fix&quot;</span>,</span><br><span class="line">   <span class="string">&quot;format&quot;</span>: <span class="string">&quot;prettier --write \&quot;./**/*.&#123;html,vue,ts,js,json,md&#125;\&quot;&quot;</span>,</span><br><span class="line">   <span class="string">&quot;lint:eslint&quot;</span>: <span class="string">&quot;eslint src/**/*.&#123;ts,vue&#125; --cache --fix&quot;</span>,</span><br><span class="line">   <span class="string">&quot;lint:style&quot;</span>: <span class="string">&quot;stylelint src/**/*.&#123;css,scss,vue&#125; --cache --fix&quot;</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p><strong>当我们运行<code>pnpm run format</code>的时候，会把代码直接格式化</strong></p>
<h5 id="配置husky">配置husky</h5>
<p>在上面我们已经集成好了我们代码校验工具，但是需要每次手动的去执行命令才会格式化我们的代码。如果有人没有格式化就提交了远程仓库中，那这个规范就没什么用。所以我们需要强制让开发人员按照代码规范来提交。</p>
<p>要做到这件事情，就需要利用husky在代码提交之前触发git hook(git在客户端的钩子)，然后执行<code>pnpm run format</code>来自动的格式化我们的代码。</p>
<p>安装<code>husky</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install -D husky</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx husky-init</span><br></pre></td></tr></table></figure>
<p>会在根目录下生成个一个.husky目录，在这个目录下面会有一个pre-commit文件，这个文件里面的命令在我们执行commit的时候就会执行</p>
<p>在<code>.husky/pre-commit</code>文件添加如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/env sh</span><br><span class="line">. &quot;$(dirname -- &quot;$0&quot;)/_/husky.sh&quot;</span><br><span class="line">pnpm run format</span><br></pre></td></tr></table></figure>
<p>当我们对代码进行commit操作的时候，就会执行命令，对代码进行格式化，然后再提交。</p>
<h5 id="配置commitlint">配置commitlint</h5>
<p>对于我们的commit信息，也是有统一规范的，不能随便写,要让每个人都按照统一的标准来执行，我们可以利用<strong>commitlint</strong>来实现。</p>
<p>安装包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm add @commitlint/config-conventional @commitlint/cli -D</span><br></pre></td></tr></table></figure>
<p>添加配置文件，新建<code>commitlint.config.cjs</code>(注意是cjs)，然后添加下面的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>],</span><br><span class="line">  <span class="comment">// 校验规则</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;type-enum&#x27;</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&#x27;feat&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fix&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;docs&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;style&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;refactor&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;perf&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;chore&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;revert&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;build&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;type-case&#x27;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;type-empty&#x27;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;scope-empty&#x27;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;scope-case&#x27;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="string">&#x27;subject-full-stop&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;subject-case&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;header-max-length&#x27;</span>: [<span class="number">0</span>, <span class="string">&#x27;always&#x27;</span>, <span class="number">72</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>package.json</code>中配置scripts命令</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 在scrips中添加下面的代码</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;commitlint&quot;</span>: <span class="string">&quot;commitlint --config commitlint.config.cjs -e -V&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置结束，现在当我们填写<code>commit</code>信息的时候，前面就需要带着下面的<code>subject</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;feat&#x27;</span>,<span class="comment">//新特性、新功能</span></span><br><span class="line"><span class="string">&#x27;fix&#x27;</span>,<span class="comment">//修改bug</span></span><br><span class="line"><span class="string">&#x27;docs&#x27;</span>,<span class="comment">//文档修改</span></span><br><span class="line"><span class="string">&#x27;style&#x27;</span>,<span class="comment">//代码格式修改, 注意不是 css 修改</span></span><br><span class="line"><span class="string">&#x27;refactor&#x27;</span>,<span class="comment">//代码重构</span></span><br><span class="line"><span class="string">&#x27;perf&#x27;</span>,<span class="comment">//优化相关，比如提升性能、体验</span></span><br><span class="line"><span class="string">&#x27;test&#x27;</span>,<span class="comment">//测试用例修改</span></span><br><span class="line"><span class="string">&#x27;chore&#x27;</span>,<span class="comment">//其他修改, 比如改变构建流程、或者增加依赖库、工具等</span></span><br><span class="line"><span class="string">&#x27;revert&#x27;</span>,<span class="comment">//回滚到上一个版本</span></span><br><span class="line"><span class="string">&#x27;build&#x27;</span>,<span class="comment">//编译相关的修改，例如发布版本、对项目构建或者依赖的改动</span></span><br></pre></td></tr></table></figure>
<p>配置husky</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx husky add .husky/commit-msg </span><br></pre></td></tr></table></figure>
<p>在生成的commit-msg文件中添加下面的命令</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env sh</span><br><span class="line">. <span class="string">&quot;$(dirname -- &quot;</span>$<span class="number">0</span><span class="string">&quot;)/_/husky.sh&quot;</span></span><br><span class="line">pnpm commitlint</span><br></pre></td></tr></table></figure>
<p>当我们 commit 提交信息时，就不能再随意写了，必须是 git commit -m ‘fix: xxx’ 符合类型的才可以，<strong>需要注意的是类型的后面需要用英文的 :，并且冒号后面是需要空一格的，这个是不能省略的</strong></p>
<h5 id="强制使用pnpm包管理器工具">强制使用pnpm包管理器工具</h5>
<p>团队开发项目的时候，需要统一包管理器工具,因为不同包管理器工具下载同一个依赖,可能版本不一样,</p>
<p>导致项目出现bug问题,因此包管理器工具需要统一管理！！！</p>
<p>在根目录创建<code>scritps/preinstall.js</code>文件，添加下面的内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (!/pnpm/.test(process.env.npm_execpath || &#x27;&#x27;)) &#123;</span><br><span class="line">  console.warn(</span><br><span class="line">    `\u001b[33mThis repository must using pnpm as the package manager ` +</span><br><span class="line">    ` for scripts to work properly.\u001b[39m\n`,</span><br><span class="line">  )</span><br><span class="line">  process.exit(1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">	&quot;preinstall&quot;: &quot;node ./scripts/preinstall.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>当我们使用npm或者yarn来安装包的时候，就会报错了。原理就是在install的时候会触发preinstall（npm提供的生命周期钩子）这个文件里面的代码。</strong></p>
<h4 id="项目集成">项目集成</h4>
<h5 id="集成element-plus">集成element-plus</h5>
<p>,UI组件库采用的element-plus，因此需要集成element-plus插件！！！</p>
<p>官网地址:<a href="https://element-plus.gitee.io/zh-CN/">https://element-plus.gitee.io/zh-CN/</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install element-plus @element-plus/icons-vue</span><br></pre></td></tr></table></figure>
<p><strong>入口文件main.ts全局安装element-plus,element-plus默认支持语言英语设置为中文</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="comment">//@ts-ignore忽略当前文件ts类型的检测否则有红色提示(打包会失败)</span></span><br><span class="line"><span class="keyword">import</span> zhCn <span class="keyword">from</span> <span class="string">&#x27;element-plus/dist/locale/zh-cn.mjs&#x27;</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>, &#123;</span><br><span class="line">    <span class="attr">locale</span>: zhCn</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Element Plus全局组件类型声明</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">&quot;types&quot;</span>: [<span class="string">&quot;element-plus/global&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置完毕可以测试element-plus组件与图标的使用.</p>
<h5 id="src别名的配置">src别名的配置</h5>
<p>在开发项目的时候文件与文件关系可能很复杂，因此我们需要给src文件夹配置一个别名！！！</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;defineConfig&#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;./src&quot;</span>) <span class="comment">// 相对路径别名配置，使用 @ 代替 src</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>TypeScript 编译配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// tsconfig.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;baseUrl&quot;: &quot;./&quot;, // 解析非相对模块的基地址，默认是当前目录</span><br><span class="line">    &quot;paths&quot;: &#123; //路径映射，相对于baseUrl</span><br><span class="line">      &quot;@/*&quot;: [&quot;src/*&quot;] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="环境变量的配置">环境变量的配置</h5>
<p><strong>项目开发过程中，至少会经历开发环境、测试环境和生产环境(即正式环境)三个阶段。不同阶段请求的状态(如接口地址等)不尽相同，若手动切换接口地址是相当繁琐且易出错的。于是环境变量配置的需求就应运而生，我们只需做简单的配置，把环境状态切换的工作交给代码。</strong></p>
<p>开发环境（development）<br>
顾名思义，开发使用的环境，每位开发人员在自己的dev分支上干活，开发到一定程度，同事会合并代码，进行联调。</p>
<p>测试环境（testing）<br>
测试同事干活的环境啦，一般会由测试同事自己来部署，然后在此环境进行测试</p>
<p>生产环境（production）<br>
生产环境是指正式提供对外服务的，一般会关掉错误报告，打开错误日志。(正式提供给客户使用的环境。)</p>
<p>注意:一般情况下，一个环境对应一台服务器,也有的公司开发与测试环境是一台服务器！！！</p>
<p>项目根目录分别添加 开发、生产和测试环境的文件!</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.env.development</span><br><span class="line">.env.production</span><br><span class="line">.env.test</span><br></pre></td></tr></table></figure>
<p>文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 变量必须以 VITE_ 为前缀才能暴露给外部读取</span><br><span class="line">NODE_ENV = &#x27;development&#x27;</span><br><span class="line">VITE_APP_TITLE = &#x27;xxx&#x27;</span><br><span class="line">VITE_APP_BASE_API = &#x27;/dev-api&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NODE_ENV = &#x27;production&#x27;</span><br><span class="line">VITE_APP_TITLE = &#x27;xxx&#x27;</span><br><span class="line">VITE_APP_BASE_API = &#x27;/prod-api&#x27;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 变量必须以 VITE_ 为前缀才能暴露给外部读取</span><br><span class="line">NODE_ENV = &#x27;test&#x27;</span><br><span class="line">VITE_APP_TITLE = &#x27;xxx&#x27;</span><br><span class="line">VITE_APP_BASE_API = &#x27;/test-api&#x27;</span><br></pre></td></tr></table></figure>
<p>配置运行命令：package.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">   <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite --open&quot;</span>,</span><br><span class="line">   <span class="string">&quot;build:test&quot;</span>: <span class="string">&quot;vue-tsc &amp;&amp; vite build --mode test&quot;</span>,</span><br><span class="line">   <span class="string">&quot;build:pro&quot;</span>: <span class="string">&quot;vue-tsc &amp;&amp; vite build --mode production&quot;</span>,</span><br><span class="line">   <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p>通过import.meta.env获取环境变量</p>
<h5 id="SVG图标配置">SVG图标配置</h5>
<p>在开发项目的时候经常会用到svg矢量图,而且我们使用SVG以后，页面上加载的不再是图片资源,</p>
<p>这对页面性能来说是个很大的提升，而且我们SVG文件比img要小的很多，放在项目中几乎不占用资源。</p>
<p><strong>安装SVG依赖插件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install vite-plugin-svg-icons -D</span><br></pre></td></tr></table></figure>
<p><strong>在<code>vite.config.ts</code>中配置插件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#123; createSvgIconsPlugin &#125; from &#x27;vite-plugin-svg-icons&#x27;</span><br><span class="line">import path from &#x27;path&#x27;</span><br><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      createSvgIconsPlugin(&#123;</span><br><span class="line">        // Specify the icon folder to be cached</span><br><span class="line">        iconDirs: [path.resolve(process.cwd(), &#x27;src/assets/icons&#x27;)],</span><br><span class="line">        // Specify symbolId format</span><br><span class="line">        symbolId: &#x27;icon-[dir]-[name]&#x27;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>入口文件导入</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;virtual:svg-icons-register&#x27;</span><br></pre></td></tr></table></figure>
<h5 id="svg封装为全局组件">svg封装为全局组件</h5>
<p>因为项目很多模块需要使用图标,因此把它封装为全局组件！！！</p>
<p><strong>在src/components目录下创建一个SvgIcon组件:代表如下</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; width: width, height: height &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">use</span> <span class="attr">:xlink:href</span>=<span class="string">&quot;prefix + name&quot;</span> <span class="attr">:fill</span>=<span class="string">&quot;color&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//xlink:href属性值的前缀</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">prefix</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">default</span>: <span class="string">&#x27;#icon-&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//svg矢量图的名字</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//svg图标的颜色</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">color</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">default</span>: <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//svg宽度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">width</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">default</span>: <span class="string">&#x27;16px&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//svg高度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">height</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">default</span>: <span class="string">&#x27;16px&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>在src文件夹目录下创建一个index.ts文件：用于注册components文件夹内部全部全局组件！！！</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;./SvgIcon/index.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">App</span>, <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">components</span>: &#123; [<span class="attr">name</span>: string]: <span class="title class_">Component</span> &#125; = &#123; <span class="title class_">SvgIcon</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">app: App</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(components).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key: string</span>) =&gt;</span> &#123;</span><br><span class="line">            app.<span class="title function_">component</span>(key, components[key]);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在入口文件引入src/index.ts文件,通过app.use方法安装自定义插件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import gloablComponent from &#x27;./components/index&#x27;;</span><br><span class="line">app.use(gloablComponent);</span><br></pre></td></tr></table></figure>
<h5 id="集成sass">集成sass</h5>
<p>我们目前在组件内部已经可以使用scss样式,因为在配置styleLint工具的时候，项目当中已经安装过sass sass-loader,因此我们再组件内可以使用scss语法！！！需要加上lang=“scss”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>接下来我们为项目添加一些全局的样式</p>
<p>在src/styles目录下创建一个index.scss文件，当然项目中需要用到清除默认样式，因此在index.scss引入reset.scss</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@import reset.scss</span><br></pre></td></tr></table></figure>
<p>在入口文件引入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;@/styles&#x27;</span><br></pre></td></tr></table></figure>
<p>但是你会发现在src/styles/index.scss全局样式文件中没有办法使用$变量.因此需要给项目中引入全局变量$.</p>
<p>在style/variable.scss创建一个variable.scss文件！</p>
<p>在vite.config.ts文件配置如下:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="attr">css</span>: &#123;</span><br><span class="line">      <span class="attr">preprocessorOptions</span>: &#123;</span><br><span class="line">        <span class="attr">scss</span>: &#123;</span><br><span class="line">          <span class="attr">javascriptEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">additionalData</span>: <span class="string">&#x27;@import &quot;./src/styles/variable.scss&quot;;&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><code>@import &quot;./src/styles/variable.less&quot;;</code>后面的<code>;</code>不要忘记，不然会报错</strong>!</p>
<p>配置完毕你会发现scss提供这些全局变量可以在组件样式中使用了！！！</p>
<h5 id="mock数据">mock数据</h5>
<p>安装依赖:<a href="https://www.npmjs.com/package/vite-plugin-mock">https://www.npmjs.com/package/vite-plugin-mock</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install -D vite-plugin-mock mockjs</span><br></pre></td></tr></table></figure>
<p>在 vite.config.js 配置文件启用插件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">UserConfigExport</span>, <span class="title class_">ConfigEnv</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; viteMockServe &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-mock&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123; command &#125;)=&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="title function_">vue</span>(),</span><br><span class="line">      <span class="title function_">viteMockServe</span>(&#123;</span><br><span class="line">        <span class="attr">localEnabled</span>: command === <span class="string">&#x27;serve&#x27;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在根目录创建mock文件夹:去创建我们需要mock数据与接口！！！</p>
<p>在mock文件夹内部创建一个user.ts文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//用户信息数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createUserList</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">userId</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">avatar</span>:</span><br><span class="line">        <span class="string">&#x27;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;111111&#x27;</span>,</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;平台管理员&#x27;</span>,</span><br><span class="line">    <span class="attr">roles</span>: [<span class="string">&#x27;平台管理员&#x27;</span>],</span><br><span class="line">    <span class="attr">buttons</span>: [<span class="string">&#x27;cuser.detail&#x27;</span>],</span><br><span class="line">    <span class="attr">routes</span>: [<span class="string">&#x27;home&#x27;</span>],</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;Admin Token&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">userId</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">avatar</span>:</span><br><span class="line">        <span class="string">&#x27;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;111111&#x27;</span>,</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;系统管理员&#x27;</span>,</span><br><span class="line">    <span class="attr">roles</span>: [<span class="string">&#x27;系统管理员&#x27;</span>],</span><br><span class="line">    <span class="attr">buttons</span>: [<span class="string">&#x27;cuser.detail&#x27;</span>, <span class="string">&#x27;cuser.user&#x27;</span>],</span><br><span class="line">    <span class="attr">routes</span>: [<span class="string">&#x27;home&#x27;</span>],</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;System Token&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line"><span class="comment">// 用户登录接口</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/api/user/login&#x27;</span>,<span class="comment">//请求地址</span></span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,<span class="comment">//请求方式</span></span><br><span class="line">  <span class="attr">response</span>: <span class="function">(<span class="params">&#123; body &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//获取请求体携带过来的用户名与密码</span></span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = body;</span><br><span class="line">    <span class="comment">//调用获取用户信息函数,用于判断是否有此用户</span></span><br><span class="line">    <span class="keyword">const</span> checkUser = <span class="title function_">createUserList</span>().<span class="title function_">find</span>(</span><br><span class="line">        <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">username</span> === username &amp;&amp; item.<span class="property">password</span> === password,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//没有用户返回失败信息</span></span><br><span class="line">    <span class="keyword">if</span> (!checkUser) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">code</span>: <span class="number">201</span>, <span class="attr">data</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;账号或者密码不正确&#x27;</span> &#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果有返回成功信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; token &#125; = checkUser</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">data</span>: &#123; token &#125; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;/api/user/info&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  <span class="attr">response</span>: <span class="function">(<span class="params">request</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//获取请求头携带token</span></span><br><span class="line">    <span class="keyword">const</span> token = request.<span class="property">headers</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="comment">//查看用户信息是否包含有次token用户</span></span><br><span class="line">    <span class="keyword">const</span> checkUser = <span class="title function_">createUserList</span>().<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">token</span> === token)</span><br><span class="line">    <span class="comment">//没有返回失败的信息</span></span><br><span class="line">    <span class="keyword">if</span> (!checkUser) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">code</span>: <span class="number">201</span>, <span class="attr">data</span>: &#123; <span class="attr">message</span>: <span class="string">&#x27;获取用户信息失败&#x27;</span> &#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果有返回成功信息</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">data</span>: &#123;checkUser&#125; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>安装axios</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pnpm install axios</span><br></pre></td></tr></table></figure>
<p>最后通过axios测试接口！！！</p>
<h4 id="axios二次封装">axios二次封装</h4>
<p>在开发项目的时候避免不了与后端进行交互,因此我们需要使用axios插件实现发送网络请求。在开发项目的时候</p>
<p>我们经常会把axios进行二次封装。</p>
<p>目的:</p>
<p>1:使用请求拦截器，可以在请求拦截器中处理一些业务(开始进度条、请求头携带公共参数)</p>
<p>2:使用响应拦截器，可以在响应拦截器中处理一些业务(进度条结束、简化服务器返回的数据、处理http网络错误)</p>
<p>在根目录下创建utils/request.ts</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ElMessage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;element-plus&quot;</span>;</span><br><span class="line"><span class="comment">//创建axios实例</span></span><br><span class="line"><span class="keyword">let</span> request = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_APP_BASE_API</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">5000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//请求拦截器</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//响应拦截器</span></span><br><span class="line">request.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">&#125;, <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//处理网络错误</span></span><br><span class="line">    <span class="keyword">let</span> msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> status = error.<span class="property">response</span>.<span class="property">status</span>;</span><br><span class="line">    <span class="keyword">switch</span> (status) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">            msg = <span class="string">&quot;token过期&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">403</span>:</span><br><span class="line">            msg = <span class="string">&#x27;无权访问&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">404</span>:</span><br><span class="line">            msg = <span class="string">&quot;请求地址错误&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">500</span>:</span><br><span class="line">            msg = <span class="string">&quot;服务器出现问题&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            msg = <span class="string">&quot;无网络&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">ElMessage</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: msg</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>
<h5 id="API接口统一管理">API接口统一管理</h5>
<p>在开发项目的时候,接口可能很多需要统一管理。在src目录下去创建api文件夹去统一管理项目的接口；</p>
<p>比如:下面方式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//统一管理咱们项目用户相关的接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> type &#123;</span><br><span class="line"></span><br><span class="line"> loginFormData,</span><br><span class="line"></span><br><span class="line"> loginResponseData,</span><br><span class="line"></span><br><span class="line"> userInfoReponseData,</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//项目用户相关的请求地址</span></span><br><span class="line"></span><br><span class="line">enum <span class="variable constant_">API</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="variable constant_">LOGIN_URL</span> = <span class="string">&#x27;/admin/acl/index/login&#x27;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="variable constant_">USERINFO_URL</span> = <span class="string">&#x27;/admin/acl/index/info&#x27;</span>,</span><br><span class="line"></span><br><span class="line"> <span class="variable constant_">LOGOUT_URL</span> = <span class="string">&#x27;/admin/acl/index/logout&#x27;</span>,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//登录接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">reqLogin</span> = (<span class="params">data: loginFormData</span>) =&gt;</span><br><span class="line"> request.<span class="property">post</span>&lt;any, loginResponseData&gt;(<span class="variable constant_">API</span>.<span class="property">LOGIN_URL</span>, data)</span><br><span class="line"><span class="comment">//获取用户信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">reqUserInfo</span> = (<span class="params"></span>) =&gt;</span><br><span class="line"></span><br><span class="line"> request.<span class="property">get</span>&lt;any, userInfoReponseData&gt;(<span class="variable constant_">API</span>.<span class="property">USERINFO_URL</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出登录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">reqLogout</span> = (<span class="params"></span>) =&gt; request.<span class="property">post</span>&lt;any, any&gt;(<span class="variable constant_">API</span>.<span class="property">LOGOUT_URL</span>)</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>面试相关</title>
    <url>/blog/2024/05/02/%E9%9D%A2%E8%AF%95/</url>
    <content><![CDATA[<p>对于最近学生的简历以及面试，做了一些记录</p>
<h4 id="面试前准备">面试前准备</h4>
<span id="more"></span>
<h4 id="面试过程">面试过程</h4>
<p><strong>个人介绍不要记流水账，突出自己的重点技术栈和项目</strong></p>
<ul>
<li>
<p>自我介绍</p>
</li>
<li>
<p>最近项目、技术栈</p>
</li>
<li>
<p>离职背景</p>
</li>
</ul>
<p><strong>为简历上的每句话负责 哪怕是一句有良好的代码编写习惯</strong></p>
<p><strong>项目职责不能只写工作还要写出成绩和结果分析</strong></p>
<p><strong>你不是PM别光介绍项目功能要重点介绍技术</strong></p>
<p>介绍项目需要注意（面试必问，如果说不清楚，可以提前准备稿子）</p>
<ul>
<li>不要平铺直述的叙述</li>
<li>做出过什么成绩，有成就感的地方</li>
<li>遇到过哪些技术问题，如何解决的？- 讲一个故事</li>
</ul>
<p><strong>面试官让你介绍项目的目的</strong></p>
<ul>
<li>了解项目流程，你在项目中充当的角色，项目是否真实</li>
<li>看个人的表达能力，对于业务的理解能力</li>
</ul>
<p><strong>面试官说你还有什么想要问我的？</strong></p>
<p>以下供参考</p>
<ul>
<li>部门所做的产品和业务，产品的用户量、规模</li>
<li>部门有多少人，有哪些角色？</li>
<li>项目的技术栈，我想提前准备下</li>
</ul>
<ul>
<li>根据你自己情况，比如是否加班（这个尽早问，别等二面）</li>
</ul>
<p><strong>谈谈你未来的规划</strong></p>
<ul>
<li>不断学习新的业务和技术，积累更多业务经验，完善自己的技术栈</li>
<li>做几件有价值的事，比如开源作品</li>
</ul>
<p><strong>对于加班的看法</strong></p>
<ul>
<li>如果是工作需要我会义不容辞加班，我现在单身，没有任何家庭负担，可以全身心的投入工作。但同时，我也会提高工作效率，减少不必要的加班</li>
<li></li>
</ul>
<p><strong>业务能力</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">问题</th>
<th style="text-align:center">答案</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">我做过什么业务？</td>
<td style="text-align:center">独立负责360数据彩票走势开发图</td>
</tr>
<tr>
<td style="text-align:center">负责的业务有什么业绩？</td>
<td style="text-align:center">历时3周完成所有彩种开发，用户量上涨15%</td>
</tr>
<tr>
<td style="text-align:center">使用了什么技术方案？</td>
<td style="text-align:center">区别常规cavans方案，使用vml+svg方案</td>
</tr>
<tr>
<td style="text-align:center">突破了什么技术难点？</td>
<td style="text-align:center">解决了走势图高级绘图版的开发</td>
</tr>
<tr>
<td style="text-align:center">遇到了什么问题？</td>
<td style="text-align:center">橡皮擦的问题，动态连线计算等</td>
</tr>
<tr>
<td style="text-align:center">最大的收获是什么？</td>
<td style="text-align:center">对业务的理解更加深入，对技术图表更有把控</td>
</tr>
</tbody>
</table>
<h4 id="面试题">面试题</h4>
<p><strong>如果线上遇到了bug，你该怎么处理</strong></p>
<p>目的：考察是否具备真实的开发经验，处理临时问题的能力，是否有复盘、总结归纳的想法</p>
<ul>
<li>
<p>先回滚（而不是先排查问题）</p>
</li>
<li>
<p>排查解决问题，测试，重新上线</p>
</li>
<li>
<p>组内复盘会（给出解决方案，如何规避，供大家学习）</p>
</li>
</ul>
]]></content>
      <categories>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>vue2 项目</title>
    <url>/blog/2024/02/16/vue2%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<h3 id="通用商城后台管理系统">通用商城后台管理系统</h3>
<h4 id="Yarn是什么">Yarn是什么</h4>
<p>Yarn是由Facebook、Google、Exponent和 Tilde 联合推出了一个新的 JS 包管理工具，正如官方文档中写的，Yam 是为了弥补 npm 的一些缺陷而出现的 ：</p>
<ul>
<li>npm install 的时候<strong>巨慢</strong>。特别是新的项目拉下来要等半天，删除node_modules，重新install的时候依旧如此。</li>
<li>同一个项目，安装的时候<strong>无法保持一致性</strong>。由于package.json文件中版本号的特点，下面三个版本号在安装的时候代表不同的含义。</li>
</ul>
<span id="more"></span>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;5.6.3&quot;</span><br><span class="line">&quot;~5.0.3”</span><br><span class="line">&quot;^5.0.3&quot;</span><br></pre></td></tr></table></figure>
<p><code>5.0.3</code>表示安装指定的5.0.3版本，<code>~ 5.0.3</code>表示安装5.0.X中最新的版本，<code>^5.0.3</code>表示安装5.X.X中最新的版本。这就麻烦了，常常会出现同一个项目，有的同事是OK的，有的同事会由于安装的版本不一致出现bug。</p>
<ul>
<li>安装的时候，包会在同一时间下载和安装，中途某个时候，一个包抛出了一个错误，但是npm会继续下载和安装包，因为npm会把所有的日志输出到终端，有关错误包的错误信息就会在一大堆npm打印的警告中丢失掉，并且你甚至永远不会注意到实际发生的错误。</li>
</ul>
<p>带着这些坑，我开始了解Yarn的优势及其解决的问题</p>
<h4 id="Yarn的优点">Yarn的优点</h4>
<ul>
<li>速度快。速度快主要来自以下两个方面：<br>
1.并行安装：无论 npm 还是 Yar 在执行包的安装时，都会执行一系列任务。npm 是按照队列执行每个 package，也就是说必须要等到当前 package 安装完成之后，才能继续后面的安装。而 Yam ,是同步执行所有任务，提高了性能。2.离线模式：如果之前已经安装过一个软件包，用Yam再次安装时之间从缓存中获取，就不用像npm那样再从网络下载</li>
<li>安装版本统一：为了防止拉取到不同的版本，Yarn 有一个锁定文件(lock file) 记录了被确切安装上的模块的版本号。和每次只要新增了一个模块，Yarn 就会创建(或更新)varn.lock 这个文件。这么做就保证了，每一次拉取同一个项目依赖时，便用的都是一样的模块版本，npm 其实也有办法实现处处使用相同版本的 packages，但需要开发者执行npm shrinkwrap 命令。这个命令将会生成一个锁定文件，在执行 npm install 的时候，该锁定文件会先被读取，和Yarn 读取 yarn.lock 文件一个道理。npm 和 Yarn 两者的不同之处在于，Yam 默认会生成这样的锁定文件，而 npm要通过 shrinkwrap 命令生成 npm.shrinkwrap.json 文件，只有当这个文件存在的时候，packages 版本信息才会被记录和更新。</li>
<li>更简洁的输出：npm 的输出信息比较冗长。在执行 npm install 的时候，命令行里会不断地打印出所有被安装上的依赖。相比之下，Yam 简洁太多：默认情况下，结合了 emoji山观且直接地打印出必要的信息，也提供了一些命令供开发者查询额外的安装信息。</li>
<li>多注册来源处理：所有的依赖包，不管他被不同的库间接关联引用多少次，安装这个包时，只会从一个注册来源去装，要么是 npm 要么是 bower, 防止出现混乱不一致。</li>
<li>更好的语义化：yarn改变了一些npm命令的名称，比如 yarn add remove，感觉上比 npm 原本的 install uninstall 要更清晰。</li>
</ul>
<h4 id="Yarn-安装">Yarn 安装</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --global yarn</span><br></pre></td></tr></table></figure>
<h4 id="Yarn和npm命令对比">Yarn和npm命令对比</h4>
<table>
<thead>
<tr>
<th>npm</th>
<th>yarn</th>
</tr>
</thead>
<tbody>
<tr>
<td>npm install</td>
<td>yarn</td>
</tr>
<tr>
<td>npm install react --save</td>
<td>yam add react</td>
</tr>
<tr>
<td>npm uninstall react --save</td>
<td>yarn remove react</td>
</tr>
<tr>
<td>npm install react -save-dev</td>
<td>yarn add react --dev</td>
</tr>
<tr>
<td>npm update --save</td>
<td>yarn upgrade</td>
</tr>
</tbody>
</table>
<h3 id="项目技术栈">项目技术栈</h3>
<p><img data-src="image-20240220191456006.png" alt="项目技术栈"></p>
<h3 id="项目环境构建">项目环境构建</h3>
<h4 id="后端环境">后端环境</h4>
<p>打开后端目录执行:<code>npm i</code> 安装依赖</p>
<h5 id="数据库">数据库</h5>
<p>下载地址：<a href="https://dev.mysql.com/downloads/">https://dev.mysql.com/downloads/</a></p>
<p>安装参照：<a href="https://zhuanlan.zhihu.com/p/37152572">https://zhuanlan.zhihu.com/p/37152572</a></p>
<p>安装navcat</p>
<p>连接数据库</p>
<p>创建数据库</p>
<p>导入sql文件</p>
<p>修改数据库配置文件</p>
<p>安装 nodemon</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i nodemon -g</span><br></pre></td></tr></table></figure>
<p>启动后端项目</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nodemon app.js</span><br></pre></td></tr></table></figure>
<h4 id="前端环境">前端环境</h4>
<h5 id="拉取项目基础代码">拉取项目基础代码</h5>
<ul>
<li>
<h5 id="拉取命令">拉取命令</h5>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/PanJiaChen/vue-admin-template.git vue-admin</span><br></pre></td></tr></table></figure>
<ul>
<li>升级core-js版本到<strong>3.25.5</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i core-js@3.25.5 <span class="comment"># npm</span></span><br><span class="line">yarn add core-js@3.25.5 <span class="comment"># yarn</span></span><br></pre></td></tr></table></figure>
<ul>
<li>安装完整依赖</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i <span class="comment"># npm</span></span><br><span class="line">yarn  <span class="comment"># yarn</span></span><br><span class="line"></span><br><span class="line">如果安装依赖报错 尝试降低node版本到 16.20.2</span><br></pre></td></tr></table></figure>
<ul>
<li>启动命令在package.json中查看</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn dev</span><br></pre></td></tr></table></figure>
<h5 id="项目目录介绍">项目目录介绍</h5>
<ul>
<li>项目目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">├── src                        <span class="comment"># 源代码目录</span></span><br><span class="line">│   ├── api                    <span class="comment"># 所有请求</span></span><br><span class="line">│   ├── assets                 <span class="comment"># 主题 字体等静态资源</span></span><br><span class="line">│   ├── components             <span class="comment"># 全局公用组件</span></span><br><span class="line">│   ├── icons                  <span class="comment"># 项目所有 svg icons</span></span><br><span class="line">│   ├── layout                 <span class="comment"># 全局 layout</span></span><br><span class="line">│   ├── router                 <span class="comment"># 路由</span></span><br><span class="line">│   ├── store                  <span class="comment"># 全局 store管理</span></span><br><span class="line">│   ├── styles                 <span class="comment"># 全局样式</span></span><br><span class="line">│   ├── utils                  <span class="comment"># 全局公用方法</span></span><br><span class="line">│   ├── views                  <span class="comment"># views 所有页面</span></span><br><span class="line">│   ├── App.vue                <span class="comment"># 入口页面</span></span><br><span class="line">│   ├── main.js                <span class="comment"># 入口文件 加载组件 初始化等</span></span><br><span class="line">│   └── permission.js          <span class="comment"># 权限管理</span></span><br><span class="line">│   └── settings.js            <span class="comment"># 配置文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>入口文件</li>
</ul>
<p><img data-src="image-20240220192059411.png" alt="image-20240220192059411"></p>
<h5 id="App-vue根组件解析">App.vue根组件解析</h5>
<ul>
<li>App.vue组件</li>
</ul>
<p><img data-src="image-20240220192119070.png" alt="image-20240220192119070"></p>
<ul>
<li>layout布局</li>
</ul>
<p><img data-src="image-20240220192135795.png" alt="image-20240220192135795"></p>
<h5 id="settings-js-permission-js">settings.js&amp;&amp;permission.js</h5>
<p>settings.js 导出网站基础配置，包括：网站标题、固定header、显示logo<br>
permission.js (权限)，主要负责路由导航守卫</p>
<h5 id="Vuex">Vuex</h5>
<ul>
<li>模板中的结构</li>
</ul>
<p><img data-src="image-20240220192436713.png" alt="image-20240220192436713"></p>
<p><img data-src="image-20240220192516121.png" alt="image-20240220192516121"></p>
<ul>
<li>
<p>Vuex的设计思想</p>
<ul>
<li>页面交互状态（折叠侧边栏-固定头部）</li>
</ul>
<p><img data-src="image-20240220192638647.png" alt="image-20240220192638647"></p>
<ul>
<li>使用全局状态Vuex根据功能拆分成不同的模块（modules）</li>
</ul>
<p><img data-src="image-20240220192939250.png" alt="image-20240220192939250"></p>
<ul>
<li>进行状态管理通过getters建立对于模块中属性的快捷访问</li>
</ul>
<p><img data-src="image-20240220192752196.png" alt="image-20240220192752196"></p>
</li>
</ul>
<h5 id="模板中的Icon图标">模板中的Icon图标</h5>
<p><a href="https://baijiahao.baidu.com/s?id=1728784571128338709&amp;wfr=spider&amp;for=pc">svg图标的好处</a></p>
<ul>
<li>src/icons/svg目录下的图标都可以使用</li>
</ul>
<p><img data-src="image-20240220192914169.png" alt="image-20240220192914169"></p>
<ul>
<li>图标文件名直接设置为svg-icon组件的iconClass属性</li>
</ul>
<p><img data-src="image-20240220193016989.png" alt="image-20240220193016989"></p>
<h5 id="扩展-解析Icon图标的实现思路">扩展-解析Icon图标的实现思路</h5>
<ul>
<li>引入目录所有的svg</li>
</ul>
<p><img data-src="image-20240220193112234.png" alt="image-20240220193112234"></p>
<ul>
<li>全局注册svg-icon组件</li>
</ul>
<p><img data-src="image-20240220193149030.png" alt="image-20240220193149030"></p>
<ul>
<li>svg-icon引用svg的链接</li>
</ul>
<p><img data-src="image-20240220193223729.png" alt="image-20240220193223729"></p>
<p>知识扩展</p>
<p>了解：require.context(路径，是否扫描子目录， 正则匹配) 可以引入某个目录下的内容<br>
了解：svg-sprite-loader打包了所有svg到一个svg标签上，将svg名称作为symbol标签的id属性<br>
了解：svg-icon使用iconClass属性引用了symbol的id</p>
<h5 id="使用git管理">使用git管理</h5>
<blockquote>
<p>因为项目是从github上拉取下来的，所以git记录了之前模版的信息，所以删除需要建立git</p>
</blockquote>
<ul>
<li>删除原有的.git文件</li>
<li>初始化仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git init <span class="comment"># 初始化仓库</span></span><br></pre></td></tr></table></figure>
<ul>
<li>添加到暂存区</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git add . <span class="comment"># 添加到暂存区</span></span><br></pre></td></tr></table></figure>
<ul>
<li>提交本地仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;初始化人力资源项目&quot;</span> <span class="comment"># 提交本地仓库</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>接下来，同学们需要在gitee上新建一个自己的远程仓库，然后将本地的仓库推送到远程仓库托管</p>
</blockquote>
<ul>
<li>本地仓库配置远程仓库地址</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git remote add origin &lt;你的远程仓库地址&gt;  <span class="comment"># 本地仓库配置远程仓库地址</span></span><br></pre></td></tr></table></figure>
<ul>
<li>推送到远程仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push -u origin master <span class="comment"># 推送到远程仓库</span></span><br></pre></td></tr></table></figure>
<h3 id="项目模块">项目模块</h3>
<blockquote>
<p>传统思路都是登录校验通过之后，直接调用接口，获取token之后，跳转到主页</p>
</blockquote>
<p><img data-src="image-20240225144651760.png" alt="image-20240225144651760"></p>
<p>vue-element-admin的登录思路：</p>
<ol>
<li>登录表单校验通过</li>
<li>调用Vuex提供的登录的action</li>
<li>登录的Action中会调用接口</li>
<li>登录接口如果成功执行，会返回token</li>
<li>利用Vuex的特性，将token共享的到Vuex中，这样Vuex就统一管理了token,别的地方想要使用，直接通过Vuex就可以</li>
<li>登录接口会调用单独封装的请求模块(api)</li>
<li>请求模块中又会使用用到axios封装的请求工具</li>
<li>而请求工具要考虑区分 开发环境和生产环境的问题</li>
<li>请求时还要考虑前后分离项目产生的跨域问题，要使用代理解决跨域</li>
</ol>
<h4 id="登录页">登录页</h4>
<blockquote>
<p>实现登录页的表单解构和表单内容</p>
</blockquote>
<p><img data-src="image-20240220193701669.png" alt="image-20240220193701669"></p>
<ul>
<li>拷贝登录页的基本结构布局-代码位置(<strong>src/views/login/index.vue)</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-card</span> <span class="attr">shadow</span>=<span class="string">&quot;never&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-card&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--登录表单--&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-card</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  name : <span class="string">&quot;Login&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: stretch;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.logo</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex</span>: <span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">38</span>, <span class="number">72</span>, <span class="number">176</span>) <span class="built_in">url</span>(<span class="string">../../assets/common/login_back.png</span>)</span></span><br><span class="line"><span class="language-css">      no-repeat center / cover;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-top-right-radius</span>: <span class="number">60px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: flex-end;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.form</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-left</span>: <span class="number">176px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-card</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">24px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-input</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">350px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">44px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.el-input__inner</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#f4f5fb</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-checkbox</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>:<span class="number">#606266</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>实现登录表单的结构</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--登录表单--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">          用户平台使用协议</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">style</span>=<span class="string">&quot;width:350px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>提交代码</li>
</ul>
<h5 id="登录表单校验-实现">登录表单校验-实现</h5>
<ol>
<li>定义数据和校验规则</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">loginForm</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">isAgree</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">loginRules</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: [&#123;</span><br><span class="line">          <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;请输入用户名&#x27;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          <span class="comment">// pattern: /^1[3-9]\d&#123;9&#125;$/,</span></span><br><span class="line">          <span class="attr">min</span>: <span class="number">3</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">8</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;用户名格式不正确&#x27;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">password</span>: [&#123;</span><br><span class="line">          <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;请输入密码&#x27;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          <span class="attr">min</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">16</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;密码长度应该为6-16位之间&#x27;</span>,</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span></span><br><span class="line"></span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="comment">// required只能检查 null &quot;&quot; undefined</span></span><br><span class="line">        <span class="attr">isAgree</span>: [&#123;</span><br><span class="line">          <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// rule规则</span></span><br><span class="line">            <span class="comment">// value检查的数据 true/false</span></span><br><span class="line">            <span class="comment">// callback 函数 执行这个函数</span></span><br><span class="line">            <span class="comment">// 成功执行callback 失败也执行callback(错误对象 new Error(错误信息))</span></span><br><span class="line">            value ? <span class="title function_">callback</span>() : <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;没有勾选用户平台协议&#x27;</span>))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">form</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">isOK</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOK) &#123;</span><br><span class="line">          <span class="title function_">alert</span>(<span class="string">&#x27;校验通过&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>绑定组件的对应属性</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;form&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;loginForm&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;loginRules&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;mobile&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;loginForm.username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;loginForm.password&quot;</span> <span class="attr">show-password</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;isAgree&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-checkbox</span> <span class="attr">v-model</span>=<span class="string">&quot;loginForm.isAgree&quot;</span>&gt;</span></span><br><span class="line">              用户平台使用协议</span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">style</span>=<span class="string">&quot;width:350px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="vuex中的user模块">vuex中的user模块</h5>
<blockquote>
<p>登录流程中最核心的是用户模块，所以这部分我们单独拿出来进行重写。</p>
</blockquote>
<p>代码位置(<strong>src/store/modules/user.js</strong>)</p>
<ul>
<li>删除原有模板中用户模块中的内容</li>
<li>导出Vuex子模块-声明一个状态token</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">   state,</span><br><span class="line">   mutations,</span><br><span class="line">   actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现token的Vue数据持久化</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getToken, setToken, removeToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/auth&#x27;</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="title function_">getToken</span>(), <span class="comment">// 从缓存中读取初始值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">setToken</span>(<span class="params">state, token</span>) &#123;</span><br><span class="line">    state.<span class="property">token</span> = token</span><br><span class="line">    <span class="comment">// 同步到缓存</span></span><br><span class="line">    <span class="title function_">setToken</span>(token)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">removeToken</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="comment">// 删除Vuex的token</span></span><br><span class="line">    state.<span class="property">token</span> = <span class="literal">null</span></span><br><span class="line">    <span class="title function_">removeToken</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>, <span class="comment">// 开启命名空间</span></span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>实现登录的action方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// context上下文，传入参数</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">context, data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="comment">// todo: 调用登录接口</span></span><br><span class="line">    <span class="keyword">const</span> token = <span class="keyword">await</span> <span class="title function_">login</span>(data)</span><br><span class="line">    <span class="comment">// 返回一个token 123456</span></span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&#x27;setToken&#x27;</span>, token)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在登录组件中调用该action方法-代码位置(<strong>src/views/login/index.vue</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">form</span>.<span class="title function_">validate</span>(<span class="function">(<span class="params">isOK</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOK) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;user/login&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意： 因为user模块导出的时候<strong>namespaced为true</strong>，所以我们调用action的时候要加上模块名称如<strong>user/login</strong></p>
<blockquote>
<p>我们完成了Vuex用户模块的创建和持久化管理，现在已经调通了 **登录页面- action，**继续往下需要处理</p>
</blockquote>
<p><strong>请求模块-axios封装-跨域-区分环境</strong></p>
<p><img data-src="image-20240225144010024.png" alt="image-20240225144010024"></p>
<blockquote>
<p>我们要先把跨域问题解决才能考虑其他内容的开发</p>
</blockquote>
<h5 id="vue-cli解决跨域">vue-cli解决跨域</h5>
<p>首先为什么会有跨域？</p>
<ul>
<li>在后端没有开启cors的情况下，浏览器的同源策略会直接限制后端返回的数据给到前端。这是因为我们目前所有的项目都是前后分离，前端一个服务， 后端一个服务，后端不开cors只能前端自己想办法。</li>
</ul>
<p><img data-src="image-20240225144155206.png" alt="image-20240225144155206"></p>
<ul>
<li>代理是怎么解决跨域的？</li>
</ul>
<p><img data-src="image-20240225144224037.png" alt="image-20240225144224037"></p>
<blockquote>
<p>既然前端不能直接请求后端服务，那就搞个中间服务，中间服务刚好和我们的前端服务同源，前端和中间服务可以通信，而中间服务是node, node后台向后端发请求是不受同源策略影响的，因为<strong>同源策略只针对浏览器！！！</strong>， 这样就是代理，中间层的服务将前端的请求代理给了后端接口。</p>
</blockquote>
<ul>
<li>具体实现</li>
</ul>
<blockquote>
<p>跨域有开发环境跨域和生产环境跨域，我们最后上线的时候要考虑生产环境跨域，目前只需要考虑开发环境。</p>
</blockquote>
<ul>
<li>配置文件可以直接配置代理 vue.config.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">	<span class="attr">port</span>: port,</span><br><span class="line">	<span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">overlay</span>: &#123;</span><br><span class="line">  	<span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">  	<span class="attr">errors</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">proxy</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;http://127.0.0.1:8888&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 基础模板做的模拟数据 它会拦截我们的请求导致发不出去</span></span><br><span class="line"><span class="comment">// before: require(&#x27;./mock/mock-server.js&#x27;)</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>注意： 要去掉before这个选项，这个是mock数据，会影响到我们的请求，并且修改完成之后要重启服务。</p>
<h5 id="axios封装">axios封装</h5>
<blockquote>
<p>完成了代理跨域，就可以考虑axios的封装了</p>
</blockquote>
<p><img data-src="image-20240225144853020.png" alt="image-20240225144853020"></p>
<blockquote>
<p>axios封装主要封装做哪些呢？</p>
</blockquote>
<ul>
<li>基础地址，超时时间</li>
<li>请求拦截器-统一注入token</li>
<li>响应拦截器-解构数据-处理异常</li>
</ul>
<p><img data-src="image-20240225144925058.png" alt="image-20240225144925058"></p>
<ul>
<li>axios的基础功能</li>
</ul>
<p><img data-src="image-20240225145010465.png" alt="image-20240225145010465"></p>
<p>代码位置(src/utils/request.js)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MessageBox</span>, <span class="title class_">Message</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// create an axios instance =&gt; 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>, <span class="comment">// url = base url + request url</span></span><br><span class="line">  <span class="comment">// 是否允许携带凭证</span></span><br><span class="line">  <span class="comment">// withCredentials: true, // send cookies when cross-domain requests</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// request timeout</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// request interceptor</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something before request is sent</span></span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">      <span class="comment">// 让每一个请求携带token</span></span><br><span class="line">      <span class="comment">// let each request carry token</span></span><br><span class="line">      <span class="comment">// 自定义token的键</span></span><br><span class="line">      <span class="comment">// [&#x27;Authorization&#x27;] is a custom headers key</span></span><br><span class="line">      <span class="comment">// please modify it according to the actual situation</span></span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`<span class="subst">$&#123;store.getters.token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something with request error</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error) <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// response interceptor</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * If you want to get http information such as headers or status</span></span><br><span class="line"><span class="comment">   * Please return  response =&gt; response</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Determine the request status by custom code</span></span><br><span class="line"><span class="comment">   * Here is just an example</span></span><br><span class="line"><span class="comment">   * You can also judge the status by HTTP Status Code</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;data, meta&#125; = response.<span class="property">data</span></span><br><span class="line">    <span class="keyword">if</span>(data)&#123;</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title class_">Message</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: meta.<span class="property">msg</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">3</span> * <span class="number">1000</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err&#x27;</span> + error) <span class="comment">// for debug</span></span><br><span class="line">    <span class="title class_">Message</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: error.<span class="property">message</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>
<h5 id="环境区分">环境区分</h5>
<p><img data-src="image-20240225145148052.png" alt="image-20240225145148052"></p>
<p><img data-src="image-20240225145224188.png" alt="image-20240225145224188"></p>
<p><img data-src="image-20240225145246168.png" alt="image-20240225145246168"></p>
<p><img data-src="image-20240225145307054.png" alt="image-20240225145307054"></p>
<ul>
<li>将.env.development中的值改为 /api 作为请求工具的基础地址</li>
<li>**process.env.VUE_APP_BASE_API **的表示读取该变量，npm run dev时该变量为 /api,  npm run build:prod时 该变量为 /prod-api</li>
</ul>
<h5 id="登录联调">登录联调</h5>
<blockquote>
<p>目前登录功能只剩下红色的部分</p>
</blockquote>
<p><img data-src="image-20240225145414846.png" alt="image-20240225145414846"></p>
<ul>
<li>首先封装登录的API请求-代码位置(<strong>src/api/user.js</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Vuex中的用户模块调用登录接口-代码位置(<strong>src/store/modules/user.js</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// context上下文，传入参数</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">context, data</span>) &#123;</span><br><span class="line">    <span class="comment">// todo: 调用登录接口</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">login</span>(data)</span><br><span class="line">    <span class="comment">// 返回一个token 123456</span></span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&#x27;setToken&#x27;</span>, data.<span class="property">token</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>登录成功后，跳转到主页-代码位置(<strong>src/views/login/index.vue</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">form</span>.<span class="title function_">validate</span>(<span class="title function_">async</span>(isOK) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOK) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/login&#x27;</span>, <span class="variable language_">this</span>.<span class="property">loginForm</span>)</span><br><span class="line">        <span class="comment">// Vuex 中的action 返回的promise</span></span><br><span class="line">        <span class="comment">// 跳转主页</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>区分不同环境的数据-代码位置(<strong>src/views/login/index.vue</strong>)</li>
</ul>
<blockquote>
<p>因为开发环境为了便利，我们将用户的账户信息和密码都默认写在了页面上，但是真正的项目我们不可能将数据进行暴露出去，所以在生产环境时应该将 用户的手机号和密码抹去</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">loginForm</span>: &#123;</span><br><span class="line">        <span class="attr">username</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span> ? <span class="string">&#x27;admin&#x27;</span> : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">password</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span> ? <span class="string">&#x27;123456&#x27;</span> : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">isAgree</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="主页权限验证">主页权限验证</h5>
<blockquote>
<p>当前项目用户是否有权限访问主页，要考虑当前有没有token,  如果有token, 用户还想去登录页，我们可以直接去主页-这个就是免登录功能。有token的情况下，直接到主页。</p>
</blockquote>
<p><img data-src="image-20240225145729373.png" alt="image-20240225145729373"></p>
<ul>
<li>访问主页-有token放过，没有token跳到登录页</li>
<li>访问登录-有token跳到主页，没有token放过</li>
</ul>
<p>代码实现-代码位置(<strong>src/pemission.js</strong>)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> nprogress <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前置守卫</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/login&#x27;</span>, <span class="string">&#x27;/404&#x27;</span>]</span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  nprogress.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="comment">// 存在token</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 跳转到主页</span></span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/&#x27;</span>) <span class="comment">// 中转到主页</span></span><br><span class="line">      <span class="comment">// next（地址）并没有执行后置守卫</span></span><br><span class="line">      nprogress.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="title function_">next</span>() <span class="comment">// 放行</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">includes</span>(to.<span class="property">path</span>)) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>) <span class="comment">// 中转到登录页</span></span><br><span class="line">      nprogress.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后置守卫</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  nprogress.<span class="title function_">done</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="首页">首页</h4>
<h5 id="获取用户资料在Vuex中共享">获取用户资料在Vuex中共享</h5>
<blockquote>
<p>登录成功跳转到主页之后，可以获取用户资料，获取的资料在Vuex中共享，这样就可以很方便的获取该信息</p>
</blockquote>
<ul>
<li>获取流程</li>
</ul>
<p><img data-src="image-20240227104352167.png" alt="image-20240227104352167"></p>
<ul>
<li>在什么位置获取？</li>
</ul>
<p><img data-src="image-20240227104434746.png" alt="image-20240227104434746"></p>
<blockquote>
<p>之前在导航守卫的位置，可以确定已经有了token，这个位置获取资料更佳，因为导航守卫在页面发生跳转时出发，这时不论你从何时何地进来，如果发现你没获取资料，都可以非常清楚直观的获取资料。判断条件也使得不会发生重复的加载。</p>
</blockquote>
<ul>
<li>
<p>封装获取用户资料的API-代码位置(<strong>src/api/user.js</strong>)，因为接口问题，有两种方式</p>
<ul>
<li>方式一：前端在登录时保存用户id，请求时携带</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="title function_">getToken</span>(), <span class="comment">// 从缓存中读取初始值</span></span><br><span class="line">  <span class="attr">userId</span>: <span class="literal">null</span>, <span class="comment">// 保存用户id</span></span><br><span class="line">  <span class="attr">userInfo</span>: &#123;&#125; <span class="comment">// 保存用户信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/users/profile&#x27;</span>+ id</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二：修改后端新增一个接口</li>
</ul>
<p>修改<code>modules/passport.js</code>，添加全局属性userInfo</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// token 验证策略</span></span><br><span class="line">passport.<span class="title function_">use</span>(<span class="keyword">new</span> <span class="title class_">Strategy</span>(</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">token, done</span>) &#123;</span><br><span class="line">        jwt.<span class="title function_">verify</span>(token, jwt_config.<span class="title function_">get</span>(<span class="string">&quot;secretKey&quot;</span>), <span class="keyword">function</span> (<span class="params">err, decode</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> <span class="title function_">done</span>(<span class="string">&quot;验证错误&quot;</span>); &#125;</span><br><span class="line">            <span class="comment">// 将用户信息保存到全局对象</span></span><br><span class="line">            <span class="variable language_">global</span>.<span class="property">userInfo</span> = decode</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, decode);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>新增接口</p>
<p>修改<code>routes/api/private/v1/users.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/profile&#x27;</span>, <span class="comment">// 参数验证</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    mgrServ.<span class="title function_">getManager</span>(<span class="variable language_">global</span>.<span class="property">userInfo</span>.<span class="property">uid</span>, <span class="keyword">function</span> (<span class="params">err, manager</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">sendResult</span>(<span class="literal">null</span>, <span class="number">400</span>, err);</span><br><span class="line">        res.<span class="title function_">sendResult</span>(manager, <span class="number">200</span>, <span class="string">&quot;获取成功&quot;</span>);</span><br><span class="line">    &#125;)(req, res, next);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>前端请求无需id</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息 api/users</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/private/v1/users/profile&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户信息 vuex-actions</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; commit &#125;</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">	<span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Vuex中声明用户信息状态，修改用户信息的mutations， 和获取用户信息的action-代码位置(<strong>src/store/modules/user.js</strong>)</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="title function_">getToken</span>(),</span><br><span class="line">  <span class="attr">userInfo</span>: &#123;&#125; <span class="comment">// 这里有一个空对象，为了放置后面取数据报错</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="title function_">setUserInfo</span>(<span class="params">state, userInfo</span>) &#123;</span><br><span class="line">    state.<span class="property">userInfo</span> = userInfo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="keyword">async</span> getUserInfo (context) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&quot;setUserInfo&quot;</span>, result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过getters声明userId(快捷访问)-代码位置(<strong>src/store/getters.js</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">userId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">userId</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>
<ul>
<li>在权限拦截处调用action-代码位置(<strong>src/pemission.js</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> nprogress <span class="keyword">from</span> <span class="string">&#x27;nprogress&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;nprogress/nprogress.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/login&#x27;</span>, <span class="string">&#x27;/404&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前置守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  nprogress.<span class="title function_">start</span>()</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="comment">// 存在token</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 跳转到主页</span></span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/&#x27;</span>) <span class="comment">// 中转到主页</span></span><br><span class="line">      <span class="comment">// next（地址）并没有执行后置守卫</span></span><br><span class="line">      nprogress.<span class="title function_">done</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">// 判断是否获取过资料</span></span><br><span class="line">       <span class="keyword">if</span>(!store.<span class="property">getters</span>.<span class="property">userId</span>) &#123;</span><br><span class="line">         <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&quot;user/getUserInfo&quot;</span>)</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="title function_">next</span>() <span class="comment">// 放行</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 没有token</span></span><br><span class="line">    <span class="keyword">if</span> (whiteList.<span class="title function_">includes</span>(to.<span class="property">path</span>)) &#123;</span><br><span class="line">      <span class="title function_">next</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>) <span class="comment">// 中转到登录页</span></span><br><span class="line">      nprogress.<span class="title function_">done</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>有同学会问，为什么用户信息不做持久化管理呢？ 不需要缓存吗？ 用户信息不同于token，token是当前用户的唯一标识，在几个小时内都是有效的，但是用户信息可能会进行修改或者发生变化，所以用户信息在一般的项目或者业务中不进行缓存。</p>
</blockquote>
<h5 id="显示用户头像和用户名">显示用户头像和用户名</h5>
<p><img data-src="image-20240227104925511.png" alt="image-20240227104925511"></p>
<blockquote>
<p>首先解析一下顶部组件的内部位置</p>
</blockquote>
<p><img data-src="image-20240227104956318.png" alt="image-20240227104956318"></p>
<blockquote>
<p>因为上个小节，将资料已经放到了Vuex中，可以通过getters开放属性，直接在组件中引用即可</p>
</blockquote>
<p>由于在返回的接口中并没有avatar属性，我们需要做以下修改</p>
<p>更新数据库表格，新增字段及数据</p>
<blockquote>
<p>头像地址：<a href="https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif">https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif</a></p>
</blockquote>
<p><img data-src="image-20240227162756864.png" alt="image-20240227162756864"></p>
<p>更新后端数据模型（models/ManagerModels.js）</p>
<p><img data-src="image-20240227162909348.png" alt="image-20240227162909348"></p>
<p>更新后端接口返回数据（services/ManagerService）</p>
<p><img data-src="image-20240227163020453.png" alt="image-20240227163020453"></p>
<p><img data-src="image-20240227163046690.png" alt="image-20240227163046690"></p>
<ul>
<li>Vuex中使用getters暴露属性-代码位置(<strong>src/store/getters.js</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">token</span>,</span><br><span class="line">  <span class="attr">userId</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">userId</span>,</span><br><span class="line">  <span class="attr">avatar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">avatar</span>, <span class="comment">// 头像</span></span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>.<span class="property">username</span>, <span class="comment">// 用户名称</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters</span><br></pre></td></tr></table></figure>
<ul>
<li>在Navbar组件引入getters-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 引入头像和用户名称</span><br><span class="line">    ...mapGetters([</span><br><span class="line">      &#x27;sidebar&#x27;,</span><br><span class="line">      &#x27;avatar&#x27;,</span><br><span class="line">      &#x27;name&#x27;</span><br><span class="line">    ])</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>NavBar组件显示用户名和头像-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;avatar-wrapper&quot;&gt;</span><br><span class="line">      &lt;!-- 头像 --&gt;</span><br><span class="line">      &lt;img :src=&quot;avatar&quot; class=&quot;user-avatar&quot;&gt;</span><br><span class="line">      &lt;!-- 用户名称 --&gt;</span><br><span class="line">      &lt;span class=&quot;name&quot;&gt;&#123;&#123; name &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;!-- 图标 --&gt;</span><br><span class="line">      &lt;i class=&quot;el-icon-setting&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置头像和用户名的样式-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.avatar-wrapper</span> &#123;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line"><span class="attribute">position</span>: relative;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line"><span class="attribute">align-items</span>: center;</span><br><span class="line"><span class="selector-class">.name</span> &#123;</span><br><span class="line">  //  用户名称距离右侧距离</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-icon-setting</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.user-avatar</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="处理头像为空的场景">处理头像为空的场景</h5>
<blockquote>
<p>不是所有用户都有头像的，当用户没有头像时要显示对应的内容</p>
</blockquote>
<p><img data-src="image-20240227105144333.png" alt="image-20240227105144333"></p>
<ul>
<li>条件判断-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;avatar-wrapper&quot;&gt;</span><br><span class="line">      &lt;!-- 头像 --&gt;</span><br><span class="line">      &lt;img v-if=&quot;avatar&quot; :src=&quot;avatar&quot; class=&quot;user-avatar&quot;&gt;</span><br><span class="line">      &lt;span v-else class=&quot;username&quot;&gt;&#123;&#123; name?.charAt(0) &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;!-- 用户名称 --&gt;</span><br><span class="line">      &lt;span class=&quot;name&quot;&gt;&#123;&#123; name &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;!-- 图标 --&gt;</span><br><span class="line">      &lt;i class=&quot;el-icon-setting&quot; /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>样式</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.username</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#04c9be</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里我们使用了可选链操作符 ？， 它的意思是当？前面的变量为空时，它不会继续往下执行，防止报错，如<br>
null?.name，但是我们当前的版本不支持？的编译，所以需要升级一下对应的版本</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i vue@2.7.0  vue-template-compiler@2.7.0   <span class="comment"># 升级vue版本️</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>升级完成后，重启服务就可以了。</p>
</blockquote>
<h5 id="token过期处理">token过期处理</h5>
<blockquote>
<p>token是有时效性的，当token超时，我们需要做一下处理</p>
</blockquote>
<p><img data-src="image-20240225204738769.png" alt="image-20240225204738769"></p>
<ul>
<li>请求拦截器处理-代码位置(<strong>src/utils/request.js</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(..., <span class="title function_">async</span>(error) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="property">response</span>.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">    <span class="title class_">Message</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;token超时了&#x27;</span> &#125;)</span><br><span class="line">    <span class="comment">// 说明token超时了</span></span><br><span class="line">    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>) <span class="comment">// 调用action 退出登录</span></span><br><span class="line">    <span class="comment">//  主动跳到登录页</span></span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>) <span class="comment">// 跳转到登录页</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// error.message</span></span><br><span class="line">  <span class="title class_">Message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>实现Vuex的登出action-代码位置(<strong>src/store/modules/user.js</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// 退出登录的action</span></span><br><span class="line">  <span class="title function_">logout</span>(<span class="params">context</span>) &#123;</span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&#x27;removeToken&#x27;</span>) <span class="comment">// 删除token</span></span><br><span class="line">    context.<span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, &#123;&#125;) <span class="comment">// 设置用户信息为空对象</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>修改后端文件passport.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">tokenAuth</span> = <span class="keyword">function</span>(<span class="params">req,res,next</span>) &#123;</span><br><span class="line">passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;bearer&#x27;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;,<span class="keyword">function</span>(<span class="params">err,tokenData</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">sendResult</span>(<span class="literal">null</span>,<span class="number">401</span>,<span class="string">&#x27;无效token&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!tokenData) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">sendResult</span>(<span class="literal">null</span>,<span class="number">401</span>,<span class="string">&#x27;无效token&#x27;</span>);</span><br><span class="line">    req.<span class="property">userInfo</span> = &#123;&#125;;</span><br><span class="line">    req.<span class="property">userInfo</span>.<span class="property">uid</span> = tokenData[<span class="string">&quot;uid&quot;</span>];</span><br><span class="line">    req.<span class="property">userInfo</span>.<span class="property">rid</span> = tokenData[<span class="string">&quot;rid&quot;</span>];</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;)(req, res, next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>拓展：<a href="https://blog.csdn.net/weixin_42960907/article/details/125503058">无感知刷新token</a></p>
<h5 id="调整下拉菜单，实现退出登录">调整下拉菜单，实现退出登录</h5>
<p><img data-src="image-20240227105327717.png" alt="image-20240227105327717"></p>
<blockquote>
<p>退出登录流程</p>
</blockquote>
<p><img data-src="image-20240227105351379.png" alt="image-20240227105351379"></p>
<ul>
<li>Navbar中点击退出登录-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dropdown-item @click.native=&quot;logout&quot;&gt;</span><br><span class="line">     &lt;span style=&quot;display:block;&quot;&gt;登出&lt;/span&gt;</span><br><span class="line">&lt;/el-dropdown-item&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>退出方法-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>  &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">     <span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 调用退出登录的action</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：native修饰符表示给组件的根元素注册事件️</p>
<h5 id="实现修改密码">实现修改密码</h5>
<h6 id="后端接口">后端接口</h6>
<ul>
<li>新增路由（routes/api/private/v1/user.js）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改用户密码</span></span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/updatepwd&quot;</span>,</span><br><span class="line"><span class="comment">// 处理业务逻辑</span></span><br><span class="line"><span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    mgrServ.<span class="title function_">updatePwd</span>(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">function</span> (<span class="params">err, manager</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">sendResult</span>(<span class="literal">null</span>, <span class="number">400</span>, err);</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                <span class="attr">data</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>&#125;,</span><br><span class="line">                <span class="attr">meta</span>: &#123;</span><br><span class="line">                    <span class="attr">status</span>: <span class="number">200</span>,</span><br><span class="line">                    <span class="attr">msg</span>: <span class="string">&#x27;更新成功&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    )(req, res, next);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>新增服务层</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 修改密码</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">updatePwd</span> = <span class="keyword">function</span> (<span class="params">params, cb</span>) &#123;</span><br><span class="line">managersDAO.<span class="title function_">update</span>(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;mg_id&quot;</span>: <span class="variable language_">global</span>.<span class="property">userInfo</span>.<span class="property">uid</span>,</span><br><span class="line">        <span class="string">&quot;mg_pwd&quot;</span>: <span class="title class_">Password</span>.<span class="title function_">hash</span>(params.<span class="property">password</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">err, manager</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">cb</span>(err);</span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>前端整体流程</li>
</ul>
<p><img data-src="image-20240227193425072.png" alt="image-20240227193425072"></p>
<p><img data-src="image-20240227193449128.png" alt="image-20240227193449128"></p>
<h6 id="修改密码弹出层">修改密码弹出层</h6>
<ul>
<li>注册修改密码点击事件-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- prevent阻止默认事件 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;updatePassword&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dropdown-item</span>&gt;</span>修改密码<span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>声明变量和方法控制弹层显示-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>  &#123;</span><br><span class="line">      <span class="attr">showDialog</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">updatePassword</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>放置弹层组件-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog width=&quot;500px&quot; title=&quot;修改密码&quot; :visible.sync=&quot;showDialog&quot; &gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>
<h6 id="修改密码-表单结构">修改密码-表单结构</h6>
<ul>
<li>表单结构-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span>  <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;旧密码&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span>  <span class="attr">show-password</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;新密码&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span>  <span class="attr">show-password</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;重复密码&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span>  <span class="attr">show-password</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> &gt;</span>确认修改<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> &gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="修改密码-表单校验">修改密码-表单校验</h6>
<p><img data-src="image-20240227193811170.png" alt="image-20240227193811170"></p>
<ul>
<li>声明数据和规则-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span>  &#123;</span><br><span class="line">     <span class="attr">passForm</span>: &#123;</span><br><span class="line">        <span class="attr">oldPassword</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 旧密码</span></span><br><span class="line">        <span class="attr">newPassword</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 新密码</span></span><br><span class="line">        <span class="attr">confirmPassword</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">// 确认密码字段</span></span><br><span class="line">      &#125;,</span><br><span class="line">     <span class="attr">rules</span>: &#123;</span><br><span class="line">        <span class="attr">oldPassword</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;旧密码不能为空&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;], <span class="comment">// 旧密码</span></span><br><span class="line">        <span class="attr">newPassword</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;新密码不能为空&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;, &#123;</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>,</span><br><span class="line">          <span class="attr">min</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">max</span>: <span class="number">16</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;新密码的长度为6-16位之间&#x27;</span></span><br><span class="line">        &#125;], <span class="comment">// 新密码</span></span><br><span class="line">        <span class="attr">confirmPassword</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;重复密码不能为空&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;, &#123;</span><br><span class="line">          <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>,</span><br><span class="line">          <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// value</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">passForm</span>.<span class="property">newPassword</span> === value) &#123;</span><br><span class="line">              <span class="title function_">callback</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;重复密码和新密码输入不一致&#x27;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;] <span class="comment">// 确认密码字段</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>绑定属性-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-form ref=&quot;passForm&quot; label-width=&quot;120px&quot; :model=&quot;passForm&quot; :rules=&quot;rules&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;旧密码&quot; prop=&quot;oldPassword&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;passForm.oldPassword&quot; show-password size=&quot;small&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;新密码&quot; prop=&quot;newPassword&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;passForm.newPassword&quot; show-password size=&quot;small&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;重复密码&quot; prop=&quot;confirmPassword&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;passForm.confirmPassword&quot; show-password size=&quot;small&quot; /&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item&gt;</span><br><span class="line">      &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot; &gt;确认修改&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button size=&quot;mini&quot; &gt;取消&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br></pre></td></tr></table></figure>
<h6 id="修改密码-确定和取消">修改密码-确定和取消</h6>
<ul>
<li>确定和取消流程</li>
</ul>
<p><img data-src="image-20240227193936210.png" alt="image-20240227193936210"></p>
<ul>
<li>封装修改密码方法-代码位置(<strong>src/api/user.js</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新密码</span></span><br><span class="line"><span class="comment"> * **/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updatePassword</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/user/updatePass&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>确定方法-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 确定</span></span><br><span class="line"><span class="title function_">btnOK</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">passForm</span>.<span class="title function_">validate</span>(<span class="keyword">async</span> isOK =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (isOK) &#123;</span><br><span class="line">      <span class="comment">// 调用接口</span></span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updatePassword</span>(<span class="variable language_">this</span>.<span class="property">passForm</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;修改密码成功&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">btnCancel</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ul>
<li>取消方法-代码位置(<strong>src/layout/components/NavBar.vue</strong>)</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">btnCancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">passForm</span>.<span class="title function_">resetFields</span>() <span class="comment">// 重置表单</span></span><br><span class="line">  <span class="comment">// 关闭弹层</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">showDialog</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>监听弹层关闭事件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;el-dialog @close=&quot;btnCancel&quot; width=&quot;500px&quot; title=&quot;修改密码&quot; :visible.sync=&quot;showDialog&quot; &gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://blog.csdn.net/qq_39075021/article/details/106826208">.sync修饰符</a></p>
<p>有同学有疑惑，不是用了.sync修饰符吗？可以直接关闭弹层，为何还要监听close事件，这是因为sync修饰符只能关闭弹层，我们还需要将表单进行重置，因为你之前打开弹层可能修改了一半或者残留一些校验信息，再打开的时候这些信息应该都被重置，所以这里用监听事件的方式再重置一下表单，保证功能的体验和完整性。</p>
</blockquote>
<h5 id="清理组件和路由">清理组件和路由</h5>
<blockquote>
<p>主页功能开发完了，我们要清理一下模板中残余文件</p>
</blockquote>
<p><img data-src="image-20240227105600705.png" alt="image-20240227105600705"></p>
<ul>
<li>路由只保留登录-主页-404</li>
<li>请求模块只保留user.js模块</li>
</ul>
<h5 id="创建项目所需要的组件和路由">创建项目所需要的组件和路由</h5>
<p>├── users            # 用户管理<br>
├── rights          # 权限管理<br>
├── goods          # 商品管理<br>
├── orders            # 订单管理<br>
├── reports          # 数据统计</p>
<ul>
<li>创建模块</li>
</ul>
<p><img data-src="image-20240228191559979.png" alt="image-20240228191559979"></p>
<ul>
<li>组件结构样例</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;users&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>路由模块样例</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/layout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/rights&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">  <span class="attr">alwaysShow</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;rights&#x27;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;权限管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;eye-open&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>, <span class="comment">// 二级路由地址为空时 表示/users显示一级路由 + 二级路由</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;rightlist&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/rights&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;权限列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;manage&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;manage&#x27;</span>, <span class="comment">// 可以用来跳转 || 标记路由</span></span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/rights/manage&#x27;</span>),</span><br><span class="line">      <span class="comment">// 路由元信息 存储数据的</span></span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;权限管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;eye-open&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>路由的统一导入</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">工作量比较大</span><br></pre></td></tr></table></figure>
<ul>
<li>在src/router/index.js中集成到当前路由中</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">回头再写</span><br></pre></td></tr></table></figure>
<h5 id="扩展-解析左侧菜单原理">扩展-解析左侧菜单原理</h5>
<p><img data-src="image-20240227110529489.png" alt="image-20240227110529489"></p>
<blockquote>
<p>左侧菜单的数据来源于路由模块的信息， 会根据路由信息的hidden属性来判断是否显示该路由信息到菜单<br>
菜单属性中的图表和标题来源于路由meta中的icon和title属性</p>
</blockquote>
<ul>
<li>分析过程</li>
</ul>
<p>sidebar组件引入路由信息</p>
<p><img data-src="image-20240227110615545.png" alt="image-20240227110615545"></p>
<p>循环渲染路由信息</p>
<p><img data-src="image-20240227110640736.png" alt="image-20240227110640736"></p>
<p>sidebarItem组件根据条件渲染-传递icon和title属性给item组件</p>
<p><img data-src="image-20240227110703764.png" alt="image-20240227110703764"></p>
<p>item组件接收icon和title属性，使用函数型组件完成渲染</p>
<p><img data-src="image-20240227110731038.png" alt="image-20240227110731038"></p>
<h5 id="拓展-动态路由">拓展-<a href="https://blog.csdn.net/m0_59006402/article/details/128753828">动态路由</a></h5>
<h4 id="其它">其它</h4>
<h5 id="PDF">PDF</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">安装: npm install vue-pdf</span><br><span class="line"></span><br><span class="line">导入: <span class="keyword">import</span> pdf <span class="keyword">from</span> <span class="string">&#x27;vue-pdf&#x27;</span></span><br><span class="line"></span><br><span class="line">使用: <span class="language-xml"><span class="tag">&lt;<span class="name">pdf</span> <span class="attr">src</span>=<span class="string">&#x27;public/pdf地址&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">pdf</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 注册</span></span><br><span class="line">  <span class="attr">components</span>: &#123; pdf &#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">乱码问题解决: <span class="attr">https</span>:<span class="comment">//github.com/FranckFreiburger/vue-pdf/pull/130/commits/253f6186ff0676abf9277786087dda8d95dd8ea7</span></span><br></pre></td></tr></table></figure>
<h5 id="i18n">i18n</h5>
<ul>
<li>
<p>安装依赖：<code>npm i vue-i18n@7.3.2</code></p>
</li>
<li>
<p>定义语言包：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/lang/zh.js</span></span><br><span class="line"><span class="comment">// 例如:</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">route</span>: &#123;</span><br><span class="line">    <span class="attr">dashboard</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">  	<span class="attr">users</span>: <span class="string">&#x27;用户管理&#x27;</span>,</span><br><span class="line">  	<span class="attr">rights</span>: <span class="string">&#x27;权限管理&#x27;</span>,</span><br><span class="line">  	<span class="attr">goods</span>: <span class="string">&#x27;商品管理&#x27;</span>,</span><br><span class="line">  	<span class="attr">orders</span>: <span class="string">&#x27;订单管理&#x27;</span>,</span><br><span class="line">  	<span class="attr">reports</span>: <span class="string">&#x27;数据统计&#x27;</span>,</span><br><span class="line">  	<span class="attr">userlist</span>: <span class="string">&#x27;用户列表&#x27;</span>,</span><br><span class="line">  	<span class="attr">goodslist</span>: <span class="string">&#x27;商品列表&#x27;</span>,</span><br><span class="line">  	<span class="attr">goodscategory</span>: <span class="string">&#x27;商品分类&#x27;</span>,</span><br><span class="line"> 	<span class="attr">goodsparams</span>: <span class="string">&#x27;商品参数&#x27;</span>,</span><br><span class="line">  	<span class="attr">orderlist</span>: <span class="string">&#x27;订单列表&#x27;</span>,</span><br><span class="line">  	<span class="attr">rightlist</span>: <span class="string">&#x27;权限列表&#x27;</span>,</span><br><span class="line">  	<span class="attr">manage</span>: <span class="string">&#x27;权限管理&#x27;</span>,</span><br><span class="line">  	<span class="attr">reportlist</span>: <span class="string">&#x27;数据统计&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">navbar</span>: &#123;</span><br><span class="line">	...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/lang/en.js</span></span><br><span class="line"><span class="comment">// 例如:</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">route</span>: &#123;</span><br><span class="line">    <span class="attr">dashboard</span>: <span class="string">&#x27;dashboard&#x27;</span>,</span><br><span class="line">  	<span class="attr">users</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">  	<span class="attr">rights</span>: <span class="string">&#x27;rights&#x27;</span>,</span><br><span class="line">  	<span class="attr">goods</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">  	<span class="attr">orders</span>: <span class="string">&#x27;orders&#x27;</span>,</span><br><span class="line">  	<span class="attr">reports</span>: <span class="string">&#x27;reports&#x27;</span>,</span><br><span class="line">  	<span class="attr">userlist</span>: <span class="string">&#x27;userlist&#x27;</span>,</span><br><span class="line">  	<span class="attr">goodslist</span>: <span class="string">&#x27;goodslist&#x27;</span>,</span><br><span class="line">  	<span class="attr">goodscategory</span>: <span class="string">&#x27;goodscategory&#x27;</span>,</span><br><span class="line">  	<span class="attr">goodsparams</span>: <span class="string">&#x27;goodsparams&#x27;</span>,</span><br><span class="line">  	<span class="attr">orderlist</span>: <span class="string">&#x27;orderlist&#x27;</span>,</span><br><span class="line">  	<span class="attr">rightlist</span>: <span class="string">&#x27;rightlist&#x27;</span>,</span><br><span class="line">  	<span class="attr">manage</span>: <span class="string">&#x27;manage&#x27;</span>,</span><br><span class="line">  	<span class="attr">reportlist</span>: <span class="string">&#x27;reportlist&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">navbar</span>: &#123;</span><br><span class="line">	...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>新建文件：src/lang/index.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueI18</span>n <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Cookies</span> <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"><span class="keyword">import</span> elementEnLocale <span class="keyword">from</span> <span class="string">&#x27;element-ui/lib/locale/lang/en&#x27;</span> <span class="comment">// element-ui lang</span></span><br><span class="line"><span class="keyword">import</span> elementZhLocale <span class="keyword">from</span> <span class="string">&#x27;element-ui/lib/locale/lang/zh-CN&#x27;</span><span class="comment">// element-ui lang</span></span><br><span class="line"><span class="keyword">import</span> enLocale <span class="keyword">from</span> <span class="string">&#x27;./en&#x27;</span></span><br><span class="line"><span class="keyword">import</span> zhLocale <span class="keyword">from</span> <span class="string">&#x27;./zh&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueI18</span>n)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合语言包对象</span></span><br><span class="line"><span class="keyword">const</span> messages = &#123;</span><br><span class="line">  <span class="attr">en</span>: &#123;</span><br><span class="line">    ...enLocale,</span><br><span class="line">    ...elementEnLocale</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">zh</span>: &#123;</span><br><span class="line">    ...zhLocale,</span><br><span class="line">    ...elementZhLocale</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getLanguage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> chooseLanguage = <span class="title class_">Cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (chooseLanguage) <span class="keyword">return</span> chooseLanguage</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if has not choose language</span></span><br><span class="line">  <span class="keyword">const</span> language = (navigator.<span class="property">language</span> || navigator.<span class="property">browserLanguage</span>).<span class="title function_">toLowerCase</span>()</span><br><span class="line">  <span class="keyword">const</span> locales = <span class="title class_">Object</span>.<span class="title function_">keys</span>(messages)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> locale <span class="keyword">of</span> locales) &#123;</span><br><span class="line">    <span class="keyword">if</span> (language.<span class="title function_">indexOf</span>(locale) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> locale</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;en&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> i18n = <span class="keyword">new</span> <span class="title class_">VueI18</span>n(&#123;</span><br><span class="line">  <span class="comment">// set locale</span></span><br><span class="line">  <span class="comment">// options: en | zh</span></span><br><span class="line">  <span class="attr">locale</span>: <span class="title function_">getLanguage</span>(),</span><br><span class="line">  <span class="comment">// set locale messages</span></span><br><span class="line">  messages</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> i18n</span><br></pre></td></tr></table></figure>
<ul>
<li>main.js引入注册i18n</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">&#x27;./lang&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Element</span>, &#123;</span><br><span class="line">  <span class="attr">i18n</span>: <span class="function">(<span class="params">key, value</span>) =&gt;</span> i18n.<span class="title function_">t</span>(key, value)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  i18n,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>组件内使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sidebarItem.vue</span></span><br><span class="line">&lt;!-- 显示一个元素的情况 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">item</span> <span class="attr">:title</span>=<span class="string">&quot;$i18n.t(onlyOneChild.name)&quot;</span> /&gt;</span></span></span><br><span class="line">    </span><br><span class="line">&lt;!-- 有子元素的情况 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">item</span> <span class="attr">:title</span>=<span class="string">&quot;$i18n.t(item.name)&quot;</span> /&gt;</span></span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// Breadcrumb/index.vue</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-else</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;handleLink(item)&quot;</span>&gt;</span>&#123;&#123; $i18n.t(item.name) &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 记得添加name属性</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDashboard</span>(first)) &#123;</span><br><span class="line"> matched = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>, <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">$i18n</span>.<span class="title function_">t</span>(<span class="string">`dashboard`</span>) &#125;, <span class="attr">name</span>: <span class="string">&#x27;dashboard&#x27;</span>&#125;].<span class="title function_">concat</span>(matched)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>切换语言</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-radio-group v-model=<span class="string">&quot;lang&quot;</span> size=<span class="string">&quot;small&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;zh&quot;</span> <span class="attr">border</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    简体中文</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">el-radio</span> <span class="attr">label</span>=<span class="string">&quot;en&quot;</span> <span class="attr">border</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    English</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">el-radio</span>&gt;</span></span></span><br><span class="line">&lt;/el-radio-group&gt;</span><br><span class="line"></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="attr">lang</span>: &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">app</span>.<span class="property">language</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">lang</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$i18n</span>.<span class="property">locale</span> = lang</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;app/setLanguage&#x27;</span>, lang)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>保存到vuex</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Cookies</span> <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getLanguage &#125; <span class="keyword">from</span> <span class="string">&#x27;@/lang/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">language</span>: <span class="title function_">getLanguage</span>(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    <span class="attr">SET_LANGUAGE</span>: <span class="function">(<span class="params">state, language</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">language</span> = language</span><br><span class="line">    <span class="title class_">Cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;language&#x27;</span>, language)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Excel导出">Excel导出</h5>
<ul>
<li><code>npm i file-saver</code></li>
<li><code>npm i xlsx</code></li>
<li><code>npm i script-loader -D</code></li>
<li>新建目录：src/excel</li>
<li>新建文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="comment">/* Blob.js*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*global self, unescape */</span></span><br><span class="line"><span class="comment">/*jslint bitwise: true, regexp: true, confusion: true, es5: true, vars: true, white: true,</span></span><br><span class="line"><span class="comment">  plusplus: true */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params">view</span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">  view.<span class="property">URL</span> = view.<span class="property">URL</span> || view.<span class="property">webkitURL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (view.<span class="property">Blob</span> &amp;&amp; view.<span class="property">URL</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Blob</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Internally we use a BlobBuilder implementation to base Blob off of</span></span><br><span class="line">  <span class="comment">// in order to support older browsers that only have BlobBuilder</span></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">BlobBuilder</span> = view.<span class="property">BlobBuilder</span> || view.<span class="property">WebKitBlobBuilder</span> || view.<span class="property">MozBlobBuilder</span> || (<span class="keyword">function</span> (<span class="params">view</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">      get_class = <span class="keyword">function</span> (<span class="params">object</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(object).<span class="title function_">match</span>(<span class="regexp">/^\[object\s(.*)\]$/</span>)[<span class="number">1</span>];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title class_">FakeBlobBuilder</span> = <span class="keyword">function</span> <span class="title function_">BlobBuilder</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span> = [];</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title class_">FakeBlob</span> = <span class="keyword">function</span> <span class="title function_">Blob</span>(<span class="params">data, type, encoding</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span> = data;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = data.<span class="property">length</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">encoding</span> = encoding;</span><br><span class="line">      &#125;,</span><br><span class="line">      FBB_proto = <span class="title class_">FakeBlobBuilder</span>.<span class="property"><span class="keyword">prototype</span></span>,</span><br><span class="line">      FB_proto = <span class="title class_">FakeBlob</span>.<span class="property"><span class="keyword">prototype</span></span>,</span><br><span class="line">      <span class="title class_">FileReaderSync</span> = view.<span class="property">FileReaderSync</span>,</span><br><span class="line">      <span class="title class_">FileException</span> = <span class="keyword">function</span> (<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">code</span> = <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">name</span> = type];</span><br><span class="line">      &#125;,</span><br><span class="line">      file_ex_codes = (</span><br><span class="line">        <span class="string">&quot;NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR &quot;</span> +</span><br><span class="line">        <span class="string">&quot;NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR&quot;</span></span><br><span class="line">      ).<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>),</span><br><span class="line">      file_ex_code = file_ex_codes.<span class="property">length</span>,</span><br><span class="line">      real_URL = view.<span class="property">URL</span> || view.<span class="property">webkitURL</span> || view,</span><br><span class="line">      real_create_object_URL = real_URL.<span class="property">createObjectURL</span>,</span><br><span class="line">      real_revoke_object_URL = real_URL.<span class="property">revokeObjectURL</span>,</span><br><span class="line">      <span class="variable constant_">URL</span> = real_URL,</span><br><span class="line">      btoa = view.<span class="property">btoa</span>,</span><br><span class="line">      atob = view.<span class="property">atob</span></span><br><span class="line"></span><br><span class="line">      ,</span><br><span class="line">      <span class="title class_">ArrayBuffer</span> = view.<span class="property">ArrayBuffer</span>,</span><br><span class="line">      <span class="title class_">Uint8Array</span> = view.<span class="property">Uint8Array</span></span><br><span class="line"></span><br><span class="line">      ,</span><br><span class="line">      origin = <span class="regexp">/^[\w-]+:\/*\[?[\w\.:-]+\]?(?::[0-9]+)?/</span>;</span><br><span class="line">    <span class="title class_">FakeBlob</span>.<span class="property">fake</span> = FB_proto.<span class="property">fake</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> (file_ex_code--) &#123;</span><br><span class="line">      <span class="title class_">FileException</span>.<span class="property"><span class="keyword">prototype</span></span>[file_ex_codes[file_ex_code]] = file_ex_code + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Polyfill URL</span></span><br><span class="line">    <span class="keyword">if</span> (!real_URL.<span class="property">createObjectURL</span>) &#123;</span><br><span class="line">      <span class="variable constant_">URL</span> = view.<span class="property">URL</span> = <span class="keyword">function</span> (<span class="params">uri</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span></span><br><span class="line">          uri_info = <span class="variable language_">document</span>.<span class="title function_">createElementNS</span>(<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>, <span class="string">&quot;a&quot;</span>),</span><br><span class="line">          uri_origin;</span><br><span class="line">        uri_info.<span class="property">href</span> = uri;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">&quot;origin&quot;</span> <span class="keyword">in</span> uri_info)) &#123;</span><br><span class="line">          <span class="keyword">if</span> (uri_info.<span class="property">protocol</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&quot;data:&quot;</span>) &#123;</span><br><span class="line">            uri_info.<span class="property">origin</span> = <span class="literal">null</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            uri_origin = uri.<span class="title function_">match</span>(origin);</span><br><span class="line">            uri_info.<span class="property">origin</span> = uri_origin &amp;&amp; uri_origin[<span class="number">1</span>];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uri_info;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">createObjectURL</span> = <span class="keyword">function</span> (<span class="params">blob</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span></span><br><span class="line">        type = blob.<span class="property">type</span>,</span><br><span class="line">        data_URI_header;</span><br><span class="line">      <span class="keyword">if</span> (type === <span class="literal">null</span>) &#123;</span><br><span class="line">        type = <span class="string">&quot;application/octet-stream&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blob <span class="keyword">instanceof</span> <span class="title class_">FakeBlob</span>) &#123;</span><br><span class="line">        data_URI_header = <span class="string">&quot;data:&quot;</span> + type;</span><br><span class="line">        <span class="keyword">if</span> (blob.<span class="property">encoding</span> === <span class="string">&quot;base64&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data_URI_header + <span class="string">&quot;;base64,&quot;</span> + blob.<span class="property">data</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (blob.<span class="property">encoding</span> === <span class="string">&quot;URI&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data_URI_header + <span class="string">&quot;,&quot;</span> + <span class="built_in">decodeURIComponent</span>(blob.<span class="property">data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (btoa) &#123;</span><br><span class="line">          <span class="keyword">return</span> data_URI_header + <span class="string">&quot;;base64,&quot;</span> + <span class="title function_">btoa</span>(blob.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> data_URI_header + <span class="string">&quot;,&quot;</span> + <span class="built_in">encodeURIComponent</span>(blob.<span class="property">data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (real_create_object_URL) &#123;</span><br><span class="line">        <span class="keyword">return</span> real_create_object_URL.<span class="title function_">call</span>(real_URL, blob);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">revokeObjectURL</span> = <span class="keyword">function</span> (<span class="params">object_URL</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (object_URL.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">5</span>) !== <span class="string">&quot;data:&quot;</span> &amp;&amp; real_revoke_object_URL) &#123;</span><br><span class="line">        real_revoke_object_URL.<span class="title function_">call</span>(real_URL, object_URL);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    FBB_proto.<span class="property">append</span> = <span class="keyword">function</span> (<span class="params">data <span class="comment">/*, endings*/</span> </span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> bb = <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">      <span class="comment">// decode data to a binary string</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Uint8Array</span> &amp;&amp; (data <span class="keyword">instanceof</span> <span class="title class_">ArrayBuffer</span> || data <span class="keyword">instanceof</span> <span class="title class_">Uint8Array</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span></span><br><span class="line">          str = <span class="string">&quot;&quot;</span>,</span><br><span class="line">          buf = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data),</span><br><span class="line">          i = <span class="number">0</span>,</span><br><span class="line">          buf_len = buf.<span class="property">length</span>;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; buf_len; i++) &#123;</span><br><span class="line">          str += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(buf[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        bb.<span class="title function_">push</span>(str);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">get_class</span>(data) === <span class="string">&quot;Blob&quot;</span> || <span class="title function_">get_class</span>(data) === <span class="string">&quot;File&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">FileReaderSync</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> fr = <span class="keyword">new</span> <span class="title class_">FileReaderSync</span>;</span><br><span class="line">          bb.<span class="title function_">push</span>(fr.<span class="title function_">readAsBinaryString</span>(data));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// async FileReader won&#x27;t work as BlobBuilder is sync</span></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileException</span>(<span class="string">&quot;NOT_READABLE_ERR&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data <span class="keyword">instanceof</span> <span class="title class_">FakeBlob</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.<span class="property">encoding</span> === <span class="string">&quot;base64&quot;</span> &amp;&amp; atob) &#123;</span><br><span class="line">          bb.<span class="title function_">push</span>(<span class="title function_">atob</span>(data.<span class="property">data</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">encoding</span> === <span class="string">&quot;URI&quot;</span>) &#123;</span><br><span class="line">          bb.<span class="title function_">push</span>(<span class="built_in">decodeURIComponent</span>(data.<span class="property">data</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">encoding</span> === <span class="string">&quot;raw&quot;</span>) &#123;</span><br><span class="line">          bb.<span class="title function_">push</span>(data.<span class="property">data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">          data += <span class="string">&quot;&quot;</span>; <span class="comment">// convert unsupported types to strings</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// decode UTF-16 to binary string</span></span><br><span class="line">        bb.<span class="title function_">push</span>(<span class="built_in">unescape</span>(<span class="built_in">encodeURIComponent</span>(data)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    FBB_proto.<span class="property">getBlob</span> = <span class="keyword">function</span> (<span class="params">type</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        type = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FakeBlob</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>), type, <span class="string">&quot;raw&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    FBB_proto.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;[object BlobBuilder]&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    FB_proto.<span class="property">slice</span> = <span class="keyword">function</span> (<span class="params">start, end, type</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> args = <span class="variable language_">arguments</span>.<span class="property">length</span>;</span><br><span class="line">      <span class="keyword">if</span> (args &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        type = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FakeBlob</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="title function_">slice</span>(start, args &gt; <span class="number">1</span> ? end : <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">length</span>), type, <span class="variable language_">this</span>.<span class="property">encoding</span></span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">    FB_proto.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;[object Blob]&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    FB_proto.<span class="property">close</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">size</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">FakeBlobBuilder</span>;</span><br><span class="line">  &#125;(view));</span><br><span class="line"></span><br><span class="line">  view.<span class="property">Blob</span> = <span class="keyword">function</span> (<span class="params">blobParts, options</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> type = options ? (options.<span class="property">type</span> || <span class="string">&quot;&quot;</span>) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> builder = <span class="keyword">new</span> <span class="title class_">BlobBuilder</span>();</span><br><span class="line">    <span class="keyword">if</span> (blobParts) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = blobParts.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Uint8Array</span> &amp;&amp; blobParts[i] <span class="keyword">instanceof</span> <span class="title class_">Uint8Array</span>) &#123;</span><br><span class="line">          builder.<span class="title function_">append</span>(blobParts[i].<span class="property">buffer</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          builder.<span class="title function_">append</span>(blobParts[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> blob = builder.<span class="title function_">getBlob</span>(type);</span><br><span class="line">    <span class="keyword">if</span> (!blob.<span class="property">slice</span> &amp;&amp; blob.<span class="property">webkitSlice</span>) &#123;</span><br><span class="line">      blob.<span class="property">slice</span> = blob.<span class="property">webkitSlice</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> blob;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> getPrototypeOf = <span class="title class_">Object</span>.<span class="property">getPrototypeOf</span> || <span class="keyword">function</span> (<span class="params">object</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> object.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  view.<span class="property">Blob</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title function_">getPrototypeOf</span>(<span class="keyword">new</span> view.<span class="title class_">Blob</span>());</span><br><span class="line">&#125;(</span><br><span class="line">  <span class="keyword">typeof</span> self !== <span class="string">&quot;undefined&quot;</span> &amp;&amp; self ||</span><br><span class="line">  <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="variable language_">window</span> ||</span><br><span class="line">  <span class="variable language_">this</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<ul>
<li>新建文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Export2Excel.js</span></span><br><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;script-loader!file-saver&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./Blob&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;script-loader!xlsx/dist/xlsx.core.min&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateArray</span>(<span class="params">table</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> out = [];</span><br><span class="line">    <span class="keyword">var</span> rows = table.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;tr&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> ranges = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R &lt; rows.<span class="property">length</span>; ++R) &#123;</span><br><span class="line">        <span class="keyword">var</span> outRow = [];</span><br><span class="line">        <span class="keyword">var</span> row = rows[R];</span><br><span class="line">        <span class="keyword">var</span> columns = row.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;td&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C &lt; columns.<span class="property">length</span>; ++C) &#123;</span><br><span class="line">            <span class="keyword">var</span> cell = columns[C];</span><br><span class="line">            <span class="keyword">var</span> colspan = cell.<span class="title function_">getAttribute</span>(<span class="string">&#x27;colspan&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> rowspan = cell.<span class="title function_">getAttribute</span>(<span class="string">&#x27;rowspan&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> cellValue = cell.<span class="property">innerText</span>;</span><br><span class="line">            <span class="keyword">if</span> (cellValue !== <span class="string">&quot;&quot;</span> &amp;&amp; cellValue == +cellValue) cellValue = +cellValue;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Skip ranges</span></span><br><span class="line">            ranges.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">range</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (R &gt;= range.<span class="property">s</span>.<span class="property">r</span> &amp;&amp; R &lt;= range.<span class="property">e</span>.<span class="property">r</span> &amp;&amp; outRow.<span class="property">length</span> &gt;= range.<span class="property">s</span>.<span class="property">c</span> &amp;&amp; outRow.<span class="property">length</span> &lt;= range.<span class="property">e</span>.<span class="property">c</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= range.<span class="property">e</span>.<span class="property">c</span> - range.<span class="property">s</span>.<span class="property">c</span>; ++i) outRow.<span class="title function_">push</span>(<span class="literal">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Row Span</span></span><br><span class="line">            <span class="keyword">if</span> (rowspan || colspan) &#123;</span><br><span class="line">                rowspan = rowspan || <span class="number">1</span>;</span><br><span class="line">                colspan = colspan || <span class="number">1</span>;</span><br><span class="line">                ranges.<span class="title function_">push</span>(&#123;<span class="attr">s</span>: &#123;<span class="attr">r</span>: R, <span class="attr">c</span>: outRow.<span class="property">length</span>&#125;, <span class="attr">e</span>: &#123;<span class="attr">r</span>: R + rowspan - <span class="number">1</span>, <span class="attr">c</span>: outRow.<span class="property">length</span> + colspan - <span class="number">1</span>&#125;&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Value</span></span><br><span class="line">            outRow.<span class="title function_">push</span>(cellValue !== <span class="string">&quot;&quot;</span> ? cellValue : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Handle Colspan</span></span><br><span class="line">            <span class="keyword">if</span> (colspan) <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; colspan - <span class="number">1</span>; ++k) outRow.<span class="title function_">push</span>(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        out.<span class="title function_">push</span>(outRow);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [out, ranges];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">datenum</span>(<span class="params">v, date1904</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (date1904) v += <span class="number">1462</span>;</span><br><span class="line">    <span class="keyword">var</span> epoch = <span class="title class_">Date</span>.<span class="title function_">parse</span>(v);</span><br><span class="line">    <span class="keyword">return</span> (epoch - <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">UTC</span>(<span class="number">1899</span>, <span class="number">11</span>, <span class="number">30</span>))) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sheet_from_array_of_arrays</span>(<span class="params">data, opts</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ws = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> range = &#123;<span class="attr">s</span>: &#123;<span class="attr">c</span>: <span class="number">10000000</span>, <span class="attr">r</span>: <span class="number">10000000</span>&#125;, <span class="attr">e</span>: &#123;<span class="attr">c</span>: <span class="number">0</span>, <span class="attr">r</span>: <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> R = <span class="number">0</span>; R != data.<span class="property">length</span>; ++R) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> C = <span class="number">0</span>; C != data[R].<span class="property">length</span>; ++C) &#123;</span><br><span class="line">            <span class="keyword">if</span> (range.<span class="property">s</span>.<span class="property">r</span> &gt; R) range.<span class="property">s</span>.<span class="property">r</span> = R;</span><br><span class="line">            <span class="keyword">if</span> (range.<span class="property">s</span>.<span class="property">c</span> &gt; C) range.<span class="property">s</span>.<span class="property">c</span> = C;</span><br><span class="line">            <span class="keyword">if</span> (range.<span class="property">e</span>.<span class="property">r</span> &lt; R) range.<span class="property">e</span>.<span class="property">r</span> = R;</span><br><span class="line">            <span class="keyword">if</span> (range.<span class="property">e</span>.<span class="property">c</span> &lt; C) range.<span class="property">e</span>.<span class="property">c</span> = C;</span><br><span class="line">            <span class="keyword">var</span> cell = &#123;<span class="attr">v</span>: data[R][C]&#125;;</span><br><span class="line">            <span class="keyword">if</span> (cell.<span class="property">v</span> == <span class="literal">null</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">var</span> cell_ref = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">encode_cell</span>(&#123;<span class="attr">c</span>: C, <span class="attr">r</span>: R&#125;);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.<span class="property">v</span> === <span class="string">&#x27;number&#x27;</span>) cell.<span class="property">t</span> = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> cell.<span class="property">v</span> === <span class="string">&#x27;boolean&#x27;</span>) cell.<span class="property">t</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cell.<span class="property">v</span> <span class="keyword">instanceof</span> <span class="title class_">Date</span>) &#123;</span><br><span class="line">                cell.<span class="property">t</span> = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">                cell.<span class="property">z</span> = <span class="variable constant_">XLSX</span>.<span class="property">SSF</span>.<span class="property">_table</span>[<span class="number">14</span>];</span><br><span class="line">                cell.<span class="property">v</span> = <span class="title function_">datenum</span>(cell.<span class="property">v</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> cell.<span class="property">t</span> = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line"></span><br><span class="line">            ws[cell_ref] = cell;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (range.<span class="property">s</span>.<span class="property">c</span> &lt; <span class="number">10000000</span>) ws[<span class="string">&#x27;!ref&#x27;</span>] = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">encode_range</span>(range);</span><br><span class="line">    <span class="keyword">return</span> ws;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Workbook</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Workbook</span>)) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Workbook</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">SheetNames</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Sheets</span> = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">s2ab</span>(<span class="params">s</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(s.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buf);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i != s.<span class="property">length</span>; ++i) view[i] = s.<span class="title function_">charCodeAt</span>(i) &amp; <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">export_table_to_excel</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> theTable = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> oo = <span class="title function_">generateArray</span>(theTable);</span><br><span class="line">    <span class="keyword">var</span> ranges = oo[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* original data */</span></span><br><span class="line">    <span class="keyword">var</span> data = oo[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> ws_name = <span class="string">&quot;SheetJS&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> <span class="title class_">Workbook</span>(), ws = <span class="title function_">sheet_from_array_of_arrays</span>(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add ranges to worksheet */</span></span><br><span class="line">    <span class="comment">// ws[&#x27;!cols&#x27;] = [&#x27;apple&#x27;, &#x27;banan&#x27;];</span></span><br><span class="line">    ws[<span class="string">&#x27;!merges&#x27;</span>] = ranges;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add worksheet to workbook */</span></span><br><span class="line">    wb.<span class="property">SheetNames</span>.<span class="title function_">push</span>(ws_name);</span><br><span class="line">    wb.<span class="property">Sheets</span>[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wbout = <span class="variable constant_">XLSX</span>.<span class="title function_">write</span>(wb, &#123;<span class="attr">bookType</span>: <span class="string">&#x27;xlsx&#x27;</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">&#x27;binary&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">saveAs</span>(<span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="title function_">s2ab</span>(wbout)], &#123;<span class="attr">type</span>: <span class="string">&quot;application/octet-stream&quot;</span>&#125;), <span class="string">&quot;test.xlsx&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">formatJson</span>(<span class="params">jsonData</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(jsonData)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">export_json_to_excel</span>(<span class="params">th, jsonData, defaultTitle</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* original data */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = jsonData;</span><br><span class="line">    data.<span class="title function_">unshift</span>(th);</span><br><span class="line">    <span class="keyword">var</span> ws_name = <span class="string">&quot;SheetJS&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wb = <span class="keyword">new</span> <span class="title class_">Workbook</span>(), ws = <span class="title function_">sheet_from_array_of_arrays</span>(data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* add worksheet to workbook */</span></span><br><span class="line">    wb.<span class="property">SheetNames</span>.<span class="title function_">push</span>(ws_name);</span><br><span class="line">    wb.<span class="property">Sheets</span>[ws_name] = ws;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wbout = <span class="variable constant_">XLSX</span>.<span class="title function_">write</span>(wb, &#123;<span class="attr">bookType</span>: <span class="string">&#x27;xlsx&#x27;</span>, <span class="attr">bookSST</span>: <span class="literal">false</span>, <span class="attr">type</span>: <span class="string">&#x27;binary&#x27;</span>&#125;);</span><br><span class="line">    <span class="keyword">var</span> title = defaultTitle || <span class="string">&#x27;列表&#x27;</span></span><br><span class="line">    <span class="title function_">saveAs</span>(<span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="title function_">s2ab</span>(wbout)], &#123;<span class="attr">type</span>: <span class="string">&quot;application/octet-stream&quot;</span>&#125;), title + <span class="string">&quot;.xlsx&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>新建文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// exportTable.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">export2Excel</span>(<span class="params">columns, list, filename</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>.<span class="title function_">ensure</span>([], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; export_json_to_excel &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@/excel/Export2Excel&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> tHeader = []</span><br><span class="line">    <span class="keyword">let</span> filterVal = []</span><br><span class="line">    <span class="keyword">if</span> (!columns) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    columns.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      tHeader.<span class="title function_">push</span>(item.<span class="property">title</span>)</span><br><span class="line">      filterVal.<span class="title function_">push</span>(item.<span class="property">key</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(filterVal)</span><br><span class="line">    <span class="keyword">const</span> data = list.<span class="title function_">map</span>(<span class="function"><span class="params">v</span> =&gt;</span> filterVal.<span class="title function_">map</span>(<span class="function"><span class="params">j</span> =&gt;</span> v[j]))</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">export_json_to_excel</span>(tHeader, data, filename);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; export2Excel &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/exportTable&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义colunms</span></span><br><span class="line"><span class="attr">columns</span>: [</span><br><span class="line">   &#123; <span class="attr">title</span>: <span class="string">&#x27;用户名&#x27;</span>,<span class="attr">key</span>:<span class="string">&#x27;username&#x27;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">title</span>: <span class="string">&#x27;邮箱&#x27;</span>,<span class="attr">key</span>:<span class="string">&#x27;email&#x27;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">title</span>: <span class="string">&#x27;手机号&#x27;</span>,<span class="attr">key</span>:<span class="string">&#x27;mobile&#x27;</span> &#125;,</span><br><span class="line">   &#123; <span class="attr">title</span>: <span class="string">&#x27;角色&#x27;</span>,<span class="attr">key</span>:<span class="string">&#x27;role_name&#x27;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">定义tableData 数据结构和colunms保持一致</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行导出</span></span><br><span class="line"><span class="title function_">export2Excel</span>(<span class="variable language_">this</span>.<span class="property">columns</span>, <span class="variable language_">this</span>.<span class="property">userList</span>, <span class="string">&#x27;用户列表&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="data-v实现大屏可视化">data-v实现大屏可视化</h5>
<ul>
<li><a href="http://datav.jiaminghi.com/guide/#%E5%AE%89%E8%A3%85">datav安装</a></li>
<li>dashboard.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container bg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed; &quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dv-full-screen-container</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;df&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 25%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-12</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-1<span class="tag">&lt;/<span class="name">dv-border-box-12</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-10</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-1<span class="tag">&lt;/<span class="name">dv-border-box-10</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-13</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-1<span class="tag">&lt;/<span class="name">dv-border-box-13</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 50%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-11</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 600px;&quot;</span>&gt;</span>dv-border-box-3<span class="tag">&lt;/<span class="name">dv-border-box-11</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 25%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-10</span> <span class="attr">:reverse</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 300px;&quot;</span>&gt;</span>dv-border-box-4<span class="tag">&lt;/<span class="name">dv-border-box-10</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-12</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 300px;&quot;</span>&gt;</span>dv-border-box-4<span class="tag">&lt;/<span class="name">dv-border-box-12</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;df&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 50%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-8</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-1<span class="tag">&lt;/<span class="name">dv-border-box-8</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 25%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-7</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-3<span class="tag">&lt;/<span class="name">dv-border-box-7</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: 0 1 25%;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dv-border-box-8</span> <span class="attr">:reverse</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 200px;&quot;</span>&gt;</span>dv-border-box-4<span class="tag">&lt;/<span class="name">dv-border-box-8</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dv-full-screen-container</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.df</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.bg</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;../../assets/common/bg.png&#x27;</span>) no-repeat center center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-size</span>: cover;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>添加js全屏效果</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NavBar.vue</span></span><br><span class="line">&lt;svg-icon icon-<span class="keyword">class</span>=<span class="string">&quot;full&quot;</span> style=<span class="string">&quot;width: 30px; height: 30px;&quot;</span> @click=<span class="string">&quot;fullScreen&quot;</span>&gt;&lt;/svg-icon&gt;</span><br><span class="line"></span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 添加全屏事件监听器</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">fullListen</span>()</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line"><span class="comment">// 全屏</span></span><br><span class="line"><span class="title function_">fullScreen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> element = <span class="variable language_">document</span>.<span class="property">documentElement</span></span><br><span class="line">  <span class="keyword">if</span> (element.<span class="property">requestFullscreen</span>) &#123;</span><br><span class="line">    element.<span class="title function_">requestFullscreen</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">mozRequestFullScreen</span>) &#123;</span><br><span class="line">    element.<span class="title function_">mozRequestFullScreen</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">msRequestFullscreen</span>) &#123;</span><br><span class="line">    element.<span class="title function_">msRequestFullscreen</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.<span class="property">webkitRequestFullscreen</span>) &#123;</span><br><span class="line">    element.<span class="title function_">webkitRequestFullScreen</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;app/isShowSiderBarAndNavBar&#x27;</span>)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 监听全屏</span></span><br><span class="line"><span class="title function_">fullListen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fullscreenchange&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// null证明不是全屏</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getFullscreenElement</span>() == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;app/isShowSiderBarAndNavBar&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 获取全屏状态</span></span><br><span class="line"><span class="title function_">getFullscreenElement</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="variable language_">document</span>[<span class="string">&#x27;fullscreenElement&#x27;</span>] ||</span><br><span class="line">    <span class="variable language_">document</span>[<span class="string">&#x27;mozFullScreenElement&#x27;</span>] ||</span><br><span class="line">    <span class="variable language_">document</span>[<span class="string">&#x27;msFullScreenElement&#x27;</span>] ||</span><br><span class="line">    <span class="variable language_">document</span>[<span class="string">&#x27;webkitFullscreenElement&#x27;</span>] || <span class="literal">null</span></span><br><span class="line">  	);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/module/app.js</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">	<span class="attr">isShowSiderBarAndNavBar</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    	state.<span class="property">status</span> = !state.<span class="property">status</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store/getters.js</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">    <span class="attr">status</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">app</span>.<span class="property">status</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>分别在Sidebar.vue/Navbar.vue中通过v-show控制显示隐藏</p>
</li>
<li>
<p>为了适配全屏，调整侧边栏宽度</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sidebar<span class="selector-class">.scss</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main-container</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240313112738629.png" alt="image-20240313112738629"></p>
<ul>
<li>使用datav内置图标实现</li>
</ul>
<p><img data-src="image-20240313160509269.png" alt="image-20240313160509269"></p>
<ul>
<li>绘制头部</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;df&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dv-decoration-2</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height:20px;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;df&quot;</span> <span class="attr">style</span>=<span class="string">&quot;align-items: center; color: #fff; font-size: 26px; font-weight: bold;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dv-decoration-8</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height:50px;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px;text-align: center;&quot;</span>&gt;</span>炫酷科技大屏<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dv-decoration-8</span> <span class="attr">:reverse</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height:50px;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dv-decoration-2</span> <span class="attr">style</span>=<span class="string">&quot;width:300px;height:20px;transform: rotateY(180deg);&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>引入echarts实现</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dv-border-box-8</span> <span class="attr">style</span>=<span class="string">&quot;width:100%; height: 240px;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box8&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%; height: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dv-border-box-8</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">initEcharts</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;box8&#x27;</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 准备配置项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">let</span> option = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">title</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">text</span>: <span class="string">&#x27;Stacked Line&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">tooltip</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">legend</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">data</span>: [<span class="string">&#x27;Email&#x27;</span>, <span class="string">&#x27;Union Ads&#x27;</span>, <span class="string">&#x27;Video Ads&#x27;</span>, <span class="string">&#x27;Direct&#x27;</span>, <span class="string">&#x27;Search Engine&#x27;</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">grid</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">containLabel</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">toolbox</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">feature</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">saveAsImage</span>: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">xAxis</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">boundaryGap</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">data</span>: [<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">yAxis</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">series</span>: [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">name</span>: <span class="string">&#x27;Email&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">stack</span>: <span class="string">&#x27;Total&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: [<span class="number">120</span>, <span class="number">132</span>, <span class="number">101</span>, <span class="number">134</span>, <span class="number">90</span>, <span class="number">230</span>, <span class="number">210</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">name</span>: <span class="string">&#x27;Union Ads&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">stack</span>: <span class="string">&#x27;Total&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: [<span class="number">220</span>, <span class="number">182</span>, <span class="number">191</span>, <span class="number">234</span>, <span class="number">290</span>, <span class="number">330</span>, <span class="number">310</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">name</span>: <span class="string">&#x27;Video Ads&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">stack</span>: <span class="string">&#x27;Total&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: [<span class="number">150</span>, <span class="number">232</span>, <span class="number">201</span>, <span class="number">154</span>, <span class="number">190</span>, <span class="number">330</span>, <span class="number">410</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">name</span>: <span class="string">&#x27;Direct&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">stack</span>: <span class="string">&#x27;Total&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: [<span class="number">320</span>, <span class="number">332</span>, <span class="number">301</span>, <span class="number">334</span>, <span class="number">390</span>, <span class="number">330</span>, <span class="number">320</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">name</span>: <span class="string">&#x27;Search Engine&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">stack</span>: <span class="string">&#x27;Total&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: [<span class="number">820</span>, <span class="number">932</span>, <span class="number">901</span>, <span class="number">934</span>, <span class="number">1290</span>, <span class="number">1330</span>, <span class="number">1320</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 设置配置项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      myChart.<span class="title function_">setOption</span>(option)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">initEcharts</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240315103237973.png" alt="image-20240315103237973"></p>
<p><img data-src="image-20240315103344393.png" alt="image-20240315103344393"></p>
<p><img data-src="image-20240315140721444.png" alt="image-20240315140721444"></p>
]]></content>
      <categories>
        <category>vue2</category>
      </categories>
      <tags>
        <tag>vue2</tag>
      </tags>
  </entry>
  <entry>
    <title>小程序 学习</title>
    <url>/blog/2023/08/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h4 id="浅谈小程序">浅谈小程序</h4>
<p>在 2016 年的「微信公开课 Pro」演讲中，微信事业群总裁张小龙这样描述了小程序的前景与未来：</p>
<blockquote>
<p>&quot; 小程序是一种不需要下载安装即可使用的应用，它实现了应用 “触手可及” 的梦想，用户扫一扫或者搜一下即可打开应用。也体现了 “用完即走” 的理念，用户不用关心是否安装太多应用的问题。应用将无处不在，随时可用，但又无须安装卸载 &quot;。</p>
</blockquote>
<p>小程序刚发布的时候要求压缩包的体积不能大于 1M，否则无法通过，在 2017 年 4 月做 了改进，由原来的 1M 提升到 2M；</p>
<p>2017 年 1 月 9 日 0 点，万众瞩目的微信第一批小程序正式低调上线。</p>
<span id="more"></span>
<p>而在 2020年的「WWDC 苹果全球开发者大会」中，轻应用则被作为 iOS 14 的主要功能进行强调与推介：</p>
<p><img data-src="image-20220830095900369.png" alt=""></p>
<blockquote>
<p>App Clip 就是一种无需用户在 iPhone 或 iPad 上安装完整的应用程序，就可以访问使用该应用程序的部分功能的轻量级应用，它们专注于处理简单快速的任务。</p>
</blockquote>
<p>不论是张小龙对「微信小程序」略带文艺的描述，还是在 WWDC 上对于「轻应用」在 iOS 生态中的地位描述，我们都能大抵能理解小程序诞生的初衷。而如果我们把时间从这两场发布会的转至今日，却会发现小程序早已不再局限于「用完即走」与「快速打开」，各式各样的小程序已呈现百花齐放的状态，不论是工具小程序，内容小程序，交易小程序，直播小程序，各种类型应有尽有。</p>
<p>不妨让我尝试用自己的工作日常举例，早上出门上班，我会打开「腾讯乘车码」扫描地铁场所码，并把健康码给地铁安检查看，临近中午11点 30分，我会用「美团」或「饿了么」为自己订一份工作餐，吃完午饭后我会打开「动物餐厅」看看小猫咪又赚了多少小鱼干，下午会议时使用「腾讯文档」查看会议纪要，快下班的时候用「叮咚买菜」购置晚饭所需的食材，晚上回家做饭时，用「懒饭 App」看看想吃的番茄肥牛饭怎么做。</p>
<p><img data-src="image-20220830100037455.png" alt=""></p>
<p>时至今日，当我们说到小程序时，也不仅仅在特指微信小程序，各式各样的平台都纷纷推出了自己专属的小程序平台，不论支付宝、字节跳动、美团还是百度等其他互联网大厂，都纷纷推出了自己专属的小程序平台，且都基于自己的生态业务，为小程序提供流量进行支持，希望用户与开发者能够选择自有平台中的小程序进行开发。</p>
<p><strong>什么样的应用适合使用小程序开发</strong></p>
<p>虽然小程序市场时至今日依然是一片蓝海，但我想也不是所有应用「都可以，都应该」使用小程序开发的。</p>
<p>基于我们的经验与积累来说，符合「逻辑简单，使用低频，对性能要求不极致」的应用场景，更加适合使用小程序进行研发。</p>
<p><strong>逻辑简单</strong>：是指应用的操作逻辑并不十分复杂，各类生活服务（如打车，订餐，查地图与导航等等）都需要给用户提供简单清晰的操作逻辑，而这一类也天然的符合起初小程序「用完即走」的定义，因此十分符合使用小程序研发。一些逻辑复杂的应用场景想要通过小程序进行适配，就可能会面临更多的设计与研发困难，同时在性能和体验也可能会面对更多需要解决的问题。</p>
<p><strong>使用低频</strong>：是指小程序的使用频率不应该太高，比如社交类的钉钉或飞书，金融类的掌上生活或浦大喜奔，媒体类的网易云音乐或斗鱼都不太适合使用小程序进行重新设计。对于用户使用的频率较高的应用来说，直接打开应用进行体验的步骤肯定最快的，此外由于某些行业的特殊性质（比如具备交易，支付等能力）要求，对于安全性与保密性的首选风险判断原则，也不宜使用常见的小程序进行设计。</p>
<p><strong>对性能要求不极致</strong>：是指由于小程序始终存在于某个独立应用（也被称为宿主应用）中，考虑到目前的性能与研发所限制，暂时不太适合开发对于这两者有更高要求的移动应用。比如把原神，王者荣耀这样的游戏应用通过小程序进行重新设计，在目前来说肯定是不现实的。</p>
<p>当然，随着相关研发实力的增强与产业生态的逐渐补充，也有越来越多的「不可能」变为了「可能」，比如华西证券的「华彩人生」，浦发银行的「浦大喜奔」，某省的移动警务平台等客户都选择使用小程序容器方案进行落地实现</p>
<p><strong>小程序与H5，原生应用有何区别？</strong></p>
<p>很多朋友在了解小程序技术的时候，都会有这样的疑惑“到底与 H5，原生应用”这些技术相比，小程序具有哪些优势与劣势呢？</p>
<p><strong>H5 移动应用</strong></p>
<p>我们常说的 H5 其实也通常可以被视为一种 Web App，相比于我们在桌面端浏览器中打开的网页，主要是增加了一些响应式的设计与交互优化，从而使得这些网页更适合在移动端的浏览器中显示运行。既然是网页应用，那依然是基于 JavaScript，CSS 和 HTML 进行实现的，由于是基于各类前端技术栈进行实现，最大的好处就是快速、简单、方便，且有各种技术资料可以参考。</p>
<p>同样，H5 的缺点与优点也是并存的，比如由于技术已经很成熟了，对于前端经验欠缺的新人来说，面对各式各样的框架，模块、任务管理工具，UI 库可能会出现无从下手的问题；此外相比于原生应用，对于系统权限的获取（比如数据缓存能力，网络通信状态等）都显得比较鸡肋，当低性能的设备加载包含复杂逻辑的页面时，会出现明显的卡顿与延迟问题。</p>
<p><strong>原生应用</strong></p>
<p>原生应用也被叫做 Native App，相比于 H5 应用通过前端三大件进行实现不同，原生应用主要会采用 iOS 与 Android 的专有语言 Object-C（或 Swift），Java（或 Kotlin）进行实现，大多我们所常见的国民应用，比如微信，支付宝等都属于这种原生应用。</p>
<p>既然被叫做「原生应用」，就像操作系统的亲儿子一样，天然在性能与体验上具备优秀的潜质，也有组件库丰富，接口支持完善等各种优势特点。但原生应用最大的缺陷就是不能跨平台研发，以目前的主流市场为例，必须要支持 iOS 与 Android 两个主流平台。</p>
<p><strong>混合应用</strong></p>
<p>混合应用一般被称为 Hybrid App。简单来说，混合应用<strong>就是将原生功能封装成对应的 JS 接口，在前端使用 H5 来开发对应的 App （即 H5 作为内容+原生应用作为壳）</strong> ，看上去虽然是一个移动原生应用整体，但实际的页面还是网页，一套代码可以生成 iOS 与 Android 两种安装包，开发成本较低。</p>
<p>我们常见的淘宝，京东等应用由于更新与优化节奏都十分快速，为了更好的响应「贴近用户」的目标，应用中有的功能通过原生 Native 实现，有的功能则通过 H5 页面进行实现，这种应用就属于我们所说的混合应用。</p>
<p><strong>小程序</strong></p>
<p>严格意义上来说，小程序并不属于以上 3 种应用的任何一种。小程序主要通过 JavaScript 与 CSS 这种常见的前端技术进行开发，但又没有完全使用 HTML 进行实现，在不同的操作系统中，JavaScript 代码分别运行在 iOS 的 JavaScriptCore 与 Android 的 JSCore 中，各家小程序平台或多或少都有一部分自研的核心，因此渲染视图层的组件也有所不同。</p>
<p><img data-src="image-20220830100558161.png" alt=""></p>
<p>相比「 H5 移动应用」与「 移动原生应用」，小程序具备如下优势：</p>
<ul>
<li>具备跨平台的能力，一套代码可以在 iOS 与 Android 两个平台中运行；</li>
<li>远超过 H5 的体验（支持本地缓存，Webview，有丰富的组件与支持库）；</li>
<li>不需要下载和安装，不想用了也不需要卸载；</li>
<li>可以避免 DOM 泄露（不使用常用的 window 对象与 document 对象）；</li>
<li>与 App 相比，学习门槛和开发成本都比较低，可以快速上手；</li>
<li>相比 H5，小程序受限微信运营规范，不像H5页面那么灵活。但它也可以做一些 H5 做 不了的事情，比如消息订阅，直接转发消息给好友等；</li>
</ul>
<p><strong>常见的小程序开发框架有哪些</strong></p>
<p>以主要的小程序开发框架举例，腾讯云社区的「极乐君」将不同平台下小程序支持的力度整理在一张表中：</p>
<p><img data-src="image-20220830100717245.png" alt=""></p>
<h4 id="小程序启动机制">小程序启动机制</h4>
<p>小程序启动会有<strong>两种情况</strong>：</p>
<ul>
<li>冷启动</li>
<li>热启动</li>
</ul>
<p><img data-src="image-20240315155723570.png" alt="小程序启动机制"></p>
<p>与小程序冷、热启动相关的，是小程序的<strong>两种状态</strong>：</p>
<ul>
<li>
<p>前台状态</p>
</li>
<li>
<p>后台状态</p>
</li>
</ul>
<p>为了安全和管控，小程序使用<strong>双线程</strong>执行：视图线程和逻辑线程</p>
<ul>
<li>
<p>View 视图线程</p>
</li>
<li>
<p>App Service 逻辑线程</p>
</li>
</ul>
<p><img data-src="image-20240315155920319.png" alt="小程序双线程"></p>
<p><strong>扩展问题：视图持续更新是怎么实现的？</strong></p>
<p><img data-src="image-20240315160053556.png" alt="代码: Hybird执行js示例"></p>
<p><strong>扩展问题：使用 setData 可能遇到哪些问题？</strong></p>
<p><strong>扩展问题：微信为什么要造一个 WXS？</strong></p>
<p><img data-src="image-20240315160301174.png" alt="wxs示例"></p>
<h5 id="视图线程">视图线程</h5>
<p><img data-src="image-20240315160351445.png" alt="小程序视图线程编译"></p>
<p><img data-src="image-20240315160905848.png" alt="小程序一般-原生双层视图层"></p>
<h5 id="逻辑线程">逻辑线程</h5>
<p><img data-src="image-20240315160948554.png" alt="小程序页面主要生命周期函数"></p>
<p><img data-src="image-20240315161024710.png" alt="逻辑线程生命状态图"></p>
<p><img data-src="image-20240315161115307.png" alt="视图线程的四个状态"></p>
<p><img data-src="image-20240315161205800.png" alt="逻辑线程的四个状态"></p>
<h4 id="小程序开发环境">小程序开发环境</h4>
<p>1、<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/">微信文档</a></p>
<p>2、<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">微信开发工具下载</a></p>
<p>3、<a href="https://mp.weixin.qq.com/">注册小程序账号</a></p>
<p><img data-src="image-20220830111436547.png" alt=""></p>
<p><img data-src="image-20220830111509859.png" alt=""></p>
<h4 id="小程序特点">小程序特点</h4>
<ol>
<li>
<p>没有 DOM</p>
</li>
<li>
<p>组件化开发：具备特定功能效果的代码集合</p>
</li>
<li>
<p>体积小，单个压缩包体积不能大于 2M，否则无法上线</p>
</li>
<li>
<p>小程序的四个重要的文件</p>
<ul>
<li>
<p>.js → js逻辑 → js</p>
</li>
<li>
<p>.wxml → view 结构 → html</p>
</li>
<li>
<p>.wxss →  view 样式 → css</p>
</li>
<li>
<p>.json →  view 配置 → json 文件</p>
</li>
</ul>
</li>
<li>
<p>小程序适配方案: rpx (responsive pixel 响应式像素单位)</p>
<ul>
<li>
<p>小程序适配单位： rpx</p>
</li>
<li>
<p>规定任何屏幕下宽度为 750rpx</p>
</li>
<li>
<p>小程序会根据屏幕的宽度不同自动计算rpx 值的大小</p>
</li>
<li>
<p>Iphone6 下： 1rpx = 1 物理像素 = 0.5px</p>
</li>
</ul>
</li>
</ol>
<p><img data-src="image-20220830141949409.png" alt=""></p>
<h4 id="小程序配置">小程序配置</h4>
<h5 id="全局配置">全局配置</h5>
<p>作用： 用于为整个应用进行选项设置</p>
<p><img data-src="image-20220830143421384.png" alt=""></p>
<h5 id="页面配置">页面配置</h5>
<p>配图参上作用：用于为指定的页面进行配置</p>
<p>注：页面配置的优先级高于全局配置</p>
<h5 id="sitemap-配置">sitemap 配置</h5>
<p>配图参上作用：配置其小程序页面是否允许微信索引</p>
<h4 id="小程序基础">小程序基础</h4>
<h5 id="框架接口">框架接口</h5>
<p><img data-src="image-20220830144258857.png" alt=""></p>
<p><strong>App</strong></p>
<ol>
<li>
<p>全局 app.js 中执行 App()</p>
</li>
<li>
<p>生成当前应用的实例对象</p>
</li>
<li>
<p>getApp()获取全局应用实例</p>
</li>
</ol>
<p><strong>Page</strong></p>
<ol>
<li>页面.js 中执行Page()</li>
<li>生成当前页面的实例</li>
<li>通过getCurrentPages() 获取页面实例</li>
</ol>
<h5 id="事件系统">事件系统</h5>
<p>忘了写 ~</p>
<h5 id="WXML语法">WXML语法</h5>
<p>具体看官方文档 ~</p>
<h6 id="ToDoList">ToDoList</h6>
<p>todolist.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;header-input&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">bindinput</span>=<span class="string">&quot;inputHandler&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">&#x27;&#123;&#123;text.title?text.title:&quot;&quot;&#125;&#125;&#x27;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">bindtap</span>=<span class="string">&quot;add&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;show&quot;</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;todoList.length &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;todoList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span>&#123;&#123;item.id + 1&#125;&#125;. &#123;&#123;item.title&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;warn&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">bindtap</span>=<span class="string">&quot;del&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span>暂无待办事项<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>todolist.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面的初始数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">todoList</span>: [</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">0</span>, <span class="attr">title</span>: <span class="string">&#x27;吃饭&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;睡觉&#x27;</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;打豆豆&#x27;</span>&#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 保存用户输入的数据</span></span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 用户输入数据后会触发的回调</span></span><br><span class="line">    <span class="title function_">inputHandler</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// 保存用户输入的数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">text</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">todoList</span>.<span class="property">length</span>,</span><br><span class="line">                <span class="attr">title</span>: e.<span class="property">detail</span>.<span class="property">value</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 修改数据并且清空输入框</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">todoList</span>: [...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">todoList</span>, <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">text</span>],</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="title function_">del</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取传过来的索引</span></span><br><span class="line">        <span class="comment">// console.log(e.target.dataset.index)</span></span><br><span class="line">        <span class="keyword">var</span> index = e.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">index</span></span><br><span class="line">        <span class="comment">// 删除数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">todoList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">// 只要修改了数据 一定要重新setData</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">todoList</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">todoList</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="Tab">Tab</h6>
<p>tab.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;tab &#123;&#123;index == current ? &#x27;active&#x27; : &#x27;&#x27;&#125;&#125;&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">bindtap</span>=<span class="string">&quot;changeCurrent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;tabList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>tab.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面的初始数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">tabList</span>: [<span class="string">&quot;首页&quot;</span>, <span class="string">&quot;购物车&quot;</span>, <span class="string">&quot;我的&quot;</span>],</span><br><span class="line">        <span class="attr">current</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">changeCurrent</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// 在事件处理函数中，通过 event.target.dataset.参数名 即可获取到具体参数的值</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>)</span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">           <span class="attr">current</span>: e.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">index</span></span><br><span class="line">       &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>target 和 currentTarget的区别？</p>
<p>target 是触发该事件的源头组件，而 currentTarget 则是当前事件所绑定的组件</p>
<p><img data-src="image-20220905233655925.png" alt=""></p>
<p>点击内部的按钮时，点击事件以冒泡的方式向外扩散，也会触发外层 view 的 tap 事件处理函数。</p>
<p>此时，对于外层的 view 来说：</p>
<p>e.target 指向的是触发事件的源头组件，因此，e.target 是内部的按钮组件</p>
<p>e.currentTarget 指向的是当前正在触发事件的那个组件，因此，e.currentTarget 是当前的 view 组件</p>
<h5 id="WXSS语法">WXSS语法</h5>
<p><img data-src="image-20220905234949557.png" alt=""></p>
<h5 id="WXS语法">WXS语法</h5>
<p>具体看官方文档 ~</p>
<p>这里补充一点，为什么有了js还要设计wxs？</p>
<p><strong>1、 WXS 的基础类库：</strong></p>
<p>WXS只提供给开发者5个基础类库，分别是 console，Math，JSON，Number，Date，以及一些常用的全局变量和全局函数，数量不多，但已经能满足基本的数据操作要求，而对于复杂的数据操作，比如类定义和继承等，还是需要依靠逻辑层的 JS 脚本完成。</p>
<p><strong>2、数组遍历</strong></p>
<p>WXS 里，遍历数组只能通过for实现，而JS中的for in和for of不被支持，对于需要循环处理数据的场景，也可以通过数组的forEach方法实现遍历：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ary = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">ary.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">i</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>3、 变量类型判断</strong></p>
<p>由于WXS先天不支持使用 Array 对象，因此我们平常用于判断数组类型变量的语句[] instanceof Array也就不能使用了，而typeof []的输出结果是&quot;object&quot;，并不能满足实际的开发要求。所幸我们还可以使用变量的 「constructor」属性进行类型判断：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[].<span class="property">constructor</span> === <span class="title class_">Array</span>  <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p><strong>4、性能差异</strong></p>
<p>小程序的架构分成了逻辑层和视图层，WXS 与JavaScript还有一个差异在于，它与WXML一同们于视图层，运行于同一个线程内，因此减少了跨线程通信的开销。这也是我们之所以优先采用WXS处理数据的原因之一</p>
<p><strong>5、平台差异</strong></p>
<p>小程序在Android上，使用V8引擎解析和渲染 JavaScript; 而在iOS上，则是使用 JavaScriptCore，这两者在解析性能的表现上差异比较大，相对来说 V8 的性能比 JSC 要好得多，那么在 IOS 的小程序中，使用脱离 JavaScript 环境的 WXS，就会使性能有更多的提升，这也是WXS文档中提及 “在 iOS 设备上小程序内的 wxs 会比 javascript 代码快 2 ~ 20 倍” 的具体原因</p>
<h6 id="FormatTime">FormatTime</h6>
<p>dateFormat.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入wxs文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">src</span>=<span class="string">&#x27;./dateFormat.wxs&#x27;</span> <span class="attr">module</span>=<span class="string">&quot;aaa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;aaa(time)&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>dateFormat.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">time</span>: <span class="number">1646372333761</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>dateFormat.wxs</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dateFormat</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> newTime = <span class="title function_">getDate</span>(time)</span><br><span class="line">    <span class="keyword">var</span> year = newTime.<span class="title function_">getFullYear</span>()</span><br><span class="line">    <span class="keyword">var</span> month = newTime.<span class="title function_">getMonth</span>() + <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> date = newTime.<span class="title function_">getDate</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> year + <span class="string">&#x27;-&#x27;</span> + month + <span class="string">&#x27;-&#x27;</span> + date </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将函数暴露</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = dateFormat</span><br></pre></td></tr></table></figure>
<h6 id="Search">Search</h6>
<p>search.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">src</span>=<span class="string">&#x27;./search.wxs&#x27;</span> <span class="attr">module</span>=<span class="string">&quot;searchList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;search-box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-input&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindinput</span>=<span class="string">&quot;getKeyWords&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;searchList(list, keyWords)&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;item&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>search.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">list</span>: [<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;acd&#x27;</span>, <span class="string">&#x27;cdb&#x27;</span>, <span class="string">&#x27;xyz&#x27;</span>, <span class="string">&#x27;zxe&#x27;</span>, <span class="string">&#x27;qwe&#x27;</span>, <span class="string">&#x27;amd&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>],</span><br><span class="line">        <span class="attr">keyWords</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getKeyWords</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">keyWords</span>: e.<span class="property">detail</span>.<span class="property">value</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>search.wxs</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">search</span>(<span class="params">list, keyWords</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> list.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> item.<span class="title function_">indexOf</span>(keyWords) &gt; -<span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = search</span><br></pre></td></tr></table></figure>
<h5 id="数据请求">数据请求</h5>
<p>request.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;swiperList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.imgUrl&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>request.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        swiperList : []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;https://www.fastmock.site/mock/d4c75f77a8eef86dc58b3fced5bf604e/laoxu/api/getData&#x27;</span>,</span><br><span class="line">          <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;<span class="attr">data</span>:&#123;data&#125;&#125; = result</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                <span class="attr">swiperList</span>: data.<span class="property">swiperList</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>request.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">12</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实战场景</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">login</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 请求自己后台登录接口</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">requestLoginApi</span> = (<span class="params">code</span>) =&gt; &#123;</span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/user/wexin-login2&#x27;</span>,</span><br><span class="line">      ...</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> token = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">authorizationToken</span></span><br><span class="line">  	  wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, token)</span><br><span class="line">      <span class="title function_">onUserLogin</span>(token)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onUserLogin</span> = (<span class="params">token</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">getApp</span>().<span class="property">globalData</span>.<span class="property">token</span> = token</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 检查当前微信登录状态是否有效</span></span><br><span class="line">wx.<span class="title function_">checkSession</span>(&#123;</span><br><span class="line">  <span class="title function_">success</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> token = wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (token) <span class="title function_">onUserLogin</span>(token)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">fail</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 拉取微信用于登录鉴权的code</span></span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res0.<span class="property">code</span>) &#123;</span><br><span class="line">          <span class="title function_">requestLoginApi</span>(res0.<span class="property">code</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 从之前使用的wx.request接口使用方式可以看出来 所有小程序接口都有两个特征</span></span><br><span class="line"><span class="comment">// 1、参数是一个对象 可以让参数的定义与添加更加自由</span></span><br><span class="line"><span class="comment">// 2、拥有相同的调用结果处理方式 都有success、fail、complete三个回调属性</span></span><br></pre></td></tr></table></figure>
<h5 id="小程序组件">小程序组件</h5>
<h6 id="icon"><a href="developers.weixin.qq.com/miniprogram/dev/component/icon.html">icon</a></h6>
<p><strong>扩展问题：icon组件介绍及如何自定义实现图标?</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;icon type=<span class="string">&quot;success&quot;</span> size=<span class="string">&quot;30px&quot;</span> color=<span class="string">&quot;green&quot;</span> /&gt;</span><br><span class="line">type类型范围:[<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;success_no_circle&#x27;</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;warn&#x27;</span>,<span class="string">&#x27;waiting&#x27;</span>,<span class="string">&#x27;cancel&#x27;</span>,<span class="string">&#x27;download&#x27;</span>, <span class="string">&#x27;search&#x27;</span>, <span class="string">&#x27;clear&#x27;</span>]</span><br><span class="line"></span><br><span class="line">&lt;icon type=<span class="string">&quot;success&quot;</span> size=<span class="string">&quot;100rpx&quot;</span>/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">icon</span> <span class="attr">style</span>=<span class="string">&quot;background:grey;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">size</span>=<span class="string">&quot;100rpx&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240319160631191.png" alt="image-20240319160631191"></p>
<p><strong>扩展问题：图标能否与文本同行，放在段落中?</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可以 但是不能在text标签内使用字体图标</span><br></pre></td></tr></table></figure>
<p><strong>扩展问题：实现icon图标的方案有哪些，原理是什么?</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.sprite_icon</span> &#123; </span><br><span class="line"> <span class="attribute">display</span>: block;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">80px</span>; </span><br><span class="line"> <span class="comment">/* 此处在wxss中，可以使⽤⽹络图⽚，不能使⽤本地图⽚ */</span></span><br><span class="line"> <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;https://cdn.nlark.com/..1bd0.png&quot;</span>) -<span class="number">180px</span> -<span class="number">310px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240319161138667.png" alt="image-20240319161138667"></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 使⽤css3绘制图标 */</span></span><br><span class="line"><span class="selector-class">.icon-close</span> &#123;</span><br><span class="line"> <span class="attribute">display</span>: inline-block;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">17px</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line"> <span class="attribute">background</span>: red;</span><br><span class="line"> <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-close</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line"> <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> <span class="attribute">display</span>: block;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">17px</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line"> <span class="attribute">background</span>: red;</span><br><span class="line"> <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">90deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240319161157952.png" alt="image-20240319161157952"></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line"> <span class="attribute">font-family</span>: <span class="string">&#x27;iconfont&#x27;</span>;</span><br><span class="line"> <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.eot&#x27;</span>);</span><br><span class="line"> <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.eot?#iefix&#x27;</span>)</span><br><span class="line"> <span class="built_in">format</span>(<span class="string">&#x27;embedded-opentype&#x27;</span>),</span><br><span class="line"> <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.woff2&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>),</span><br><span class="line"> <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.woff&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff&#x27;</span>),</span><br><span class="line"> <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.ttf&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;truetype&#x27;</span>),</span><br><span class="line"> <span class="built_in">url</span>(<span class="string">&#x27;//at.alicdn.com/t/font_1716930_3m30jvz589y.svg#iconfont&#x27;</span>) <span class="built_in">format</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.iconfont</span> &#123;</span><br><span class="line"> <span class="attribute">font-family</span>: <span class="string">&quot;iconfont&quot;</span> <span class="meta">!important</span>;</span><br><span class="line"> <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line"> <span class="attribute">font-style</span>: normal;</span><br><span class="line"> -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line"> -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.icon-sun</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line"> <span class="attribute">content</span>: <span class="string">&quot;\e603&quot;</span>;</span><br><span class="line"> <span class="attribute">color</span>: red;</span><br><span class="line"> <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="attribute">icon</span> class=&quot;iconfont <span class="attribute">icon</span>-sun&quot;&gt;&lt;/<span class="attribute">icon</span>&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240319161219064.png" alt="image-20240319161219064"></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">www<span class="selector-class">.sojson</span><span class="selector-class">.com</span>/image2base64<span class="selector-class">.html</span></span><br><span class="line"><span class="selector-class">.svg-icon</span>&#123;</span><br><span class="line"> <span class="attribute">display</span>: block;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">200px</span>; </span><br><span class="line"> <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line"> <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/svg+xml;base64,PHN...Zz4=&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="attribute">icon</span> class=&quot;svg-<span class="attribute">icon</span>&quot;&gt;&lt;/<span class="attribute">icon</span>&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240319161234777.png" alt="image-20240319161234777"></p>
<p><strong>拓展问题：有时候真机上显示icon空白，不正常显示的问题</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">有人觉得可能是因为url导致的 因为字体文件的url没有在安全域名中定义 访问被拒绝了 其实不是 在wxss中加载图片及字体文件资源是允许使用外域地址的 如果图标是自定义实现的 要检查下机型及嵌入的字体文件类型 很有可能是兼容性引起的 在小程序中推荐使用woff和ttf格式的字体 如果使用的是这俩问题依然存在的话 可以考虑SVG格式的数据嵌入 </span><br></pre></td></tr></table></figure>
<p><strong>拓展问题：weui组件库里的icon组件的图标如何取出来，保存到本地?</strong><br>
答：<a href="https://git.weixin.qq.com/rxyk/weapp-practice/repository/archive.zip?ref=2.1-icon-514">sketch设计稿</a></p>
<h6 id="progress">progress</h6>
<p><strong>实现简易下载效果</strong></p>
<p>wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;progress-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;progress-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">progress</span> <span class="attr">class</span>=<span class="string">&quot;mt&quot;</span> <span class="attr">percent</span>=<span class="string">&#x27;&#123;&#123;percentValue&#125;&#125;&#x27;</span> <span class="attr">border-radius</span>=<span class="string">&#x27;50&#x27;</span> <span class="attr">stroke-width</span>=<span class="string">&#x27;10&#x27;</span> <span class="attr">active</span> <span class="attr">active-mode</span>=<span class="string">&quot;forwards&quot;</span> <span class="attr">bindactiveend</span>=<span class="string">&#x27;complete&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">progress</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;icons&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">icon</span> <span class="attr">class</span>=<span class="string">&quot;progress-cancel&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cancel&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;cancel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">icon</span> <span class="attr">class</span>=<span class="string">&quot;progress-cancel&quot;</span> <span class="attr">type</span>=<span class="string">&quot;download&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;download&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">icon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isShow&#125;&#125;&quot;</span>&gt;</span>下载完成<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isShow2&#125;&#125;&quot;</span>&gt;</span>暂停下载<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">	<span class="attr">data</span>: &#123;</span><br><span class="line">		<span class="attr">percentValue</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">isShow</span>: <span class="literal">false</span>,</span><br><span class="line">		<span class="attr">isShow2</span>: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 动画完成</span></span><br><span class="line">	<span class="title function_">complete</span>(<span class="params">e</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (e.<span class="property">detail</span>.<span class="property">curPercent</span> &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">				<span class="attr">isShow</span>: <span class="literal">true</span></span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 暂停动画</span></span><br><span class="line">	<span class="title function_">cancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">		<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">			<span class="attr">isShow2</span>: <span class="literal">true</span></span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 继续下载</span></span><br><span class="line">	<span class="title function_">download</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">		<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">			<span class="attr">isShow2</span>: <span class="literal">false</span></span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">percentValue</span> &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">				<span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">				<span class="attr">percentValue</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">percentValue</span> += <span class="number">10</span></span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;, <span class="number">500</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">percentValue</span> &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">				<span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">				<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">					<span class="attr">isShow2</span>: <span class="literal">false</span></span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">				<span class="attr">percentValue</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">percentValue</span> += <span class="number">10</span></span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;, <span class="number">500</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>拓展问题：progress 已产生的进度条如何设置圆角?</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;progress <span class="attribute">border-radius</span>=&quot;<span class="number">5</span>&quot; percent=&quot;<span class="number">20</span>&quot; show-info /&gt;</span><br><span class="line"><span class="selector-class">.wx-progress-inner-bar</span> &#123;</span><br><span class="line"> <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line"> <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wx-progress-inner-bar</span> &#123;</span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展问题：如何实现环形进度条？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">代码太多...</span><br></pre></td></tr></table></figure>
<p><strong>扩展问题：已经加载完的进度条progress,如何点击某个按钮让它重新加载呢?</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式一</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">percentValue</span>: <span class="number">0</span> &#125;);</span><br><span class="line">	<span class="keyword">if</span> (wx.<span class="title function_">canIUse</span>(<span class="string">&#x27;nextTick&#x27;</span>)) &#123;</span><br><span class="line">		wx.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">percentValue</span>: <span class="number">100</span> &#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 小程序每秒渲染的帧数是60帧</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">percentValue</span>: <span class="number">100</span> &#125;);</span><br><span class="line">		&#125;, <span class="number">17</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二</span></span><br><span class="line"><span class="title function_">onTapReloadBtn</span>(<span class="params">e</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">percentValue</span>: <span class="number">0</span> &#125;)</span><br><span class="line">	<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">percentValue</span>: <span class="number">50</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展问题：progress石边进度的百分比数字,它的颜色怎么设置?</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;gap&quot;</span>&gt;</span>progress 右边进度的百分比数字，它的颜色怎么设置？<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">progress</span> <span class="attr">percent</span>=<span class="string">&quot;40&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;5&quot;</span> <span class="attr">show-info</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">.wx-progress-info &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="rich-text">rich-text</h6>
<p>rich-text.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- emsp: 中文字符空格大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">space</span>=<span class="string">&quot;emsp&quot;</span> <span class="attr">nodes</span>=<span class="string">&quot;&#123;&#123;nodes&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;tap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>=====================<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section-title&quot;</span>&gt;</span>通过HTML String渲染<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-content&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">nodes</span>=<span class="string">&quot;&#123;&#123;htmlSnip&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>rich-text.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="comment">// name: 表示节点名称</span></span><br><span class="line">        <span class="comment">// attrs: 节点属性</span></span><br><span class="line">        <span class="comment">// class: 类名</span></span><br><span class="line">        <span class="comment">// style: 样式</span></span><br><span class="line">        <span class="attr">nodes</span>: [&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">            <span class="attr">attrs</span>: &#123;</span><br><span class="line">                <span class="attr">class</span>: <span class="string">&#x27;div_class&#x27;</span>,</span><br><span class="line">                <span class="attr">style</span>: <span class="string">&#x27;line-height: 20px;padding:20px;&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">children</span>: [&#123;</span><br><span class="line">                <span class="comment">// text文本节点</span></span><br><span class="line">                <span class="comment">// 注: 如果不是text节点 则必须有一个name属性</span></span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: <span class="string">&#x27;⼩程序实践&#x27;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="comment">// 图片节点</span></span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;img&#x27;</span>,</span><br><span class="line">                <span class="attr">attrs</span>: &#123;</span><br><span class="line">                    <span class="attr">src</span>: <span class="string">&#x27;https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/dba375885a62e4436a6b969d74bad683.jpg?thumb=1&amp;w=1533&amp;h=575&amp;f=webp&amp;q=90&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 解决图片缝隙问题</span></span><br><span class="line">                    <span class="comment">// 小程序不允许外部修改内部的img样式 我们可以修改node节点img样式</span></span><br><span class="line">                    <span class="comment">// style: &#x27;width:100%;font-size:0;display:block;&#x27;</span></span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;img&#x27;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// rich-text.wxss</span></span><br><span class="line">                    <span class="comment">// .img&#123;</span></span><br><span class="line">                    <span class="comment">// font-size:0;</span></span><br><span class="line">                    <span class="comment">// display:block;</span></span><br><span class="line">                    <span class="comment">// &#125;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;img&#x27;</span>,</span><br><span class="line">                <span class="attr">attrs</span>: &#123;</span><br><span class="line">                    <span class="attr">src</span>: <span class="string">&#x27;https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/b915dfd62177e40b5a9c760e90250cc0.jpg?thumb=1&amp;w=1533&amp;h=575&amp;f=webp&amp;q=90&#x27;</span>,</span><br><span class="line">                    <span class="attr">style</span>: <span class="string">&#x27;width:100%&#x27;</span>,</span><br><span class="line">                    <span class="attr">class</span>: <span class="string">&#x27;img&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;img&#x27;</span>,</span><br><span class="line">                <span class="attr">attrs</span>: &#123;</span><br><span class="line">                    <span class="attr">src</span>: <span class="string">&#x27;https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/0ba9f03efa17f17ca26cebf9364c1ff9.jpg?thumb=1&amp;w=1533&amp;h=575&amp;f=webp&amp;q=90&#x27;</span>,</span><br><span class="line">                    <span class="attr">style</span>: <span class="string">&#x27;width:100%&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">urls</span>: [],</span><br><span class="line">        <span class="attr">htmlSnip</span>: <span class="string">`&lt;div class=&quot;div_class&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Title&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p class=&quot;p&quot;&gt;</span></span><br><span class="line"><span class="string">          渲染出来了 ~</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 取出 urls</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">findUrl</span>(<span class="params">nodes</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> urls = []</span><br><span class="line">            nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 如果有attrs属性</span></span><br><span class="line">                <span class="keyword">if</span> (item.<span class="property">attrs</span>) &#123;</span><br><span class="line">                    <span class="comment">// 遍历attrs属性</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> item.<span class="property">attrs</span>) &#123;</span><br><span class="line">                        <span class="comment">// 如果键是src</span></span><br><span class="line">                        <span class="keyword">if</span> (key == <span class="string">&#x27;src&#x27;</span>) &#123;</span><br><span class="line">                            <span class="comment">// 保存到数组中</span></span><br><span class="line">                            urls.<span class="title function_">push</span>(item.<span class="property">attrs</span>[key])</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 判断有没有字节点</span></span><br><span class="line">                <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">                    <span class="comment">// 如果有则递归调用</span></span><br><span class="line">                    <span class="comment">// 将返回的结果合并到上一个数组中</span></span><br><span class="line">                    urls = urls.<span class="title function_">concat</span>(<span class="title function_">findUrl</span>(item.<span class="property">children</span>))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span> urls</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">urls</span> = <span class="title function_">findUrl</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">nodes</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 点击图片实现预览</span></span><br><span class="line">    <span class="title function_">tap</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="comment">// 鼠标点击的位置 / 图片的高度 =&gt; 向下取整作为urls的下标</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e.<span class="property">detail</span>.<span class="property">y</span> / <span class="number">134</span>)</span><br><span class="line">        <span class="keyword">let</span> urls = <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">urls</span></span><br><span class="line">        wx.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">            <span class="comment">// 当前图片</span></span><br><span class="line">            <span class="attr">current</span>: urls[index],</span><br><span class="line">            <span class="comment">// 图片数组</span></span><br><span class="line">            <span class="attr">urls</span>: urls</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>拓展问题：如何预览保存rich-text富文本组件中的图片？</strong></p>
<p>思路：如果可以使用单击事件，以单击事件的事件源currentTarget获取到目标组件，再判断组件是不是image，如果是就取它的src属性就能实现预览和下载，但是rich-text中所有节点都屏蔽了单击事件，所以此方法是行不通的，但我们仍然可以添加tap事件，在事件函数中使用wx.previewImage接口预览图片，然后选择需要的图片下载，需要注意的是， 预览之前我们需要遍历rich-text中nodes数据，将所有图片地址预先取出来，当单击rich-text时，触发预览，在事件句柄中，事件对象是一个TouchEvent对象，使用其pageX、pageY属性，判断用户大概点击了什么位置，如果以位置可以判断出是哪一张，就将其作为wx.previewImage的第一个参数传进去，如果不能，就选第一张即可</p>
<p><strong>拓展问题：在富文本rich-text里面怎么插入ad 广告标签？如何将HTML文本直接解析呈现？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">代码太多...</span><br></pre></td></tr></table></figure>
<h6 id="view"><a href="https://developers.weixin.qq.com/miniprogram/dev/component/view.html">view</a></h6>
<p><strong>扩展问题：如何把 view 上的内容绘制在画布上，生成一张海报?</strong></p>
<p>思路：view不能直接转绘到画布上，如果想生成海报，一种可行的办法是这样</p>
<ul>
<li>用wx.createCanvasContext创建一个画布</li>
<li>在画布上绘制内容，文本，图片</li>
<li>wx.canvasToTempFilePath保存到本地并获取一个临时图片路径</li>
<li>wx.saveImageToPhotosAlbum保存临时文件到相册里</li>
</ul>
<p><a href="https://github.com/Kujiale-Mobile/Painter">GitHub - Kujiale-Mobile/Painter: 小程序生成图片库，轻松通过 json 方式绘制一张可以发到朋友圈的图片</a></p>
<p><a href="https://github.com/wechat-miniprogram/wxml-to-canvas">wxml-to-canvas</a></p>
<p><img data-src="image-20240321114537787.png" alt="image-20240321114537787"></p>
<h6 id="image"><a href="https://developers.weixin.qq.com/miniprogram/dev/component/image.html">image</a></h6>
<h6 id="swiper"><a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html">swiper</a></h6>
<h6 id="scrollview">scrollview</h6>
<p>scrollview.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;height: 300rpx;background-color: aquamarine;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    bindscrolltolower: 滚动到底部/右边时触发 </span></span><br><span class="line"><span class="comment">    refresher-enabled: 开启下拉刷新</span></span><br><span class="line"><span class="comment">    refresher-triggered: 下拉刷新状态</span></span><br><span class="line"><span class="comment">    bindrefresherrefresh: 下拉刷新触发的回调</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>纵向scroll-view<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   	<span class="comment">&lt;!-- 注意: 当开启scroll-y时 一定要给组件一个高度 子组件的高度之和一定要大于这个高度 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;sv&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">scroll-y</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindscrolltolower</span>=<span class="string">&quot;toLoewrHandler&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">refresher-enabled</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">refresher-triggered</span>=<span class="string">&quot;&#123;&#123;isReFresh&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindrefresherrefresh</span>=<span class="string">&quot;refreshHandler&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;swiperList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.imgUrl&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100vw;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>横向scroll-view<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    enable-flex: 启用 flexbox 布局</span></span><br><span class="line"><span class="comment">    scroll-x: 启用横向滚动</span></span><br><span class="line"><span class="comment">    注意: 启用时要给组件一个宽度 一般这个值是100%等于屏宽 子组件的宽度之和要大于屏宽 </span></span><br><span class="line"><span class="comment">    如果出现不滚动的现象尝试给容器添加这两个样式: white-space: nowrap; display:inline-block</span></span><br><span class="line"><span class="comment">	目的是为了让子元素在横向上排列成一行 </span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;sv2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">enable-flex</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">scroll-x</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindscrolltolower</span>=<span class="string">&quot;toRightHandler&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;swiperList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.imgUrl&#125;&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100vw;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;widthFix&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>scrollview.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">swiperList</span>: [],</span><br><span class="line">        <span class="attr">isReFresh</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toRightHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getProductList&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="keyword">const</span> &#123;data&#125; = result</span><br><span class="line">               <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                <span class="comment">// 实现上拉加载的效果</span></span><br><span class="line">                <span class="comment">// 在之前的数据数组中追加新的数据</span></span><br><span class="line">                  <span class="attr">swiperList</span>: [</span><br><span class="line">                      ...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">swiperList</span>,</span><br><span class="line">                      ...data</span><br><span class="line">                  ]</span><br><span class="line">               &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">refreshHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getProductList&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="keyword">const</span> &#123;data&#125; = result</span><br><span class="line">               <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                <span class="comment">// 实现上拉加载的效果</span></span><br><span class="line">                <span class="comment">// 在之前的数据数组中追加新的数据</span></span><br><span class="line">                  <span class="attr">swiperList</span>: [</span><br><span class="line">                      ...data,</span><br><span class="line">                      ...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">swiperList</span>,</span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">isReFresh</span>: <span class="literal">false</span></span><br><span class="line">               &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toLoewrHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getProductList&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="keyword">const</span> &#123;data&#125; = result</span><br><span class="line">               <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                <span class="comment">// 实现上拉加载的效果</span></span><br><span class="line">                <span class="comment">// 在之前的数据数组中追加新的数据</span></span><br><span class="line">                  <span class="attr">swiperList</span>: [</span><br><span class="line">                      ...<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">swiperList</span>,</span><br><span class="line">                      ...data</span><br><span class="line">                  ]</span><br><span class="line">               &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getProductList&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">               <span class="keyword">const</span> &#123;data&#125; = result</span><br><span class="line">               <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                  <span class="attr">swiperList</span>: data</span><br><span class="line">               &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>scrollview.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.sv</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sv2</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item2</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">400</span>rpx;</span><br><span class="line">    <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="movable-view"><a href="https://developers.weixin.qq.com/miniprogram/dev/component/movable-view.html">movable-view</a></h6>
<p><strong>左滑删除实现</strong></p>
<p>slide-view.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 左滑删除1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section-title&quot;</span>&gt;</span>左侧删除1<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">movable-area</span> <span class="attr">style</span>=<span class="string">&quot;width:750rpx;height:100rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">movable-view</span> <span class="attr">style</span>=<span class="string">&quot;width:1050rpx;height:100rpx;&quot;</span> <span class="attr">direction</span>=<span class="string">&quot;horizontal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;max&quot;</span> <span class="attr">direction</span>=<span class="string">&quot;all&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>这⾥是插⼊到组内容 1<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;read&quot;</span>&gt;</span>已读<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">movable-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">movable-area</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 左滑删除2 使用第三方模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section-title&quot;</span>&gt;</span>左侧删除2<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slide-view</span> <span class="attr">class</span>=<span class="string">&quot;slide&quot;</span> <span class="attr">width</span>=<span class="string">&quot;750&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">slideWidth</span>=<span class="string">&quot;300&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span>&gt;</span>这⾥是插⼊到组内容 2<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span> <span class="attr">slot</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;read&quot;</span>&gt;</span>已读<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slide-view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 左滑删除3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section-title&quot;</span>&gt;</span>左侧删除3<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page__bd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mp-slideview</span> <span class="attr">ext-class</span>=<span class="string">&quot;slideViewClass&quot;</span> <span class="attr">buttons</span>=<span class="string">&quot;&#123;&#123;slideButtons&#125;&#125;&quot;</span> <span class="attr">bindbuttontap</span>=<span class="string">&quot;slideButtonTap&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mp-cell</span> <span class="attr">value</span>=<span class="string">&quot;标题文字&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mp-cell</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mp-slideview</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-cells&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mp-slideview</span> <span class="attr">buttons</span>=<span class="string">&quot;&#123;&#123;slideButtons&#125;&#125;&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class="attr">bindbuttontap</span>=<span class="string">&quot;slideButtonTap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;weui-slidecell&quot;</span>&gt;</span></span><br><span class="line">    左滑可以删除（图标Button）</span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mp-slideview</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>slide-view.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> base64 = <span class="built_in">require</span>(<span class="string">&quot;../../images/base64&quot;</span>);</span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">widget</span> = <span class="variable language_">this</span>.<span class="title function_">selectComponent</span>(<span class="string">&#x27;.widget&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">icon</span>: base64.<span class="property">icon20</span>,</span><br><span class="line">      <span class="attr">slideButtons</span>: [&#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;普通1&#x27;</span>,</span><br><span class="line">        <span class="attr">src</span>: <span class="string">&#x27;/images/icon_love.svg&#x27;</span>, <span class="comment">// icon的路径</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;普通2&#x27;</span>,</span><br><span class="line">        <span class="attr">extClass</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">        <span class="attr">src</span>: <span class="string">&#x27;/images/icon_star.svg&#x27;</span>, <span class="comment">// icon的路径</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;警示3&#x27;</span>,</span><br><span class="line">        <span class="attr">extClass</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">        <span class="attr">src</span>: <span class="string">&#x27;/images/icon_del.svg&#x27;</span>, <span class="comment">// icon的路径</span></span><br><span class="line">      &#125;],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>slide-view.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;slide-view&quot;</span><span class="punctuation">:</span> <span class="string">&quot;miniprogram-slide-view&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp-slideview&quot;</span><span class="punctuation">:</span> <span class="string">&quot;weui-miniprogram/slideview/slideview&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mp-cell&quot;</span><span class="punctuation">:</span> <span class="string">&quot;weui-miniprogram/cell/cell&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>slide-view.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">movable-view &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#1AAD19</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">movable-area &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.max</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">600</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">600</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 左滑删除1 */</span></span><br><span class="line"><span class="selector-class">.list_item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#DEDEDE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 左侧删除2 */</span></span><br><span class="line"><span class="selector-class">.slide</span>&#123;</span><br><span class="line">  <span class="comment">/* border-top:1px solid #ccc; */</span></span><br><span class="line">  <span class="attribute">border-bottom</span>:<span class="number">1px</span> solid <span class="number">#DEDEDE</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">750</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">color</span>: grey;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100</span>rpx;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">direction</span>: row;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">110</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.read</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.delete</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: red;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150</span>rpx; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  */</span></span><br><span class="line"><span class="selector-class">.slideViewClass</span> <span class="selector-class">.weui-cell</span>&#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="shopCar">shopCar</h6>
<p>shopCar.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">wxs</span> <span class="attr">src</span>=<span class="string">&#x27;./getSum.wxs&#x27;</span> <span class="attr">module</span>=<span class="string">&quot;getSum&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">wxs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;productList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">checkbox</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">checked</span>=<span class="string">&quot;&#123;&#123;item.isChecked&#125;&#125;&quot;</span> <span class="attr">catchtap</span>=<span class="string">&quot;clickHandler&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">data-index</span>=<span class="string">&#x27;&#123;&#123;index&#125;&#125;&#x27;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item.price&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item.number&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;total&quot;</span>&gt;</span>总价: &#123;&#123;getSum(productList)&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>shopCar.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">productList</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;白象方便面&#x27;</span>,</span><br><span class="line">                <span class="attr">price</span>: <span class="number">50</span>,</span><br><span class="line">                <span class="attr">number</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">isChecked</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;鸿星尔克哈&#x27;</span>,</span><br><span class="line">                <span class="attr">price</span>: <span class="number">99</span>,</span><br><span class="line">                <span class="attr">number</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">isChecked</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;卫龙辣条哈&#x27;</span>,</span><br><span class="line">                <span class="attr">price</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="attr">number</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">isChecked</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;德芙巧克力&#x27;</span>,</span><br><span class="line">                <span class="attr">price</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="attr">number</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">isChecked</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">clickHandler</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取页面传来的index</span></span><br><span class="line">        <span class="keyword">let</span> index = e.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">index</span></span><br><span class="line">        <span class="comment">// 找到数组中对应index数据 对其isChecked属性进行取反操作</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">productList</span>[index].<span class="property">isChecked</span> =!<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">productList</span>[index].<span class="property">isChecked</span></span><br><span class="line">        <span class="comment">// 更新数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">productList</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">productList</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>shopCar.wxs</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getSum</span>(<span class="params">productList</span>) &#123;</span><br><span class="line">    <span class="comment">// 目前仅支持es5的语法</span></span><br><span class="line">    <span class="keyword">var</span> total = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;productList.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        <span class="comment">// 如果商品被选中</span></span><br><span class="line">        <span class="keyword">if</span>(productList[i].<span class="property">isChecked</span>)&#123;</span><br><span class="line">            <span class="comment">// 计算总价</span></span><br><span class="line">            total += productList[i].<span class="property">price</span> * productList[i]. number</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 暴露</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = getSum</span><br></pre></td></tr></table></figure>
<p>shopCar.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">100</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.total</span> &#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">100</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="自定义组件"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/">自定义组件</a></h5>
<h6 id="selfComponent">selfComponent</h6>
<p>selfComponent.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">navbar</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">parentList</span>=<span class="string">&#x27;&#123;&#123;[&quot;电影&quot;,&quot;综艺&quot;, &quot;科幻&quot;]&#125;&#125;&#x27;</span> <span class="attr">parentCurrent</span>=<span class="string">&quot;&#123;&#123;parentCurrent&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bind:parentEvent</span>=<span class="string">&quot;parentEvent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">navbar</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swiper</span>  <span class="attr">bindchange</span>=<span class="string">&#x27;changeHandler&#x27;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">current</span>=<span class="string">&quot;&#123;&#123;parentCurrent&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span>电影<span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span>综艺<span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span>科幻<span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>selfComponent.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">parentCurrent</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">changeHandler</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取轮播图当前所在的index</span></span><br><span class="line">        <span class="keyword">const</span> &#123;current&#125; = e.<span class="property">detail</span>;</span><br><span class="line">        <span class="comment">// 保存index</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">parentCurrent</span>: current</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">parentEvent</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="comment">// e.detail: 子组件传过来的参数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">parentCurrent</span>: e.<span class="property">detail</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>selfComponent.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;usingComponents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;navbar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../components/navbar/navbar&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>selfComponent.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">swiper &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">40</span>rpx;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">280</span>rpx;</span><br><span class="line">    <span class="attribute">background-color</span>: chartreuse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="navbar">navbar</h6>
<p>navbar.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;parentList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;*this&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;&#123;&#123;parentCurrent==index?&#x27;active&#x27;:&#x27;&#x27;&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindtap</span>=<span class="string">&quot;clickHandler&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-index</span>=<span class="string">&quot;&#123;&#123;index&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>navbar.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组件的属性列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">properties</span>: &#123;</span><br><span class="line">        <span class="attr">parentList</span>: &#123;</span><br><span class="line">            <span class="comment">// 类型检测</span></span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">            <span class="comment">// 默认值</span></span><br><span class="line">            <span class="attr">default</span>: [<span class="string">&quot;笔记本&quot;</span>, <span class="string">&quot;手机&quot;</span>, <span class="string">&quot;平板&quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">parentCurrent</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组件的初始数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="comment">// list: [&quot;笔记本&quot;, &quot;手机&quot;, &quot;平板&quot;],</span></span><br><span class="line">        <span class="comment">// current: 0</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组件的方法列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="comment">// clickHandler(e)&#123;</span></span><br><span class="line">        <span class="comment">//     this.setData(&#123;</span></span><br><span class="line">        <span class="comment">//         current: e.currentTarget.dataset.index</span></span><br><span class="line">        <span class="comment">//     &#125;)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不能再使用上面方式修改数据了</span></span><br><span class="line">        <span class="comment">// 因为页面上使用的是父级传过来的parentCurrent</span></span><br><span class="line">        <span class="comment">// 所以我们要通知父级 让父级去修改数据</span></span><br><span class="line">        <span class="title function_">clickHandler</span>(<span class="params">e</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&#x27;parentEvent&#x27;</span>, e.<span class="property">currentTarget</span>.<span class="property">dataset</span>.<span class="property">index</span>) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>navbar.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100</span>rpx;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.active</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="slot插槽">slot插槽</h5>
<p>header.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;left&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;right&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>header.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="comment">// 在组件定义时的选项中启用多slot支持</span></span><br><span class="line">        <span class="attr">multipleSlots</span>: <span class="literal">true</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>header.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将上面组件引入到页面中使用</p>
<p>slot.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;left&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;tapHandler&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">slot</span>=<span class="string">&quot;right&quot;</span>&gt;</span>个人<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;isCreated&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>slot.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">isCreated</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">tapHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">isCreated</span>: !<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">isCreated</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>slot.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;usingComponents&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;header&quot;</span>: <span class="string">&quot;../../components/header/header&quot;</span>,</span><br><span class="line">    <span class="string">&quot;footer&quot;</span>: <span class="string">&quot;../../components/footer/footer&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="组件的生命周期">组件的生命周期</h5>
<p><img data-src="image-20220908220753798.png" alt="image-20220908220753798"></p>
<p>count.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">count</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">        <span class="title function_">created</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">count</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 在组件实例进入页面节点树时执行</span></span><br><span class="line">        <span class="title function_">attached</span>(<span class="params"></span>)&#123; </span><br><span class="line">            <span class="comment">// 开启定时器</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">count</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="comment">// 通知父组件移除子组件</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">triggerEvent</span>(<span class="string">&quot;removeTimeId&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                    <span class="attr">count</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">count</span> -= <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 在组件实例被从页面节点树移除时执行</span></span><br><span class="line">        <span class="title function_">detached</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="路由跳转">路由跳转</h5>
<p><img data-src="image-20220908225310387.png" alt=""></p>
<h5 id="页面生命周期">页面生命周期</h5>
<p><img data-src="https://res.wx.qq.com/wxdoc/dist/assets/img/page-lifecycle.2e646c86.png" alt="img"></p>
<p>pageLife.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;msg&#125;&#125;</span><br><span class="line">   <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;clickHandler&quot;</span>&gt;</span>跳转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>pageLife.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面的初始数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;若有诗书藏于心 岁月从不败美人&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">clickHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。使用 wx.navigateBack 可以返回到原页面。小程序中页面栈最多十层</span></span><br><span class="line">        wx.<span class="title function_">redirectTo</span>(&#123;</span><br><span class="line">            <span class="comment">// ?id=2 路由传参 </span></span><br><span class="line">            <span class="comment">// 通过onload的形参options接收该参数</span></span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;/pages/07-shopcar/07-shopcar?id=2&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听页面加载&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onReady</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听页面初次渲染完成&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听页面显示&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面隐藏</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onHide</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听页面隐藏&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面卸载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onUnload</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听页面卸载&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="获取用户信息">获取用户信息</h5>
<p>getUserInfo.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 40rpx;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">bindtap</span>=<span class="string">&quot;getUserInfo&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;!userInfo.avatarUrl&#125;&#125;&quot;</span>&gt;</span>获取用户信息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;userInfo.avatarUrl&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;userInfo.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 40rpx;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">open-type</span>=<span class="string">&quot;share&quot;</span>&gt;</span>分享当前页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- &lt;button type=&quot;primary&quot; style=&quot;margin-top: 40rpx;&quot; open-type=&quot;getUserInfo&quot;</span></span><br><span class="line"><span class="comment">    bindgetuserinfo=&quot;getUserInfo&quot;&gt;获取用户信息&lt;/button&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- &lt;button style=&quot;margin-top: 40rpx;&quot;</span></span><br><span class="line"><span class="comment">    type=&quot;primary&quot;</span></span><br><span class="line"><span class="comment">    open-type=&quot;getPhoneNumber&quot;</span></span><br><span class="line"><span class="comment">    bindgetphonenumber=&quot;getPhoneNumber&quot;</span></span><br><span class="line"><span class="comment">    &gt;获取用户电话&lt;/button&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>getUserInfo.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getUserInfo</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        wx.<span class="title function_">getUserProfile</span>(&#123;</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;desc&#x27;</span>,</span><br><span class="line">            <span class="attr">lang</span>: <span class="string">&#x27;zh_CN&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">                    <span class="attr">userInfo</span>: res.<span class="property">userInfo</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// 将用户信息保存到本地缓存中</span></span><br><span class="line">                wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;userInfo&#x27;</span>, res.<span class="property">userInfo</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// getPhoneNumber(phone)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(phone)</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="comment">// 每次加载页面从本地缓存中取出用户数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">userInfo</span>: wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onPullDownRefresh</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;监听用户下拉动作&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onReachBottom</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上拉触底&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户点击右上角分享</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">onShareAppMessage</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">from</span> == <span class="string">&#x27;button&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">from</span> == <span class="string">&#x27;menu&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">222</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;好兄弟帮忙砍一刀&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/pages/12-getUserInfo/12-getUserInfo&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>getUserInfo.wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">100</span>rpx;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> image &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200</span>rpx;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200</span>rpx;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">100</span>rpx;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">40</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="获取用户openId">获取用户openId</h5>
<p>openId.wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-top: 40rpx;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;tapHandler&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>获取用户code<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>openId.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="comment">// 获取用户的code</span></span><br><span class="line">    <span class="title function_">tapHandler</span>(<span class="params"></span>)&#123;</span><br><span class="line">        wx.<span class="title function_">login</span>(&#123; </span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(res.<span class="property">code</span>) &#123;</span><br><span class="line">                    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">                      <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getOpenId&#x27;</span>,</span><br><span class="line">                      <span class="attr">data</span>: &#123;<span class="attr">code</span>: res.<span class="property">code</span>&#125;,</span><br><span class="line">                      <span class="title function_">success</span>(<span class="params">res</span>)&#123;</span><br><span class="line">                        wx.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;token&#x27;</span>, res.<span class="property">data</span>)</span><br><span class="line">                      &#125; </span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后端如何处理code？代码如下 要求了解</span></span><br><span class="line">    <span class="comment">// 获取openId</span></span><br><span class="line">    <span class="comment">// app.use(&#x27;/getOpenId&#x27;, async (req, res, next) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     const CODE = req.query.code</span></span><br><span class="line">    <span class="comment">//     const APPID = &quot;wx13bb6e5496ae00d3&quot;</span></span><br><span class="line">    <span class="comment">//     const APPSECRET =    &quot;c72598c06ee2fc7f167923c3dfa3f116&quot;</span></span><br><span class="line">    <span class="comment">//     let url = `https://api.weixin.qq.com/sns/    jscode2session?appid=$&#123;APPID&#125;&amp;secret=$&#123;APPSECRET&#125;&amp;  js_code=$&#123;CODE&#125;&amp;grant_type=authorization_code`</span></span><br><span class="line">    <span class="comment">//     // 发起请求获取openId</span></span><br><span class="line">    <span class="comment">//     const &#123;data&#125; = await fly.get(&#123;url&#125;)</span></span><br><span class="line">    <span class="comment">//     // 反序列化 data</span></span><br><span class="line">    <span class="comment">//     let openId = JSON.parse(data).openid</span></span><br><span class="line">    <span class="comment">//     // 自定义登录态 =&gt; 将openId和用户信息进行关联</span></span><br><span class="line">    <span class="comment">//     let obj = &#123;</span></span><br><span class="line">    <span class="comment">//       name: &#x27;许&#x27;,</span></span><br><span class="line">    <span class="comment">//       age: 18,</span></span><br><span class="line">    <span class="comment">//       openId</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     // 对登录态进行加密 jsonwebtoken</span></span><br><span class="line">    <span class="comment">//     let token = jwt.sign(obj, &#x27;web2301a&#x27;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     let verifyObj = jwt.verify(token, &#x27;bgs2012A&#x27;)</span></span><br><span class="line">    <span class="comment">//     console.log(verifyObj)</span></span><br><span class="line">    <span class="comment">//     // &#123;</span></span><br><span class="line">    <span class="comment">//     //   name: &#x27;许&#x27;,</span></span><br><span class="line">    <span class="comment">//     //   age: 18,</span></span><br><span class="line">    <span class="comment">//     //   openId: &#x27;oZmUB41o1l8nTYRvDg0NXBYVaUdk&#x27;,</span></span><br><span class="line">    <span class="comment">//     //   iat: 1646789558</span></span><br><span class="line">    <span class="comment">//     // &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     res.send(token)</span></span><br><span class="line">    <span class="comment">//   &#125;)</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="小程序开放能力">小程序开放能力</h4>
<h5 id="小程序连接wifi">小程序连接wifi</h5>
<p>wxml</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-head&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;page-head__title&quot;</span>&gt;</span>微信连wifi<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;page-head__desc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page-section&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;page-section__title&quot;</span>&gt;</span>3.15<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn-area&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;startToConnect&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> connectWifi <span class="keyword">from</span> <span class="string">&#x27;../../lib/connect-wifi&#x27;</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">startToConnect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="title function_">connectWifi</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;startToConnect result&quot;</span>,res)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>wifi-connect.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">connectWifi</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ssid = <span class="string">&#x27;201&#x27;</span>,</span><br><span class="line">  pass = <span class="string">&#x27;123456789&#x27;</span></span><br><span class="line">  <span class="comment">// 查看平台环境</span></span><br><span class="line">  <span class="keyword">let</span> sysInfo = wx.<span class="title function_">getSystemInfoSync</span>()</span><br><span class="line">  <span class="keyword">let</span> platform = sysInfo.<span class="property">platform</span></span><br><span class="line">  <span class="comment">// devtools/android/ios </span></span><br><span class="line">  <span class="comment">// ios:iOS 10.0.1</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;platform&quot;</span>, platform, sysInfo.<span class="property">system</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 只有ios 11以上，及andoird 6以上，才有这样的wifi连接功能</span></span><br><span class="line">  <span class="keyword">if</span> (platform == <span class="string">&quot;android&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// android 6.21</span></span><br><span class="line">    <span class="keyword">let</span> sysVersion = <span class="built_in">parseInt</span>(sysInfo.<span class="property">system</span>.<span class="title function_">substr</span>(<span class="number">8</span>))</span><br><span class="line">    <span class="keyword">if</span> (sysVersion &lt; <span class="number">6</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;android版本低&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> res0 = <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">    <span class="comment">// 是否同时获取用户订阅消息的订阅状态，默认不获取。注意：withSubscriptions 只返回用户勾选过订阅面板中的“总是保持以上选择，不再询问”的订阅消息</span></span><br><span class="line">      <span class="attr">withSubscriptions</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">	<span class="comment">// 检查是否有地理位置授权</span></span><br><span class="line">    <span class="keyword">if</span> (res0 &amp;&amp; !res0.<span class="property">authSetting</span>[<span class="string">&quot;scope.userLocation&quot;</span>]) &#123;</span><br><span class="line">      <span class="comment">// 如果没有这个权限，先授权</span></span><br><span class="line">      <span class="keyword">let</span> authRes = <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">authorize</span>(&#123;</span><br><span class="line">        <span class="attr">scope</span>: <span class="string">&#x27;scope.userLocation&#x27;</span></span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (authRes &amp;&amp; authRes.<span class="property">errMsg</span> != <span class="string">&quot;authorize:ok&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;地理授权失败&#x27;</span>, authRes.<span class="property">errMsg</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;android地理授权失败&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform == <span class="string">&quot;ios&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// ios 12.0</span></span><br><span class="line">    <span class="keyword">let</span> sysVersion = <span class="built_in">parseInt</span>(sysInfo.<span class="property">system</span>.<span class="title function_">substr</span>(<span class="number">4</span>))</span><br><span class="line">    <span class="keyword">if</span> (sysVersion &lt; <span class="number">11</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;ios版本低&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;请切到系统设置-&gt;wifi列表，等待wifi连接成功&#x27;</span>,</span><br><span class="line">      <span class="attr">showCancel</span>: <span class="literal">false</span></span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;平台不支持&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 启动wifi模块</span></span><br><span class="line">  <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">startWifi</span>().<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 拉取wifi列表</span></span><br><span class="line">  <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">getWifiList</span>().<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 监听wifi列表到达</span></span><br><span class="line">    wx.<span class="title function_">onGetWifiList</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">wifiList</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="string">&quot;wifi列表为空&quot;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res.wifiList&quot;</span>, res.<span class="property">wifiList</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// var signalStrength = 0;</span></span><br><span class="line">  <span class="keyword">var</span> bssid = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; res.<span class="property">wifiList</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> wifi = res.<span class="property">wifiList</span>[i]</span><br><span class="line">    <span class="keyword">if</span> (wifi.<span class="property">SSID</span> == ssid) &#123;</span><br><span class="line">      <span class="comment">// BSSID: wifi网络的唯一地址</span></span><br><span class="line">      bssid = wifi.<span class="property">BSSID</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!bssid) <span class="keyword">return</span> <span class="string">&#x27;未查询到目标wifi&#x27;</span></span><br><span class="line">  <span class="comment">// 连接wifi</span></span><br><span class="line">  <span class="keyword">let</span> res1 = <span class="keyword">await</span> wx.<span class="property">wxp</span>.<span class="title function_">connectWifi</span>(&#123;</span><br><span class="line">    <span class="attr">SSID</span>: ssid,</span><br><span class="line">    <span class="attr">BSSID</span>: bssid,</span><br><span class="line">    <span class="attr">password</span>: pass</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;err&quot;</span>, err);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`运行错误：<span class="subst">$&#123;err&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (res1) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;wifi连接成功&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;connectWifi:ok&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;未知错误&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connectWifi</span><br></pre></td></tr></table></figure>
<p>app.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;permission&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;scope.userLocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;位置信息用途说明&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="云开发">云开发</h4>
<p><strong>云开发提供的所有能力</strong><br>
云函数<br>
云数据库<br>
云存储<br>
云调用<br>
HTTP API<br>
…</p>
<p><img data-src="image-20220912205119776.png" alt=""></p>
<p><img data-src="image-20220912205219937.png" alt=""></p>
<p><img data-src="image-20220912205522992.png" alt=""></p>
<h5 id="云开发和非云开的区别？">云开发和非云开的区别？</h5>
<p>1：云开发是什么</p>
<p>小程序云开发是一种新的开发方式，它能够帮助开发者快速、便捷地开发小程序。</p>
<p>2：小程序云开发的优势</p>
<p>小程序云开发和非云开发有什么区别？这是一个很好的问题。</p>
<p>首先，我们来看看小程序云开发的优势。</p>
<p>总之，小程序云开发具有诸多优势，能够帮助我们快速、方便、安全地开发小程度。</p>
<p>3：非云开发的优势</p>
<p>首先，我们来看一下小程序云开发和非云开发的区别：</p>
<p>小程序云开发是一种全新的开发方式，它使用了云端的资源，能够更加轻松地开发出高质量的小程序。非云开发则是相对传统的开发方式，使用本地的资源进行开发。</p>
<p>下面我们来看看小程序云开发和非云开发各自的优势：</p>
<p><strong>小程序云开发</strong></p>
<p>使用了云端的资源，能够更加轻松地开发出高质量的小程序。</p>
<p>在运行时也能够得到更好的性能。因为它不会像本地小程序那样占用过多的内存和CPU资源。</p>
<p>代码也更加容易维护和理解。因为代码是分布在不同的文件中，并且采用了标准化的代码风格。</p>
<p>对于新手来说，学习小程序云开发也相对容易一些。因为相对而言，它的代码量要少很多。</p>
<p><strong>非云开发</strong></p>
<p>相对传统的开发方式，使用本地的资源进行开发。</p>
<p>在运行时不会占用过多的内存和CPU资源（如果代码写得好的话)。</p>
<p>代码也相对容易理解和修改。因为代码是集中在一个文件中，并且采用了标准化的代码风格。</p>
<p><strong>总结：</strong></p>
<p><strong>传统开发中</strong>， 开发者不仅需要关注前端的页面展示， 还需要搭建后端的数据库， 购买服务器</p>
<p>和域名，如果是境内服务器， 还需要备案等等。</p>
<p>小程序上线后， 开发者需要定期进行数据库维护、网络安全、负载均衡等工作</p>
<p><strong>云开发中</strong>，开发者只需要关注前端的页面展示， 后端的服务器、维护、安全处理等工作全部由腾讯云代替我们完成，方便了很多！</p>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack 学习</title>
    <url>/blog/2023/08/09/webpack/</url>
    <content><![CDATA[<h4 id="npm相关">npm相关</h4>
<blockquote>
<p>课堂临时记录，后续单独开篇 ~</p>
</blockquote>
<p>在我们需要下载第三方包之前 需要先初始化项目</p>
<p><code>npm init -y</code>: 初始化项目, 生成 package.json 文件</p>
<p><code>init</code> 表示的是初始化</p>
<p><code>-y</code> 表示的是所有需要填写的内容都使用默认的</p>
<span id="more"></span>
<p><strong>package.json字段</strong></p>
<p>name：包名。规范定义它需要由小写的字母和数字组成，可以包含.、_和-，但不允许出现空格。不允许出现中文，<em><strong>*包名必须是唯一的*</strong></em>，以免对外公布时产生重名冲突的误解。除此之外，NPM还建议不要在包名中附带上node或js来重复标识它是JavaScript或Node模块。</p>
<p>author：作者</p>
<p>description：包的简介</p>
<p>version：版本号</p>
<p>main：入口文件</p>
<p>keywords：关键词数组，NPM中主要用来做分类搜索。一个好的关键词数组有利于用户快速找到你编写的包。</p>
<p>devDependencies：一些模块只在开发时需要依赖。配置这个属性，可以提示包的后续开发者安装依赖包。</p>
<p>dependencies：使用当前包所需要依赖的包列表。这个属性十分重要，NPM会通过这个属性帮助自动加载依赖的包。</p>
<p>scripts：脚本说明对象。它主要被包管理器用来安装、编译、测试和卸载包。</p>
<p>bin：一些包作者希望包可以作为命令行工具使用。配置好bin字段后，通过npm install package name -g命令可以将脚本添加到执行路径中，之后可以在命令行中直接执行。前面的node -gyp即是这样安装的。通过-g命令安装的模块包称为全局模式。</p>
<p><strong>dependencies  VS  devDependencies</strong></p>
<p>dependencies：生产依赖 项目在部署运行时需要用到的依赖</p>
<p>(npm i 包名 --save 或者 npm i 包名)</p>
<p>devDependencies：开发依赖 项目在开发时候需要用到的依赖</p>
<p>(npm i 包名 --save-dev 或者 npm i 包名 -D)</p>
<p>还有一种 npm i 包名 –g：全局安装 =&gt; 安装在nodejs目录下的node_modules中</p>
<p>安装在全局的目的是为了在任意位置都能够使用该包</p>
<p>为什么能在任意位置使用它呢？因为配置了环境变量</p>
<p>初始化项目后可以通过 npm i（install） 包名，比如：npm i jquery</p>
<p>来下载第三方模块，第三方模块会默认下载到当前项目下的node_modules中</p>
<p>卸载第三方包：npm un（uninstall） 包名（后缀和安装包的时候保持一致）</p>
<p>npm 设置淘宝镜像源：<code>npm config set registry=https://registry.npm.taobao.org/</code></p>
<h4 id="什么是构建工具">什么是构建工具</h4>
<p><strong>事实上随着前端的快速发展，目前前端的开发已经变的越来越复杂了：</strong></p>
<p>比如开发过程中我们需要通过模块化的方式来开发；</p>
<p>比如也会使用一些高级的特性来加快我们的开发效率或者安全性，比如通过ES6+、TypeScript开发脚本逻辑， 通过sass、less等方式来编写css样式代码；</p>
<p>比如开发过程中，我们还希望实时的监听文件的变化来并且反映到浏览器上，提高开发的效率；</p>
<p>比如开发完成后我们还需要将代码进行压缩、合并以及其他相关的优化；</p>
<p>等等….</p>
<p>上述这些工作理论上是可以人工完成的，但是它繁琐，工作量大，本质是无意义的劳动，人为的错误也随着流程的增加而增加了更多的出错率。所以每一个团队都希望有一种工具，能帮助整个团队在开发中能精简流程、提高效率、减少错误率，管理各种小工具之间的错综复杂的关系或者配置，这种工具就叫构建工具。</p>
<p>说到构建工具，我往往会在前面加**「自动化」**三个字，因为构建工具就是用来让我们不再做机械重复的事情，解放我们的双手的(my god)。所以构建工具作用是：提升项目性能，提高开发效率。</p>
<h4 id="构建工具的发展">构建工具的发展</h4>
<p>有了工具能满足基本的打包工作，对于开发人员而言总是需要更精益求精。就像在一辆能发动的车上去安装各种零件来提升使用者的体验。这些零件就是构建工具所需要的插件，这些插件对提升开发效率很有帮助，包括语法转换（Babel），模板热更新（HotModuleReplacementPlugin），清理重复的打包的文件（clean-webpack-plugin）等等。</p>
<p>构建工具目前来说还在处于不停发展的阶段，但是相应的打包技术已经很成熟。 本次主要介绍市面上比较火热的Gulp，Grunt， Webpack, Vite这三个打包工具之间的对比和它们的优势。</p>
<h4 id="构建工具介绍">构建工具介绍</h4>
<p>Grunt: 是一个优化前端的开发流程的工具。<br>
配置一系列的task，定义task处理的事务（例如文件压缩合并、启动server、版本控制等），然后定义执行顺序，来让Grunt执行这些task，从而构建项目的整个前端开发流程。<br>
工作方式：<br>
<img data-src="image-20220707230125487.png" alt=""></p>
<p>Wepack: 是一种模块化的解决方案。更强调模块化。<br>
把你的项目当做一个整体，通过一个指定的主文件名（index.js, 一般是入口文件），webpack 将从这个文件开始找到你的项目所依赖的文件，使用loaders 来处理它们，最后打包为一个浏览器可识别的js 文件。<br>
<img data-src="image-20220707230147762.png" alt=""></p>
<p>Vite: 一种新型前端构建工具,它区别与不同的打包工具,它在开发环境中不对项目进行整体打包。<br>
原因：当我们的构建的项目越来越庞大时，对整个项目进行资源整合的时间会变长，如果有数千个模块的项目在进行构建时甚至需要几分钟才能启动开发服务器。所以vite解决了在开发过程中需要等待整个项目打包这一段过程，让开发时更加丝滑。<br>
依赖：使用esbuild（GO编写）预构建依赖，比 JavaScript 编写的打包器预构建依赖快 10-100 倍。<br>
源码：在浏览器请求资源时-&gt; vite转换一些非js文件-&gt;动态导入代码。<br>
源码利用浏览器的协商缓存（304 Not Modified），依赖模块请求则会通过 Cache-Control: max-age=31536000, immutable 进行强缓存，保持热更新的速度。<br>
<img data-src="image-20220707230212662.png" alt=""></p>
<h4 id="如何选择适合的构建工具？">如何选择适合的构建工具？</h4>
<p>Grunt对于一些中小型项目而言更加轻便和灵活，如果只针对代码压缩合并，Grunt就可以满足要求，发展历程长，基本是稳定的。但是如果要处理庞大的项目文件，特别是处理多种类型的资源文件，强调模块开发，Webpack则更适合这个场景。Webpack对于中大型项目而言是更加稳定的，文档资料和迭代速度也很快。当然这对开发人员而言也是挺头疼的，隔一段时间就需要去适应文档的配置。Vite作为一门新的构建技术，想要它去构建一门稳定的中大型项目有点冒险，虽然已经发布稳定版本，但是还是会有一些潜在的风险，等它更多人推广后使用更加稳妥，但是对于平时构建一些个人网站和项目等使用vite，感受一下它的便捷也可以。</p>
<h4 id="什么是webpack">什么是webpack</h4>
<p>webpack是一种前端资源构建工具，一个静态模块打包器(module bundler)。 在 webpack看来,前端的所有资源文件(js/json/css/img/less/…)都会作为模块处理。 它将根据模块的依赖关系进行静态分析，打包生成对应的静态资源(bundle)。</p>
<p><img data-src="image-20220707224530157.png" alt=""></p>
<h4 id="理解module、chunk、bundle">理解module、chunk、bundle</h4>
<p>在 webpack 中，一切皆module，任何一个文件都可以看成是module。js、css、图片等都是module<br>
webpack 会将入口文件以及它的依赖引入到一个 chunk 中，然后进过一系列处理打包成bundle</p>
<p><img data-src="image-20220707230231353.png" alt=""></p>
<p>大致流程如下：</p>
<p>1、根据index.js入口文件依赖关系生成树状图</p>
<p>2、根据树状图引入相关的资源 生成chunk(块)</p>
<p>3、对chunk进行处理 (babel、less-loader …)</p>
<p>4、打包生成bundler.js</p>
<p>5、将bundler.js文件引入到index.html中</p>
<h4 id="webpack五个核心概念">webpack五个核心概念</h4>
<h5 id="Entry">Entry</h5>
<p>入口（Entry）：指示 webpack以哪个文件为入口起点开始打包，分析构建内部依赖图。其取值可以是字符串，数组或者一个对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 单入口单文件</span><br><span class="line">entry: &quot;./src/index.js&quot;</span><br><span class="line"></span><br><span class="line">// 单入口多文件</span><br><span class="line">entry: [&quot;./ src/index.js&quot;, &quot;./src/common.js&quot;] // 若index.js与common.js没有依赖关系，可以通过此方式将它们打包在一起</span><br><span class="line"></span><br><span class="line">// 多入口</span><br><span class="line">entry: &#123;</span><br><span class="line">  page1: &quot;./src/page1.js&quot;,</span><br><span class="line">  page2: &quot;./src/page2.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Output">Output</h5>
<p>输出（Output）：指示 webpack打包后的资源 bundles输出到哪里去，以及如何命名</p>
<p>webpack打包的输出，常用配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">  path: path.resolve(__dirname, &quot;./dist&quot;),</span><br><span class="line">  // 单入口时（默认）</span><br><span class="line">  // filename: &quot;main.js&quot;,</span><br><span class="line">  // filename: &quot;js/main.js&quot;, // filename也可以写路径，表示输出到 dist/js 目录下</span><br><span class="line">  // 多入口时，由于会有多个输出，因此文件名不能写死</span><br><span class="line">  filename: &quot;[name].js&quot;, // name表示chunk的名称，此处为entry中的key值</span><br><span class="line">  chunkFilename: &quot;[name].js&quot;, // 按需加载的模块打包后的名称</span><br><span class="line">  publicPath: &quot;/&quot; // 项目部署在服务器上的路径，如果在根路径则为 /</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Loader">Loader</h5>
<p>处理器（Loader）：webpack默认只能处理js、json格式的文件，而loader的作用则是将其他格式的文件，转换成webpack能够处理的文件</p>
<p>使用loader需要在webpack配置文件的module.rules中配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line"> entry: ...,</span><br><span class="line"> output: ...,</span><br><span class="line"> module: &#123;</span><br><span class="line">   noParse:  /node_modules/, //忽略解析 node_modules 中的文件</span><br><span class="line">   rules: [</span><br><span class="line">     &#123;</span><br><span class="line">       test: /\.xxx$/, // 匹配后缀名为xxx的文件</span><br><span class="line">       // 单个loader</span><br><span class="line">       // loader: &quot;xxx-loader&quot;,</span><br><span class="line">       // options: &#123;&#125;,</span><br><span class="line">       // 多个loader，loader的处理顺序为从后往前，因此需要优先处理的loader放在数组最后面</span><br><span class="line">       // use: [&quot;xxxx-loader&quot;, &quot;xxx-loader&quot;],</span><br><span class="line">       //  如果某个loader需要配置，写成下面的格式</span><br><span class="line">       use: [</span><br><span class="line">         &#123;</span><br><span class="line">           loader: &quot;xxxx-loader&quot;,</span><br><span class="line">           options: &#123;&#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         &quot;xxx-loader&quot;</span><br><span class="line">       ],</span><br><span class="line">       include: [path.resolve(__dirname, &quot;./src&quot;)], // 只解析src中的文件，可以是正则</span><br><span class="line">       exclude: [path.resolve(__dirname, &quot;./library&quot;)], // 忽略library中的文件，可以是正则</span><br><span class="line">       // 当多个规则同时匹配某类文件时，可以使用enforce参数指定优先级</span><br><span class="line">       enforce: &quot;pre&quot; // 优先执行该规则里的loader，post 最后执行该规则里的loader</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       // 当规则匹配时，不再匹配后面的规则。例如某个文件匹配到了第一个规则，不再匹配后面规则</span><br><span class="line">       oneOf: [</span><br><span class="line">         &#123;</span><br><span class="line">           test: /\.xxx$/,</span><br><span class="line">           use: &quot;xxx-loader&quot;</span><br><span class="line">         &#125;, </span><br><span class="line">         &#123;</span><br><span class="line">           test: /\.xxx$/,</span><br><span class="line">           use: &quot;xxx-loader&quot;</span><br><span class="line">         &#125;</span><br><span class="line">       ] </span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Plugins">Plugins</h5>
<p>插件(Plugins)可以用于执行范围更广的任务，它能处理loader无法处理的事情。插件的范围包括，从打包优化和压缩， 一直到重新定义环境中的变量等。</p>
<p>它使用非常简单，在plugins数组中添加插件的实例化对象即可</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const xxxWebpackPlugin = require(&quot;xxx-webpack-plugin&quot;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: ...,</span><br><span class="line">  output: ...,</span><br><span class="line">  plugins: [</span><br><span class="line">    new xxxWebpackPlugin(),</span><br><span class="line">    new xxxxWebpackPlugin(&#123;</span><br><span class="line">      // 插件的配置项</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="mode">mode</h5>
<p>webpack打包分为两种模式，开发模式（development）与生产模式（production），默认为生产模式</p>
<table>
<thead>
<tr>
<th style="text-align:center">选项</th>
<th style="text-align:left">描述</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">development</td>
<td style="text-align:left">会将 process.env.NODE_ENV 的值设为 development。启用 NamedChunksPlugin 和 NamedModulesPlugin。</td>
<td>能让代码本地调试 运行的环境</td>
</tr>
<tr>
<td style="text-align:center">production</td>
<td style="text-align:left">会将 process.env.NODE_ENV 的值设为 production。启用 FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin 和 UglifyJsPlugin.</td>
<td>能让代码优化上线 运行的环境</td>
</tr>
</tbody>
</table>
<p>Mode的配置更多含义</p>
<p><img data-src="image-20220712165237536.png" alt=""></p>
<p><img data-src="image-20220712165249707.png" alt=""></p>
<h4 id="webpack使用前提">webpack使用前提</h4>
<p>webpack的官方文档是 <a href="https://webpack.js.org/">https://webpack.js.org/</a></p>
<p>webpack的中文官方文档是 <a href="https://webpack.docschina.org/">https://webpack.docschina.org/</a></p>
<p>DOCUMENTATION：文档详情，也是我们最关注的</p>
<p>Webpack的运行是依赖Node环境的，所以我们电脑上必须有Node环境</p>
<p>所以我们需要先安装Node.js，并且同时会安装npm；</p>
<p>我当前电脑上的node版本是v14.15.5，npm版本是6.14.11（你也可以使用nvm或者n来管理Node版本）；</p>
<p>Node官方网站：<a href="https://nodejs.org/">https://nodejs.org/</a></p>
<p><img data-src="image-20220707231535073.png" alt=""></p>
<h4 id="webpack安装">webpack安装</h4>
<p>webpack的安装目前分为两个：webpack、webpack-cli</p>
<p><strong>那么它们是什么关系呢？</strong></p>
<p>执行webpack命令，会执行node_modules下的.bin目录下的webpack；</p>
<p>webpack在执行时是依赖webpack-cli的，如果没有安装就会报错；</p>
<p>而webpack-cli中代码执行时，才是真正利用webpack进行编译和打包的过程；</p>
<p>所以在安装webpack时，我们需要同时安装webpack-cli（第三方的脚手架事实上是没有使用webpack-cli的，而是类似于自 己的 vue-service-cli 的东西）</p>
<p><img data-src="image-20220707231754415.png" alt=""></p>
<p>全局安装：<code>npm install webpack webpack-cli –g</code></p>
<p>局部安装：<code>npm install webpack webpack-cli –D</code></p>
<h4 id="webpack的默认打包">webpack的默认打包</h4>
<p>我们可以通过webpack进行打包，之后运行打包之后的代码</p>
<p>在目录下直接执行 webpack 命令：<code>webpack</code></p>
<p>生成一个dist文件夹，里面存放一个main.js的文件，就是我们打包之后的文件：</p>
<p>这个文件中的代码被压缩和丑化了；</p>
<p>另外我们发现代码中依然存在ES6的语法，比如箭头函数、const等，这是因为默认情况下webpack并不清楚我们打包后的文 件是否需要转成ES5之前的语法，后续我们需要通过babel来进行转换和设置；</p>
<p>我们发现是可以正常进行打包的，但是有一个问题，webpack是如何确定我们的入口的呢？</p>
<p>事实上，当我们运行webpack时，webpack会查找当前目录下的 src/index.js作为入口；</p>
<p>所以，如果当前项目中没有存在src/index.js文件，那么会报错；</p>
<p>当然，我们也可以通过配置来指定入口和出口</p>
<p>开发环境指令：</p>
<p><code>webpack src/js/index.js -o build/js/built.js --mode=development</code></p>
<p>功能：webpack能够编译打包 js和 json文件，并且能将 es6的模块化语法转换成 浏览器能识别的语法。</p>
<p><code>webpack --entry ./src/main.js --output-path ./build/js/bundle.js --mode=development</code></p>
<p>生产环境指令：</p>
<p><code>webpack src/js/index.js -o build/js/built.js --mode=production</code></p>
<p>功能：在开发配置功能上多一个功能，压缩代码。</p>
<p><code>webpack --entry ./src/main.js --output-path ./build/js/bundle.js --mode=production</code></p>
<h5 id="配置script脚本">配置script脚本</h5>
<p>在package.json，script字段下配置脚本，执行命令更为简便：npm run 脚本名</p>
<p>结论 ：</p>
<ul>
<li>webpack能够编译打包 js和 json文件。</li>
<li>能将 es6的模块化语法转换成浏览器能识别的语法。</li>
<li>能压缩代码。</li>
</ul>
<p>问题 ：</p>
<ul>
<li>不能编译打包 css、img等文件。</li>
<li>不能将 js的 es6基本语法转化为 es5以下语法。</li>
<li>在通常情况下，webpack需要打包的项目是非常复杂的，并且我们需要一系列的配置来满足要求，默认配置必然</li>
</ul>
<p>是不可以的。</p>
<h4 id="webpack开发环境配置">webpack开发环境配置</h4>
<h5 id="创建配置文件">创建配置文件</h5>
<p>在项目根目录下创建文件 webpack.config.js，来作为webpack的配置文件，名字默认，如果要修改，执行时需要添加 --config 配置文件名来读取该配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); <span class="comment">// node 内置核心模块，用来处理路径问题</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">entry</span>: <span class="string">&#x27;./src/js/index.js&#x27;</span>, <span class="comment">// 入口文件</span></span><br><span class="line">	<span class="attr">output</span>: &#123; <span class="comment">// 输出配置</span></span><br><span class="line">		<span class="attr">filename</span>: <span class="string">&#x27;./bundle.js&#x27;</span>, <span class="comment">// 输出文件名</span></span><br><span class="line">		<span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build/js&#x27;</span>) <span class="comment">// 输出文件路径配置</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span> <span class="comment">//开发环境</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="打包样式资源">打包样式资源</h5>
<p>1、准备css、less资源</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 创建一个元素</span><br><span class="line">let div = document.createElement(&#x27;div&#x27;)</span><br><span class="line">div.className = &#x27;dv&#x27;</span><br><span class="line">div.style.width = &#x27;100px&#x27;</span><br><span class="line">div.style.height = &#x27;100px&#x27;</span><br><span class="line">div.innerHTML = &#x27;把酒祝东风，且共从容&#x27;</span><br><span class="line"></span><br><span class="line">document.body.appendChild(div)</span><br><span class="line"></span><br><span class="line">.dv &#123;</span><br><span class="line">  background-color:tomato;</span><br><span class="line">  /* 页面文字不让选中 */</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br><span class="line">执行编译发现报错: 模块解析失败，你需要一个合适的loader来处理这个文件类型</span><br><span class="line"></span><br><span class="line">上面的错误信息告诉我们需要一个loader来加载这个css文件，但是loader是什么呢？</span><br><span class="line">loader 可以用于对模块的源代码进行转换；</span><br><span class="line">我们可以将css文件也看成是一个模块，我们是通过import来加载这个模块的；</span><br><span class="line">在加载这个模块时，webpack其实并不知道如何对其进行加载，我们必须制定对应的loader来完成这个功能；</span><br><span class="line">那么我们需要一个什么样的loader呢？</span><br><span class="line">对于加载css文件来说，我们需要一个可以读取css文件的loader；</span><br><span class="line">这个loader最常用的是css-loader</span><br></pre></td></tr></table></figure>
<p>2、下载安装 loader 包 <code>npm i css-loader  -D</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">如何使用这个loader来加载css文件呢？有三种方式：</span><br><span class="line">	- 内联方式；</span><br><span class="line">	- CLI方式（webpack5中不再使用）；</span><br><span class="line">	- 配置方式；</span><br><span class="line">内联方式：内联方式使用较少，因为不方便管理；</span><br><span class="line">	- 在引入的样式前加上使用的loader，并且使用!分割: import &#x27;css-loader!./js/a.css&#x27;</span><br><span class="line">CLI方式（webpack5中不再使用）这里不展开说</span><br></pre></td></tr></table></figure>
<p>3、修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// resolve 用来拼接绝对路径的方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 配置</span></span><br><span class="line">  <span class="comment">// 入口起点</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="comment">// 输出</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;built.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// 输出路径</span></span><br><span class="line">    <span class="comment">// __dirname nodejs 的变量，代表当前文件的目录绝对路径</span></span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// loader 的配置</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">	<span class="comment">// module.rules中允许我们配置多个loader（因为我们也会继续使用其他的loader，来完成其他文件的加载）</span></span><br><span class="line">    <span class="comment">// 这种方式可以更好的表示loader的配置，也方便后期的维护，同时也让你对各个Loader有一个全局的概览</span></span><br><span class="line">    <span class="comment">// rules属性对应的值是一个数组 数组中存放的是一个个的Rule，Rule是一个对象，对象中可以设置多个属性</span></span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// 详细 loader 配置</span></span><br><span class="line">      <span class="comment">// 不同文件必须配置不同 loader 处理</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 用于对 resource（资源）进行匹配的，通常会设置成正则表达式</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 对应的值时一个数组 表示使用哪些 loader 进行处理</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// use 数组中 loader 执行顺序：从右到左，从下到上 依次执行</span></span><br><span class="line">          <span class="comment">// 创建 style 标签，将 js 中的样式资源插入进行，添加到 head 中生效</span></span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="comment">// 将 css 文件变成 commonjs 模块加载 js 中，里面内容是样式字符串</span></span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="comment">// use属性：对应的值时一个数组：[UseEntry]</span></span><br><span class="line">		<span class="comment">// UseEntry是一个对象，可以通过对象的属性来设置一些其他属性</span></span><br><span class="line">		<span class="comment">// loader：必须有一个 loader属性，对应的值是一个字符串；</span></span><br><span class="line">		<span class="comment">// options：可选的属性，值是一个字符串或者对象，值会被传入到loader中；</span></span><br><span class="line">		<span class="comment">// query：目前已经使用options来替代；</span></span><br><span class="line">		<span class="comment">// 传递字符串（如：use: [ &#x27;style-loader&#x27; ]）是 loader 属性的简写方式（如：use: [ &#123; loader: &#x27;style-loader&#x27;&#125; ]）；</span></span><br><span class="line">		<span class="comment">// loader属性： Rule.use: [ &#123; loader &#125; ] 的简写。</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// 开发模式</span></span><br><span class="line">  <span class="comment">// mode: &#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、运行指令：webpack 或 自定义脚本 npm run build</p>
<h5 id="style-loader">style-loader</h5>
<p>我们已经可以通过css-loader来加载css文件了</p>
<p>但是你会发现这个css在我们的代码中并没有生效（页面没有效果）。</p>
<p>这是为什么呢？</p>
<p>因为css-loader只是负责将.css文件进行解析，并不会将解析之后的css插入到页面中；</p>
<p>如果我们希望再完成插入style的操作，那么我们还需要另外一个loader，就是style-loader；</p>
<p>安装style-loader：<code>npm install style-loader -D</code></p>
<p>那么我们应该如何使用style-loader：</p>
<p>在配置文件中，添加style-loader，具体看上面代码</p>
<p>注意：因为loader的执行顺序是从右向左（或者说从下到上，或者说从后到前的），所以我们需要将style- loader写到css-loader的前面；</p>
<p>ps：当前目前我们的css是通过页内样式的方式添加进来的；</p>
<p>​		后续我们也会讲如何将css抽取到单独的文件中，并且进行压缩等操作</p>
<h5 id="less-loader">less-loader</h5>
<p>在我们开发中，我们可能会使用less、sass、stylus的预处理器来编写css样式，效率会更高。</p>
<p>那么，如何可以让我们的环境支持这些预处理器呢？</p>
<p>首先我们需要确定，less、sass等编写的css需要通过工具转换成普通的css；</p>
<p>比如我们编写如下的less样式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@fsz:20px;</span><br><span class="line">@fsw:&#x27;bold&#x27;;</span><br><span class="line"></span><br><span class="line">.dv &#123;</span><br><span class="line">  font-size: @fsz;</span><br><span class="line">  font-weight: @fsw;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以使用less工具来完成它的编译转换：<code>npm install less -D</code></p>
<p>执行如下命令：<code>npx lessc ./src/css/title.less title.css</code></p>
<p>但是在项目中我们会编写大量的css，它们如何可以自动转换呢？</p>
<p>这个时候我们就可以使用less-loader，来自动使用less工具转换less到css；</p>
<p>此时我们需要配置webpack.config.js</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	test: /\.less$/,</span><br><span class="line">	use: [</span><br><span class="line">		&#x27;style-loader&#x27;,</span><br><span class="line">		&#x27;css-loader&#x27;,</span><br><span class="line">		// 将 less 文件编译成 css 文件</span><br><span class="line">		// 需要下载 less-loader 和 less</span><br><span class="line">		&#x27;less-loader&#x27;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行npm run build，less就可以自动转换成css，并且页面也会生效了</p>
<h5 id="PostCss">PostCss</h5>
<p>什么是PostCSS呢？</p>
<p>PostCSS是一个通过JavaScript来转换样式的工具；</p>
<p>这个工具可以帮助我们进行一些CSS的转换和适配，比如自动添加浏览器前缀、css样式的重置；</p>
<p>但是实现这些功能，我们需要借助于PostCSS对应的插件；</p>
<p>如何使用PostCSS呢？主要就是两个步骤：</p>
<p>第一步：查找PostCSS在构建工具中的扩展，比如webpack中的postcss-loader；</p>
<p>第二步：选择可以添加你需要的PostCSS相关的插件；</p>
<p>当然，我们能不能也直接在终端使用PostCSS呢？</p>
<p>也是可以的，但是我们需要单独安装一个工具postcss-cli；</p>
<p>我们可以安装一下它们：postcss、postcss-cli</p>
<p><code>npm install postcss postcss-cli -D</code></p>
<p>我们编写一个需要添加前缀的css：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.dv &#123;</span><br><span class="line">  /* 页面文字不让选中 */</span><br><span class="line">  user-select: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="autoprefixer"><strong>autoprefixer</strong></h6>
<p>因为我们需要添加前缀，所以要安装autoprefixer：</p>
<p><code>npm install autoprefixer -D</code></p>
<p>直接使用使用postcss工具，并且制定使用autoprefixer</p>
<p><code>npx postcss --use autoprefixer -o end.css ./src/css/style.css</code></p>
<h6 id="postcss-loader"><strong>postcss-loader</strong></h6>
<p>真实开发中我们必然不会直接使用命令行工具来对css进行处理，而是可以借助于构建工具：</p>
<p>在webpack中使用postcss就是使用postcss-loader来处理的；</p>
<p>我们来安装postcss-loader：</p>
<p><code>npm install postcss-loader -D</code></p>
<p>我们修改加载css的loader：（配置文件已经过多，给出一部分了）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  loader: &quot;postcss-loader&quot;,</span><br><span class="line">  options: &#123;</span><br><span class="line">  postcssOptions: &#123;</span><br><span class="line">  // 使用插件 </span><br><span class="line">  // ps:因为postcss需要有对应的插件才会起效果，所以我们需要配置它的plugin；</span><br><span class="line">  plugins: [</span><br><span class="line">  // 引入插件</span><br><span class="line">    require(&#x27;autoprefixer&#x27;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，我们也可以将这些配置信息放到一个单独的文件中进行管理：</p>
<p>在根目录下创建postcss.config.js</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    require(&#x27;autoprefixer&#x27;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="postcss-preset-env"><strong>postcss-preset-env</strong></h6>
<p>事实上，在配置postcss-loader时，我们配置插件并不需要使用autoprefixer。</p>
<p>我们可以使用另外一个插件：postcss-preset-env</p>
<p>postcss-preset-env也是一个postcss的插件；</p>
<p>它可以帮助我们将一些现代的CSS特性，转成大多数浏览器认识的CSS，并且会根据目标浏览器或者运行时环境 添加所需的polyfill；</p>
<p>也包括会自动帮助我们添加autoprefixer（所以相当于已经内置了autoprefixer）；</p>
<p>首先，我们需要安装postcss-preset-env：</p>
<p><code>npm install postcss-preset-env -D</code></p>
<p>之后，我们直接修改掉之前的autoprefixer即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  loader: &quot;postcss-loader&quot;,</span><br><span class="line">  options: &#123;</span><br><span class="line">  postcssOptions: &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    require(&#x27;postcss-preset-env&#x27;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="打包HTML资源">打包HTML资源</h5>
<h6 id="HtmlWebpackPlugin"><strong>HtmlWebpackPlugin</strong></h6>
<p>另外还有一个<strong>不太规范</strong>的地方：</p>
<p>我们的HTML文件是编写在根目录下的，而最终打包的dist文件夹中是没有index.html文件的。</p>
<p>在进行项目部署的时，必然也是需要有对应的入口文件index.html；</p>
<p>所以我们也需要对index.html进行打包处理；</p>
<p>对HTML进行打包处理我们可以使用另外一个插件：<strong>HtmlWebpackPlugin</strong>；</p>
<p>1、创建html页面</p>
<p>2、下载安装 plugin 包：npm install -D html-webpack-plugin</p>
<p>3、修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// plugins的配置</span></span><br><span class="line">    <span class="comment">// html-webpack-plugin</span></span><br><span class="line">    <span class="comment">//功能：默认会创建一个空的 HTML，自动引入打包输出的所有资源（JS/CSS）</span></span><br><span class="line">    <span class="comment">//需求：需要有结构的 HTML文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">//复制 &#x27;./src/index.html&#x27;文件，并自动引入打包输出的所有资源（JS/CSS）</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="打包图片资源">打包图片资源</h5>
<h6 id="file-loader">file-loader</h6>
<blockquote>
<p>参考文章：<a href="https://www.jianshu.com/p/c0de85a2d3fb">https://www.jianshu.com/p/c0de85a2d3fb</a></p>
</blockquote>
<p>1、创建图片资源</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">方式一:</span><br><span class="line"><span class="keyword">let</span> dv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">dv.<span class="property">className</span> = <span class="string">&#x27;box&#x27;</span></span><br><span class="line">dv.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line">dv.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(dv)</span><br><span class="line"></span><br><span class="line">.<span class="property">box</span> &#123;</span><br><span class="line">  background-<span class="attr">image</span>: <span class="title function_">url</span>(<span class="string">&#x27;../imgs/2.jpg&#x27;</span>);</span><br><span class="line">  background-<span class="attr">repeat</span>: no-repeat;</span><br><span class="line">  background-<span class="attr">size</span>: contain;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">方式二:</span><br><span class="line"><span class="keyword">import</span> imgUrl <span class="keyword">from</span> <span class="string">&#x27;./imgs/1.png&#x27;</span></span><br><span class="line"><span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line"><span class="comment">// img.src = &#x27;./imgs/1.png&#x27;</span></span><br><span class="line">img.<span class="property">src</span> = imgUrl</span><br><span class="line">img.<span class="property">style</span>.<span class="property">width</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line">img.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&#x27;400px&#x27;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(img)</span><br></pre></td></tr></table></figure>
<p>2、下载安装 loader 包 npm install --save-dev file-loader</p>
<p>3、修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;built.js&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">esModule</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;imgs/[name]-[hash:5].[ext]&#x27;</span></span><br><span class="line">            <span class="comment">// outputPath: imgs</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;javascript/auto&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>文件命名规则</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">有时候我们处理后的文件名称按照一定的规则进行显示：</span><br><span class="line">比如保留原来的文件名、扩展名，同时为了防止重复，包含一个hash值等；</span><br><span class="line">这个时候我们可以使用PlaceHolders来完成，webpack给我们提供了大量的PlaceHolders来显示不同的内容：</span><br><span class="line">https://webpack.js.org/loaders/file-loader/#placeholders</span><br><span class="line">我们可以在文档中查阅自己需要的placeholder；</span><br><span class="line">我们这里介绍几个最常用的placeholder：</span><br><span class="line">[ext]： 处理文件的扩展名；</span><br><span class="line">[name]：处理文件的名称；</span><br><span class="line">[hash]：文件的内容，使用MD4的散列函数处理，生成的一个128位的hash值（32个十六进制）；</span><br><span class="line">[contentHash]：在file-loader中和[hash]结果是一致的（在webpack的一些其他地方不一样，后面会讲到）；</span><br><span class="line">[hash:&lt;length&gt;]：截图hash的长度，默认32个字符太长了；</span><br><span class="line">[path]：文件相对于webpack配置文件的路径；</span><br></pre></td></tr></table></figure>
<h6 id="url-loader">url-loader</h6>
<p><strong>url-loader</strong>和<strong>file-loader</strong>的工作方式是相似的，但是可以将较小的文件，转成base64的URI</p>
<p>安装：<code>npm install url-loader -D</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/i</span>,</span><br><span class="line">    <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;[name]-[hash:5].[ext]&#x27;</span>,</span><br><span class="line">            <span class="attr">outputPath</span>: <span class="string">&#x27;imgs&#x27;</span>,</span><br><span class="line">            <span class="attr">limit</span>: <span class="number">20</span> * <span class="number">1024</span></span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>显示结果是一样的，并且图片可以正常显示；</strong></p>
<p>但是在dist文件夹中，我们会看不到图片文件：</p>
<p>因为默认情况下url-loader会将所有的图片文件转成base64编码</p>
<p>但是开发中我们往往是小的图片需要转换，但是大的图片直接使用图片即可</p>
<p>这是因为小的图片转换base64之后可以和页面一起被请求，减少不必要的请求过程；</p>
<p>而大的图片也进行转换，反而会影响页面的请求速度；</p>
<p>那么，我们如何可以<strong>限制哪些大小的图片转换和不转换</strong>呢？</p>
<p>url-loader有一个options属性<strong>limit</strong>，可以用于设置转换的限制；</p>
<blockquote>
<p>url-loader在webpack5中已废弃</p>
<p>参考文章：<a href="https://www.jianshu.com/p/36e972b19b28">https://</a><a href="https://www.jianshu.com/p/36e972b19b28">www.jianshu.com</a><a href="https://www.jianshu.com/p/36e972b19b28">/p/</a><a href="https://www.jianshu.com/p/36e972b19b28">36e972b19b28</a></p>
</blockquote>
<h6 id="html-loader">html-loader</h6>
<p>在html中引入一张图片，npm run build后发现该图片无法打包</p>
<p>解决方式：</p>
<p>安装html-loader <code>npm i html-loader -D</code></p>
<p>修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理html中的图片</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">test</span>: <span class="regexp">/\.(html|htm)$/</span>,</span><br><span class="line">   <span class="comment">// 处理html文件的img图片(负责引入img, 从而能被url-loader进行处理)</span></span><br><span class="line">   <span class="attr">loader</span>: <span class="string">&#x27;html-loader&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="打包其它资源">打包其它资源</h5>
<p>1、引入字体图标</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> elI = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">elI.<span class="property">className</span> = <span class="string">&#x27;icomoon icon-heart&#x27;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(elI)</span><br></pre></td></tr></table></figure>
<p>2、下载 file-loader ：<code>npm i file-loader -D</code></p>
<p>3、修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//新增规则 =&gt; 打包其他资源(除了 html/js/css资源以外的资源)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">//排除 css/js/html资源</span></span><br><span class="line">   <span class="attr">exclude</span>: <span class="regexp">/\.(css|js|html|less)$/</span>,</span><br><span class="line">   <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">   <span class="attr">options</span>: &#123;</span><br><span class="line">   <span class="attr">esModule</span>: <span class="literal">false</span>,</span><br><span class="line">   <span class="attr">name</span>: <span class="string">&#x27;fonts/[hash:10].[ext]&#x27;</span></span><br><span class="line"> &#125;,</span><br><span class="line">   <span class="attr">type</span>: <span class="string">&#x27;javascript/auto&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="asset-module-type"><strong>asset</strong> <strong>module</strong> <strong>type</strong></h4>
<p>我们当前使用的webpack版本是webpack5：</p>
<p>在webpack5之前，加载这些资源我们需要使用一些loader，比如raw-loader 、url-loader、file-loader；</p>
<p>在webpack5开始，我们可以直接使用资源模块类型（<strong>asset</strong> <strong>module</strong> <strong>type</strong>），来替代上面的这些loader；</p>
<p><strong>资源模块类型</strong>(<strong>asset</strong> <strong>module</strong> <strong>type)</strong>，通过添加 4 种新的模块类型，来替换所有这些 loader：</p>
<p><strong>asset/resource</strong> 发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现；</p>
<p><strong>asset/inline</strong> 导出一个资源的 data URI。之前通过使用 url-loader 实现；</p>
<p><strong>asset/source</strong> 导出资源的源代码。之前通过使用 raw-loader 实现；</p>
<p><strong>asset</strong> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过 url-loader + limit 配置资源体积限制实现；</p>
<p><strong>比如打包图片：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/i</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">    <span class="comment">// 生成器</span></span><br><span class="line">    <span class="attr">generator</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;img/[name].[hash:5][ext]&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 解析</span></span><br><span class="line">  <span class="attr">parser</span>: &#123;</span><br><span class="line">    <span class="comment">// 条件</span></span><br><span class="line">    <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">      <span class="comment">// 小于20kb的图片都转成base64位</span></span><br><span class="line">      <span class="attr">maxSize</span>: <span class="number">20</span> * <span class="number">1024</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><strong>转base64</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">因为不生成文件，所以没有generator属性</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|svg)$/i</span>,</span><br><span class="line">	<span class="attr">type</span>: <span class="string">&#x27;asset/inline&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>比如打包字体：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(woff2?|eot|ttf)$/</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">  <span class="attr">generator</span>: &#123;</span><br><span class="line">     <span class="attr">filename</span>: <span class="string">&#x27;font/[name].[ext]&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Plugins-2">Plugins</h4>
<p><strong>Webpack</strong>的另一个核心是Plugin，官方有这样一段对Plugin的描述：</p>
<p>While loaders are used to transform certain types of modules, plugins can be leveraged to perform a  wider range of tasks like bundle optimization, asset management and injection of environment variables.</p>
<p>上面表达的含义翻译过来就是：</p>
<p>Loader是用于特定的模块类型进行转换；</p>
<p>Plugin可以用于执行更加广泛的任务，比如打包优化、资源管理、环境变量注入等</p>
<p><img data-src="image-20220712163127495.png" alt=""></p>
<h5 id="CleanWebpackPlugin"><strong>CleanWebpackPlugin</strong></h5>
<p>前面我们演示的过程中，每次修改了一些配置，重新打包时，都需要手动删除build文件夹：</p>
<p>我们可以借助于一个插件来帮助我们完成，这个插件就是CleanWebpackPlugin；</p>
<p>首先，我们先安装这个插件：</p>
<p><code>npm install clean-webpack-plugin -D</code></p>
<p>修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="HtmlWebpackPlugin-2"><strong>HtmlWebpackPlugin</strong></h5>
<p>对HTML进行打包处理我们可以使用另外一个插件：<strong>HtmlWebpackPlugin</strong>；</p>
<p>1、创建html页面</p>
<p>2、下载安装 plugin 包：npm install -D html-webpack-plugin</p>
<p>3、修改配置文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// plugins的配置</span></span><br><span class="line">    <span class="comment">// html-webpack-plugin</span></span><br><span class="line">    <span class="comment">//功能：默认会创建一个空的 HTML，自动引入打包输出的所有资源（JS/CSS）</span></span><br><span class="line">    <span class="comment">//需求：需要有结构的 HTML文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">//复制 &#x27;./src/index.html&#x27;文件，并自动引入打包输出的所有资源（JS/CSS）</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>自定义html模板</strong></p>
<p><strong>如果我们想在自己的模块中加入一些比较特别的内容：</strong></p>
<p>比如添加一个noscript标签，在用户的JavaScript被关闭时，给予响应的提示；</p>
<p>比如在开发vue或者react项目时，我们需要一个可以挂载后续组件的根标签 ；</p>
<p>我们需要一个属于自己的模板</p>
<p>我们选择复制vue的index.html作为模板</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span>&gt;</span>We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的代码中，会有一些类似这样的语法&lt;%= 变量 %&gt;，这个是EJS模块填充数据的方式。</p>
<p>在配置HtmlWebpackPlugin时，我们可以添加如下配置：</p>
<p>template：指定我们要使用的模块所在的路径；</p>
<p>title：在进行htmlWebpackPlugin.options.title读取时，就会读到该信息；</p>
<p>但是，这个时候编译还是会报错，因为在我们的模块中还使用到一个<strong>BASE_URL</strong>的常量：</p>
<p><img data-src="image-20220712164729873.png" alt=""></p>
<p>这是因为在编译template模块时，有一个BASE_URL：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;link rel=&quot;icon&quot; href=&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>但是我们并没有设置过这个常量值，所以会出现没有定义的错误；</p>
<p>这个时候我们可以使用DefinePlugin插件</p>
<h5 id="DefinePlugin"><strong>DefinePlugin</strong></h5>
<p>DefinePlugin允许在编译时创建配置的全局常量，是一个webpack内置的插件（不需要单独安装）：</p>
<p><img data-src="image-20220712164815568.png" alt=""></p>
<p>这个时候，编译template就可以正确的编译了，会读取到BASE_URL的值</p>
<h5 id="CopyWebpackPlugin"><strong>CopyWebpackPlugin</strong></h5>
<p>在vue的打包过程中，如果我们将一些文件放到public的目录下，那么这个目录会被复制到dist文件夹中。</p>
<p>这个复制的功能，我们可以使用CopyWebpackPlugin来完成；</p>
<p>安装CopyWebpackPlugin插件：</p>
<p><code>npm install copy-webpack-plugin -D</code></p>
<p><strong>接下来配置CopyWebpackPlugin即可：</strong></p>
<p>复制的规则在patterns中设置；</p>
<p>**from：**设置从哪一个源中开始复制；</p>
<p>**to：**复制到的位置，可以省略，会默认复制到打包的目录下；</p>
<p>**globOptions：**设置一些额外的选项，其中可以编写需要忽略的文件：</p>
<p>.DS_Store：mac目录下回自动生成的一个文件；</p>
<p>index.html：也不需要复制，因为我们已经通过HtmlWebpackPlugin完成了index.html的生成；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title function_">copyWebpackPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">patterns</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&#x27;public&#x27;</span>,</span><br><span class="line">      <span class="attr">globOptions</span>: &#123;</span><br><span class="line">        <span class="comment">// 忽略</span></span><br><span class="line">        <span class="attr">ignore</span>: [</span><br><span class="line">          <span class="string">&#x27;**/.DS_Store&#x27;</span></span><br><span class="line">          <span class="string">&#x27;**/index.html&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Babel相关">Babel相关</h4>
<p>事实上，在开发中我们很少直接去接触babel，但是<strong>babel</strong>对于前端开发来说，目前是不可缺少的一部分：</p>
<p>开发中，我们想要使用ES6+的语法，想要使用TypeScript，开发React项目，它们都是离不开Babel的；</p>
<p>所以，学习Babel对于我们理解代码从编写到线上的转变过程至关重要；</p>
<p>那么，<strong>Babel到底是什么呢？</strong></p>
<p>Babel是一个工具链，主要用于旧浏览器或者环境中将ECMAScript 2015+代码转换为向后兼容版本的 JavaScript；</p>
<p>包括：语法转换、源代码转换等；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> num = <span class="number">10</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Babel命令行使用</strong></p>
<p>babel本身可以作为<strong>一个独立的工具</strong>（和postcss一样），不和webpack等构建工具配置来单独使用。</p>
<p>如果我们希望在命令行尝试使用babel，需要安装如下库：</p>
<p>@babel/core：babel的核心代码，必须安装；</p>
<p>@babel/cli：可以让我们在命令行使用babel；</p>
<p><code>npm install @babel/cli @babel/core -D</code></p>
<p>使用babel来处理我们的源代码：</p>
<p>src：是源文件的目录；</p>
<p>–out-dir：指定要输出的文件夹dist；</p>
<p><code>npx babel src --out-dir dist</code></p>
<p><strong>插件的使用</strong></p>
<p>比如我们需要转换箭头函数，那么我们就可以使用<strong>箭头函数转换相关的插件</strong></p>
<p><code>npm install @babel/plugin-transform-arrow-functions -D</code></p>
<p><code>npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions</code></p>
<p>查看转换后的结果：我们会发现 const 并没有转成 var</p>
<p>这是因为 plugin-transform-arrow-functions，并没有提供这样的功能；</p>
<p>我们需要使用 plugin-transform-block-scoping 来完成这样的功能；</p>
<p><code>npm install @babel/plugin-transform-block-scoping -D</code></p>
<p><code>npx babel src --out-dir dist --plugins=@babel/plugin-transform-block-scoping,@babel/plugin-transform-arrow-functions</code></p>
<p><strong>Babe的预设preset</strong></p>
<p>但是如果要转换的内容过多，一个个设置是比较麻烦的，我们可以使用预设（preset）：</p>
<p>后面我们再具体来讲预设代表的含义；</p>
<p>安装@babel/preset-env预设：</p>
<p><code>npm install @babel/preset-env -D</code></p>
<p>执行如下命令：</p>
<p><code>npx babel src --out-dir dist --presets=@babel/preset-env</code></p>
<p><strong>Babel的底层原理</strong></p>
<p>babel是如何做到将我们的一段代码（ES6、TypeScript、React）转成另外一段代码（ES5）的呢？</p>
<p>从一种源代码（原生语言）转换成另一种源代码（目标语言），这是什么的工作呢？</p>
<p>就是<strong>编译器</strong>，事实上我们可以将babel看成就是一个编译器。</p>
<p>Babel编译器的作用就是将我们的源代码，转换成浏览器可以直接识别的另外一段源代码；</p>
<p><strong>Babel也拥有编译器的工作流程：</strong></p>
<ul>
<li>解析阶段（Parsing)</li>
<li>转换阶段（Transformation）</li>
<li>生成阶段（Code Generation）</li>
</ul>
<p>参考：<a href="https://github.com/jamiebuilds/the-super-tiny-compiler">https://github.com/jamiebuilds/the-super-tiny-compiler</a></p>
<p><strong>Babel编译器执行原理</strong></p>
<p><img data-src="image-20220712170658784.png" alt=""></p>
<p>当然，这只是一个简化版的编译器工具流程，在每个阶段又会有自己具体的工作</p>
<p><img data-src="image-20220712170714878.png" alt="image-20220712170714878"></p>
<p><strong>babel-loader</strong></p>
<p>在实际开发中，我们通常会在构建工具中通过配置babel来对其进行使用的，比如在webpack中。</p>
<p>那么我们就需要去安装相关的依赖：</p>
<p>如果之前已经安装了@babel/core，那么这里不需要再次安装；</p>
<p><code>npm install babel-loader @babel/core</code></p>
<p>我们可以设置一个规则，在加载js文件时，使用我们的babel</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/.js$/</span>,</span><br><span class="line">    <span class="attr">use</span>: &#123;</span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="comment">// 指定使用的插件</span></span><br><span class="line">      <span class="comment">// plugins: [</span></span><br><span class="line">      <span class="comment">//   &quot;@babel/plugin-transform-arrow-functions&quot;,</span></span><br><span class="line">      <span class="comment">//   &quot;@babel/plugin-transform-block-scoping&quot;</span></span><br><span class="line">      <span class="comment">// ]</span></span><br><span class="line">      <span class="comment">// 指定预设环境</span></span><br><span class="line">      <span class="comment">// presets: [</span></span><br><span class="line">      <span class="comment">//   [&quot;@babel/preset-env&quot;]</span></span><br><span class="line">      <span class="comment">// ]</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="babel-preset-env">babel/preset-env</h5>
<p>如果我们一个个去安装使用插件，那么需要手动来管理大量的babel插件，我们可以直接给webpack提供一个 preset，webpack会根据我们的预设来加载对应的插件列表，并且将其传递给babel。</p>
<p>比如常见的预设有三个：</p>
<p>env</p>
<p>react</p>
<p>TypeScript</p>
<p>安装preset-env：</p>
<p><code>npm install @babel/preset-env</code></p>
<p>配置文件修改看上面</p>
<h5 id="babel配置文件">babel配置文件</h5>
<p>像之前一样，我们可以将babel的配置信息放到一个独立的文件中，babel给我们提供了两种配置文件的编写：</p>
<p>babel.config.json（或者.js，.cjs，.mjs）文件；</p>
<p>.babelrc.json（或者.babelrc，.js，.cjs，.mjs）文件；</p>
<p>它们两个有什么区别呢？目前很多的项目都采用了多包管理的方式（babel本身、element-plus、umi等）；</p>
<p>.babelrc.json：早期使用较多的配置方式，但是对于配置Monorepos项目是比较麻烦的；</p>
<p>babel.config.js（babel7）：可以直接作用于Monorepos项目的子包，更加推荐；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    <span class="string">&quot;@babel/preset-env&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="corejs">corejs</h5>
<p>js兼容性处理：babel-loader @babel/core</p>
<ul>
<li>
<p>基本js兼容性处理 --&gt; @babel/preset-env</p>
<ul>
<li>问题：只能转换基本语法，如promise高级语法不能转换</li>
</ul>
</li>
<li>
<p>全部js兼容性处理 --&gt; @babel/polyfill</p>
</li>
<li>
<p>问题：我只要解决部分兼容性问题，但是将所有兼容性代码全部引入，体积太大了~</p>
</li>
<li>
<p>需要做兼容性处理的就做：按需加载  --&gt; core-js</p>
<p>配置文件修改</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">    <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="comment">// 预设：指示babel做怎么样的兼容性处理</span></span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// 按需加载</span></span><br><span class="line">          <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">          <span class="comment">// 指定core-js版本</span></span><br><span class="line">          <span class="attr">corejs</span>: &#123;</span><br><span class="line">            <span class="attr">version</span>: <span class="number">3</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">          <span class="attr">targets</span>: &#123;</span><br><span class="line">            <span class="attr">chrome</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">            <span class="attr">firefox</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">            <span class="attr">ie</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">            <span class="attr">safari</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">            <span class="attr">edge</span>: <span class="string">&#x27;17&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 开启babel缓存</span></span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="eslint-2">eslint</h5>
<p>我们希望通过eslint对js语法进行检查 目的为了统一编码规范</p>
<p>1、官网查找eslint-loader 发现过期了 官网推荐使用eslint-webpack-plugin<br>
2、找到eslint-webpack-plugin包 提示需要安装eslint包<br>
3、安装完以后 webpack执行命令报错src路径下缺少.eslintrc.js文件(自定义校验规则文件)<br>
4、在src下新增**.eslintrc.js**文件 自定义编码规则 webpack执行检查是否生效</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="string">&quot;env&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;browser&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;es6&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;node&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;extends&quot;</span>: <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;ecmaVersion&quot;</span>: <span class="number">2015</span>,</span><br><span class="line">    <span class="string">&quot;sourceType&quot;</span>: <span class="string">&quot;module&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 缩进</span></span><br><span class="line">    <span class="string">&quot;indent&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="number">4</span> <span class="comment">//我的是编辑器自动格式化，不是使用tabs，而是四个空格</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;linebreak-style&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;windows&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 引号</span></span><br><span class="line">    <span class="string">&quot;quotes&quot;</span>: [</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;single&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 分号结尾</span></span><br><span class="line">    <span class="string">&quot;semi&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="string">&quot;always&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;no-unused-vars&quot;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">    <span class="comment">// 允许声明未使用变量</span></span><br><span class="line">    <span class="string">&quot;vars&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">    <span class="comment">// 参数不检查</span></span><br><span class="line">    <span class="string">&quot;args&quot;</span>: <span class="string">&quot;none&quot;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="comment">// 最大空行100</span></span><br><span class="line">    <span class="string">&quot;no-multiple-empty-lines&quot;</span>: [<span class="number">0</span>, &#123; <span class="string">&quot;max&quot;</span>: <span class="number">100</span> &#125;],</span><br><span class="line">    <span class="string">&quot;no-mixed-spaces-and-tabs&quot;</span>: [<span class="number">0</span>],</span><br><span class="line">    <span class="comment">//不能使用console</span></span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="comment">//未定义变量不能使用</span></span><br><span class="line">    <span class="string">&quot;no-undef&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">//一行结束后面不要有空格</span></span><br><span class="line">    <span class="string">&quot;no-trailing-spaces&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//强制驼峰法命名</span></span><br><span class="line">    <span class="string">&quot;camelcase&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">//对象字面量项尾不能有逗号</span></span><br><span class="line">    <span class="string">&quot;comma-dangle&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">    <span class="comment">//this别名</span></span><br><span class="line">    <span class="string">&quot;consistent-this&quot;</span>: [<span class="number">2</span>, <span class="string">&quot;that&quot;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5、查找eslint-config-airbnb-base包 提示如果要支持es6以上的语法需要安装eslint-plugin-import和eslint<br>
6、安装完成后 配置package.json文件 继承airbnb-base校验规则<br>
7、执行webpack 检查校验规则是否生效</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">语法检查： eslint-loader  eslint</span><br><span class="line">注意：只检查自己写的源代码，第三方的库是不用检查的</span><br><span class="line">设置检查规则：</span><br><span class="line">package.<span class="property">json</span>中eslintConfig中设置~</span><br><span class="line">  <span class="string">&quot;eslintConfig&quot;</span>: &#123;</span><br><span class="line">     <span class="string">&quot;extends&quot;</span>: <span class="string">&quot;airbnb-base&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">airbnb --&gt; eslint-config-airbnb-base  eslint-plugin-<span class="keyword">import</span> eslint</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">ESLintPlugin</span>(&#123;</span><br><span class="line">    <span class="comment">// 指定eslint检查的路径</span></span><br><span class="line">    <span class="attr">context</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">	fix : <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Vue源码打包">Vue源码打包</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 入口文件</span></span><br><span class="line"><span class="comment">// runtime + compiler</span></span><br><span class="line"><span class="comment">// runtime-only</span></span><br><span class="line"><span class="comment">// import &#123; createApp &#125; from &#x27;vue/dist/vue.esm-bundler.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./vue/App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./js/a.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span>.<span class="property">hot</span>)&#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./js/a.js&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a.js更新了&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const app = createApp(&#123;</span></span><br><span class="line"><span class="comment">//   template: &#x27;#mytemp&#x27;,</span></span><br><span class="line"><span class="comment">//   data()&#123;</span></span><br><span class="line"><span class="comment">//     return &#123;</span></span><br><span class="line"><span class="comment">//       title: &#x27;hello vue3&#x27;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// app.mount(&#x27;#app&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>通过查看我们发现界面上是没有效果的</p>
<p>并且查看运行的控制台，会发现如下的警告信息</p>
<p><img data-src="image-20231212184839838.png" alt="image-20231212184839838"></p>
<h5 id="Vue打包后不同版本解析">Vue打包后不同版本解析</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vue(.runtime).global(.prod).js：</span><br><span class="line">  通过浏览器中的 &lt;script src=&quot;...&quot;&gt; 直接使用</span><br><span class="line">  我们之前通过CDN引入和下载的Vue版本就是这个版本</span><br><span class="line">  会暴露一个全局的Vue来使用</span><br><span class="line"></span><br><span class="line">vue(.runtime).esm-browser(.prod).js：</span><br><span class="line">  用于通过原生 ES 模块导入使用 (在浏览器中通过 &lt;script type=&quot;module&quot;&gt; 来使用)</span><br><span class="line">  </span><br><span class="line">vue(.runtime).esm-bundler.js：</span><br><span class="line">  用于 webpack，rollup 和 parcel 等构建工具</span><br><span class="line">  构建工具中默认是vue.runtime.esm-bundler.js</span><br><span class="line">  如果我们需要解析模板template，那么需要手动指定vue.esm-bundler.js</span><br><span class="line">  </span><br><span class="line">vue.cjs(.prod).js：</span><br><span class="line">  服务器端渲染使用</span><br><span class="line">  通过require()在Node.js中使用</span><br></pre></td></tr></table></figure>
<h5 id="运行时-编译器-vs-仅运行时">运行时+编译器 vs 仅运行时</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在Vue的开发过程中我们有三种方式来编写DOM元素：</span><br><span class="line">方式一：template模板的方式（之前经常使用的方式）</span><br><span class="line">方式二：render函数的方式，使用h函数来编写渲染的内容</span><br><span class="line">方式三：通过.vue文件中的template来编写模板</span><br><span class="line"></span><br><span class="line">它们的模板分别是如何处理的呢？</span><br><span class="line">方式二中的h函数可以直接返回一个虚拟节点，也就是Vnode节点</span><br><span class="line">方式一和方式三的template都需要有特定的代码来对其进行解析</span><br><span class="line">方式三.vue文件中的template可以通过在vue-loader对其进行编译和处理</span><br><span class="line">方式一种的template我们必须要通过源码中一部分代码来进行编译</span><br><span class="line"></span><br><span class="line">所以，Vue在让我们选择版本的时候分为 运行时+编译器 vs 仅运行时</span><br><span class="line">运行时+编译器包含了对template模板的编译代码，更加完整，但是也更大一些</span><br><span class="line">仅运行时没有包含对template版本的编译代码，相对更小一些；</span><br></pre></td></tr></table></figure>
<h5 id="全局标识的配置">全局标识的配置</h5>
<p>我们会发现控制台还有另外的一个警告：</p>
<p><img data-src="image-20231212185339848.png" alt="image-20231212185339848"></p>
<p>在GitHub上的文档中我们可以找到说明：</p>
<p><img data-src="image-20231212185404993.png" alt="image-20231212185404993"></p>
<p>这是两个特性的标识，一个是使用Vue的Options，一个是Production模式下是否支持devtools工具</p>
<p>虽然他们都有默认值，但是强烈建议我们手动对他们进行配置；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">    <span class="attr">BASE_URL</span>: <span class="string">&quot;&#x27;./&#x27;&quot;</span>,</span><br><span class="line">    <span class="comment">// 是否支持OptionsApi</span></span><br><span class="line">    <span class="attr">__VUE_OPTIONS_API__</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 生产环境下是否支持DEVTOOLS</span></span><br><span class="line">    <span class="attr">__VUE_PROD_DEVTOOLS__</span>: <span class="literal">false</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<h5 id="VSCode对SFC文件的支持">VSCode对SFC文件的支持</h5>
<p>真实开发中多数情况下我们都是使用SFC（ single-file components (单文件组件) ）</p>
<p>我们先说一下VSCode对SFC的支持</p>
<p>插件一：Vetur，从Vue2开发就一直在使用的VSCode支持Vue的插件；</p>
<p>插件二：Volar，官方推荐的插件（后续会基于Volar开发官方的VSCode插件）；</p>
<h5 id="编写App-vue代码">编写App.vue代码</h5>
<p>Father.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">:parentMsg</span>=<span class="string">parentMsg</span>&gt;</span><span class="tag">&lt;/<span class="name">Child</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&#x27;./Child.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Child</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">title</span>: <span class="string">&#x27;我是父组件&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">parentMsg</span>: <span class="string">&#x27;你站在这里别动 我去买几个橘子~~~&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>Son.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h4</span> @<span class="attr">click</span>=<span class="string">&#x27;buy&#x27;</span>&gt;</span>&#123;&#123;childMsg&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">props</span>: [<span class="string">&#x27;parentMsg&#x27;</span>],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">msg</span>: <span class="string">&#x27;我是子组件&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">childMsg</span>: <span class="variable language_">this</span>.<span class="property">parentMsg</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">buy</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// console.log(this.parentMsg)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">childMsg</span> = <span class="string">&#x27;我感觉你在侮辱我&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="App-vue的打包过程">App.vue的打包过程</h5>
<p>我们对代码打包会报错：我们需要合适的Loader来处理文件</p>
<p>这个时候我们需要使用vue-loader</p>
<p><code>npm install vue-loader@next -D</code></p>
<p>在webpack的模板规则中进行配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">   <span class="attr">loader</span>: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="vue-compiler-sfc">@vue/compiler-sfc</h5>
<p>打包依然会报错，这是因为我们必须添加@vue/compiler-sfc来对template进行解析</p>
<p><code>npm install @vue/compiler-sfc -D</code></p>
<p>另外我们需要配置对应的Vue插件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解构vue-loader</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">VueLoaderPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vue-loader&#x27;</span>)</span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()   </span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="搭建本地服务器"><strong>搭建本地服务器</strong></h4>
<p>为什么要搭建？</p>
<p>目前我们开发的代码，为了运行需要有两个操作：</p>
<p>操作一：npm run build，编译相关的代码；</p>
<p>操作二：通过live server或者直接通过浏览器，打开index.html代码，查看效果；</p>
<p>这个过程经常操作会影响我们的开发效率，我们希望可以做到，当文件发生变化时，可以自动的完成 编译 和 展示；</p>
<p>为了完成自动编译，webpack提供了几种可选的方式：</p>
<p>webpack watch mode；</p>
<p>webpack-dev-server（常用）；</p>
<p>webpack-dev-middleware；</p>
<h5 id="Webpack-watch"><strong>Webpack watch</strong></h5>
<p>webpack给我们提供了watch模式：</p>
<p>在该模式下，webpack依赖图中的所有文件，只要有一个发生了更新，那么代码将被重新编译；</p>
<p>我们不需要手动去运行 npm run build指令了；</p>
<p>如何开启watch呢？两种方式：</p>
<p>方式一：在导出的配置中，添加 watch: true；</p>
<p>方式二：在启动webpack的命令中，添加 --watch的标识；</p>
<p>这里我们选择方式二，在package.json的 scripts 中添加一个 watch 的脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build&quot;: &quot;npx webpack&quot;,</span><br><span class="line">    &quot;watch&quot;: &quot;webpack --watch&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h5 id="webpack-dev-server"><strong>webpack-dev-server</strong></h5>
<p>上面的方式可以监听到文件的变化，但是事实上它本身是没有自动刷新浏览器的功能的：</p>
<p>当然，目前我们可以在VSCode中使用live-server来完成这样的功能；</p>
<p>但是，我们希望在不使用live-server的情况下，可以具备live reloading（实时重新加载）的功能；</p>
<p>安装webpack-dev-server</p>
<p><code>npm install webpack-dev-server -D</code></p>
<p>修改配置文件，告知 dev server，从什么位置查找文件：</p>
<p>contentBase 已经从webpack5中移除 使用static取代</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    // 主要是指定静态资源的根目录的 下面这种方式已废弃</span><br><span class="line">    // contentBase: &#x27;./public&#x27;,</span><br><span class="line">    </span><br><span class="line">    // webpack5最新的方式</span><br><span class="line">    static: &#123;</span><br><span class="line">       directory: path.join(__dirname, &#x27;public&#x27;),</span><br><span class="line">     &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>webpack-dev-server 在编译之后不会写入到任何输出文件。而是将 bundle 文件保留在内存中：事实上webpack-dev-server使用了一个库叫memfs（memory-fs webpack自己写的）</p>
<h5 id="认识模块热替换（HMR）">认识模块热替换（HMR）</h5>
<p>什么是HMR呢？</p>
<p>HMR的全称是Hot Module Replacement，翻译为模块热替换；</p>
<p>模块热替换是指在 应用程序运行过程中，替换、添加、删除模块，而无需重新刷新整个页面；</p>
<p>HMR通过如下几种方式，来提高开发的速度：</p>
<p>不重新加载整个页面，这样可以保留某些应用程序的状态不丢失；</p>
<p>只更新需要变化的内容，节省开发的时间；</p>
<p>修改了css、js源代码，会立即在浏览器更新，相当于直接在浏览器的devtools中直接修改样式；</p>
<p>如何使用HMR呢？</p>
<p>默认情况下，webpack-dev-server已经支持HMR，我们只需要开启即可；</p>
<p>在不开启HMR的情况下，当我们修改了源代码之后，整个页面会自动刷新，使用的是live reloading</p>
<h5 id="开启HMR">开启HMR</h5>
<p>修改配置文件:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">	<span class="attr">static</span>: &#123;</span><br><span class="line">       <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>),</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>浏览器控制台查看效果</p>
<p><img data-src="image-20220713233728291.png" alt=""></p>
<p>但是你会发现，当我们修改了某一个模块的代码时，依然是刷新的整个页面：</p>
<p>这是因为我们需要去指定哪些模块发生更新时，进行HMR；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./a.js&#x27;</span></span><br><span class="line"><span class="comment">// 指定哪些模块发生更新时进行HMR</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span>.<span class="property">hot</span>)&#123;</span><br><span class="line">  <span class="comment">// accept: 认可 同意</span></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./a.js&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a.js已经更新啦~~~~~~&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="框架的HMR">框架的HMR</h5>
<p>有一个问题：在开发其他项目时，我们是否需要经常手动去写入 module.hot.accpet相关的API呢？</p>
<p>比如开发Vue、React项目，我们修改了组件，希望进行热更新，这个时候应该如何去操作呢？</p>
<p>事实上社区已经针对这些有很成熟的解决方案了：</p>
<p>比如vue开发中，我们使用vue-loader，此loader支持vue组件的HMR，提供开箱即用的体验；</p>
<p>比如react开发中，有React Hot Loader，实时调整react组件（目前React官方已经弃用了，改成使用react- refresh）；</p>
<h5 id="HRM原理">HRM原理</h5>
<p>那么HMR的原理是什么呢？如何可以做到只更新一个模块中的内容呢？</p>
<p>webpack-dev-server会创建两个服务：提供静态资源的服务（express）和Socket服务（net.Socket）；</p>
<p>express server负责直接提供静态资源的服务（打包后的资源直接被浏览器请求和解析）；</p>
<p>HMR Socket Server，是一个socket的长连接：</p>
<p>长连接有一个最好的好处是建立连接后双方可以通信（服务器可以直接发送文件到客户端）；</p>
<p>当服务器监听到对应的模块发生变化时，会生成两个文件.json（manifest文件）和.js文件（update chunk）；</p>
<p>通过长连接，可以直接将这两个文件主动发送给客户端（浏览器）；</p>
<p>浏览器拿到两个新的文件后，通过HMR runtime机制，加载这两个文件，并且针对修改的模块进行更新；</p>
<p><img data-src="image-20220714222243288.png" alt=""></p>
<h5 id="hotOnly、host配置">hotOnly、host配置</h5>
<p>host设置主机地址：</p>
<p>默认值是localhost；</p>
<p>如果希望其他地方也可以访问，可以设置为 0.0.0.0；</p>
<p>localhost 和 0.0.0.0 的区别：</p>
<p>localhost：本质上是一个域名，通常情况下会被解析成127.0.0.1;</p>
<p>127.0.0.1：回环地址(Loop Back Address)，表达的意思其实是我们主机自己发出去的包，直接被自己接收;</p>
<p>正常的数据库包发送过程 应用层 - 传输层 - 网络层 - 数据链路层 - 物理层 ;</p>
<p>而回环地址，是在网络层直接就被获取到了，是不会经常数据链路层和物理层的;</p>
<p>比如我们监听 127.0.0.1时，在同一个网段下的主机中，通过ip地址是不能访问的;</p>
<p>0.0.0.0：监听IPV4上所有的地址，再根据端口找到不同的应用程序;</p>
<p>比如我们监听 0.0.0.0时，在同一个网段下的主机中，通过ip地址是可以访问的;</p>
<h5 id="port、open、compress">port、open、compress</h5>
<p>port设置监听的端口，默认情况下是8080</p>
<p>open是否打开浏览器：</p>
<p>默认值是false，设置为true会打开浏览器；</p>
<p>也可以设置为类似于 Google Chrome等值；</p>
<p>compress是否为静态文件开启gzip compression：</p>
<p>默认值是false，可以设置为true；</p>
<p><img data-src="image-20220714222504046.png" alt=""></p>
<h5 id="Proxy-2">Proxy</h5>
<p>proxy是我们开发中非常常用的一个配置选项，它的目的设置代理来解决跨域访问的问题：</p>
<p>比如我们的一个api请求是 <a href="http://localhost:8888">http://localhost:8888</a>，但是本地启动服务器的域名是 <a href="http://localhost:8000">http://localhost:8000</a>，这 个时候发送网络请求就会出现跨域的问题；</p>
<p>那么我们可以将请求先发送到一个代理服务器，代理服务器和API服务器没有跨域的问题，就可以解决我们的跨域问题了；</p>
<p>我们可以进行如下的设置：</p>
<p>target：表示的是代理到的目标地址，比如 /api-hy/moment会被代理到 <a href="http://localhost:8888/api-">http://localhost:8888/api-</a>  hy/moment；</p>
<p>pathRewrite：默认情况下，我们的 /api-hy 也会被写入到URL中，如果希望删除，可以使用pathRewrite；</p>
<p>secure：默认情况下不接收转发到https的服务器上，如果希望支持，可以设置为false；</p>
<p>changeOrigin：它表示是否更新代理后请求的headers中host地址；</p>
<h5 id="changeOrigin">changeOrigin</h5>
<p>这个 changeOrigin官方说的非常模糊，通过查看源码我发现其实是要修改代理请求中的headers中的host属性：</p>
<p>因为我们真实的请求，其实是需要通过 http://localhost:8888来请求的；</p>
<p>但是因为使用了代码，默认情况下它的值时 <a href="http://localhost:8000">http://localhost:8000</a>；</p>
<p>如果我们需要修改，那么可以将changeOrigin设置为true即可；</p>
<p><img data-src="image-20220714222917297.png" alt=""></p>
<h5 id="historyApiFallback">historyApiFallback</h5>
<p>historyApiFallback是开发中一个非常常见的属性，它主要的作用是解决SPA页面在路由跳转之后，进行页面刷新 时，返回404的错误。</p>
<p>boolean值：默认是false</p>
<p>如果设置为true，那么在刷新时，返回404错误时，会自动返回 index.html 的内容；</p>
<p>object类型的值，可以配置rewrites属性：</p>
<p>可以配置from来匹配路径，决定要跳转到哪一个页面；</p>
<p>事实上devServer中实现historyApiFallback功能是通过connect-history-api-fallback库的：</p>
<p>可以查看connect-history-api-fallback 文档</p>
<h5 id="resolve模块解析">resolve模块解析</h5>
<p>resolve用于设置模块如何被解析：</p>
<p>在开发中我们会有各种各样的模块依赖，这些模块可能来自于自己编写的代码，也可能来自第三方库；</p>
<p>resolve可以帮助webpack从每个 require/import 语句中，找到需要引入到合适的模块代码；</p>
<p>webpack 使用 enhanced-resolve 来解析文件路径；</p>
<p><strong>webpack能解析三种文件路径：</strong></p>
<p>绝对路径</p>
<p>由于已经获得文件的绝对路径，因此不需要再做进一步解析。</p>
<p>相对路径</p>
<p>在这种情况下，使用 import 或 require 的资源文件所处的目录，被认为是上下文目录；</p>
<p>在 import/require 中给定的相对路径，会拼接此上下文路径，来生成模块的绝对路径；</p>
<p>模块路径</p>
<p>在 resolve.modules中指定的所有目录检索模块；</p>
<p>默认值是 [‘node_modules’]，所以默认会从node_modules中查找文件；</p>
<p>我们可以通过设置别名的方式来替换初识模块路径，具体后面讲解alias的配置；</p>
<p><strong>确实文件还是文件夹</strong></p>
<p>如果是一个文件：</p>
<p>如果文件具有扩展名，则直接打包文件；</p>
<p>否则，将使用 resolve.extensions选项作为文件扩展名解析；</p>
<p>如果是一个文件夹：</p>
<p>会在文件夹中根据 resolve.mainFiles配置选项中指定的文件顺序查找；</p>
<p>resolve.mainFiles的默认值是 [‘index’]；</p>
<p>再根据 resolve.extensions来解析扩展名；</p>
<h5 id="extensions和alias配置">extensions和alias配置</h5>
<p>extensions是解析到文件时自动添加扩展名：</p>
<p>默认值是 [‘.wasm’, ‘.mjs’, ‘.js’, ‘.json’]；</p>
<p>所以如果我们代码中想要添加加载 .vue 或者 jsx 或者 ts 等文件时，我们必须自己写上扩展名；</p>
<p>另一个非常好用的功能是配置别名alias：</p>
<p>特别是当我们项目的目录结构比较深的时候，或者一个文件的路径可能需要 …/…/…/这种路径片段；</p>
<p>我们可以给某些常见的路径起一个别名；</p>
<p><img data-src="image-20220714223714865.png" alt=""></p>
<h4 id="webpack生产环境配置">webpack生产环境配置</h4>
<h5 id="css提取">css提取</h5>
<p>下载插件 <code>npm install --save-dev mini-css-extract-plugin</code></p>
<p>修改配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">       <span class="attr">use</span>: [</span><br><span class="line">           <span class="comment">//创建 style标签，将样式放入</span></span><br><span class="line">           <span class="comment">// &#x27;style-loader&#x27;,</span></span><br><span class="line">           <span class="comment">//这个 loader取代 style-loader。作用：提取 js中的 css成单独文件</span></span><br><span class="line">           <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">           <span class="comment">//将 css文件整合到 js文件中</span></span><br><span class="line">           <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">    <span class="comment">//对输出的 css文件进行重命名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;css/built.css&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h5 id="css兼容">css兼容</h5>
<p>详见：postcss-preset-env</p>
<p>补充一点：package.json中指定要兼容到哪个版本</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;browserslist&quot;</span> : &#123;</span><br><span class="line">	<span class="string">&quot;development&quot;</span> :[</span><br><span class="line">		<span class="string">&quot;last 1 chrome version&quot;</span> ,</span><br><span class="line">		<span class="string">&quot;last 1 firefox version&quot;</span> ,</span><br><span class="line">		<span class="string">&quot;last 1 safari version&quot;</span></span><br><span class="line">    ],</span><br><span class="line">	<span class="string">&quot;production&quot;</span>:[</span><br><span class="line">        <span class="string">&quot;&gt;0.2%&quot;</span>,</span><br><span class="line">		<span class="string">&quot;not dead&quot;</span> ,</span><br><span class="line">		<span class="string">&quot;not op_mini all&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;last 1 chrome version&quot;</span> 表示兼容最近版本的 chrome</span><br><span class="line"><span class="string">&quot;&gt;0.2%&quot;</span> 表示大于 <span class="number">99.8</span>% 的浏览器</span><br><span class="line"><span class="string">&quot;not dead&quot;</span> 表示不要已经死去的浏览器(如 <span class="title class_">IE10</span>)</span><br><span class="line"><span class="string">&quot;not op_mini all&quot;</span> 表示要 欧朋mini 浏览器 (不兼容已经死去的浏览器)</span><br></pre></td></tr></table></figure>
<p>或者在根目录下新建<code>.browserslistrc</code>文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&gt; <span class="number">1</span>%</span><br><span class="line">last <span class="number">2</span> versions</span><br><span class="line">not dead</span><br></pre></td></tr></table></figure>
<p><code>browserslist</code>默认使用的是production环境变量 我们可以修改nodejs的环境变量来决定它的环境变量</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">process.<span class="property">env</span>.<span class="property">NODE_ENV</span> = <span class="string">&#x27;development&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="css压缩">css压缩</h5>
<p>下载插件 <code>npm install --save-dev optimize-css-assets-webpack-plugin</code></p>
<p>webpack5改用 <code>npm i -D css-minimizer-webpack-plugin</code></p>
<p>修改配置文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span>()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h5 id="js语法检查">js语法检查</h5>
<p>详见：eslint</p>
<h5 id="js兼容处理">js兼容处理</h5>
<p>详见：babel</p>
<h5 id="js压缩">js压缩</h5>
<p>生产环境下会自动压缩 js代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mode: &#x27;production&#x27;</span><br></pre></td></tr></table></figure>
<h5 id="HTML压缩">HTML压缩</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">    <span class="comment">//压缩 html代码</span></span><br><span class="line">    <span class="attr">minify</span>: &#123;</span><br><span class="line">      <span class="comment">//移除空格</span></span><br><span class="line">      <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//移除注释</span></span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 移除空元素</span></span><br><span class="line">      <span class="attr">removeEmptyElements</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="性能优化">性能优化</h4>
<p>开发环境性能优化</p>
<ul>
<li>优化打包构建速度</li>
<li>优化代码调试</li>
</ul>
<p>生产环境性能优化</p>
<ul>
<li>优化打包构建速度</li>
<li>优化代码运行的性能</li>
</ul>
<h5 id="HMR">HMR</h5>
<p><strong>HMR：hot module replacement 热模块替换/模块热替换 是基于开发环境的</strong></p>
<p><strong>作用</strong>：一个模块发生变化，只会宠幸打包这一个文件，而不是打包所有的源文件</p>
<p><strong>样式文件</strong>：可以使用HMR，因为在style-loader内部实现了，所以在开发环境中，都用style-loader</p>
<p><strong>js文件</strong>：默认不能使用HMR.要使用，在对应js文件中添加如下代码</p>
<p><strong>注意</strong>：HMR功能对js的处理，只能处理非入口js文件的其他文件！！！！</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span>.<span class="property">hot</span>)&#123;</span><br><span class="line">    <span class="comment">//这里以build.js为例子,不能处理入口js文件</span></span><br><span class="line">    moule.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&#x27;./build.js&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//会监听index.js的变化，一旦发生变化，就会执行这里的函数</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>html文件</strong>：默认不能使用HMR功能，同时会导致问题： html文件不能热更新了～(不用做HMR功能)</p>
<p><strong>解决</strong>：修改entry入口，将html文件引入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">entry：[<span class="string">&#x27;src/index.js&#x27;</span>, <span class="string">&#x27;public/index.html&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h5 id="source-map">source-map</h5>
<p>作用：一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射可以追踪源代码错误)</p>
<p>参数：<code>[inline-|hidden-|eva1-][nosources-][cheap-[module-]]source-map</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source-map: 外部</span><br><span class="line">显示错误代码准确信息 和 源代码的错误位置</span><br><span class="line"></span><br><span class="line">inline-source-map：内联（只生成一个内联source-map）</span><br><span class="line">显示错误代码准确信息 和 源代码的错误位置</span><br><span class="line"></span><br><span class="line">hidden-source-map：外部（每一个文件都生成对应的source-map 都在eval中）</span><br><span class="line">显示错误代码错误原因 但是没有错误位置 不能追踪源代码错误位置 只能提示到构建后代码的错误位置</span><br><span class="line"></span><br><span class="line">eval-source-map：内联</span><br><span class="line">显示错误代码准确信息 和 源代码的错误位置</span><br><span class="line"></span><br><span class="line">nosources-source-map：外部</span><br><span class="line">显示错误代码准确信息 但是没有任何源代码的信息</span><br><span class="line"></span><br><span class="line">cheap-source-map：外部</span><br><span class="line">显示错误代码准确信息 和 源代码的错误位置 只能精确到错误行不能精确到错误列</span><br><span class="line"></span><br><span class="line">cheap-module-source-map：外部</span><br><span class="line">显示错误代码准确信息 和 源代码的错误位置 module会将loader的source-map也加入进来</span><br><span class="line"></span><br><span class="line">内联和外部的区别：</span><br><span class="line">1．外部生成了文件，内联没有</span><br><span class="line">2．内联构建速度更快</span><br></pre></td></tr></table></figure>
<p>如何决定使用哪个呢？</p>
<p>开发环境：</p>
<p>速度快：（eval&gt;inline&gt;cheap…）=&gt;  eval-cheap-source-map || eval-source-map</p>
<p>调试更友好： source-map || cheap-module-source-map || cheap-source-map</p>
<p>结论： 推荐 eval-source-map / eval-cheap-module-source-map</p>
<p>生成环境：</p>
<p>注：内联会让生产环境变的特别大 所以在生产环境下不推荐这种方式</p>
<p>源码要不要隐藏：nosources-source-map || hidden-source-map</p>
<p>调试要不要更友好：source-map || cheap-module-source-map</p>
<p>结论：推荐 source-map</p>
<h5 id="oneOf">oneOf</h5>
<p>oneof是提供优化生产环境打包配置的，正常来讲，一个文件只能被一个loader处理。<br>
比如：同时同时处理css文件和less文件，都需要css-loader，会让css-loader重复的执行，而oneof则会优化</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//以下 loader只会匹配一个</span></span><br><span class="line"><span class="comment">//注意：不能有两个配置处理同一种类型文件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//只需要将配置文件放入oneof中即可</span></span><br><span class="line">        <span class="attr">oneof</span>:[]</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>注意：两个loader处理一个时，则需要放在外面</strong></p>
<p>比如：js文件需要eslint-loader处理和babel-loader处理。这个时候我们就需要单独提取出。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>:&#123;</span><br><span class="line">    <span class="attr">rules</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">//这里放单独提取出的loader处理,只需要放一个  </span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//只需要将配置文件放入oneof中即可</span></span><br><span class="line">            <span class="attr">oneof</span>:[]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="缓存">缓存</h5>
<p>生产环境</p>
<p>当我们的js代码有很多时，我们修改其中的一个，并不希望所有的js代码都重新被打包。此时我们就要用到生产环境的缓存处理</p>
<p><strong>babel缓存</strong></p>
<p><strong>让第二次打包构建速度更快</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// babel-loader配置项中开启babel缓存，第二次构建的时候就会读取缓存</span></span><br><span class="line"><span class="attr">cacheDirectory</span>:<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>此时，用户第一次打开就会生成缓存，后面打开的话就会很快。</p>
<p>但是，如果你的js css代码修改的话，重新打包，页面将不会有任何反应，因为他们用的都是第一次留下的缓存，那我们怎么让他正常的处理呢？ 我们对文件名加入hash值即可</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在webpack.config.js中，所有的filename中加入hash值即可,比如下述代码</span></span><br><span class="line"><span class="attr">filename</span>:<span class="string">&#x27;index[hash:10].js&#x27;</span></span><br></pre></td></tr></table></figure>
<p>造成的问题：因为css和js同时使用一个hash值。</p>
<p>如果重新打包，会导致所有的缓存失效。（我们只想改变其中的一个文件）</p>
<p>chunkhash：不行，因为所引入的js，css等文件都是源自一个chunk，所以他们生成的哈希值也一样</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">filename</span>:<span class="string">&#x27;index[chunkhash:10].js&#x27;</span></span><br></pre></td></tr></table></figure>
<p>contenthash：不同文件会生成不同的哈希值，可以</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">filename</span>:<span class="string">&#x27;index[contenthash:10].js&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="tree-shaking">tree shaking</h5>
<p>作用：去除无用代码，让代码体积变小</p>
<p>前提：</p>
<p>1、必须使用模块化</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;increment, decrement&#125; <span class="keyword">from</span> <span class="string">&#x27;utils&#x27;</span></span><br><span class="line"><span class="title function_">increment</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>2、开启production环境</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在package.json中配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;sideEffects&quot;</span>:<span class="literal">false</span>  <span class="comment">//所有代码都没有副作用,即可以进行tree shaking</span></span><br><span class="line">问题:可能会把css / @babel/polyfill (副作用)等文件干掉 ,此时我们要再加</span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>:[<span class="string">&quot;*.css&quot;</span>]  <span class="comment">//这样即可</span></span><br></pre></td></tr></table></figure>
<h5 id="code-split">code split</h5>
<p>code split 就是解决防止打包后一个文件过大，而请求缓慢.</p>
<p>code split 就是生成多个chunk，即把代码分成很多块</p>
<p>作用：</p>
<p>1、可以将node_modules中代码单独打包一个chunk</p>
<p>2、自动分析多入口chunk中，有没有公共的文件，如果有则会打包成一个chunk</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>  <span class="comment">//单入口</span></span><br><span class="line"><span class="attr">entry</span>:&#123;  <span class="comment">//多入口有几个文件就会输出几个文件，不同配置下面代码也可以</span></span><br><span class="line">    <span class="attr">index</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">test</span>:<span class="string">&#x27;./src/test.js&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在后面加入下述代码即可</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">optimization</span>:&#123;</span><br><span class="line">    <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">        <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次，我们还可以通过写js代码方式进行单独打包，首先要配置optimization和单入口</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这是在index.js中引入。假设有test.js和index.js在同一层级</span></span><br><span class="line"><span class="title function_">import</span>(<span class="comment">/*webpackChunkname:&#x27;test&#x27;*/</span><span class="string">&#x27;./test&#x27;</span>)  <span class="comment">//在/**/中可以指定生成对应名字</span></span><br><span class="line">.<span class="title function_">then</span>(()=&#123;</span><br><span class="line">    <span class="comment">//文件调用成功</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//文件加载失败</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>总结三种方法</strong></p>
<ul>
<li>使用多入口文件进行单独打包</li>
<li>引入optimization相关配置，会根据单入口，多入口进行打包</li>
<li>引入optimization相关配置，在js中写入对应js代码，进行单独打包</li>
</ul>
<h5 id="懒加载和预加载">懒加载和预加载</h5>
<p>不是图片的懒加载，这里指的是js代码的懒加载</p>
<p>懒加载：当文件使用的时候加载</p>
<p>预加载 prefetch ：等其他资源加载完，再加载… 兼容性较差，一般都是用懒加载就够了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这里比如当点击btn时，加载test.js文件</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;btn&#x27;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">import</span>(<span class="comment">/*webpackChunkName:&#x27;test&#x27;,webpackPrefetch:true*/</span><span class="string">&#x27;./test.js&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="PWA">PWA</h5>
<p>pwa即离线可访问技术</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">WorkboxWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;workbox-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="comment">//再通过plugins  中new调用</span></span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WorkboxWebpackPlugin</span>.<span class="title class_">GenerateSW</span>(&#123;</span><br><span class="line">        <span class="comment">//会生成serviceworker配置文件</span></span><br><span class="line">        <span class="comment">//1.帮助serviceworker快速启动</span></span><br><span class="line">        <span class="comment">//2.删除旧的servicewoker</span></span><br><span class="line">        <span class="attr">clientsClaim</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">skipWaiting</span>:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后还要去index.js中输入相应js代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;serviceWorker&#x27;</span> <span class="keyword">in</span> navigator)&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>,()=&#123;</span><br><span class="line">        navigator.<span class="property">serviceWorker</span></span><br><span class="line">        .<span class="title function_">register</span>(<span class="string">&#x27;/service-worker.js&#x27;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;注册成功&#x27;</span>)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">           <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;注册失败&#x27;</span>)</span><br><span class="line">           &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这里，再打包eslint则会报错，不认识navigator等关键字，故我们要修改eslint中的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在package.json中eslintConfig中添加下面代码</span></span><br><span class="line"><span class="string">&quot;env&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;browser&quot;</span>:<span class="literal">true</span>    <span class="comment">//支持浏览器全局变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>serviceWorker必须运行在服务器上</strong></p>
<h5 id="多进程打包">多进程打包</h5>
<p>多进程打包主要用来优化打包速度。用的是thread-loader</p>
<p>在哪里用，在那里加就可以，基本是给js文件处理</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">use</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&#x27;thread-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123;</span><br><span class="line">            <span class="attr">workers</span>:<span class="number">2</span>  <span class="comment">//z</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>:&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>开启多线程打包，只有工作消耗时间比较长，我们才开启多线程打包，否则会适得其反，多线程启动大概600ms</p>
<h5 id="externals">externals</h5>
<p>可以禁止打包一些从cdn中可以获取到库，从而达到代码量少,在webpack.config.js中配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">externals</span>:&#123;</span><br><span class="line">    <span class="comment">//比如，拒绝vue被打包进来</span></span><br><span class="line">    <span class="attr">vue</span>:<span class="string">&#x27;Vue&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在html中通过script标签引入cdn链接</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="dll">dll</h5>
<p>dll和上面的externals相似。dll是需要打包一次。而externals是不打包</p>
<p>我们要新建webpack.dll.js文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>:&#123;</span><br><span class="line">        <span class="comment">//例如打包jquery. [name]--&gt; jquery   [&#x27;jquery&#x27;]--&gt;代表要打包的库是jquery</span></span><br><span class="line">        <span class="attr">jquery</span>:[<span class="string">&#x27;jquery&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;dll&#x27;</span>),</span><br><span class="line">        <span class="comment">//打包的库向外暴露出去的名字</span></span><br><span class="line">        <span class="attr">library</span>:<span class="string">&#x27;[name]_[hash]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="comment">//打包生成一个manifest.json 和jquery提供映射</span></span><br><span class="line">        <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>:<span class="string">&#x27;[name]_[hash]&#x27;</span> <span class="comment">//暴露出去的名称</span></span><br><span class="line">            <span class="attr">path</span>:<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;dll/mainfest.json&#x27;</span>)<span class="comment">//输出文件路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">     <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在config.js配置如下即可</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;resolve&#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="comment">//webpack默认打包是config.js文件。可以通过引入然后调用改变默认打包文件</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;add-asset-html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exprots</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;built.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//告诉webpack哪些库不需要打包,也就是通过json文件映射到相应库，告诉webpack不参与打包</span></span><br><span class="line">        <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">            <span class="attr">mainfest</span>:<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//将文件打包输出出去，并在html中自动引入资源</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filepath</span>:<span class="title function_">resolve</span>(__dirname,<span class="string">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更详细配置待更新 …</p>
]]></content>
      <categories>
        <category>webpack</category>
      </categories>
      <tags>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>vue3 学习</title>
    <url>/blog/2023/08/09/vue3/</url>
    <content><![CDATA[<h4 id="vue3简介">vue3简介</h4>
<p><img data-src="image-20220729221023361.png" alt=""></p>
<ul>
<li>2020年9月18日，Vue.js发布3.0版本，代号：One Piece（海贼王）</li>
<li>耗时2年多、<a href="https://github.com/vuejs/vue-next/graphs/commit-activity">2600+次提交</a>、<a href="https://github.com/vuejs/rfcs/tree/master/active-rfcs">30+个RFC</a>、<a href="https://github.com/vuejs/vue-next/pulls?q=is%3Apr+is%3Amerged+-author%3Aapp%2Fdependabot-preview+">600+次PR</a>、<a href="https://github.com/vuejs/vue-next/graphs/contributors">99位贡献者</a></li>
<li>github上的tags地址：<a href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">https://github.com/vuejs/vue-next/releases/tag/v3.0.0</a></li>
</ul>
<span id="more"></span>
<h4 id="Vue3带来了什么">Vue3带来了什么</h4>
<h5 id="1-性能的提升">1.性能的提升</h5>
<ul>
<li>
<p>打包大小减少41%</p>
</li>
<li>
<p>初次渲染快55%, 更新渲染快133%</p>
</li>
<li>
<p>内存减少54%</p>
<p>…</p>
</li>
</ul>
<h5 id="2-源码的升级">2.源码的升级</h5>
<ul>
<li>
<p>使用Proxy代替defineProperty实现响应式</p>
</li>
<li>
<p>重写虚拟DOM的实现和Tree-Shaking</p>
<p>…</p>
</li>
</ul>
<h5 id="3-拥抱TypeScript">3.拥抱TypeScript</h5>
<ul>
<li>Vue3可以更好的支持TypeScript</li>
</ul>
<h5 id="4-新的特性">4.新的特性</h5>
<ol>
<li>
<p>Composition API（组合API）</p>
<ul>
<li>setup配置</li>
<li>ref与reactive</li>
<li>watch与watchEffect</li>
<li>provide与inject</li>
<li>…</li>
</ul>
</li>
<li>
<p>新的内置组件</p>
<ul>
<li>Fragment</li>
<li>Teleport</li>
<li>Suspense</li>
</ul>
</li>
<li>
<p>其他改变</p>
<ul>
<li>新的生命周期钩子</li>
<li>data 选项应始终被声明为一个函数</li>
<li>移除keyCode支持作为 v-on 的修饰符</li>
<li>…</li>
</ul>
</li>
</ol>
<h4 id="创建vue3项目">创建vue3项目</h4>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## 查看@vue/cli版本，确保@vue/cli版本在4.5.0以上</span></span><br><span class="line">vue --version</span><br><span class="line"><span class="comment">## 安装或者升级你的@vue/cli</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"><span class="comment">## 创建</span></span><br><span class="line">vue create vue3_study</span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line"><span class="built_in">cd</span> vue3_study</span><br><span class="line">npm run serve</span><br><span class="line"></span><br><span class="line">vite创建参照官网</span><br></pre></td></tr></table></figure>
<h4 id="Options-API的弊端">Options API的弊端</h4>
<p>在Vue2中，我们编写组件的方式是 <strong>OptionsAPI</strong>：</p>
<p>Options API的一大特点就是在对应的属性中编写对应的功能模块；</p>
<p>比如data定义数据、methods中定义方法、computed中定义计算属性、watch中监听属性改变，也包括生命 周期钩子；</p>
<p><strong>但是这种代码有一个很大的弊端：</strong></p>
<p>当我们实现某一个功能时，这个功能对应的代码逻辑会被拆分到各个属性中；</p>
<p>当我们组件变得更大、更复杂时，逻辑关注点的列表就会增长，那么同一个功能的逻辑就会被拆分的很分散；</p>
<p>尤其对于那些一开始没有编写这些组件的人来说，这个组件的代码是难以阅读和理解的（阅读组件的其他人）；</p>
<p><strong>下面我们来看一个非常大的组件，其中的逻辑功能按照颜色进行了划分：</strong></p>
<p>这种碎片化的代码使用理解和维护这个复杂的组件变得异常困难，并且隐藏了潜在的逻辑问题；</p>
<p>并且当我们处理单个逻辑关注点时，需要不断的跳到相应的代码块中；</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img data-src="image-20220731071836628.png" alt=""></td>
<td><img data-src="image-20220731071850917.png" alt=""></td>
</tr>
</tbody>
</table>
<p>如果我们能将同一个逻辑关注 点相关的代码收集在一起会更好。</p>
<p>这就是<strong>Composition API</strong>想要做的事情，以及可以帮助我 们完成的事情。</p>
<p>也有人把Vue Composition  API简称为<strong>VCA</strong>。</p>
<h4 id="认识Composition-API">认识Composition API</h4>
<p>那么既然知道Composition API想要帮助我们做什么事情，接下来看一下<strong>到底是怎么做</strong>呢？</p>
<p>为了开始使用Composition API，我们需要有一个可以实际使用它（编写代码）的地方；</p>
<p>在Vue组件中，这个位置就是 setup 函数；</p>
<p><strong>setup</strong>其实就是组件的另外一个选项：</p>
<p>只不过这个选项强大到我们可以用它来替代之前所编写的大部分其他选项；</p>
<p>比如methods、computed、watch、data、生命周期等等；</p>
<p>接下来我们一起学习这个函数的使用：</p>
<h5 id="setup函数的参数">setup函数的参数</h5>
<p>我们先来研究一个setup函数的参数，它主要<strong>有两个参数</strong>：</p>
<p>第一个参数：props</p>
<p>第二个参数：context</p>
<p>props非常好理解，它其实就是<strong>父组件传递过来的属性</strong>会被放到props对象中，我们在<strong>setup中如果需要使用</strong>，那么就可以直接通过props参数获取：</p>
<p>对于定义props的类型，我们还是和之前的规则是一样的，在props选项中定义；</p>
<p>并且在template中依然是可以正常去使用props中的属性，比如message；</p>
<p>如果我们在setup函数中想要使用props，那么不可以通过 this 去获取（后面我会讲到为什么）；</p>
<p>因为props有直接作为参数传递到setup函数中，所以我们可以直接通过参数来使用即可；</p>
<p>另外一个参数是<strong>context</strong>，我们也称之为是一个<strong>SetupContext</strong>，它里面<strong>包含三个属性</strong>：</p>
<p><strong>attrs</strong>：所有的非prop的attribute；</p>
<p><strong>slots</strong>：父组件传递过来的插槽（这个在以渲染函数返回时会有作用，后面会讲到）；</p>
<p><strong>emit</strong>：当我们组件内部需要发出事件时会用到emit（因为我们不能访问this，所以不可以通过 this.$emit发出事件）；</p>
<h5 id="setup函数的返回值">setup函数的返回值</h5>
<p>setup函数的两种返回值：</p>
<ol>
<li>若返回一个对象，则对象中的属性、方法, 在模板中均可以直接使用。（重点关注！）</li>
<li><span style="color:#aad">若返回一个渲染函数：则可以自定义渲染内容。（了解）</span></li>
</ol>
<p><strong>注意点：</strong></p>
<ol>
<li>尽量不要与Vue2.x配置混用
<ul>
<li>Vue2.x配置（data、methos、computed…）中<strong style="color:#DD5145">可以访问到</strong>setup中的属性、方法。</li>
<li>但在setup中<strong style="color:#DD5145">不能访问到</strong>Vue2.x配置（data、methos、computed…）。</li>
<li>如果有重名, setup优先。</li>
</ul>
</li>
<li>setup不能是一个async函数，因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性。（后期也可以返回一个Promise实例，但需要Suspense和异步组件的配合）</li>
</ol>
<h4 id="ref函数">ref函数</h4>
<ul>
<li>作用: 定义一个响应式的数据</li>
<li>语法: <code>const xxx = ref(initValue)</code>
<ul>
<li>创建一个包含响应式数据的<strong style="color:#DD5145">引用对象（reference对象，简称ref对象）, 其内部的值是在ref.value属性中被维护的 </strong>。</li>
<li>JS中操作数据： <code>xxx.value</code></li>
<li>模板中读取数据:  vue自动帮我们进行解包操作，不需要.value，直接：<code>&lt;div&gt;&#123;&#123;xxx&#125;&#125;&lt;/div&gt;</code></li>
</ul>
</li>
<li>备注：
<ul>
<li>接收的数据可以是：基本类型、也可以是对象类型。</li>
<li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>完成的。</li>
<li>对象类型的数据：内部 <strong>求助</strong> 了Vue3.0中的一个新函数—— <code>reactive</code>函数。</li>
</ul>
</li>
</ul>
<p><strong>源码位置: packages/reactivity/src/ref.ts</strong></p>
<p><img data-src="image-20240429164050859.png" alt="ref实现"></p>
<h4 id="reactive函数">reactive函数</h4>
<ul>
<li>作用: 定义一个<strong style="color:#DD5145">对象类型</strong>的响应式数据（基本类型不要用它，控制台会报警告，要用<code>ref</code>函数）</li>
<li>语法：<code>const 代理对象= reactive(源对象)</code>接收一个对象（或数组），返回一个<strong style="color:#DD5145">代理对象（Proxy的实例对象，简称proxy对象）</strong></li>
<li>reactive定义的响应式数据是“深层次的”。</li>
<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据进行操作。</li>
</ul>
<p><strong>为什么就可以变成响应式的呢？</strong></p>
<p>这是因为当我们使用reactive函数处理我们的数据之后，数据再次被使用时就会进行依赖收集；</p>
<p>当数据发生改变时，所有收集到的依赖都是进行对应的响应式操作（比如更新界面）；</p>
<p>事实上，我们编写的data选项，也是在内部交给了reactive函数将其变成响应式对象的；</p>
<p>需要注意的是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = reactive&lt;string[]&gt;([<span class="string">&quot;111&quot;</span>])</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 借助数组的方法添加元素</span></span><br><span class="line">  <span class="comment">// arr.push(&quot;222&quot;)</span></span><br><span class="line">  <span class="comment">// console.log(arr); // proxy</span></span><br><span class="line">  <span class="comment">// 直接覆盖reactive定义的响应式对象</span></span><br><span class="line">  <span class="comment">// arr = [&quot;222&quot;]</span></span><br><span class="line">  <span class="comment">// console.log(arr); // 普通对象 =&gt; 丢失响应式</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr2 = reactive&lt;&#123; <span class="attr">list</span>: string[] &#125;&gt;(&#123; <span class="attr">list</span>: [<span class="string">&quot;111&quot;</span>] &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 覆盖arr的某个属性而不是整个对象 =&gt; 不会丢失响应式</span></span><br><span class="line">  arr2.<span class="property">list</span> = [<span class="string">&quot;222&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>源码位置: packages/reactivity/src/reactive.ts</strong></p>
<p><img data-src="image-20240429164221291.png" alt="reactive实现"></p>
<h4 id="ref-reactive">ref &amp; reactive</h4>
<ul>
<li>从定义数据角度对比：
<ul>
<li>ref用来定义：<strong style="color:#DD5145">基本类型数据</strong>。</li>
<li>reactive用来定义：<strong style="color:#DD5145">对象（或数组）类型数据</strong>。</li>
<li>备注：ref也可以用来定义<strong style="color:#DD5145">对象（或数组）类型数据</strong>, 它内部会自动通过<code>reactive</code>转为<strong style="color:#DD5145">代理对象</strong>。</li>
</ul>
</li>
<li>从原理角度对比：
<ul>
<li>ref通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li>
<li>reactive通过使用<strong style="color:#DD5145">Proxy</strong>来实现响应式（数据劫持）, 并通过<strong style="color:#DD5145">Reflect</strong>操作<strong style="color:orange">源对象</strong>内部的数据。</li>
</ul>
</li>
<li>从使用角度对比：
<ul>
<li>ref定义的数据：操作数据<strong style="color:#DD5145">需要</strong><code>.value</code>，读取数据时模板中直接读取<strong style="color:#DD5145">不需要</strong><code>.value</code>。</li>
<li>reactive定义的数据：操作数据与读取数据：<strong style="color:#DD5145">均不需要</strong><code>.value</code>。</li>
</ul>
</li>
</ul>
<h4 id="ref的其它API">ref的其它API</h4>
<h5 id="unref"><strong>unref</strong></h5>
<p>如果我们想要<strong>获取一个ref引用中的value</strong>，那么也可以通过<strong>unref</strong>方法：</p>
<p>如果参数是一个 ref，则返回内部值，否则返回参数本身；</p>
<p>这是 val = isRef(val) ? val.value : val 的语法糖函数；</p>
<h5 id="isRef"><strong>isRef</strong></h5>
<p>判断值是否是一个ref对象。</p>
<h5 id="shallowRef">shallowRef</h5>
<ul>
<li>shallowRef：只处理基本数据类型的响应式, 不进行对象的响应式处理。</li>
<li>什么时候使用?
<ul>
<li>如果有一个对象数据，结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive。</li>
<li>如果有一个对象数据，后续功能不会修改该对象中的属性，而是产生新的对象来替换 ===&gt; shallowRef。</li>
</ul>
</li>
</ul>
<h5 id="triggerRef"><strong>triggerRef</strong></h5>
<p>手动触发和 shallowRef 相关联的副作用</p>
<h5 id="customRef">customRef</h5>
<p>创建一个<strong>自定义的ref</strong>，并<strong>对其依赖项跟踪和更新触发</strong>进行<strong>显示控制</strong>：</p>
<p>它需要一个工厂函数，该函数接受 track 和 trigger 函数作为参数；</p>
<p>并且应该返回一个带有 get 和 set 的对象；</p>
<p><strong>这里我们使用一个的案例：</strong></p>
<p>对双向绑定的属性进行debounce(节流)的操作；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;keyword&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123;ref,customRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">name</span>:<span class="string">&#x27;Demo&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// let keyword = ref(&#x27;hello&#x27;) //使用Vue准备好的内置ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//自定义一个myRef</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">function</span> <span class="title function_">myRef</span>(<span class="params">value,delay</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">let</span> timer</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//通过customRef去实现自定义</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track,trigger</span>)=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">get</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">track</span>() <span class="comment">//告诉Vue这个value值是需要被“追踪”的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> value</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">set</span>(<span class="params">newValue</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="built_in">clearTimeout</span>(timer)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          timer = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            value = newValue</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="title function_">trigger</span>() <span class="comment">//告诉Vue去更新界面</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,delay)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> keyword = <span class="title function_">myRef</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">500</span>) <span class="comment">//使用程序员自定义的ref</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    keyword</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;&#125;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="toRef">toRef</h5>
<p>如果我们只希望转换一个<strong>reactive</strong>对象中的属性为ref, 那么可以使用<strong>toRef</strong>的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script setup lang=<span class="string">&quot;ts&quot;</span>&gt;</span><br><span class="line"><span class="comment">// toRef只能针对响应式对象的值 非响应式不起作用</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive, toRef, toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let obj = &#123;name: &#x27;zs&#x27;&#125;</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;)</span><br><span class="line"><span class="comment">// let name = toRef(obj, &#x27;name&#x27;)</span></span><br><span class="line"><span class="comment">// let age = toRef(obj, &#x27;age&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解构相当于 =&gt; 这种方式得到的数据丢失了响应式</span></span><br><span class="line"><span class="comment">// let &#123; name, age &#125; = obj</span></span><br><span class="line"><span class="comment">// let name = obj.name</span></span><br><span class="line"><span class="comment">// let age = obj.age</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const change = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//  // 通过toRef处理的属性会变成ObjectRefImpl对象 使用需要.value</span></span><br><span class="line"><span class="comment">//  name.value = &#x27;ls&#x27;</span></span><br><span class="line"><span class="comment">//  age.value = 20</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 手写 toRefs</span></span><br><span class="line"><span class="comment">// const toRefs = &lt;T extends Object&gt;(obj: T) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   const map: any = &#123;&#125;</span></span><br><span class="line"><span class="comment">//   for(let key in obj) &#123;</span></span><br><span class="line"><span class="comment">//     map[key] = toRef(obj, key)</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   return map</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用</span></span><br><span class="line"><span class="comment">// setName(toRef(obj, &#x27;name&#x27;))</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>应用:   要将响应式对象中的某个属性单独提供给外部使用时。</p>
<h5 id="toRefs">toRefs</h5>
<p>如果我们使用ES6的解构语法，对reactive返回的对象进行解构获取值，那么之后无论是修改解构后的变量，还是修改reactive返回的state对象，数据都不再是响应式的：</p>
<p>那么有没有办法<strong>让我们解构出来的属性是响应式</strong>的呢？</p>
<p>Vue为我们提供了一个toRefs的函数，可以将reactive返回的对象中的属性都转成ref；</p>
<p>那么我们再次进行结构出来的 name 和 age 本身都是 ref的；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// toRefs</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age &#125; = <span class="title function_">toRefs</span>(obj)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">change</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  name.<span class="property">value</span> = <span class="string">&#x27;ls&#x27;</span></span><br><span class="line">  age.<span class="property">value</span> = <span class="number">20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种做法相当于已经在state.name和ref.value之间建立了链接，任何一个修改都会引起另外一个变化；</p>
<h4 id="响应式原理">响应式原理</h4>
<p>观察者模式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 有观察者 有被观察者  </span></span><br><span class="line"><span class="comment">// 观察者需要放到被观察者中 被观察者状态发生变化 需要通知观察者 我变化了</span></span><br><span class="line"><span class="comment">// 被观察者需要收集观察者</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 内部也是基于发布订阅模式  订阅和发布之间有明显关系</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Baby</span> &#123; <span class="comment">// 被观察者 小宝宝</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;好嗨哟&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 这样写相当于在原型上添加方法 Baby.prototype.attach()</span></span><br><span class="line">  <span class="title function_">attach</span>(<span class="params">o</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(o)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">    <span class="comment">// 小宝宝新状态覆盖老状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = newState</span><br><span class="line">    <span class="comment">// 主动通知观察者(爸爸妈妈)状态发生变化</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">o</span> =&gt;</span> o.<span class="title function_">update</span>(<span class="variable language_">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123; <span class="comment">// 观察者 我 我媳妇</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">update</span>(<span class="params">baby</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前&#x27;</span> + <span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;被通知了,小宝宝此刻的状态是&#x27;</span> + baby.<span class="property">state</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我和我媳妇需要观察小宝宝的状态</span></span><br><span class="line"><span class="keyword">let</span> baby = <span class="keyword">new</span> <span class="title class_">Baby</span>(<span class="string">&#x27;小宝宝&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> father = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&#x27;爸爸&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> mother = <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="string">&#x27;妈妈&#x27;</span>)</span><br><span class="line"><span class="comment">// 小宝宝收集爸爸妈妈</span></span><br><span class="line">baby.<span class="title function_">attach</span>(father)</span><br><span class="line">baby.<span class="title function_">attach</span>(mother)</span><br><span class="line"><span class="comment">// 小宝宝状态发生变化</span></span><br><span class="line">baby.<span class="title function_">setState</span>(<span class="string">&#x27;好想哭&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被观察者状态变化主动通知观察者, 所以观察者也是基于发布订阅的</span></span><br><span class="line"><span class="comment">// 但是发布订阅只是相当于一个中介, 往那一放, 回头取出来就好了</span></span><br><span class="line"><span class="comment">// vue里面可以说它是观察者模式, 数据更新视图会发生变化, 也可以说它是发布订阅模式</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/luckest/p/16962989.html">发布订阅模式</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 发布订阅模式主要分成两个部分 on emit</span></span><br><span class="line"><span class="comment">// on就是把一些函数维护到一个数组中</span></span><br><span class="line"><span class="comment">// emit 就是让数组中的方法依次执行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let fs = require(&#x27;fs&#x27;)</span></span><br><span class="line"><span class="comment">// let man = &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // 订阅和发布之间并没有明显关系 靠arr中介来实现</span></span><br><span class="line"><span class="comment">// let event = &#123;</span></span><br><span class="line"><span class="comment">//     arr: [],</span></span><br><span class="line"><span class="comment">//     on(fn) &#123;</span></span><br><span class="line"><span class="comment">//         this.arr.push(fn)</span></span><br><span class="line"><span class="comment">//     &#125;,</span></span><br><span class="line"><span class="comment">//     emit() &#123;</span></span><br><span class="line"><span class="comment">//         this.arr.forEach(fn =&gt; fn())</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// event.on(function () &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&#x27;读取了一个&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// event.on(function () &#123;</span></span><br><span class="line"><span class="comment">//     // console.log(&#x27;读取完毕&#x27;);</span></span><br><span class="line"><span class="comment">//     // 我们希望所有读取操作执行完毕后再走这里的内容</span></span><br><span class="line"><span class="comment">//     if (Object.keys(man).length == 2) &#123;</span></span><br><span class="line"><span class="comment">//         console.log(man);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fs.readFile(&#x27;./name.txt&#x27;, &#x27;utf8&#x27;, function (err, data) &#123;</span></span><br><span class="line"><span class="comment">//     man.name = data</span></span><br><span class="line"><span class="comment">//     event.emit();</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fs.readFile(&#x27;./age.txt&#x27;, &#x27;utf8&#x27;, function (err, data) &#123;</span></span><br><span class="line"><span class="comment">//     man.age = data</span></span><br><span class="line"><span class="comment">//     event.emit();</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Events</span>(<span class="params"></span>) &#123; <span class="comment">// redux promise</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">results</span> = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Events</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">on</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123; <span class="comment">// 订阅</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">push</span>(cb)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Events</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">emit</span> = <span class="keyword">function</span> (<span class="params">data</span>) &#123; <span class="comment">// 发布</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">results</span>.<span class="title function_">push</span>(data)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">c</span> =&gt;</span> <span class="title function_">c</span>(<span class="variable language_">this</span>.<span class="property">results</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> env = <span class="keyword">new</span> <span class="title class_">Events</span>()</span><br><span class="line">env.<span class="title function_">on</span>(<span class="keyword">function</span> (<span class="params">arr</span>) &#123; <span class="comment">// 这里的arr 读取文件的结果的数组  [ &#x27;老许&#x27;, &#x27;18&#x27; ]</span></span><br><span class="line">    <span class="keyword">if</span> (arr.<span class="property">length</span> === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./name.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">    env.<span class="title function_">emit</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./age.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">    env.<span class="title function_">emit</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20240430104915199.png" alt="image-20240430104915199"></p>
<p><a href="https://blog.csdn.net/lunahaijiao/article/details/129630837">Vue2与Vue3响应式原理与依赖收集详解</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// effect.ts</span></span><br><span class="line"><span class="comment">// 定义变量 保存fn</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">effectActive</span>: any</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">effect</span> = (<span class="params">fn: <span class="built_in">Function</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    effectActive = fn</span><br><span class="line">    <span class="title function_">fn</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 首次渲染</span></span><br><span class="line">  <span class="title function_">foo</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依赖收集</span></span><br><span class="line"><span class="keyword">let</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">track</span> = (<span class="params">target: any, key: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 根据目标对象在weakMap中查找是否有对应的值</span></span><br><span class="line">  <span class="keyword">let</span> depsMap = weakMap.<span class="title function_">get</span>(target);</span><br><span class="line">  <span class="comment">// 第一次肯定是没有的</span></span><br><span class="line">  <span class="keyword">if</span> (!depsMap) &#123;</span><br><span class="line">    <span class="comment">// 给一个初始化的Map</span></span><br><span class="line">    depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">    weakMap.<span class="title function_">set</span>(target, depsMap); <span class="comment">// &#123;&#123;name:&#x27;zs&#x27;, age: 18&#125;: &lt;map&gt;&#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> deps = depsMap &amp;&amp; depsMap.<span class="title function_">get</span>(key);</span><br><span class="line">  <span class="keyword">if</span> (!deps) &#123;</span><br><span class="line">    <span class="comment">// 给一个初始化的Set</span></span><br><span class="line">    deps = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    depsMap.<span class="title function_">set</span>(key, deps) <span class="comment">// &#123;&#123;name:&#x27;zs&#x27;, age: 18&#125;: &#123;name: &lt;set&gt;&#125;&#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">  deps.<span class="title function_">add</span>(effectActive) <span class="comment">// &#123;&#123;name:&#x27;zs&#x27;, age: 18&#125;: &#123;name: &lt;effectActive&gt;&#125;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图更新</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">trigger</span> = (<span class="params">target: any, key: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> desMap = weakMap.<span class="title function_">get</span>(target)</span><br><span class="line">  <span class="keyword">let</span> deps = desMap.<span class="title function_">get</span>(key)</span><br><span class="line">  deps.<span class="title function_">forEach</span>(<span class="function"><span class="params">dep</span> =&gt;</span> <span class="title function_">dep</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reactive.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;track, trigger&#125; <span class="keyword">from</span> <span class="string">&#x27;./effect.js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObj</span> = (<span class="params">target</span>) =&gt; <span class="keyword">typeof</span> target !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> reactive&lt;T <span class="keyword">extends</span> <span class="title class_">Object</span>&gt;(<span class="attr">target</span>: T)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>)&#123;</span><br><span class="line">      <span class="keyword">let</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">      <span class="comment">// 依赖收集</span></span><br><span class="line">      <span class="title function_">track</span>(target, key)</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_">isObj</span>(res)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reactive</span>(res)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newVal</span>) &#123;</span><br><span class="line">      <span class="comment">// 修改数据</span></span><br><span class="line">      <span class="keyword">let</span> flag = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newVal)</span><br><span class="line">      <span class="comment">// 视图更新</span></span><br><span class="line">      <span class="title function_">trigger</span>(target, key)</span><br><span class="line">      <span class="keyword">return</span> flag</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- // index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;./dist/reactive.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; effect &#125; <span class="keyword">from</span> <span class="string">&#x27;./dist/effect.js&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 响应式处理</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">age</span>: <span class="number">18</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">girlFriend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;刘亦菲&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 渲染函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">effect</span>(<span class="function">()=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">innerText</span> = <span class="string">`<span class="subst">$&#123;obj.name&#125;</span> - <span class="subst">$&#123;obj.age&#125;</span> - <span class="subst">$&#123;obj.girlFriend.name&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      obj.<span class="property">age</span> = <span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        obj.<span class="property">name</span> = <span class="string">&#x27;ls&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        obj.<span class="property">girlFriend</span>.<span class="property">name</span> = <span class="string">&#x27;翠花&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="readonly">readonly</h4>
<p>我们通过<strong>reactive或者ref可以获取到一个响应式的对象</strong>，但是某些情况下，我们<strong>传入给其他地方（组件）<strong>的这个 响应式对象希望</strong>在另外一个地方（组件）被使用</strong>，但是<strong>不能被修改</strong>，这个时候如何防止这种情况的出现呢？</p>
<p>Vue3为我们提供了readonly的方法；</p>
<p>readonly会返回原生对象的只读代理（也就是它依然是一个Proxy，这是一个proxy的set方法被劫持，并且不 能对其进行修改）；</p>
<p><strong>在开发中常见的readonly方法会传入三个类型的参数：</strong></p>
<p>类型一：普通对象；</p>
<p>类型二：reactive返回的对象；</p>
<p>类型三：ref的对象；</p>
<p><strong>在readonly的使用过程中，有如下规则：</strong></p>
<p>readonly返回的对象都是不允许修改的；但是经过readonly处理的原来的对象是允许被修改的；</p>
<p>比如 const info = readonly(obj)，info对象是不允许被修改的；</p>
<p>当obj被修改时，readonly返回的info对象也会被修改；但是我们不能去修改readonly返回的对象info；</p>
<p>其实本质上就是readonly返回的对象的setter方法被劫持了而已；</p>
<p><strong>应用场景</strong>：在我们传递给其他组件数据时，往往希望其他组件使用我们传递的内容，但是不允许它们修改时，就可以使用readonly了；</p>
<h4 id="reactive-其它API">reactive 其它API</h4>
<h5 id="isProxy"><strong>isProxy</strong></h5>
<p>检查对象是否是由 reactive 或 readonly创建的 proxy。</p>
<h5 id="isReactive"><strong>isReactive</strong></h5>
<p>检查对象是否是由 reactive创建的响应式代理：</p>
<p>如果该代理是 readonly 建的，但包裹了由 reactive 创建的另一个代理，它也会返回 true；</p>
<h5 id="isReadonly"><strong>isReadonly</strong></h5>
<p>检查对象是否是由 readonly 创建的只读代理。</p>
<h5 id="shallowReactive"><strong>shallowReactive</strong></h5>
<p>创建一个响应式代理，它跟踪其自身 property 的响应性，但不执行嵌套对象的深层响应式转换 (深层还是原生对象)。</p>
<h5 id="shallowReadonly"><strong>shallowReadonly</strong></h5>
<p>创建一个 proxy，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换（深层还是可读、可写的）。只处理对象最外层属性的响应式（浅响应式）。</p>
<p>深度监听存在的问题： 如果数据量比较大，非常消耗性能。 有些时候我们并不需要对数据进行深度监听。 这个时候就没有必要使用ref和reactive</p>
<h4 id="其它-Composition-API">其它 Composition API</h4>
<h5 id="toRaw-markRaw">toRaw &amp; markRaw</h5>
<ul>
<li>toRaw：
<ul>
<li>作用：将一个由<code>reactive</code>生成的<strong style="color:orange">响应式对象</strong>转为<strong style="color:orange">普通对象</strong>。</li>
<li>使用场景：用于读取响应式对象对应的普通对象，对这个普通对象的所有操作，不会引起页面更新。</li>
</ul>
</li>
<li>markRaw：
<ul>
<li>作用：标记一个对象，使其永远不会再成为响应式对象。</li>
<li>应用场景:
<ol>
<li>有些值不应被设置为响应式的，例如复杂的第三方类库等。</li>
<li>当渲染具有不可变数据源的大列表时，跳过响应式转换可以提高性能。</li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hello&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; oldObj &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeInfo&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; toRaw, reactive, markRaw &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// let obj = reactive(&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   name: &#x27;zs&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 获取 reactive 或 readonly 代理的原始对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// let oldObj = toRaw(obj)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(oldObj);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ======= markRaw ========</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> obj = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 标记一个对象，使其永远不会再成为响应式对象。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> oldObj = <span class="title function_">markRaw</span>(obj)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(oldObj);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 设置响应式失效</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    oldObj = <span class="title function_">reactive</span>(oldObj)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">changeInfo</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      oldObj.<span class="property">name</span> = <span class="string">&#x27;lisi&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 数据发生变化 =&gt; 视图没有更新</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(oldObj.<span class="property">name</span> );</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      oldObj,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      changeInfo</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="provide-与-inject">provide 与 inject</h5>
<p><img data-src="image-20220801225915620.png" alt="image-20220801225915620"></p>
<p>作用：实现<strong style="color:#DD5145">祖与后代组件间</strong>通信</p>
<p>套路：父组件有一个 <code>provide</code> 选项来提供数据，后代组件有一个 <code>inject</code> 选项来开始使用这些数据</p>
<p>具体写法：</p>
<p>祖组件中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">let</span> car = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;奔驰&#x27;</span>,<span class="attr">price</span>:<span class="string">&#x27;40万&#x27;</span>&#125;)</span><br><span class="line">    <span class="title function_">provide</span>(<span class="string">&#x27;car&#x27;</span>,car)</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后代组件中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props,context</span>)&#123;</span><br><span class="line">	......</span><br><span class="line">    <span class="keyword">const</span> car = <span class="title function_">inject</span>(<span class="string">&#x27;car&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;car&#125;</span><br><span class="line">	......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="计算属性与监视">计算属性与监视</h4>
<h5 id="computed">computed</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    姓名: &#123;&#123; fullName &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    修改姓名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;fullName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    姓:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;stu.firstName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;stu.lastName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; reactive, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// vue2的computed简单写法</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// computed: &#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   fullName() &#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     return this.stu.firstName + &#x27;-&#x27; + this.stu.lastName</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// vue2的computed完整写法</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// computed: &#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   fullName: &#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     get()&#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//       return this.stu.firstName + &#x27;-&#x27; + this.stu.lastName</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     &#125;,</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     set()&#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//       console.log(111);</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// &#125;, </span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> stu = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">firstName</span>: <span class="string">&#x27;张&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">lastName</span>: <span class="string">&#x27;三&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vu3 computed 简写 =&gt; 修改报警告需要提供setter</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// let fullName = computed(()=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   return stu.firstName + &#x27;-&#x27; + stu.lastName</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 挂载到stu上</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// stu.fullName = computed(()=&gt;&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   return stu.firstName + &#x27;-&#x27; + stu.lastName</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vue3 computed 完整写法 =&gt; 可读可写</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> fullName = <span class="title function_">computed</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> stu.<span class="property">firstName</span> + <span class="string">&#x27;-&#x27;</span> + stu.<span class="property">lastName</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">set</span>(<span class="params">val</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> arr = val.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        stu.<span class="property">firstName</span> = arr[<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">        stu.<span class="property">lastName</span> = arr[<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      stu,</span></span><br><span class="line"><span class="language-javascript">      fullName</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="watch">watch</h5>
<ul>
<li>
<p>与Vue2.x中watch配置功能一致</p>
</li>
<li>
<p>两个小“坑”：</p>
<ul>
<li>监视reactive定义的响应式数据时：oldValue无法正确获取、强制开启了深度监视（deep配置失效）。</li>
<li>监视reactive定义的响应式数据中某个属性时：deep配置有效。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//情况一：监视ref定义的响应式数据</span></span><br><span class="line"><span class="title function_">watch</span>(sum,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sum变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//情况二：监视多个ref定义的响应式数据</span></span><br><span class="line"><span class="title function_">watch</span>([sum,msg],<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sum或msg变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 情况三：监视reactive定义的响应式数据</span></span><br><span class="line"><span class="comment">   若watch监视的是reactive定义的响应式数据，则无法正确获得oldValue！！</span></span><br><span class="line"><span class="comment">   若watch监视的是reactive定义的响应式数据，则强制开启了深度监视 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">watch</span>(person,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">false</span>&#125;) <span class="comment">//此处的deep配置不再奏效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//情况四：监视reactive定义的响应式数据中的某个属性</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>person.<span class="property">job</span>,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">true</span>&#125;) </span><br><span class="line"></span><br><span class="line"><span class="comment">//情况五：监视reactive定义的响应式数据中的某些属性</span></span><br><span class="line"><span class="title function_">watch</span>([<span class="function">()=&gt;</span>person.<span class="property">job</span>,<span class="function">()=&gt;</span>person.<span class="property">name</span>],<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">immediate</span>:<span class="literal">true</span>,<span class="attr">deep</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//特殊情况</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">()=&gt;</span>person.<span class="property">job</span>,<span class="function">(<span class="params">newValue,oldValue</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;person的job变化了&#x27;</span>,newValue,oldValue)</span><br><span class="line">&#125;,&#123;<span class="attr">deep</span>:<span class="literal">true</span>&#125;) <span class="comment">//此处由于监视的是reactive定义的对象中的某个属性，所以deep配置有效</span></span><br></pre></td></tr></table></figure>
<p>在前面的Options API中，我们可以通过watch选项来侦听data或者props的数据变化，当数据变化时执行某一些 操作。</p>
<p>而在Composition API中，我们可以使用watchEffect和watch来完成响应式数据的侦听；</p>
<p>watchEffect用于自动收集响应式数据的依赖；</p>
<p>watch需要手动指定侦听的数据源；</p>
<h5 id="watchEffect">watchEffect</h5>
<ul>
<li>
<p>watch的套路是：既要指明监视的属性，也要指明监视的回调。</p>
</li>
<li>
<p>watchEffect的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。watchEffect 是默认会执行一次。</p>
</li>
<li>
<p>watchEffect有点像computed：</p>
<ul>
<li>但computed注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li>
<li>而watchEffect更注重的是过程（回调函数的函数体），所以不用写返回值。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">watchEffect所指定的回调中用到的数据只要发生变化，则直接重新执行回调。</span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> x1 = sum.<span class="property">value</span></span><br><span class="line">    <span class="keyword">const</span> x2 = person.<span class="property">age</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;watchEffect配置的回调执行了&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="watchEffect-停止侦听">watchEffect 停止侦听</h5>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ref定义的响应式数据</span></span><br><span class="line">    <span class="keyword">let</span> num = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">let</span> stu = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">      <span class="attr">friend</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">addNum</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      ++num.<span class="property">value</span></span><br><span class="line">      <span class="keyword">if</span> (num.<span class="property">value</span> &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="comment">// 停止侦听</span></span><br><span class="line">        <span class="title function_">stop</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 首先，watchEffect传入的函数会被立即执行一次，并且在执行的过程中会收集依赖；</span></span><br><span class="line">    <span class="comment">// 其次，只有收集的依赖发生变化时，watchEffect传入的函数才会再次执行；</span></span><br><span class="line">    <span class="keyword">let</span> stop = <span class="title function_">watchEffect</span>(<span class="function">(<span class="params">onInvalidate</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 没有所谓的深度监视</span></span><br><span class="line">      <span class="comment">// console.log(num.value, stu.friend.name);</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(num.<span class="property">value</span>);</span><br><span class="line">      <span class="title function_">onInvalidate</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;取消上一次请求~&#x27;</span>);</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timeId)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> timeId = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发起请求~&#x27;</span>);</span><br><span class="line">      &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      num,</span><br><span class="line">      addNum,</span><br><span class="line">      ...<span class="title function_">toRefs</span>(stu)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h5 id="watchEffect-清除副作用">watchEffect 清除副作用</h5>
<p>什么是清除副作用呢？</p>
<p>比如在开发中我们需要在侦听函数中执行网络请求，但是在网络请求还没有达到的时候，我们停止了侦听器， 或者侦听器侦听函数被再次执行了。</p>
<p>那么上一次的网络请求应该被取消掉，这个时候我们就可以清除上一次的副作用；</p>
<p>在我们给watchEffect传入的函数被回调时，其实可以获取到一个参数：onInvalidate</p>
<p>当<strong>副作用即将重新执行</strong> 或者 <strong>侦听器被停止</strong> 时会执行该函数传入的回调函数；</p>
<p>我们可以在传入的回调函数中，执行一些清除工作；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">代码参上</span><br></pre></td></tr></table></figure>
<h5 id="setup中使用ref">setup中使用ref</h5>
<p>在讲解 watchEffect执行时机之前，我们先补充一个知识：在setup中如何使用ref获取元素或者组件？</p>
<p>其实非常简单，我们只需要定义一个ref对象，绑定到元素或者组件的ref属性上即可；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">ref</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// vue2中的ref是用来获取dom元素或者组件实例的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// vue3中没有 this 获取不到</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(this.$refs.title);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> title = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;  </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      title</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="watchEffect的执行时机">watchEffect的执行时机</h5>
<p>默认情况下，组件的更新会在副作用函数执行之前：</p>
<p>如果我们希望在副作用函数中获取到元素，是否可行呢？</p>
<p>如上代码我们会发现打印结果打印了两次：</p>
<p>这是因为setup函数在执行时就会立即执行传入的副作用函数，这个时候DOM并没有挂载，所以打印为null；</p>
<p>而当DOM挂载时，会给title的ref对象赋值新的值，副作用函数会再次执行，打印出来对应的元素；</p>
<h5 id="调整watchEffect的执行时机">调整watchEffect的执行时机</h5>
<p>如果我们希望在第一次的时候就打印出来对应的元素呢？</p>
<p>这个时候我们需要改变副作用函数的执行时机；</p>
<p>它的默认值是pre，它会在元素 挂载 或者 更新 之前执行；</p>
<p>所以我们会先打印出来一个空的，当依赖的title发生改变时，就会再次执行一次，打印出元素；</p>
<p>flush 选项还接受 sync，这将强制效果始终同步触发。然而，这是低效的，应该很少需要。</p>
<h4 id="生命周期函数">生命周期函数</h4>
<ul>
<li>Vue3.0中可以继续使用Vue2.x中的生命周期钩子，但有有两个被更名：
<ul>
<li><code>beforeDestroy</code>改名为 <code>beforeUnmount</code></li>
<li><code>destroyed</code>改名为 <code>unmounted</code></li>
</ul>
</li>
<li>Vue3.0也提供了 Composition API 形式的生命周期钩子，与Vue2.x中钩子对应关系如下：
<ul>
<li><code>beforeCreate</code>===&gt;<code>setup()</code></li>
<li><code>created</code>=======&gt;<code>setup()</code></li>
<li><code>beforeMount</code> ===&gt;<code>onBeforeMount</code></li>
<li><code>mounted</code>=======&gt;<code>onMounted</code></li>
<li><code>beforeUpdate</code>===&gt;<code>onBeforeUpdate</code></li>
<li><code>updated</code> =======&gt;<code>onUpdated</code></li>
<li><code>beforeUnmount</code> ==&gt;<code>onBeforeUnmount</code></li>
<li><code>unmounted</code> =====&gt;<code>onUnmounted</code></li>
</ul>
</li>
</ul>
<p><img data-src="image-20220808210007522.png" alt="image-20220808210007522"></p>
<h4 id="自定义hook函数">自定义hook函数</h4>
<ul>
<li>
<p>什么是hook？—— 本质是一个函数，把setup函数中使用的Composition API进行了封装。</p>
</li>
<li>
<p>类似于vue2.x中的mixin。</p>
</li>
<li>
<p>自定义hook的优势: 复用代码, 让setup中的逻辑更清楚易懂。</p>
</li>
</ul>
<p><strong>useCounter</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref, computed&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    count.<span class="property">value</span> ++ </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    count.<span class="property">value</span> -- </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> doubleCount = <span class="title function_">computed</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count.<span class="property">value</span> * <span class="number">2</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    count,</span><br><span class="line">    doubleCount,</span><br><span class="line">    increment,</span><br><span class="line">    decrement</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>useTitle</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ref, reactive, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params">title=<span class="string">&#x27;默认title&#x27;</span></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> titleRef = <span class="title function_">ref</span>(title)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(titleRef, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = titleRef.<span class="property">value</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> titleRef</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>App.vue</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; doubleCount &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> useCounter <span class="keyword">from</span> <span class="string">&#x27;./hooks/useCounter&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> useTitle <span class="keyword">from</span> <span class="string">&#x27;./hooks/useTitle&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; toRefs, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> counter = <span class="title function_">reactive</span>(<span class="title function_">useCounter</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">useTitle</span>().<span class="property">value</span> = <span class="string">&#x27;使用hooks&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ...<span class="title function_">toRefs</span>(counter)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="setup的顶层编写方式">setup的顶层编写方式</h4>
<blockquote>
<p>博客：<a href="https://blog.csdn.net/weixin_43931876/article/details/120058286">https://blog.csdn.net/weixin_43931876/article/details/120058286</a></p>
<p>官网：<a href="https://v3.cn.vuejs.org/api/sfc-spec.html#script-setup">https://v3.cn.vuejs.org/api/sfc-spec.html#script-setup</a></p>
</blockquote>
<h4 id="新的组件">新的组件</h4>
<h5 id="Fragment">Fragment</h5>
<ul>
<li>在Vue2中: 组件必须有一个根标签</li>
<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<h5 id="Teleport">Teleport</h5>
<p>​	什么是Teleport？—— <code>Teleport</code> 是一种能够将我们的<strong style="color:#DD5145">组件html结构</strong>移动到指定位置的技术</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// App.vue  </span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  App组件</span><br><span class="line">  <span class="tag">&lt;<span class="name">Father</span>&gt;</span><span class="tag">&lt;/<span class="name">Father</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Father</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Father.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Father</span>,</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">setup</span>(<span class="params"></span>) &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.app</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">padding</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-color</span>: hotpink;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Father.vue</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    Father组件</span><br><span class="line">    <span class="tag">&lt;<span class="name">Son</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Son</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.father</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Son.vue</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;son&quot;</span>&gt;</span></span><br><span class="line">    Son组件</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow = true&quot;</span>&gt;</span>显示弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h3</span>&gt;</span>我是一个弹窗<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;isShow = false&quot;</span>&gt;</span>关闭弹窗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> isShow = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      isShow</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.son</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: yellow;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.dialog</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: azure;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.mask</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">5</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Suspense">Suspense</h5>
<ul>
<li>
<p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>
</li>
<li>
<p>使用步骤：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// App.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;app&quot;&gt;</span><br><span class="line">  App组件</span><br><span class="line">  &lt;Suspense&gt;</span><br><span class="line">    &lt;template v-slot:default&gt;</span><br><span class="line">      &lt;Father&gt;&lt;/Father&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;template v-slot:fallback&gt;</span><br><span class="line">      &lt;h3&gt;精彩内容正在加载中 ...&lt;/h3&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/Suspense&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 静态加载 同步</span><br><span class="line">// import Father from &#x27;./components/Father.vue&#x27;</span><br><span class="line">// 异步加载</span><br><span class="line">import &#123; defineAsyncComponent &#125; from &#x27;vue&#x27;</span><br><span class="line">const Father = defineAsyncComponent(()=&gt;import(&#x27;./components/Father.vue&#x27;))</span><br><span class="line">export default &#123;</span><br><span class="line">components: &#123;</span><br><span class="line">  Father,</span><br><span class="line">&#125;,</span><br><span class="line">setup() &#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.app &#123;</span><br><span class="line">padding: 40px;</span><br><span class="line">background-color: hotpink;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><strong>Father.vue</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">  Father组件</span><br><span class="line">  &#123;&#123; num &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">async</span> <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> num = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// return new Promise((resolve, rejects)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   setTimeout(function()&#123;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//     resolve(&#123;num&#125;)</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">//   &#125;, 3000)</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, rejects</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">resolve</span>(&#123; num &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">3000</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> res</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.father</span> &#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">padding</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="其它-2">其它</h4>
<h5 id="全局API的转移">全局API的转移</h5>
<p>Vue 2.x 有许多全局 API 和配置。</p>
<ul>
<li>例如：注册全局组件、注册全局指令等。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注册全局组件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;button @click=&quot;count++&quot;&gt;Clicked &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册全局指令</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">focus</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Vue3.0中对这些API做出了调整：</p>
<ul>
<li>将全局的API，即：<code>Vue.xxx</code>调整到应用实例（<code>app</code>）上</li>
</ul>
<table>
<thead>
<tr>
<th>2.x 全局 API（<code>Vue</code>）</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vue.config.xxxx</td>
<td>app.config.xxxx</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><strong style="color:#DD5145">移除</strong></td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
</tbody>
</table>
<h5 id="其它改变">其它改变</h5>
<ul>
<li>
<p>data选项应始终被声明为一个函数。</p>
</li>
<li>
<p>过度类名的更改：</p>
<p>Vue2.x写法</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.v-enter</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.v-leave</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Vue3.x写法</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.v-enter-from</span>,</span><br><span class="line"><span class="selector-class">.v-leave-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.v-leave-from</span>,</span><br><span class="line"><span class="selector-class">.v-enter-to</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong style="color:#DD5145">移除</strong>keyCode作为 v-on 的修饰符，同时也不再支持<code>config.keyCodes</code></p>
</li>
<li>
<p><strong style="color:#DD5145">移除</strong><code>v-on.native</code>修饰符</p>
<p>父组件中绑定事件</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;my-component</span><br><span class="line">  v-on:close=&quot;handleComponentEvent&quot;</span><br><span class="line">  v-on:click=&quot;handleNativeClickEvent&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>子组件中声明自定义事件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    emits: [&#x27;close&#x27;]</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong style="color:#DD5145">移除</strong>过滤器（filter）</p>
<blockquote>
<p>过滤器虽然这看起来很方便，但它需要一个自定义语法，打破大括号内表达式是 “只是 JavaScript” 的假设，这不仅有学习成本，而且有实现成本！建议用方法调用或计算属性去替换过滤器。</p>
</blockquote>
</li>
<li>
<p>…</p>
</li>
</ul>
<h5 id="h函数">h函数</h5>
<p>Vue推荐在绝大数情况下<strong>使用模板</strong>来创建你的HTML，然而一些特殊的场景，你真的需要<strong>Javascript的完全编程的能力</strong>，这个时候你可以使用<strong>渲染函数</strong> ，它<strong>比模板更接近编译器</strong>；</p>
<p>前面我们讲解过VNode和VDOM的改变：</p>
<p>Vue在生成真实的DOM之前，会将我们的节点转换成VNode，而VNode组合在一起形成一颗树结构，就是虚拟DOM（VDOM）；</p>
<p>事实上，我们之前编写的 template 中的HTML 最终也是使用<strong>渲染函数</strong>生成对应的VNode；</p>
<p>那么，如果你想充分的利用JavaScript的编程能力，我们可以自己来编写 createVNode 函数，生成对应的 VNode；</p>
<p>那么我们应该怎么来做呢？<strong>使用h()函数</strong></p>
<p>h() 函数是一个用于创建 vnode 的一个函数；</p>
<p>其实更准确的命名是 createVNode() 函数，但是为了简便在Vue将之简化为 h() 函数；</p>
<h6 id="如何使用？">如何使用？</h6>
<p><img data-src="image-20220817212549041.png" alt="image-20220817212549041"></p>
<p><strong>注意事项：</strong></p>
<p>如果没有props，那么通常可以将children作为第二个参数传入；</p>
<p>如果会产生歧义，可以将null作为第二个参数传入，将children作为第三个参数传入；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, &#123;<span class="attr">class</span>: <span class="string">&#x27;title&#x27;</span>&#125;, <span class="string">&quot;hello h函数&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h6 id="实现计数器">实现计数器</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// data()&#123;</span></span><br><span class="line">  <span class="comment">//   return &#123;</span></span><br><span class="line">  <span class="comment">//     count: 0</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// return &#123; count &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;counter&#x27;</span> &#125;, [</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, <span class="literal">null</span>, <span class="string">`当前计数为:<span class="subst">$&#123;count.value&#125;</span>`</span>),</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">onClick</span>: <span class="function">() =&gt;</span> count.<span class="property">value</span>++</span><br><span class="line">        &#125;, <span class="string">&#x27;++&#x27;</span>),</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">onClick</span>: <span class="function">() =&gt;</span> count.<span class="property">value</span>--</span><br><span class="line">        &#125;, <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// render()&#123;</span></span><br><span class="line">  <span class="comment">//   return h(&#x27;div&#x27;, &#123;class: &#x27;counter&#x27;&#125;, [</span></span><br><span class="line">  <span class="comment">//     h(&#x27;h4&#x27;, null, `当前计数为:$&#123;this.count&#125;`),</span></span><br><span class="line">  <span class="comment">//     h(&#x27;button&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//       onClick: () =&gt; this.count ++</span></span><br><span class="line">  <span class="comment">//     &#125;, &#x27;++&#x27;),</span></span><br><span class="line">  <span class="comment">//     h(&#x27;button&#x27;, &#123;</span></span><br><span class="line">  <span class="comment">//       onClick: () =&gt; this.count --</span></span><br><span class="line">  <span class="comment">//     &#125;, &#x27;--&#x27;)</span></span><br><span class="line">  <span class="comment">//   ])</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h6 id="渲染插槽">渲染插槽</h6>
<blockquote>
<p>先了解下插槽的用法，可参照<a href="https://blog.csdn.net/weixin_43931876/article/details/120058286">setup顶层编写方式内的博客网址</a></p>
</blockquote>
<p>App.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./05-Hi&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="title class_">Hi</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">default</span>: <span class="function"><span class="params">props</span> =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, <span class="literal">null</span>, <span class="string">`05-render函数渲染插槽<span class="subst">$&#123;props.title&#125;</span>`</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>Hi.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h4&#x27;</span>, &#123;<span class="attr">class</span>: <span class="string">&#x27;title&#x27;</span>&#125;, [</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&#x27;h2&#x27;</span>,<span class="literal">null</span>, <span class="string">&quot;hi ~~&quot;</span>),</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span> ? </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="title function_">default</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;--本手俗手妙手无从下手&quot;</span>&#125;) : <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;Hi组件默认插槽内容&#x27;</span>)</span><br><span class="line">      ])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="jsx">jsx</h5>
<p>如果我们希望<strong>在项目中使用jsx，那么我们需要添加对jsx的支持</strong>：</p>
<p>jsx我们通常会通过Babel来进行转换（React编写的jsx就是通过babel转换的）；</p>
<p>对于Vue来说，我们只需要在Babel中配置对应的插件即可；</p>
<p>安装<strong>Babel支持Vue的jsx插件</strong>：</p>
<p><code>npm install @vue/babel-plugin-jsx -D</code></p>
<p>在<strong>babel.config.js</strong>配置文件中配置插件（现在好像不需要配置了）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    <span class="string">&#x27;@vue/cli-plugin-babel/preset&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="string">&quot;@vue/babel-plugin-jsx&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="实现计数器-2">实现计数器</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;this.count&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h6 id="组件使用">组件使用</h6>
<p>Hi.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Hi组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.$slots.default ? this.$slots.default() : <span class="tag">&lt;<span class="name">span</span>&gt;</span>哇咔咔<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./06-Hi.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;this.count&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Hi</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123;default: props =&gt; <span class="tag">&lt;<span class="name">button</span>&gt;</span>我是按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Hi</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>setup写法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Hi</span> <span class="keyword">from</span> <span class="string">&#x27;./06-Hi.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">decrement</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>--</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getVal</span> = (<span class="params">num</span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(num)</span><br><span class="line">      <span class="comment">// vue3需要使用高阶函数来获取到e</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">e</span>)=&gt;</span> &#123;  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">checked</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">()=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">checked</span> <span class="attr">onChange</span>=<span class="string">&#123;</span> <span class="attr">getVal</span>(<span class="attr">1</span>) &#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h4</span>&gt;</span>当前计数: &#123;count.value&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;increment&#125;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;decrement&#125;</span>&gt;</span>--<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="自定义指令">自定义指令</h5>
<p>在Vue的模板语法中我们学习过各种各样的指令：v-show、v-for、v-model等等，除了使用这些指令之外，<strong>Vue也允许我们来自定义自己的指令</strong></p>
<p>注意：在Vue中，代码的复用和抽象主要还是通过组件；</p>
<p>通常在某些情况下，你需要对DOM元素进行底层操作，这个时候就会用到自定义指令；</p>
<p><strong>自定义指令分为两种：</strong></p>
<p>自定义局部指令：组件中通过 directives 选项，只能在当前组件中使用；</p>
<p>自定义全局指令：app的 directive 方法，可以在任意组件中被使用；</p>
<p><strong>比如我们来做一个非常简单的案例：当某个元素挂载完成后可以自定获取焦点</strong></p>
<p>实现方式一：如果我们使用默认的实现方式；</p>
<p>实现方式二：自定义一个 v-focus 的局部指令；</p>
<p>实现方式三：自定义一个 v-focus 的全局指令；</p>
<h6 id="聚焦实现">聚焦实现</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;iptRef&quot;</span> <span class="attr">v-focus</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, nextTick, onMounted, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives选项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   focus: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     // 指令的生命周期 不是 vue3的生命周期</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     mounted(el) &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//       el.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//     &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> iptRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// nextTick(()=&gt;&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   iptRef.value.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// onMounted(()=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   iptRef.value.focus()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      iptRef</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="局部自定义指令">局部自定义指令</h6>
<p>自定义一个 v-focus 的局部指令</p>
<p>这个自定义指令实现非常简单，我们只需要在组件选项中使用 directives 即可；</p>
<p>它是一个对象，在对象中编写我们自定义指令的名称（注意：这里不需要加v-）；</p>
<p>自定义指令有一个生命周期，是在组件挂载后调用的 mounted，我们可以在其中完成操作；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;iptRef&quot;</span> <span class="attr">v-focus</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// directives选项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">directives</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">focus</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 指令的生命周期 不是 vue3的生命周期</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        el.<span class="title function_">focus</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="全局自定义指令">全局自定义指令</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 全局自定义指令 =&gt; 放在mount之前</span></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&quot;focus&quot;</span>, &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    el.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="指令的生命周期">指令的生命周期</h6>
<p><strong>一个指令定义的对象，Vue提供了如下的几个钩子函数：</strong></p>
<p>created：在绑定元素的 attribute 或事件监听器被应用之前调用；</p>
<p>beforeMount：当指令第一次绑定到元素并且在挂载父组件之前调用；</p>
<p>mounted：在绑定元素的父组件被挂载后调用；</p>
<p>beforeUpdate：在更新包含组件的 VNode 之前调用；</p>
<p>updated：在包含组件的 VNode <strong>及其子组件的</strong> <strong>VNode</strong> 更新后调用；</p>
<p>beforeUnmount：在卸载绑定元素的父组件之前调用；</p>
<p>unmounted：当指令与元素解除绑定且父组件已卸载时，只调用一次；</p>
<h6 id="指令的参数和修饰符">指令的参数和修饰符</h6>
<p>如果我们指令需要<strong>接受一些参数或者修饰符</strong>应该如何操作呢？</p>
<p>info是参数的名称；</p>
<p>aaa-bbb是修饰符的名称；</p>
<p>后面是传入的具体的值；</p>
<p>在我们的生命周期中，我们可以<strong>通过</strong> <strong>bindings</strong> <strong>获取到对应的内容</strong>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-myDir.aaa.bbb</span>=<span class="string">&quot;&#123;name:&#x27;zs&#x27;&#125;&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;count &lt; 5&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, directives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">directives</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">myDir</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;created&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeMount&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(binding)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeUpdate&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;updated&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeUnmount&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;unmounted&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count.<span class="property">value</span> ++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      increment</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="自定义指令练习">自定义指令练习</h6>
<p><strong>自定义指令案例：时间戳的显示需求：</strong></p>
<p>在开发中，大多数情况下从服务器获取到的都是时间戳；我们需要将时间戳转换成具体格式化的时间来展示；</p>
<p>在Vue2中我们可以通过过滤器来完成；在Vue3中我们可以通过 计算属性（computed） 或者 自定义一个方法（methods） 来完成，其实我们还可以通过一个自定义的指令来完成；</p>
<p>我们来实现一个可以自动对<strong>时间格式化的指令v-format-time</strong>：</p>
<p>这里我封装了一个函数，在首页中我们只需要调用这个函数并且传入app即可；</p>
<p><strong>format-time.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 挂载全局自定义指令</span></span><br><span class="line">  app.<span class="title function_">directive</span>(<span class="string">&#x27;format-time&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">      <span class="comment">// 获取到用户指定的格式</span></span><br><span class="line">      <span class="keyword">let</span> formatStr = binding.<span class="property">value</span></span><br><span class="line">      <span class="comment">// 如果用户没有传格式</span></span><br><span class="line">      <span class="keyword">if</span>(!binding.<span class="property">value</span>)&#123;</span><br><span class="line">        <span class="comment">// 给个默认的格式</span></span><br><span class="line">        formatStr = <span class="string">&#x27;YYYY-MM-DD hh:mm:ss&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 拿到组件标签上的时间戳</span></span><br><span class="line">      <span class="keyword">let</span> timeStamp = el.<span class="property">textContent</span></span><br><span class="line">      <span class="keyword">if</span>(timeStamp.<span class="property">length</span> == <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="comment">// 秒 =&gt; 毫秒</span></span><br><span class="line">        timeStamp = timeStamp * <span class="number">1000</span></span><br><span class="line">      &#125;</span><br><span class="line">      el.<span class="property">textContent</span> = <span class="title function_">dayjs</span>(<span class="built_in">parseInt</span>(timeStamp)).<span class="title function_">format</span>(formatStr)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js 引入自定义指令 </span></span><br><span class="line"><span class="keyword">import</span> &#123; formatTime &#125; <span class="keyword">from</span> <span class="string">&#x27;./directives&#x27;</span></span><br><span class="line"><span class="title function_">formatTime</span>(app)</span><br></pre></td></tr></table></figure>
<p><strong>Time.vue</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-format-time</span>=<span class="string">&quot;&#x27;YYYY/MM/DD&#x27;&quot;</span> &gt;</span> 1654766827786 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count.<span class="property">value</span> ++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      count,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      increment</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="plugins">plugins</h4>
<p>通常我们向Vue全局添加一些功能时，会采用<strong>插件的模式，它有两种编写方式</strong>：</p>
<p>对象类型：一个对象，但是必须包含一个 install 的函数，该函数会在安装插件时执行；</p>
<p>函数类型：一个function，这个函数会在安装插件时自动执行；</p>
<p>插件可以<strong>完成的功能没有限制</strong>，比如下面的几种都是可以的：</p>
<p>添加全局方法或者 property，通过把它们添加到 config.globalProperties 上实现；</p>
<p>添加全局资源：指令/过滤器/过渡等；</p>
<p>通过全局 mixin 来添加一些组件选项；</p>
<p>一个库，提供自己的 API，同时提供上面提到的一个或多个功能；</p>
<p>App.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>哥们 你这睡眠质量不行呀 我一般都8小时后才发现<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// mounted()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//   console.log(this.$msg)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// console.log(this.$msg)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// setup中没有this指向 所以不能像vue2获取原型上的数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 需要按照下面的方式</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> instance = <span class="title function_">getCurrentInstance</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="property">appContext</span>.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js引入插件</span></span><br><span class="line"><span class="keyword">import</span> msgPluginObject <span class="keyword">from</span> <span class="string">&#x27;./plugins/msgPlugin-object&#x27;</span></span><br><span class="line"><span class="keyword">import</span> msgPluginFunction <span class="keyword">from</span> <span class="string">&#x27;./plugins/msgPlugin-function&#x27;</span></span><br><span class="line"><span class="comment">// 使用插件</span></span><br><span class="line"><span class="comment">// app.use(msgPluginObject)</span></span><br><span class="line"><span class="comment">// use相当于 msgPlugin.install(app)</span></span><br><span class="line">app.<span class="title function_">use</span>(msgPluginFunction)</span><br></pre></td></tr></table></figure>
<h5 id="函数写法">函数写法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">  app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span> = <span class="string">&quot;听说高考数学卷很难 刚刚试了下 两小时后才发现试卷拿反了&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="对象写法">对象写法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    <span class="comment">// 往app原型上添加属性</span></span><br><span class="line">    app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$msg</span> = <span class="string">&quot;听说高考数学卷很难 刚刚试了下 两小时后才发现试卷拿反了&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="路由-2">路由</h4>
<p>待更新 ~</p>
<h4 id="Vuex-2">Vuex</h4>
<p>待更新 ~</p>
<h4 id="Pinia">Pinia</h4>
<p>Vuex 作为一个老牌 Vue 状态管理库，大家都很熟悉了</p>
<p>Pinia 是 Vue.js 团队成员专门为 Vue 开发的一个全新的状态管理库，并且已经被纳入官方 <strong><a href="https://link.zhihu.com/?target=https%3A//github.com/vuejs/pinia">github</a></strong></p>
<p><strong>为什么有 Vuex 了还要再开发一个 Pinia ？</strong></p>
<p>先来一张图，看下当时对于<a href="https://link.zhihu.com/?target=https%3A//github.com/vuejs/rfcs/pull/271"> Vuex5 的提案</a>，就是下一代 Vuex5 应该是什么样子的</p>
<p><img data-src="image-20220820223415718.png" alt="image-20220820223415718"></p>
<p>Pinia 就是完整的符合了他当时 Vuex5 提案所提到的功能点，所以可以说 Pinia 就是 Vuex5 也不为过，因为它的作者就是官方的开发人员，并且已经被官方接管了，只是目前 Vuex 和 Pinia 还是两个独立的仓库，以后可能会合并，也可能独立发展，只是官方肯定推荐的是 Pinia</p>
<p>因为在 Vue3 中使用 Vuex 的话需要使用 Vuex4，并且还只能作为一个过渡的选择，存在很大缺陷，所以在 Componsition API 诞生之后，也就设计了全新的状态管理 Pinia</p>
<h5 id="Pinia-特性"><strong>Pinia 特性</strong></h5>
<ul>
<li>
<p>Pinia 没有 <code>Mutations</code></p>
</li>
<li>
<p><code>Actions</code> 支持同步和异步</p>
</li>
<li>
<p>没有模块的嵌套结构</p>
</li>
<li>
<ul>
<li>Pinia 通过设计提供扁平结构，就是说每个 store 都是互相独立的，谁也不属于谁，也就是扁平化了，更好的代码分割且没有命名空间。当然你也可以通过在一个模块中导入另一个模块来隐式嵌套 store，甚至可以拥有 store 的循环依赖关系</li>
</ul>
</li>
<li>
<p>更好的 <code>TypeScript</code> 支持</p>
</li>
<li>
<ul>
<li>不需要再创建自定义的复杂包装器来支持 TypeScript 所有内容都类型化，并且 API 的设计方式也尽可能的使用 TS 类型推断</li>
</ul>
</li>
<li>
<p>不需要注入、导入函数、调用它们，享受自动补全，让我们开发更加方便</p>
</li>
<li>
<p>无需手动添加 store，它的模块默认情况下创建就自动注册的</p>
</li>
<li>
<p>Vue2 和 Vue3 都支持</p>
</li>
<li>
<ul>
<li>除了初始化安装和SSR配置之外，两者使用上的API都是相同的</li>
</ul>
</li>
<li>
<p>支持 <code>Vue DevTools</code></p>
</li>
<li>
<ul>
<li>跟踪 actions, mutations 的时间线</li>
<li>在使用了模块的组件中就可以观察到模块本身</li>
<li>支持 time-travel 更容易调试</li>
<li>在 Vue2 中 Pinia 会使用 Vuex 的所有接口，所以它俩不能一起使用</li>
<li>但是针对 Vue3 的调试工具支持还不够完美，比如还没有 time-travel 功能</li>
</ul>
</li>
<li>
<p>模块热更新</p>
</li>
<li>
<ul>
<li>无需重新加载页面就可以修改模块</li>
<li>热更新的时候会保持任何现有状态</li>
</ul>
</li>
<li>
<p>支持使用插件扩展 Pinia 功能</p>
</li>
<li>
<p>支持服务端渲染</p>
</li>
</ul>
<h5 id="Pinia-和-Vuex">Pinia 和 Vuex</h5>
<p>上面的也算 ~</p>
<p><strong>核心区别</strong></p>
<p><strong>Vuex</strong>： <code>State</code>、<code>Gettes</code>、<code>Mutations</code>(同步)、<code>Actions</code>(异步)</p>
<p><strong>Pinia</strong>： <code>State</code>、<code>Gettes</code>、<code>Actions</code>(同步异步都支持)</p>
<p><strong>版本支持</strong></p>
<p>Vuex 当前最新版是 <code>4.x</code></p>
<ul>
<li>Vuex4 用于 Vue3</li>
<li>Vuex3 用于 Vue2</li>
</ul>
<p>Pinia 当前最新版是 <code>2.x</code></p>
<ul>
<li>即支持 Vue2 也支持 Vue3</li>
</ul>
<h5 id="使用场景">使用场景</h5>
<p>个人感觉：，由于Pinea是轻量级的，体积很小，它适合于中小型应用。它也适用于低复杂度的Vue.js项目，因为一些调试功能，如时间旅行和编辑仍然不被支持。<br>
将 Vuex 用于中小型 Vue.js 项目是过度的，因为它重量级的，对性能降低有很大影响。因此，Vuex 适用于大规模、高复杂度的 Vue.js 项目</p>
<h5 id="pinia使用">pinia使用</h5>
<h6 id="准备工作"><strong>准备工作</strong></h6>
<p>想要学习<code>pinia</code>，最好有<code>Vue3</code>的基础，明白组合式<code>API</code>是什么。如果你还不会<code>Vue3</code>，建议先去学习<code>Vue3</code>。</p>
<p>本篇全部基于<code>Vue3</code>来讲解pinia，至于<code>Vue2</code>中如何使用<code>pinia</code>，大家可以自行去<code>pinia</code>官网学习，毕竟<code>Vue2</code>中使用<code>pinia</code>的还是少数。</p>
<h6 id="项目搭建">项目搭建</h6>
<p>我们这里搭建一个最新的<code>Vue3 + TS + Vite</code>项目。</p>
<p>执行命令：<code>vue create vue-pinia</code>  选择babel、vue3、ts，创建完毕，清空项目，启动项目 ~</p>
<h6 id="安装pinia">安装pinia</h6>
<p>执行命令：<code>npm install pinia</code></p>
<h6 id="使用pinia">使用pinia</h6>
<p>安装完成后我们需要将<code>pinia</code>挂载到<code>Vue</code>应用中，也就是我们需要创建一个根存储传递给应用程序，简单来说就是创建一个存储数据的数据桶，放到应用程序中去。</p>
<p>修改<code>main.js</code>，引入<code>pinia</code>提供的<code>createPinia</code>方法，创建根存储。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>在 store 目录下创建一个 <code>user.ts</code> 为例，我们先定义并导出一个名为 <code>user</code> 的模块</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; </span><br><span class="line">            <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">arr</span>: []</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123; ... &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123; ... &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>defineStore</code> 接收两个参数</p>
<p>第一个参数就是模块的名称，必须是唯一的，多个模块不能重名，Pinia 会把所有的模块都挂载到根容器上<br>
第二个参数是一个对象，里面的选项和 Vuex 差不多</p>
<ul>
<li>其中 <code>state</code> 用来存储全局状态，它必须是箭头函数，为了在服务端渲染的时候避免交叉请求导致的数据状态污染所以只能是函数，而必须用箭头函数则为了更好的 TS 类型推导</li>
<li><code>getters</code> 就是用来封装计算属性，它有缓存的功能</li>
<li><code>actions</code> 就是用来封装业务逻辑，修改 state</li>
</ul>
<h6 id="访问-state">访问 state</h6>
<p>比如我们要在页面中访问 state 里的属性 count</p>
<p>由于 <code>defineStore</code> 会返回一个函数，所以要先调用拿到数据对象，然后就可以在模板中直接使用了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; user_store.count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 解构</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// const &#123; count &#125; = userStore()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>比如像注释中的解构出来使用，是完全没有问题的，只是注意了，这样拿到的数据不是<code>响应式</code>的，如果要解构还保持响应式就要用到一个方法 <code>storeToRefs()</code>，示例如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; count &#125; = <span class="title function_">storeToRefs</span>(userStore)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>原因就是 Pinia 其实是把 state 数据都做了 <code>reactive</code> 处理，和 Vue3 的 reactive 同理，解构出来的也不是响应式，所以需要再做 <code>ref</code> 响应式代理</p>
<h6 id="getters"><strong>getters</strong></h6>
<p>这个和 Vuex 的 getters 一样，也有缓存功能。如下在页面中多次使用，第一次会调用 getters，数据没有改变的情况下之后会读取缓存</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; myCount &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>注意两种方法的区别，写在注释里了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">getters</span>: &#123;</span><br><span class="line"><span class="comment">// 方法一，接收一个可选参数 state</span></span><br><span class="line"><span class="title function_">myCount</span>(<span class="params">state</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;调用了&#x27;</span>) <span class="comment">// 页面中使用了三次，这里只会执行一次，然后缓存起来了</span></span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 方法二，不传参数，使用 this</span></span><br><span class="line"><span class="comment">// 但是必须指定函数返回值的类型，否则类型推导不出来</span></span><br><span class="line"><span class="title function_">myCount</span>(): number&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">count</span> + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="actions"><strong>actions</strong></h6>
<p>更新 state 里的数据有四种方法，我们先看三种简单的更新，说明都写在注释里了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; user_store.count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法一</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.<span class="property">count</span>++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法二，需要修改多个数据，建议用 $patch 批量更新，传入一个对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.$patch(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">count</span>: user_store.<span class="property">count1</span>++,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// arr: user_store.arr.push(1) // 错误</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">arr</span>: [ ...user_store.<span class="property">arr</span>, <span class="number">1</span> ] <span class="comment">// 可以，但是还得把整个数组都拿出来解构，就没必要</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 使用 $patch 性能更优，因为多个数据更新只会更新一次视图</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 方法三，还是$patch，传入函数，第一个参数就是 state</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    user_store.$patch( <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">count</span>++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        state.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>第四种方法就是当逻辑比较多或者请求的时候，我们就可以封装到示例中 store/user.ts 里的 actions 里</p>
<p>可以传参数，也可以通过 this.xx 可以直接获取到 state 里的数据，需要注意的是不能用箭头函数定义 actions，不然就会绑定外部的 this 了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="title function_">changeState</span>(<span class="params">num: number</span>)&#123; <span class="comment">// 不能用箭头函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> += num</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  user_store.<span class="title function_">changeState</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="支持-VueDevtools"><strong>支持 VueDevtools</strong></h6>
<p>打开开发者工具的 <code>Vue Devtools</code> 就会发现 Pinia，而且可以手动修改数据调试，非常方便</p>
<h6 id="模拟调用接口"><strong>模拟调用接口</strong></h6>
<p>示例：</p>
<p>我们先定义示例接口 api/user.ts</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 接口数据类型</span></span><br><span class="line"><span class="keyword">export</span> interface userListType&#123;</span><br><span class="line">    <span class="attr">id</span>: number</span><br><span class="line">    <span class="attr">name</span>: string</span><br><span class="line">    <span class="attr">age</span>: number</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 模拟请求接口返回的数据</span></span><br><span class="line"><span class="keyword">const</span> userList = [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>, <span class="attr">age</span>: <span class="number">19</span> &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 封装模拟异步效果的定时器</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">wait</span>(<span class="params">delay: number</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, delay))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">wait</span>(<span class="number">100</span>) <span class="comment">// 延迟100毫秒返回</span></span><br><span class="line">    <span class="keyword">return</span> userList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 store/user.ts 里的 actions 封装调用接口</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getUserList, userListType &#125; <span class="keyword">from</span> <span class="string">&#x27;../api/user&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 用户列表</span></span><br><span class="line">    <span class="attr">list</span>: [] <span class="keyword">as</span> userListType <span class="comment">// 类型转换成 userListType</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">actions</span>: &#123; </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadUserList</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">getUserList</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span> = list</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>页面中调用 actions 发起请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in user_store.list&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../store&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">user_store.<span class="title function_">loadUserList</span>() <span class="comment">// 加载所有数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="跨模块修改数据"><strong>跨模块修改数据</strong></h6>
<p>在一个模块的 actions 里需要修改另一个模块的 state 数据</p>
<p>示例：比如在 chat 模块里修改 user 模块里某个用户的名称</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// chat.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; userStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./user&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> chatStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;chat&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">actions</span>: &#123; </span><br><span class="line">    <span class="title function_">someMethod</span>(<span class="params">userItem</span>)&#123;</span><br><span class="line">       userItem.<span class="property">name</span> = <span class="string">&#x27;新的名字&#x27;</span></span><br><span class="line">       <span class="keyword">const</span> user_store = <span class="title function_">userStore</span>()</span><br><span class="line">       user_store.<span class="title function_">updateUserName</span>(userItem)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>user 模块里</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">list</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">actions</span>: &#123; </span><br><span class="line">  <span class="title function_">updateUserName</span>(<span class="params">userItem</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === userItem.<span class="property">id</span>)</span><br><span class="line">    <span class="keyword">if</span>(user)&#123;</span><br><span class="line">      user.<span class="property">name</span> = userItem.<span class="property">name</span></span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>vue3</tag>
      </tags>
  </entry>
  <entry>
    <title>vue2 学习</title>
    <url>/blog/2023/08/09/vue2/</url>
    <content><![CDATA[<p>Vue 是一套用于构建用户界面的 渐进式框架 。</p>
<p>与其它大型框架不同的是，Vue 采用自底向上增量开发的设计。</p>
<p>Vue 的核心库只关注视图层，并且非常容易学习，非常容易与其它库或已有项目整合。另一方面，Vue 完全有能力驱动采用单文件组件和Vue生态系统支持的库开发的复杂单页应用。</p>
<p>Vue.js 的目标是通过尽可能简单的 API 实现响应的数据绑定和组合的视图组件。</p>
<p>最初它不过是个人项目，时至今日，已成为全世界三大前端框架之一，github 上拥有 19.8万 Star。 领先于 React 和 Angular，在国内更是首选。</p>
<span id="more"></span>
<p><img data-src="image-20220717092054413.png" alt=""></p>
<h4 id="vue-发展历程">vue 发展历程</h4>
<p><img data-src="image-20220717093650297.png" alt=""></p>
<p><strong>自从Vue 2.0 发布之后，Vue 就成了前端领域的热门话题。</strong></p>
<p>2019.02.05，Vue 发布了 2.6.0 ，这是一个承前启后的版本，在它之后，推出了 3.0.0。</p>
<p>2019.12.05，在万众期待中，尤雨溪公布了 Vue 3 源代码，此时的 Vue 3仍 处于 Alpha 版本。</p>
<p>2020年09月18日，Vue.js 3.0 正式发布。</p>
<h4 id="vue-官网">vue 官网</h4>
<p><a href="https://vuejs.org/">英文官网</a></p>
<p><a href="https://cn.vuejs.org/">中文官网</a></p>
<h4 id="vue-介绍">vue 介绍</h4>
<p>vue是一套用来动态<strong>构建用户界面</strong>的<strong>渐进式</strong> JavaScript 框架</p>
<ul>
<li>构建用户界面：把数据通过某种方式变成用户所看到的界面</li>
<li>渐进式：vue可以自底向上逐层的应用，简单应用只需要一个轻量小巧的核心库，复杂应用可以引入各式各样的vue插件，详细见：<a href="https://blog.csdn.net/m0_45070460/article/details/107539586">https://blog.csdn.net/m0_45070460/article/details/107539586</a></li>
</ul>
<h4 id="vue-特点">vue 特点</h4>
<ul>
<li>
<p>遵循 MVVM 模式，什么是MVVM？</p>
</li>
<li>
<p>MVVM 本质上是 MVC （Model-View- Controller）的改进版。即模型-视图-视图模型。</p>
<p><code>模型</code>model指的是后端传递的数据，<code>视图</code>view指的是所看到的页面。</p>
<p><code>视图模型</code>viewModel是 mvvm 模式的核心，它是连接 view 和 model 的桥梁。它有两个方向：</p>
<p>将<code>模型</code>转化成<code>视图</code>，即将后端传递的数据转化成所看到的页面。实现的方式是：<strong>数据绑定</strong> 将<code>视图</code>转化成<code>模型</code>，即将所看到的页面转化成后端的数据。实现的方式是：<strong>DOM 事件监听</strong></p>
<p>这两个方向都实现的，我们称之为<strong>数据的双向绑定</strong></p>
</li>
<li>
<p><img data-src="image-20220717222557950.png" alt=""></p>
</li>
<li>
<p>编码简洁，体积小，运行效率高，适合 移动/PC 端开发</p>
</li>
<li>
<p>它本身只关注 UI，可以轻松引入 vue 插件或其它第三方库开发项目</p>
</li>
<li>
<p>采用组件化模式，提高代码复用率、且让代码更好维护</p>
<p><img data-src="image-20220717190728013.png" alt=""></p>
</li>
<li>
<p>声明式编码，让编码人员无需直接操作DOM，提高开发效率</p>
<p>原生开发和Vue开发的模式和特点，我们会发现是完全不同的</p>
<p>这里其实涉及到<strong>两种不同的编程范式：命令式编程和声明式编程</strong>；</p>
<p>命令式编程关注的是 “how to do”，声明式编程关注的是 “what to do”，由框架(机器)完成 “how”的过程；</p>
<p><strong>在原生的实现过程中，我们是如何操作的呢？</strong></p>
<p>我们每完成一个操作，都需要通过JavaScript编写一条代码，来给浏览器一个指令；</p>
<p>这样的编写代码的过程，我们称之为命令式编程；</p>
<p>在早期的原生JavaScript和jQuery开发的过程中，我们都是通过这种命令式的方式在编写代码的；</p>
<p><strong>在Vue的实现过程中，我们是如何操作的呢？</strong></p>
<p>我们会在createApp传入的对象中声明需要的内容，模板template、数据data、方法methods；</p>
<p>这样的编写代码的过程，我们称之为是声明式编程；</p>
<p>目前Vue、React、Angular的编程模式，我们称之为声明式编程；</p>
<p><img data-src="image-20220717141517491.png" alt=""></p>
</li>
<li>
<p>使用虚拟DOM和Diff算法，尽量复用DOM节点</p>
<p><img data-src="image-20220717141542239.png" alt=""></p>
</li>
</ul>
<h5 id="与其他前端-JS-框架的关联">与其他前端 JS 框架的关联</h5>
<p>借鉴 angular 的 <strong>模板</strong> 和 <strong>数据绑定</strong> 技术<br>
借鉴 react 的 <strong>组件化</strong> 和 <strong>虚拟DOM</strong> 技术</p>
<h5 id="Vue-周边生态">Vue 周边生态</h5>
<p>vue-cli：vue 脚手架<br>
vue-resource(axios)：ajax 请求<br>
vue-router：路由<br>
vuex：状态管理（它是 vue 的插件但是没有用 vue-xxx 的命名规则）<br>
vue-lazyload：图片懒加载<br>
vue-scroller：页面滑动相关<br>
mint-ui：基于 vue 的 UI 组件库（移动端）<br>
element-ui：基于 vue 的 UI 组件库（PC 端）</p>
<h5 id="框架和库的区别">框架和库的区别</h5>
<ul>
<li>框架：是一套完整的解决方案；对项目的侵入性较大，项目如果需要更换框架，则需要重新架构整个项目。</li>
</ul>
<ul>
<li>node 中的 express；</li>
</ul>
<ul>
<li>库（插件）：提供某一个小功能，对项目的侵入性较小，如果某个库无法完成某些需求，可以很容易切换到其它库实现需求。</li>
</ul>
<ul>
<li>从Jquery 切换到 Zepto</li>
<li>从 EJS 切换到 art-template</li>
</ul>
<h4 id="初识vue">初识vue</h4>
<h5 id="前置工作">前置工作</h5>
<ol>
<li>
<p>给浏览器安装Vue Devtools插件</p>
</li>
<li>
<p>标签引入Vue包</p>
</li>
<li>
<p>(可选) 阻止vue在启动时生成生产提示 Vue.config.productionTip = false</p>
</li>
<li>
<p>favicon报错 需要将页签图标放在项目根路径，重新打开就有了(shfit+F5强制刷新)</p>
</li>
</ol>
<h5 id="vue初体验">vue初体验</h5>
<ol>
<li>
<p>想让vue工作，就必须创建一个Vue实例，且要传入一个配置对象</p>
</li>
<li>
<p>root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法</p>
</li>
<li>
<p>root容器里的代码被称为Vue模板</p>
</li>
<li>
<p>Vue 实例与容器是一一对应的</p>
</li>
<li>
<p>真实开发中只有一个 Vue实例，并且会配合着组件一起使用</p>
</li>
<li>
中的 xxx 要写 js 表达式，且 xxx 可以自动读取到data中的所有属性
<p>区分：js表达式 和 js语句<br>
<strong>js表达式</strong>：一个表达式会产生一个值，可以放在任何一个需要值的地方<br>
1、a<br>
2、a+b<br>
3、fn(1)<br>
4、x=== y ? ‘1’ : ‘2’<br>
<strong>js语句</strong><br>
1、if(){}<br>
2、for(){}</p>
</li>
<li>
<p>一旦data中的数据发生变化，那么模板中用到该数据的地方也会自动更新</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">   &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">   &lt;head&gt;</span><br><span class="line">       &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">       &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">       &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">       &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">       &lt;!-- 本地资源引入 当我们将vue.js引入后 页面上就多了一个Vue构造函数--&gt;</span><br><span class="line">       &lt;script src=&quot;../vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">       &lt;!-- CDN方式引入 --&gt;</span><br><span class="line">       &lt;!-- &lt;script src=&quot;url&quot;&gt;&lt;/script&gt; --&gt;</span><br><span class="line">   &lt;/head&gt;</span><br><span class="line">   &lt;body&gt;</span><br><span class="line">       &lt;!-- 将来创建的vue实例对象所控制的区域 v:视图--&gt;</span><br><span class="line">       &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">           &lt;!-- &#123;&#123;&#125;&#125;: 插值表达式 --&gt;</span><br><span class="line">           &#123;&#123; msg &#125;&#125;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">   </span><br><span class="line">       &lt;script&gt;</span><br><span class="line">           //阻止 vue在启动时生成生产提示。</span><br><span class="line">           Vue.config.productionTip = false</span><br><span class="line">           </span><br><span class="line">           // 创建vue实例 =&gt; vm</span><br><span class="line">           let vm = new Vue(&#123;</span><br><span class="line">               // 写法一: new Vue的时候指定el属性</span><br><span class="line">               // el用于指定当前Vue实例为哪个容器服务，值通常为css选择器字符串</span><br><span class="line">               el: &#x27;#app&#x27;, </span><br><span class="line">               // data中用于存储数据，数据供el所指定的容器去使用，值暂时先写成一个对象, 相当于model层</span><br><span class="line">               data: &#123;</span><br><span class="line">                   msg: &#x27;hello vue !&#x27;</span><br><span class="line">               &#125;,</span><br><span class="line">               // 方法</span><br><span class="line">               methods: &#123;&#125;,</span><br><span class="line">           &#125;)</span><br><span class="line">          // 写法二: 先创建Vue实例，随后再通过vm.$mount(&#x27;#root&#x27;)指定el的值</span><br><span class="line">           vm.$mount(&#x27;#app&#x27;)</span><br><span class="line">       &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="计数器实现">计数器实现</h5>
<ol>
<li>原生写法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 获取DOM原生</span></span><br><span class="line"><span class="keyword">const</span> titleEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.title&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> btnInEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.increment&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> btnDeEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.decrement&#x27;</span>);</span><br><span class="line"><span class="comment">// 2. 默认设置的是Hello World</span></span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line"><span class="comment">// 3. 设置titleEl的内容</span></span><br><span class="line">titleEl.<span class="property">innerHTML</span> = counter;</span><br><span class="line"><span class="comment">// 4. 监听按钮的点击</span></span><br><span class="line">btnInEl.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,(=&gt;&#123;</span><br><span class="line">    counter += <span class="number">1</span>;</span><br><span class="line">    titleEl.<span class="property">innerHTML</span> =counter;</span><br><span class="line">&#125;)</span><br><span class="line">btnDeEl.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,(=&gt;&#123;</span><br><span class="line">    counter -=<span class="number">1</span>;</span><br><span class="line">    titleEl.<span class="property">innerHTML</span> = counter;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>vue实现</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">   &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;head&gt;</span><br><span class="line">   &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">   &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">   &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">   &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">     &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">   &lt;/head&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;body&gt;</span><br><span class="line">     &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">       &lt;!-- vue指令: v-on:事件类型 --&gt;</span><br><span class="line">       &lt;button v-on:click=&quot;increment&quot;&gt;+&lt;/button&gt;</span><br><span class="line">       &lt;!-- 简写 比如: @click @keyup @keydown --&gt;</span><br><span class="line">       &lt;button @click=&quot;increment&quot;&gt;+&lt;/button&gt;</span><br><span class="line">       &#123;&#123; count &#125;&#125;</span><br><span class="line">       &lt;button v-on:click=&quot;decrement&quot;&gt;-&lt;/button&gt;</span><br><span class="line">       &lt;button @click=&quot;decrement&quot;&gt;-&lt;/button&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">     &lt;script&gt;</span><br><span class="line">       // 关闭生产提示</span><br><span class="line">       Vue.config.productionTip = false</span><br><span class="line">   </span><br><span class="line">       var vm = new Vue(&#123;</span><br><span class="line">         el: &#x27;#app&#x27;,</span><br><span class="line">         // 数据</span><br><span class="line">         data: &#123;</span><br><span class="line">           count: 0</span><br><span class="line">         &#125;,</span><br><span class="line">         // 方法</span><br><span class="line">         methods: &#123;</span><br><span class="line">           increment()&#123;</span><br><span class="line">             // this =&gt; vue实例</span><br><span class="line">             this.count++</span><br><span class="line">           &#125;,</span><br><span class="line">           decrement()&#123;</span><br><span class="line">             this.count--</span><br><span class="line">           &#125;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">     &lt;/script&gt;</span><br><span class="line">   &lt;/body&gt;</span><br><span class="line">   </span><br><span class="line">   &lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="模板的理解">模板的理解</h5>
<p>模板就是<strong>动态html页面</strong>，这里面包含了一些<strong>js语法代码</strong></p>
<p>Vue的模板语法分为两种，分别是：</p>
<ul>
<li>【插值语法】双大括号表达式 （“Mustache”语法）【一个】</li>
<li>【指令语法】指令（以v-开头的自定义标签属性）【很多】</li>
</ul>
<ol>
<li>插值语法：</li>
</ol>
<ul>
<li>功能：用于解析标签体内容，向页面输出数据</li>
<li>写法：<code>&#123;&#123;xxx&#125;&#125;</code>，xxx是js表达式，且可以直接读取到data中的所有属性，可以调用对象的方法</li>
<li>备注：里面写<strong>js表达式</strong>：有返回值的js代码，而不是<strong>js语句</strong></li>
</ul>
<ol>
<li>指令语法：</li>
</ol>
<ul>
<li>功能：用于解析标签（包括：标签属性、标签体内容、绑定事件…）</li>
<li>举例：<code>v-bind:href=&quot;xxx&quot;</code> 或  简写为 <code>:href=&quot;xxx&quot;</code>，xxx同样要写js表达式，且可以直接读取到data中的所有属性</li>
<li>备注：Vue中有很多的指令，且形式都是：<code>v-????</code></li>
</ul>
<p>下面我们来介绍几个常用的指令语法</p>
<h5 id="指令语法：">指令语法：</h5>
<h5 id="属性绑定-v-bind">属性绑定 <code>v-bind:</code></h5>
<p>功能：动态地绑定一个或多个 attribute，或一个组件 prop 到表达式</p>
<ol>
<li>语法：<code>v-bind:href =&quot;xxx&quot;</code> 或简写为 <code>:href =&quot;xxx&quot;</code></li>
<li>特点：<strong>单向数据绑定</strong> 数据只能从 data 流向页面</li>
</ol>
<h6 id="属性绑定应用">属性绑定应用</h6>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 数组 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;red&#x27;, &#x27;thin&#x27;]&quot;</span>&gt;</span>&#123;&#123;msg ? &#x27;尘埃等闲&#x27;:&#x27;大千世界&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;!-- 数组嵌套三元表达式 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;red&#x27;, &#x27;thin&#x27;, isactive?&#x27;active&#x27;: &#x27;&#x27;]&quot;</span>&gt;</span>&#123;&#123;msg ? &#x27;尘埃等闲&#x27;:&#x27;大千世界&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;!-- 数组嵌套对象 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;red&#x27;, &#x27;thin&#x27;, &#123;active: isactive&#125;]&quot;</span>&gt;</span>&#123;&#123;msg ? &#x27;尘埃等闲&#x27;:&#x27;大千世界&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;!-- 直接使用对象 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;red:true&#125;&quot;</span>&gt;</span>&#123;&#123;msg ? &#x27;尘埃等闲&#x27;:&#x27;大千世界&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">:class</span>=<span class="string">&quot;styles&quot;</span>&gt;</span>&#123;&#123;msg ? &#x27;尘埃等闲&#x27;:&#x27;大千世界&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;click&#x27;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">msg</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">info</span>: <span class="string">&#x27;明天就中秋了，你们的中秋节目准备的咋样了？&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">isactive</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">index</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">styles</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">red</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">thin</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">active</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">click</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h5 id="双向数据绑定-指令-v-model">双向数据绑定 指令 <code>v-model</code></h5>
<ol>
<li>语法：<code>v-model:value=&quot;xxx&quot;</code> 或简写为 <code>v-model=&quot;xxx&quot;</code></li>
<li>特点：数据不仅能从 data 流向页面，还能从页面流向 data</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">@v-on :v-bind的 语法糖</span><br><span class="line">	之所以叫「语法」糖，不只是因为加糖后的代码功能与加糖前保持一致，更重要的是，糖在不改变其所在位置的语法结构的前提下，实现了运行时等价。可以简单理解为，加糖后的代码编译后跟加糖前一毛一样。以下是实现</span><br><span class="line">&lt;input type=<span class="string">&quot;text&quot;</span> :value=<span class="string">&#x27;msg&#x27;</span> @input=<span class="string">&#x27;(e)=&gt; msg = e.target.value&#x27;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;msg&#x27;</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="v-model应用">v-model应用</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">v-model:用来辅助开发者在不操作 DOM 的前提下，快速获取表单的数据</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>选择的省份是: &#123;&#123;province&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&#x27;province&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>--请选择--<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;4&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>&gt;</span>杭州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>您选中的是:&#123;&#123;sex&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;sex&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;man&quot;</span>&gt;</span>man</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;sex&#x27;</span> <span class="attr">value</span>=<span class="string">&quot;woman&quot;</span>&gt;</span>woman</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>您的爱好是: &#123;&#123;loves&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;game&quot;</span> <span class="attr">v-model</span>=<span class="string">loves</span> <span class="attr">value</span>=<span class="string">&quot;玩游戏&quot;</span>&gt;</span>玩游戏</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;music&quot;</span> <span class="attr">v-model</span>=<span class="string">loves</span> <span class="attr">value</span>=<span class="string">&quot;听音乐&quot;</span>&gt;</span>听音乐</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;basketball&quot;</span> <span class="attr">v-model</span>=<span class="string">loves</span> <span class="attr">value</span>=<span class="string">&quot;打篮球&quot;</span>&gt;</span>打篮球</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;eat&quot;</span> <span class="attr">v-model</span>=<span class="string">loves</span> <span class="attr">value</span>=<span class="string">&quot;吃东西&quot;</span>&gt;</span>吃东西</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;treenp&quot;</span> <span class="attr">v-model</span>=<span class="string">loves</span> <span class="attr">value</span>=<span class="string">&quot;吹牛皮&quot;</span>&gt;</span>吹牛皮</span><br><span class="line"></span><br><span class="line">.number: 将输入值转化为数字类型</span><br><span class="line">想要严格限制输入框只允许输入数字，请使用属性type=&quot;number&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&#x27;first&#x27;</span> @<span class="attr">keyup</span>=<span class="string">&#x27;sum&#x27;</span>&gt;</span>+</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&#x27;last&#x27;</span> @<span class="attr">keyup</span>=<span class="string">&#x27;sum&#x27;</span>&gt;</span> =</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;result&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.lazy: 当添加了.lazy修饰符后，双向绑定的数据就不同步了，相当于在input输入框失去焦点后触发的change事件中同步</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;msg&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;show&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  data () &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>: 老许</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    show () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">msg</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.trim 自动去除输入框前后(首尾)空格</span><br><span class="line">如下: 如果直接在开头输入空格，或者是在末尾输入空格，是不会显示有输入内容的</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;msg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="指令语法：绑定事件监听-v-on">指令语法：绑定事件监听 <code>v-on</code></h5>
<blockquote>
<p>功能：绑定指定事件名的回调函数</p>
</blockquote>
<p>完整写法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">v-<span class="attr">on</span>:click=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">v-<span class="attr">on</span>:keyup=<span class="string">&#x27;xxx(参数)&#x27;</span></span><br><span class="line">v-<span class="attr">on</span>:keyup.<span class="property">enter</span>=<span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>简洁写法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">@click=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">@keyup=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">@keyup.<span class="property">enter</span>=<span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure>
<h5 id="事件修饰符">事件修饰符</h5>
<ul>
<li>prevent：阻止默认事件（常用）；</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">v-on:submit.prevent</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>stop：阻止事件冒泡（常用）；</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;demo1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.stop</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 修饰符可以连续写 先写的先起作用: 这样写就是先阻止默认行为后阻止冒泡--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;a href=&quot;https://www.baidu.com&quot; @click.prevent.stop=&quot;showInfo&quot;&gt;点我&lt;/a&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>once：事件只触发一次（常用）；</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件只触发一次（常用） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.once</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>capture：使用事件的捕获模式；</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span> @<span class="attr">click.capture</span>=<span class="string">&quot;showMsg(1)&quot;</span>&gt;</span></span><br><span class="line">	div1</span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;showMsg(2)&quot;</span>&gt;</span></span><br><span class="line">		div2</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>self：只有event.target是当前操作的元素时才触发事件；</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;demo1&quot;</span> @<span class="attr">click.self</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showInfo&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>native:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">关于 .native 官网解释：</span><br><span class="line">你可能想在某个组件的根元素上监听一个原生事件。可以使用 v-on 的修饰符 .native </span><br><span class="line"></span><br><span class="line">大白话：如果你想在某个组件的根元素上绑定事件，直接使用 @click=&#x27;&#x27;function&#x27; 是不生效的，我们可以添加.native修饰符 @click.native=&#x27;&#x27;function&#x27;&#x27;，也可以理解为该修饰符的作用就是把一个vue组件转化为一个普通的HTML标签，并且该修饰符对普通HTML标签是没有任何作用的。</span><br></pre></td></tr></table></figure>
<h5 id="按键修饰符">按键修饰符</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- &lt;input type=&quot;text&quot; @keyup.enter=&#x27;show&#x27;&gt; --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.esc</span>=<span class="string">&#x27;clear&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- 以下写法在vue3中已经被废弃 --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- &lt;input type=&quot;text&quot; @keyup.13=&#x27;show&#x27;&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 自定义按键修饰符 相当于把a的keyCode值改成了88而非本来的65</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Vue.config.keyCodes.a = 88</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 常用的别名有:</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">enter</span> =&gt; <span class="comment">//enter键</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">tab</span> =&gt; <span class="comment">//tab键</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">delete</span> =&gt; <span class="comment">//删除键</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">esc</span> =&gt; <span class="comment">//取消键</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">space</span> =&gt; <span class="comment">//空格键</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">up</span> =&gt; <span class="comment">//上</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">down</span> =&gt; <span class="comment">//下</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">left</span> =&gt; <span class="comment">//左</span></span></span><br><span class="line"><span class="language-javascript">.<span class="property">right</span> =&gt; <span class="comment">//右</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="指令语法：内容渲染指令-v-text与v-html">指令语法：内容渲染指令 <code>v-text与v-html</code></h5>
<p><strong>v-text</strong></p>
<ol>
<li>作用：向其所在的节点中渲染文本内容。</li>
<li>与插值语法的区别：<code>v-text</code>会替换掉节点中的内容，<code>&#123;&#123;xx&#125;&#125;</code>则不会。</li>
</ol>
<p><strong>v-html</strong></p>
<ol>
<li>作用：向指定节点中渲染包含html结构的内容。</li>
<li>与插值语法的区别：</li>
</ol>
<ul>
<li>(1).<code>v-html</code>会替换掉节点中所有的内容，<code>&#123;&#123;xx&#125;&#125;</code>则不会。</li>
<li>(2).<code>v-html</code>可以识别html结构。</li>
</ul>
<ol>
<li>严重注意：<code>v-html</code>有安全性问题！！！！</li>
</ol>
<ul>
<li>(1). 在网站上动态渲染任意HTML是非常危险的，容易导致XSS攻击。</li>
<li>(2). 一定要在可信的内容上使用<code>v-html</code>，永不要用在用户提交的内容上！</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&#x27;app&#x27;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;h2&gt;1. 大括号表达式&lt;/h2&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;/p&gt;    &lt;!--textContent --&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123;msg.toUpperCase()&#125;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p v-html=&quot;msg&quot;&gt;&lt;/p&gt; &lt;!--innerHTML --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p v-text=&quot;msg&quot;&gt;&lt;/p&gt; &lt;!--textContent --&gt;</span><br><span class="line">        &lt;p v-text=&quot;msg.toUpperCase()&quot;&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;h2&gt;2. 指令一： 强制数据绑定&lt;/h2&gt;</span><br><span class="line">        &lt;img src=&quot;imgUrl&quot; alt=&quot;Vue&quot;&gt;  &lt;!--无法显示图片，没有识别成js表达式 --&gt;</span><br><span class="line">        &lt;img v-bind:src=&quot;imgUrl&quot; alt=&quot;Vue&quot;&gt; &lt;!--属性值识别成js表达式 --&gt;</span><br><span class="line">        &lt;img :src=&quot;imgUrl&quot; alt=&quot;Vue&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;h2&gt;3. 指令二： 绑定事件监听&lt;/h2&gt;</span><br><span class="line">        &lt;button v-on:click=&quot;test1&quot;&gt;test1&lt;/button&gt;</span><br><span class="line">        &lt;button @click=&quot;test1&quot;&gt;test1&lt;/button&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;button @click=&quot;test2(&#x27;abc&#x27;)&quot;&gt;test2&lt;/button&gt; &lt;!--可以传参数 --&gt;</span><br><span class="line">        &lt;button @click=&quot;test2(msg)&quot;&gt;test2&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script src=&quot;../js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        new Vue(&#123;</span><br><span class="line">            el: &#x27;#app&#x27;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                msg: &#x27;&lt;a href=&quot;http:www.baidu.com&quot;&gt;I Will Back!&lt;/a&gt;&#x27;,</span><br><span class="line">                imgUrl: &quot;https://cn.vuejs.org/images/logo.png&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                test1() &#123;</span><br><span class="line">                    alert(&#x27;heheh&#x27;);</span><br><span class="line">                &#125;,</span><br><span class="line">                test2(content)&#123;</span><br><span class="line">                    alert(content);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="指令语法：条件渲染指令-v-if与v-show">指令语法：条件渲染指令 <code>v-if与v-show</code></h5>
<p><code>v-if</code>是控制元素是否加载到页面上（有性能开销）</p>
<p>适用于：切换频率较低的场景。</p>
<p>特点：不展示的DOM元素直接被移除。当条件不成立时, v-if 的所有子节点不会解析</p>
<p>注意：v-if可以和:v-else-if、v-else一起使用，但要求结构不能被 ‘打断’。</p>
<p><code>v-show</code>是控制元素的显示与隐藏 （初始创建时加载一次）</p>
<ul>
<li>切换频率较高的场景。</li>
<li>不展示的DOM元素未被移除，仅仅是使用样式隐藏掉</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&#x27;flag&#x27;</span>&gt;</span>海底月是天上月<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>眼前人是心上人<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;type === &#x27;A&#x27;&quot;</span>&gt;</span>优秀<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type === &#x27;B&#x27;&quot;</span>&gt;</span>良好<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type === &#x27;C&#x27;&quot;</span>&gt;</span>一般<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>=<span class="string">&quot;type === &#x27;D&#x27;&quot;</span>&gt;</span>差<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&#x27;flag&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="练习-4">练习</h6>
<p>1、实现一个简易的计算器</p>
<p><img data-src="image-20220719063621256.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n1&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;opt&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;+&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;-&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;*&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;/&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n2&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;=&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;calc&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">n1</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  	<span class="attr">n2</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  	<span class="attr">opt</span>: <span class="string">&#x27;+&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  	<span class="attr">result</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">calc</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// switch(this.opt)&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   case &#x27;+&#x27;: </span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   this.result = this.n1 + this.n2</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   break;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   case &#x27;-&#x27;: </span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   this.result = this.n1 - this.n2</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   break;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   case &#x27;*&#x27;: </span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   this.result = this.n1 * this.n2</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   break;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   case &#x27;/&#x27;: </span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   this.result = this.n1 / this.n2</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   break;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// eval: 将内容当作js来解析执行 存在安全隐患 </span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">result</span> = <span class="built_in">eval</span>(<span class="variable language_">this</span>.<span class="property">n1</span> + <span class="variable language_">this</span>.<span class="property">opt</span> + <span class="variable language_">this</span>.<span class="property">n2</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、跑马灯效果</p>
<p><img data-src="image-20220719064017901.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;浪起来&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;lang&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;低调&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;stop&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msg</span>: <span class="string">&#x27;别浪，稳住发育，后期再团 ~~~！&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  	<span class="attr">timeId</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">lang</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> that = <span class="variable language_">this</span> <span class="comment">// =&gt; 也可以改成箭头函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 如果定时器不为空 证明该定时器是第一次开启</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 定时器第一次开启无法进入判断 所以代码不会return 继续往下执行</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 当用户再次点击按钮触发lang事件 此时定时器已经不为空</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 所以可以进入判断 return执行 导致后续代码无法执行</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">timeId</span> != <span class="literal">null</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 开启定时器</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 别</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> start = that.<span class="property">msg</span>.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 浪，稳住发育，后期再团 ~~~！</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> end = that.<span class="property">msg</span>.<span class="title function_">substring</span>(<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 浪，稳住发育，后期再团 ~~~！别</span></span></span><br><span class="line"><span class="language-javascript">  that.<span class="property">msg</span> = end + start</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="number">500</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 清理定时器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timeId</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">timeId</span> = <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="v-cloak">v-cloak</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-attr">[v-cloak]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配合css样式用来解决页面闪烁问题 =&gt; &#123;&#123;xxx&#125;&#125;</span></span><br><span class="line"><span class="comment">        当数据渲染到插值表达式中 vue会删除掉v-cloak属性</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-cloak</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">msg</span>: <span class="string">&#x27;萨瓦迪卡&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="v-once">v-once</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-once这个指令不需要任何表达式，它的作用就是定义它的元素或组件只会渲染一次，包括元素或者组件的所有子节点。首次渲染后，不再随着数据的改变而重新渲染。也就是说使用v-once，那么该块都将被视为静态内容</span></span><br><span class="line"><span class="comment">可用于优化性能 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-once</span>&gt;</span>仅用于展示的数据:&#123;&#123;number&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>用于修改的数据:&#123;&#123;number&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;number += 1&#x27;</span>&gt;</span>加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">number</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="v-pre">v-pre</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 浏览器解析引擎遇到vue的插值符号时会自动解析，当你想输出不被解析的纯文本时，可以使用v-pre指令。 跳过编译检查环节(没有使用指令语法和差值语法的节点) 当作静态内容输出，从而加快编译</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-pre</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>门前大桥下<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        门前大桥下游过一群鸭</span><br><span class="line">        快来快来数一数 二四六七八<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">msg</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="列表渲染指令-v-for">列表渲染指令 <code>v-for</code></h5>
<p>v-for指令:</p>
<p>1、用于展示列表数据</p>
<p>2、语法：v-for=“(item, index) in xxx” :key=“yyy”</p>
<p>3、可遍历：数组、对象、字符串（用的很少）、指定次数（用的很少）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 遍历数组 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>key是唯一的标识 其数据类型只能是字符串或者数字<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- item代表数组中的每一项 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 如果需要取下标 (item, index) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) of persons&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">	&#123;&#123;item.name&#125;&#125;-&#123;&#123;item.age&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key) of car&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line">	&#123;&#123;key&#125;&#125;-&#123;&#123;value&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(char,index) of str&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;char&#125;&#125;-&#123;&#123;index&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 遍历指定次数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(number,index) of 5&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;index&#125;&#125;-&#123;&#123;number&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="key属性注意事项">key属性注意事项</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">面试题：react、vue中的key有什么作用？（key的内部原理）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1. 虚拟DOM中key的作用：</span></span><br><span class="line"><span class="comment">key是虚拟DOM对象的标识，当数据发生变化时，Vue会根据【新数据】生成【新的虚拟DOM】, </span></span><br><span class="line"><span class="comment">随后Vue进行【新虚拟DOM】与【旧虚拟DOM】的差异比较，比较规则如下：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">2.对比规则：</span></span><br><span class="line"><span class="comment">(1).旧虚拟DOM中找到了与新虚拟DOM相同的key：</span></span><br><span class="line"><span class="comment">		①.若虚拟DOM中内容没变, 直接使用之前的真实DOM！</span></span><br><span class="line"><span class="comment">		②.若虚拟DOM中内容变了, 则生成新的真实DOM，随后替换掉页面中之前的真实DOM。</span></span><br><span class="line"><span class="comment">(2).旧虚拟DOM中未找到与新虚拟DOM相同的key</span></span><br><span class="line"><span class="comment">		创建新的真实DOM，随后渲染到到页面。</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">3. 用index作为key可能会引发的问题：</span></span><br><span class="line"><span class="comment">	1. 若对数据进行：逆序添加、逆序删除等破坏顺序操作:</span></span><br><span class="line"><span class="comment">					会产生没有必要的真实DOM更新 ==&gt; 界面效果没问题, 但效率低。</span></span><br><span class="line"><span class="comment">	2. 如果结构中还包含输入类的DOM：</span></span><br><span class="line"><span class="comment">					会产生错误DOM更新 ==&gt; 界面有问题。</span></span><br><span class="line"><span class="comment">4. 开发中如何选择key?</span></span><br><span class="line"><span class="comment">	1.最好使用每条数据的唯一标识作为key, 比如id、手机号、身份证号、学号等唯一值。</span></span><br><span class="line"><span class="comment">	2.如果不存在对数据的逆序添加、逆序删除等破坏顺序操作，仅用于渲染列表用于展示，</span></span><br><span class="line"><span class="comment">	使用index作为key是没有问题的。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;carname&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;add&#x27;</span>&gt;</span>添加一辆车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-for</span>=<span class="string">&#x27;(item, index) in list&#x27;</span> <span class="attr">:key</span>=<span class="string">&#x27;item.id&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;<span class="name">input</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&lt;/div &gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">carname</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">nextId</span>: <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">id</span>: <span class="number">001</span>, <span class="attr">name</span>: <span class="string">&#x27;法拉利&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">id</span>: <span class="number">002</span>, <span class="attr">name</span>: <span class="string">&#x27;兰博基尼&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">id</span>: <span class="number">003</span>, <span class="attr">name</span>: <span class="string">&#x27;布加迪&#x27;</span> &#125;]</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">unshift</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">nextId</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">carname</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">nextId</span> += <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="image-20231226153440109.png" alt="id作为key"></p>
<p><img data-src="image-20231226153515304.png" alt="index作为key"></p>
<h6 id="综合练习">综合练习</h6>
<p><img data-src="image-20220719224700549.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>品牌列表案例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./lib/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/brandlist.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 卡片区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">        添加品牌</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加品牌的表单区域 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 阻止表单默认事件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> @<span class="attr">submit.prevent</span>=<span class="string">&#x27;add&#x27;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-row align-items-center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-auto&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group mb-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-text&quot;</span>&gt;</span>品牌名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入品牌名称&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;carname&#x27;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-auto&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary mb-2&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-auto&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group mb-2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-text&quot;</span>&gt;</span>品牌名称<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入搜索内容&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;keywords&#x27;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-auto&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&#x27;search&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary mb-2&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表格区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-bordered table-hover table-striped&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>品牌名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>创建时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;tr v-for=&#x27;item in search()&#x27; :key=&#x27;item.id&#x27;&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&#x27;item in searchList&#x27;</span> <span class="attr">:key</span>=<span class="string">&#x27;item.id&#x27;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-control custom-switch&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-input&quot;</span> <span class="attr">:id</span>=<span class="string">&quot;&#x27;customSwitch&#x27;+item.id&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;item.status&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-label&quot;</span> <span class="attr">:for</span>=<span class="string">&quot;&#x27;customSwitch&#x27;+item.id&quot;</span>&gt;</span>&#123;&#123; item.status ? &#x27;已启用&#x27;: &#x27;已禁用&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">&lt;!-- 第二种方式 --&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- &lt;label class=&quot;custom-control-label&quot; :for=&quot;&#x27;customSwitch&#x27;+item.id&quot; v-if=&#x27;item.status&#x27;&gt;已启用&lt;/label&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">              <span class="comment">&lt;!-- &lt;label class=&quot;custom-control-label&quot; :for=&quot;&#x27;customSwitch&#x27;+item.id&quot; v-else&gt;已禁用&lt;/label&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 将渲染到页面上的数据进行过滤 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 将item.time通过管道符交给dateFormat过滤器处理</span></span><br><span class="line"><span class="comment">          最终的结果返回到该插值表达式中 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 局部过滤器演示 --&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- &lt;td&gt;&#123;&#123;item.time | dateFormat(&#x27;YYYY-MM-DD HH:mm:ss&#x27;) | dateAdd &#125;&#125;&lt;/td&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">&lt;!-- 全局过滤器演示 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.time | dateDel(&#x27;YYYY-MM-DD&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- javascript:; 表示a标签不会跳转 而是用来点击实现某些功能 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&#x27;del(item.id)&#x27;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/vue-2.6.12.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/dayjs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 全局过滤器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 参数一: 过滤器的名字</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;dateDel&#x27;</span>, <span class="keyword">function</span> (<span class="params">val, str</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title function_">dayjs</span>(val).<span class="title function_">format</span>(str)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">carname</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">nextId</span>: <span class="number">6</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 用户输入的内容</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">keywords</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">searchList</span>: [],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">carList</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;宝马&#x27;</span>, <span class="attr">status</span>: <span class="literal">true</span>, <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;奔驰&#x27;</span>, <span class="attr">status</span>: <span class="literal">false</span>, <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;奥迪&#x27;</span>, <span class="attr">status</span>: <span class="literal">true</span>, <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125;,</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 删除</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">del</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 删除原数据的数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">carList</span> = <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> != id)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 删除新数组中的数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">searchList</span> = <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> != id)</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 方法二效率高点</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">some</span>(<span class="function">(<span class="params">item, index</span>)=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 查找数组中的元素id和要删除的id一样的元素</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">id</span> == id)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 删除指定下标的元素</span></span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 停止循环</span></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 自定义一个对象 获取到用户输入的车名</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">carname</span> == <span class="string">&#x27;&#x27;</span>) <span class="keyword">return</span> <span class="title function_">alert</span>(<span class="string">&#x27;输入内容不能为空&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 如果代码执行到这个位置 证明用户输入了车名</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 自定义对象</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">nextId</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">carname</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">status</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 将自定义的对象添加到数组中</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">push</span>(obj)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 原数组新增数据后同步到新数组</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">searchList</span> = <span class="variable language_">this</span>.<span class="property">carList</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// id加1 保证下次再添加数据id能在原有的基础上++</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">nextId</span> += <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 清空输入框</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">carname</span> = <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 搜索</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">search</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 1. 原数组</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 使用原数组产生的问题</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.carList = this.carList.filter(item =&gt; item.name.includes(this.keywords));</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 2. 新数组点击按钮</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 创建一个新数组用来存放搜索的数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// includes(&#x27;&#x27;) =&gt; true</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">searchList</span> = <span class="variable language_">this</span>.<span class="property">carList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span>.<span class="title function_">includes</span>(<span class="variable language_">this</span>.<span class="property">keywords</span>));</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 3. 不需要点击按钮 不需要维护新数组</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// return this.carList.filter(item =&gt; item.name.includes(this.keywords));</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当dom加载完毕后</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当虚拟dom转成真实dom并且初次渲染到页面上时 (DOM挂载完毕) 只执行一次</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 让页面一进来就调用一下搜索方法</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">search</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 局部过滤器</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">filters</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// dateFormat(val, str1, str2)&#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//   return val + str1 + str2</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">dateFormat</span>(<span class="params">val, parten = <span class="string">&#x27;YY-MM-DD&#x27;</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let time = new Date(val)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let year = time.getFullYear()</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let month = time.getMonth() + 1</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let day = time.getDate()</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let hours = time.getHours()</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let m = time.getMinutes()</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// let s = time.getSeconds()</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// if (parten == &#x27;YY-MM-DD&#x27;) &#123;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   return `$&#123;year&#125;/$&#123;month&#125;/$&#123;day&#125;`</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// &#125;else &#123;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   // &#x27;YYYY-MM-DD HH:mm:ss&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//   return `$&#123;year&#125;/$&#123;month&#125;/$&#123;day&#125; $&#123;hours&#125;:$&#123;m&lt;10?&#x27;0&#x27;+m : m&#125;:$&#123;s&#125;`</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// dayjs提供的格式化时间的方法</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// return dayjs(val).format(&#x27;YY/MM/DD&#x27;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="title function_">dayjs</span>(val).<span class="title function_">format</span>(parten)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 第二个局部过滤器</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">dateAdd</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> val + <span class="string">&#x27;~~~&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// let vm2 = new Vue(&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   el: &#x27;#app&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="图书列表">图书列表</h6>
<p><img data-src="image-20231226153654605.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">table</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* 合并边框 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-collapse</span>: collapse;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>欢迎您: &#123;&#123; getUsername() &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;bookList.length != 0&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>书籍名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>出版日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>购买数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in bookList&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.book&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.date&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>￥&#123;&#123;item.price&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;decrement(index)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.num&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment(item.id)&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;remove(index)&quot;</span>&gt;</span>移除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>总价: &#123;&#123;total()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">      购物车空空如也 ~</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">bookList</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">book</span>: <span class="string">&#x27;将夜&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">price</span>: <span class="number">85</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>: <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">book</span>: <span class="string">&#x27;庆余年&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">price</span>: <span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">3</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">book</span>: <span class="string">&#x27;间客&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">price</span>: <span class="number">60</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">book</span>: <span class="string">&#x27;猫腻三部曲&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">price</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">num</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1、点击 + 将id传下来</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2、通过id找到数据中对应的图书</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3、++</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">increment</span>(<span class="params">id</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">bookList</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">id</span> == id)&#123;</span></span><br><span class="line"><span class="language-javascript">              item.<span class="property">num</span> += <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">total</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 传入index</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">decrement</span>(<span class="params">index</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">bookList</span>[index].<span class="property">num</span> -= <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">total</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">remove</span>(<span class="params">index</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">bookList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">total</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> num = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">bookList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            num += item.<span class="property">price</span> * item.<span class="property">num</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> num</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getUsername</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// return new URLSearchParams(location.search).get(&#x27;username&#x27;)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;username&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="登录页面">登录页面</h6>
<p><img data-src="image-20231226153807627.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">      用户名 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      密<span class="symbol">&amp;emsp;</span>码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      验证码 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入验证&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;confrimVercode&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; vercode &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>看不清<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeVercode&quot;</span>&gt;</span>换一张<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">username</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">vercode</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">confrimVercode</span>: <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 生成随机验证码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">changeVercode</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">vercode</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 登录</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">login</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">username</span> == <span class="string">&#x27;qwe&#x27;</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">password</span> == <span class="string">&#x27;123&#x27;</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">vercode</span> == <span class="variable language_">this</span>.<span class="property">confrimVercode</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 地址栏拼接</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// location.href = &quot;./02-图书列表.html#&quot;+ this.username</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// location.href = &quot;./02-图书列表.html?username=&quot;+ this.username</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 本地存储</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;username&quot;</span>, <span class="variable language_">this</span>.<span class="property">username</span>)</span></span><br><span class="line"><span class="language-javascript">            location.<span class="property">href</span> = <span class="string">&#x27;./02-图书列表.html&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;输入有误&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 页面挂载完成时 =&gt; 暂时理解为js的onload</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">changeVercode</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="评论列表">评论列表</h6>
<p><img data-src="image-20231226154036469.png" alt=""></p>
<p><img data-src="image-20231226154109107.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.sete</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">span</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">6px</span> <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">outline</span>: none;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.edit</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">30%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;span class=&quot;sete&quot; :class=&quot;statu==0 ? &#x27;active&#x27;: &#x27;&#x27;&quot;&gt;评论管理&lt;/span&gt;</span></span><br><span class="line"><span class="comment">      &lt;span class=&quot;sete&quot; :class=&quot;statu==1 ? &#x27;active&#x27;: &#x27;&#x27;&quot;&gt;发布评论&lt;/span&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 数组 --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;span :class=&quot;[&#x27;sete&#x27;, statu==0 ? &#x27;active&#x27;: &#x27;&#x27;]&quot;&gt;评论管理&lt;/span&gt;</span></span><br><span class="line"><span class="comment">      &lt;span :class=&quot;[&#x27;sete&#x27;, statu==1 ? &#x27;active&#x27;: &#x27;&#x27;]&quot;&gt;发布评论&lt;/span&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- 对象 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;sete&#x27;, &#123;active: statu == 0&#125;]&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;statu = 0&quot;</span>&gt;</span>评论管理<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;sete&#x27;, &#123;active: statu == 1&#125;]&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;statu = 1&quot;</span>&gt;</span>发布评论<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发表评论 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 20px;margin-top: 20px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sete&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;statu == 1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;昵称&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;评论内容&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;comment&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>立即提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 评论管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding: 10px;margin-top: 20px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sete&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;statu == 0&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in commentList&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>评论人: &#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>评论时间: &#123;&#123;item.date&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>评论内容: &#123;&#123;item.comment&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showEdit(item.id)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 编辑框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;edit&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;editFlag&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        评论人啊: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;editItem.name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        评论时间: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">disabled</span> <span class="attr">:value</span>=<span class="string">&quot;editItem.date&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        评论内容: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;editItem.comment&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;edit&quot;</span>&gt;</span>确认<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1 代表发布评论 0 代表评论管理</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">statu</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 评论列表</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">commentList</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;评论人-1&#x27;</span>, <span class="attr">date</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(), <span class="attr">comment</span>: <span class="string">&quot;哈哈哈&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;评论人-2&#x27;</span>, <span class="attr">date</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(), <span class="attr">comment</span>: <span class="string">&quot;呵呵呵&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        ],</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 评论人</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 评论内容</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">comment</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 控制编辑框的显示隐藏</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">editFlag</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 回显的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">editItem</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">submit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">commentList</span>.<span class="title function_">push</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">commentList</span>[<span class="variable language_">this</span>.<span class="property">commentList</span>.<span class="property">length</span> - <span class="number">1</span>].<span class="property">id</span> + <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">name</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">comment</span>: <span class="variable language_">this</span>.<span class="property">comment</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 清空输入框</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">comment</span> = <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 切换到评论列表页</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">statu</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showEdit</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 显示编辑弹框</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">editFlag</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 查找数据列表中id和需要编辑的id一样的元素</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">commentList</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">id</span> == id)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 保存 =&gt; 回显</span></span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="property">editItem</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, item)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 确认编辑</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">edit</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">commentList</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">id</span> == <span class="variable language_">this</span>.<span class="property">editItem</span>.<span class="property">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 修改数据</span></span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// item.name = this.editItem.name</span></span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// item.comment = this.editItem.comment</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 合并</span></span></span><br><span class="line"><span class="language-javascript">              <span class="title class_">Object</span>.<span class="title function_">assign</span>(item, <span class="variable language_">this</span>.<span class="property">editItem</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 隐藏编辑框</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">editFlag</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="购物车">购物车</h6>
<p><img data-src="image-20231226155051374.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#app</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">480px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">table</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* 合并边框 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-collapse</span>: collapse;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.footer</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;checkAll&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;checkAllStatu&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>商品<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>金额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;item in proList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;item.statu&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;check($event, item.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.img&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 80px; height: 80px;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.num&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>￥&#123;&#123;item.price&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>￥&#123;&#123;item.num * item.price&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> @<span class="attr">click</span>=<span class="string">&quot;delCheck&quot;</span>&gt;</span>删除所选<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>继续购物<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;totalNum&#125;&#125;件商品(不含运费): ￥&#123;&#123;totalPrice&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;display: block; padding: 10px 5px; </span></span></span><br><span class="line"><span class="string"><span class="tag">        background-color: orange; color: white; text-align: center;</span></span></span><br><span class="line"><span class="string"><span class="tag">        cursor: pointer;&quot;</span>&gt;</span>去结算<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">proList</span>: [</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;vivo&quot;</span>, <span class="attr">price</span>: <span class="number">1999</span>, <span class="attr">num</span>: <span class="number">3</span>, <span class="attr">statu</span>: <span class="literal">true</span>, <span class="attr">img</span>: <span class="string">&quot;./02.jpg&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;xiaomi&quot;</span>, <span class="attr">price</span>: <span class="number">1299</span>, <span class="attr">num</span>: <span class="number">1</span>, <span class="attr">statu</span>: <span class="literal">false</span>, <span class="attr">img</span>: <span class="string">&quot;./02.jpg&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;redmi&quot;</span>, <span class="attr">price</span>: <span class="number">999</span>, <span class="attr">num</span>: <span class="number">2</span>, <span class="attr">statu</span>: <span class="literal">true</span>, <span class="attr">img</span>: <span class="string">&quot;./02.jpg&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;oppo&quot;</span>, <span class="attr">price</span>: <span class="number">3333</span>, <span class="attr">num</span>: <span class="number">4</span>, <span class="attr">statu</span>: <span class="literal">true</span>, <span class="attr">img</span>: <span class="string">&quot;./02.jpg&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&quot;sanxing&quot;</span>, <span class="attr">price</span>: <span class="number">8000</span>, <span class="attr">num</span>: <span class="number">2</span>, <span class="attr">statu</span>: <span class="literal">false</span>, <span class="attr">img</span>: <span class="string">&quot;./02.jpg&quot;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 全选</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">checkAll</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            item.<span class="property">statu</span> = e.<span class="property">target</span>.<span class="property">checked</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 单选</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">check</span>(<span class="params">e, id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">some</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (item.<span class="property">id</span> == id) &#123;</span></span><br><span class="line"><span class="language-javascript">              item.<span class="property">statu</span> = e.<span class="property">target</span>.<span class="property">checked</span></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 删除所选</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">delCheck</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">proList</span> = <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 过滤所有未选中的元素 选中的就是要删除的元素</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> !item.<span class="property">statu</span></span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 全选状态</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">checkAllStatu</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// every: 全true为true 有false为false</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">statu</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 数量</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">totalNum</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> num = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 如果选中</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">statu</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 计算数量</span></span></span><br><span class="line"><span class="language-javascript">              num += item.<span class="property">num</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> num</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 总价</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">totalPrice</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> price = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">proList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 如果选中</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(item.<span class="property">statu</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 计算总价</span></span></span><br><span class="line"><span class="language-javascript">              price += item.<span class="property">num</span> * item.<span class="property">price</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> price</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="过滤器">过滤器</h5>
<p>过滤器：</p>
<p>​    定义：对要显示的数据进行特定格式化后再显示（适用于一些简单逻辑的处理）。</p>
<p>​    语法：</p>
<p>​      1.注册过滤器：Vue.filter (name,callback) 或 new  Vue { filters:{} }</p>
<p>​      2.使用过滤器：<code>&#123;&#123;  xxx | 过滤器名 &#125;&#125; </code> 或  <code>v-bind:属性 = &quot;xxx | 过滤器名&quot;</code></p>
<p>​    备注：</p>
<p>​      1.过滤器也可以接收额外参数、多个过滤器也可以串联</p>
<p>​      2.并没有改变原本的数据, 是产生新的对应的数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt; !--准备好一个容器--&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>显示格式化后的时间<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 计算属性实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>现在是：&#123;&#123; fmtTime &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- methods实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>现在是：&#123;&#123; getFmtTime() &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>现在是：&#123;&#123; time | timeFormater&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器实现（传参） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>现在是：&#123;&#123; time | timeFormater(&#x27;YYYY_MM_DD&#x27;) | mySlice&#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">:x</span>=<span class="string">&quot;msg | mySlice&quot;</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	&lt;/div &gt;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg | mySlice&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	&lt;/body &gt;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//全局过滤器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;mySlice&#x27;</span>,<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">return</span> value.<span class="title function_">slice</span>(<span class="number">0</span>,<span class="number">4</span>)</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#root&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">time</span>:<span class="number">1621561377603</span>, <span class="comment">//时间戳</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">msg</span>:<span class="string">&#x27;你好，vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">			&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fmtTime</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">return</span> <span class="title function_">dayjs</span>(<span class="variable language_">this</span>.<span class="property">time</span>).<span class="title function_">format</span>(<span class="string">&#x27;YYYY年MM月DD日 HH:mm:ss&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">getFmtTime</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">return</span> <span class="title function_">dayjs</span>(<span class="variable language_">this</span>.<span class="property">time</span>).<span class="title function_">format</span>(<span class="string">&#x27;YYYY年MM月DD日 HH:mm:ss&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//局部过滤器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filters</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">timeFormater</span>(<span class="params">value, str = <span class="string">&#x27;YYYY年MM月DD日 HH:mm:ss&#x27;</span></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="comment">// console.log(&#x27;@&#x27;,value)</span></span></span><br><span class="line"><span class="language-javascript">			<span class="keyword">return</span> <span class="title function_">dayjs</span>(value).<span class="title function_">format</span>(str)</span></span><br><span class="line"><span class="language-javascript">			&#125;</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">&#x27;#root2&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>:<span class="string">&#x27;hello,vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br></pre></td></tr></table></figure>
<h5 id="computed和method">computed和method</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;firstName&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;lastName&#x27;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 插值表达式的实现 简单的js逻辑表达式 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;span&gt;&#123;&#123;firstName +&#x27;-&#x27;+ lastName&#125;&#125;&lt;/span&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;span&gt;&#123;&#123;firstName&#125;&#125; - &#123;&#123;lastName&#125;&#125; &lt;/span&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 更复杂的通过方法的实现 </span></span><br><span class="line"><span class="comment">        methods中的方法调用一次就会执行一次 如果数据不需要更新</span></span><br><span class="line"><span class="comment">        会造成性能的浪费--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;span&gt;&#123;&#123;fullName()&#125;&#125; &lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName()&#125;&#125; &lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName()&#125;&#125; &lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName()&#125;&#125; &lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName()&#125;&#125; &lt;/span&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- &lt;span&gt;&#123;&#123;fullName&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;fullName&#125;&#125;&lt;/span&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fullName&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 定义到data中的数据默认会被响应式监听</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">firstName</span>: <span class="string">&#x27;张&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastName</span>: <span class="string">&#x27;三&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// fullName() &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     console.log(111);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     return this.firstName + &#x27;-&#x27; + this.lastName</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 计算属性computed: 计算属性的值本身不存在 是需要通过计算得到的 </span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 底层也是通过object.defineProperty来实现的</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// computed 与 methods的区别</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 1、是否存在缓存: methods调用一次执行一次</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// computed第一次调用时会将结果缓存 (有缓存)、后续调用在所依赖的数据不发生变化的前提下 直接返回缓存的结果 =&gt; 复用率高 提升性能</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 2、调用方式不同: methods使用时，一般情况需要加括号，而computed则不需要</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 3、绑定方式不同: methods是单向数据绑定 只有getter, computed是双向数据绑定, 有setter和getter </span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 使用场景</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 某个属性的值需要来自多个属性的简单计算或者复杂逻辑计算得出的值时, 推荐使用computed属性, 比如购物车的总价计算</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 完整写法</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fullName</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// get作用: 当使用到fullName的时候 默认会调用get方法</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// get特点: </span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 1、初次使用计算属性的时候会执行</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 2、当依赖的响应式数据发生变化的时候会执行</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27;-&#x27;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 如果需要修改计算属性 需要提供一个set方法</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 并且这个set方法中要能够引起依赖的数据的变化</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> arr = val.<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">firstName</span> = arr[<span class="number">0</span>]</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">lastName</span> = arr[<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 简写</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// fullName()&#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     return this.firstName + &#x27;-&#x27; + this.lastName</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="watch-2">watch</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/axios@0.21.4/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;name&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;student.loves.playGame.tencent.name&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// watch 侦听器允许开发者监视数据的变化，从而针对数据的变化做特定的操作</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// _data会收集data中的数据 处理成响应式</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 再将其挂载到vm实例对象下方便开发者使用 =&gt; 数据代理</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 响应式: 简单的说就是数据发生变化 页面会重新渲染</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 页面发生变化 数据也会随之变化</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&#x27;admin&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">message</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">student</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">loves</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">playGame</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">tencent</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">name</span>: <span class="string">&#x27;王者荣耀&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">price</span>: <span class="number">99</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">wangyi</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">name</span>: <span class="string">&#x27;和平精英&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 侦听器本质是一个函数 需要侦听谁 就将侦听的属性当作函数名放到watch中即可</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 当被监视的属性发生变化时，回调函数自动调用，执行函数中的代码</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// name() &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     if (this.name == &#x27;&#x27;) return</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     const &#123; data &#125; = await axios.get(&#x27;https://www.escook.cn/api/finduser/&#x27; + this.name)</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     this.message = data.message</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 有配置项的情况 将函数改造成对象的形式</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// name: &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     async handler(newVal, oldVal) &#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         console.log(111);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         console.log(&#x27;新值&#x27;+ newVal, &#x27;老值&#x27;+ oldVal);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         if (this.name == &#x27;&#x27;) return</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         const &#123; data &#125; = await axios.get(&#x27;https://www.escook.cn/api/finduser/&#x27; + this.name)</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         this.message = data.message</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     &#125;,</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 表示页面初次渲染好之后，就立即触发当前的 watch 侦听器</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 执行handler函数中的内容</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     immediate: true,</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 如果层次不深 可以直接通过这种方式侦听</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#x27;student.name&#x27;:&#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#x27;student.loves.playGame.tencent.name&#x27;:&#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     handler(newVal)&#123;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         console.log(11111);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//         console.log(newVal);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">				<span class="comment">// vue中的watch默认不监视对象内部的值改变</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">student</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">11111</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal);</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 开启深度监听</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// </span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">deep</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        vm.$watch(<span class="string">&#x27;student&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handler</span>(<span class="params">newVal</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">11111</span>);</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 开启深度监听</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">deep</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="computed和watch">computed和watch</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span>&gt;</span>&#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">firstName</span>: <span class="string">&#x27;Foo&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastName</span>: <span class="string">&#x27;Bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fullName</span>: <span class="string">&#x27;Foo Bar&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 侦听器的方式</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">firstName</span>: <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">fullName</span> = val + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">lastName</span>: <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">fullName</span> = <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27; &#x27;</span> + val</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 计算属性的方式</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">fullName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">fullName</span> = <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">lastName</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// computed和watch的区别</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 1、computed是有缓存的  watch没有</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 2、computed一般执行同步操作 异步操作在watch中实现</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 3、computed监听的那个数据的数据发生变化时,不会重新计算,只有依赖的数据发生变化时才会重新调用getter来计算</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// watch监听的数据发生变化时 立马执行相应的回调函数重新计算</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="数据代理">数据代理</h5>
<p>什么是数据代理？</p>
<p>通过一个对象代理对另一个对象中属性的操作（读/写）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="attr">x</span>: <span class="number">100</span> &#125;</span><br><span class="line"><span class="keyword">let</span> obj2 = &#123; <span class="attr">y</span>: <span class="number">200</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj2, <span class="string">&#x27;x&#x27;</span>, &#123;</span><br><span class="line">	<span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> obj1.<span class="property">x</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="title function_">set</span>(<span class="params">value</span>) &#123;</span><br><span class="line">		obj1.<span class="property">x</span> = value</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">此时操作obj2实际上在操作obj1</span><br></pre></td></tr></table></figure>
<p>vue中的数据代理</p>
<p>vue里面data的数据代理 通过_data收集data中的数据</p>
<p>利用Object.defineProperty中的get和set将data中的每个数据进行数据代理</p>
<p>再将代理好的数据挂载到vm实例上</p>
<p>好处: 方便开发者操作data中的数据</p>
<h5 id="Vue-set">Vue.set()</h5>
<p>注意：受现代 JavaScript 的限制 (以及废弃 Object.observe)，Vue 不能检测到对象属性的添加或删除。由于 Vue 会在初始化实例时对属性执行 getter/setter 转化过程，所以属性必须在 data 对象上存在才能让 Vue 转换它，这样才能让它是响应的</p>
<p>如果在实例创建之后添加新的属性到实例上，它不会触发视图更新</p>
<p>如果想要数据是响应式的并且能触发视图更新 使用Vue.set()</p>
<p>(比如 <code>this.myObject.newProperty = 'hi'</code>)</p>
<h5 id="自定义指令-2">自定义指令</h5>
<p>除了核心功能默认内置的指令 (<code>v-model</code> 和 <code>v-show</code>)，Vue 也允许注册自定义指令。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">自定义指令总结：</span><br><span class="line">一、定义语法：</span><br><span class="line">(1).局部指令：</span><br><span class="line">new Vue(&#123; new Vue(&#123;</span><br><span class="line">directives:&#123;指令名:配置对象&#125; 或 directives&#123;指令名:回调函数&#125;</span><br><span class="line">&#125;) &#125;)</span><br><span class="line">(2).全局指令：</span><br><span class="line">Vue.directive(指令名,配置对象) 或 Vue.directive(指令名,回调函数)</span><br><span class="line"></span><br><span class="line">二、配置对象中常用的3个回调：</span><br><span class="line">(1).bind：指令与元素成功绑定时调用。</span><br><span class="line">(2).inserted：指令所在元素被插入页面时调用。</span><br><span class="line">(3).update：指令所在模板结构被重新解析时调用。</span><br><span class="line"></span><br><span class="line">三、备注：</span><br><span class="line">1.指令定义时不加v-，但使用时要加v-；</span><br><span class="line">2.指令名如果是多个单词，要使用kebab-case命名方式，不要用camelCase命名。</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;input type=&quot;text&quot; v-focus&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    自定义指令: <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-two-double.flag</span>=<span class="string">&quot;number&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;number += 1&quot;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;age += 1&quot;</span>&gt;</span>++<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    自动聚焦: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-focus</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;del&quot;</span>&gt;</span>移除元素<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ctrl+shift+k 删除当前行</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 1、自定义指令什么时候会被执行 ?</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// - 指令与页面元素绑定成功时(页面一打开)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// - 自定义指令所在的vue模板被重新解析时</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 函数式写法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;two-double&#x27;</span>, <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      el.<span class="property">innerText</span> = binding.<span class="property">value</span> * <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Vue.directive(&#x27;focus&#x27;, (el, binding) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   // 聚焦失败 原因是此时元素并没有渲染到页面上</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   el.focus()</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 对象式写法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 指令与元素成功绑定时调用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">bind</span>(<span class="params">el,binding</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        el.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;skyblue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 指令所在元素被插入页面时调用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">inserted</span>(<span class="params">el,binding</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        el.<span class="title function_">focus</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 指令所在模板结构被重新解析时调用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">update</span>(<span class="params">el,binding</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;update&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">unbind</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;unbind&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">number</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">flag</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">del</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">flag</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 局部自定义指令</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// directives: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="格式化时间指令">格式化时间指令</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/dayjs@1.11.9/dayjs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-format-time</span>=<span class="string">&quot;&#x27;YYYY-MM-DD&#x27;&quot;</span>&gt;</span>1693900568477<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-format-time</span>&gt;</span>1693901090018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 全局注册自定义指令</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;format-time&#x27;</span>, <span class="function">(<span class="params">el, binding</span>)=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> geshi = <span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果使用该自定义指令设置了value值</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(binding.<span class="property">value</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        geshi = binding.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      el.<span class="property">textContent</span> = <span class="title function_">dayjs</span>(el.<span class="property">textContent</span> - <span class="number">0</span>).<span class="title function_">format</span>(geshi)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="自定义防抖指令">自定义防抖指令</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">v-debounce</span>=<span class="string">&quot;&#123; eventType: &#x27;click&#x27;, fn, delay: 2000 &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag = !flag&quot;</span>&gt;</span>让左边按钮消失<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;debounce&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 元素插入到页面上时执行该钩子</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">inserted</span>(<span class="params">el, binding</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 接收使用该指令传过来的值 并解构</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> &#123; delay, eventType, fn &#125; = binding.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 防抖</span></span></span><br><span class="line"><span class="language-javascript">        el.<span class="property">timeId</span> = <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">        el.<span class="property">handler</span> = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (timeId) &#123; <span class="built_in">clearTimeout</span>(timeId) &#125;</span></span><br><span class="line"><span class="language-javascript">            timeId = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;, delay)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 绑定事件</span></span></span><br><span class="line"><span class="language-javascript">        el.<span class="title function_">addEventListener</span>(eventType, el.<span class="property">handler</span>, <span class="literal">false</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 只调用一次，指令与元素解绑时调用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">unbind</span>(<span class="params">el, binding</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> &#123; delay, eventType, fn &#125; = binding.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 清理定时器</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">clearTimeout</span>(el.<span class="property">timeId</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 解绑事件</span></span></span><br><span class="line"><span class="language-javascript">        el.<span class="title function_">removeEventListener</span>(eventType, el.<span class="property">handler</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;事件移除了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">flag</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;事件触发了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="vue组件">vue组件</h5>
<p><strong>定义</strong></p>
<p>实现应用中代码和资源的集合</p>
<p><img data-src="image-20220724232550182.png" alt=""></p>
<p><strong>组件化和模块化的区别</strong></p>
<p>模块化</p>
<p>站在代码逻辑的角度来划分 解决js依赖等问题 方便分层开发 保证每个模块职能单一</p>
<p>组件化</p>
<p>站在UI界面的角度来划分 方便将来UI组件的复用</p>
<h6 id="全局组件">全局组件</h6>
<p><strong>第一种注册方式</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 在页面中使用组件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-com</span>&gt;</span><span class="tag">&lt;/<span class="name">my-com</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-com</span>&gt;</span><span class="tag">&lt;/<span class="name">my-com</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">my-com</span>&gt;</span><span class="tag">&lt;/<span class="name">my-com</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 关闭生产环境下的vue提示</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用组件三步骤</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1、通过Vue.extend(options)定义组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2、通过Vue.component(&#x27;组件名&#x27;, 定义好的组件)注册全局组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3、在页面结构中通过&lt;组件名&gt;&lt;/组件名&gt;使用组件</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 注意事项</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1、template有且只能有一个根元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2、不要写el属性 定义的组件都要交给vm管理 由vm中的el来决定服务于哪个容器</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3、如果自定义组件名使用了驼峰命名法(myCom) 在页面中使用的时候要用-分割组件名并且转为小写(my-com)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 4、组件名不要使用已有的元素名称，比如：div、span都不行。</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 5、组件中的data必须定义为一个函数 函数中必须返回一个对象 避免组件在复用时 数据直接相互引用导致冲突问题</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 6、不用使用脚手架时，单标签会导致复用组件后续无法渲染的问题</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 7、组件中的this指向的是当前组件的实例对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 8、使用name配置项指定组件在开发者工具中呈现的名字</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 第一种注册方式 Vue.extend + Vue.component 结合</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 定义组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> mycom = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// el: &#x27;#app&#x27;, 违背设计组件的初心</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// template: 将来展示在页面上的结构</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// name: &#x27;qwer&#x27;, 使用name配置项指定组件在开发者工具中呈现的名字</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">`&lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                        &lt;h1 @click=&#x27;show&#x27;&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                        &lt;h3&gt;&#123;&#123;msg&#125;&#125;&lt;/h3&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                       &lt;/div&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">msg</span>: <span class="string">&#x27;hello component&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">show</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// this指向的是当前组件的实例对象</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 注册全局组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;my-com&#x27;</span>, mycom)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>第二种注册方式</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mycom1</span>&gt;</span><span class="tag">&lt;/<span class="name">mycom1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- .vue文件中也是通过这种方式定义页面结构 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- template模板 只会将template中的内容渲染到页面上 不会将template标签渲染到页面上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;mycom1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>第三种注册方式<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 第二种注册方式 =&gt; template没有提示</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Vue.component(&#x27;mycom1&#x27;, Vue.extend(&#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     template: &#x27;&lt;h1&gt;第二种注册方式&lt;/h1&gt;&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;))</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 简写 Vue.component(&#x27;组件名&#x27;, 配置对象) 内部会帮我们调用Vue.extend</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// Vue.component(&#x27;mycom1&#x27;, &#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     template: &#x27;&lt;h1&gt;第二种注册方式&lt;/h1&gt;&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 第三种注册方式</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;mycom1&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">&#x27;#mycom1&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="组件data详解">组件data详解</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button-counter</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button-counter</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button-counter</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 定义一个名为 button-counter 的新组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;button-counter&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">count</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">&#x27;&lt;button v-on:click=&quot;count++&quot;&gt;You clicked me &#123;&#123; count &#125;&#125; times.&lt;/button&gt;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 为什么data必须是一个函数且返回一个对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 如果是对象的话多个页面可能会复用这个组件 如果其中一个页面对组件data进行修改的话 其它页面的data也会发生变化 造成数据冲突 (引用问题)</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 而定义成一个函数 每次返回一个新的对象 保证了对象的唯一性 避免了组件数据修改影响其他组件数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var obj = &#123;x:100, y:100&#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var obj2 = obj</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// obj2.x = 1000</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(obj); // &#123;x:1000, y:100&#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ===================================</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// function getObj()&#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     return &#123;x: 100, y:100&#125;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;  </span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var obj = getObj()</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var obj2 = getObj() </span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// obj2.x = 1000</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(obj); // &#123;x:100, y:100&#125;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="局部组件">局部组件</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mycom</span>&gt;</span><span class="tag">&lt;/<span class="name">mycom</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mycom2</span>&gt;</span><span class="tag">&lt;/<span class="name">mycom2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模板 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;tmpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> mycom = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">&#x27;#tmpl&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">msg</span>: <span class="string">&#x27;局部组件注册&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> mycom2 = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">template</span>: <span class="string">&#x27;#tmpl&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">msg</span>: <span class="string">&#x27;局部组件注册222&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                mycom,</span></span><br><span class="line"><span class="language-javascript">                mycom2</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="嵌套组件">嵌套组件</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 组件标签中写任何内容都不会渲染 插槽--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;father&gt;</span></span><br><span class="line"><span class="comment">      &lt;son&gt;&lt;/son&gt;</span></span><br><span class="line"><span class="comment">    &lt;/father&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- &lt;father&gt;&lt;/father&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 嵌套子组件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">son</span>&gt;</span><span class="tag">&lt;/<span class="name">son</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;mother&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;son&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> son = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">&#x27;#son&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&#x27;行晟玮表示听不懂&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 全局注册</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;son&#x27;</span>, son)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> father = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">&#x27;#father&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&#x27;你在这里等我不要走 我去给你买橘子&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 注册子组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// components: &#123; son &#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> mother = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">&#x27;#mother&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&#x27;your mother&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 注册子组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// components: &#123; son &#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> <span class="title class_">App</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">`&lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;father&gt;&lt;/father&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;mother&gt;&lt;/mother&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">      &lt;/div&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">components</span>: &#123; father, mother &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">App</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// father,</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// son</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="vue-cli">vue-cli</h5>
<p>vue-cli是vue官方出品的快速构建单页应用的脚手架，里面集成了webpack，npm，nodejs，babel，vue，vue-router …</p>
<p>安装： <code>npm install -g @vue/cli</code></p>
<p>初始化项目：<code>vue create 项目名</code><br>
<img data-src="image-20230904105500377.png" alt=""></p>
<p><img data-src="image-20230904105554409.png" alt=""></p>
<p><img data-src="image-20230904105644353.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node_modules : 项目安装的包 插件</span><br><span class="line">public: 公共的资源 (第一种方式配置devserver跨域会默认从这先查找)</span><br><span class="line">  	 favicon.ico 网站图标</span><br><span class="line"> 	 index.html 单页应用的html入口</span><br><span class="line">src: 源码</span><br><span class="line">     assets: 静态资源（图片、css样式等）</span><br><span class="line">     components: 组件</span><br><span class="line">     App.vue: 根组件</span><br><span class="line">     main.js: 入口文件</span><br><span class="line">.browserslistrc: 配置文件 =&gt; 兼容支持</span><br><span class="line">.gitignore: 提交到git的时候需要忽略的文件</span><br><span class="line">babel.config.js: babel配置文件 =&gt; 兼容</span><br><span class="line">package-lock.json: 记录包的详细信息 比如: 下载地址、密钥、版本信息等</span><br><span class="line">package.json: 记录工程和包的信息</span><br><span class="line">README.md: 对于整个项目的介绍</span><br><span class="line">public和assets的区别: https://www.cnblogs.com/zhanghuifang/p/16283071.html</span><br></pre></td></tr></table></figure>
<h6 id="render函数">render函数</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">	该文件是整个项目的入口文件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//引入Vue</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//引入App组件，它是所有组件的父组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="comment">//关闭vue的生产提示</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">	关于不同版本的Vue：</span></span><br><span class="line"><span class="comment">	1.vue.js与vue.runtime.xxx.js的区别：</span></span><br><span class="line"><span class="comment">		(1).vue.js是完整版的Vue，包含：核心功能+模板解析器。</span></span><br><span class="line"><span class="comment">		(2).vue.runtime.xxx.js是运行版的Vue，只包含：核心功能；没有模板解析器。</span></span><br><span class="line"><span class="comment">	2.因为vue.runtime.xxx.js没有模板解析器，所以不能使用template配置项，需要使用render函数接收到的createElement函数去指定具体内容。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Vue实例对象---vm</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">	<span class="attr">el</span>:<span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">	<span class="comment">//render函数完成了这个功能：将App组件放入容器中</span></span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">	<span class="comment">// render:q=&gt; q(&#x27;h1&#x27;,&#x27;你好啊&#x27;)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// template:`&lt;h1&gt;你好啊&lt;/h1&gt;`,</span></span><br><span class="line">	<span class="comment">// components:&#123;App&#125;,</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="cli默认配置">cli默认配置</h6>
<p>查看默认配置 <code>vue inspect &gt; output.js</code></p>
<p>输出的文件内容不允许修改</p>
<p>如需修改在项目根目录下添加vue.config.js来自定义配置</p>
<h5 id="vue生命周期">vue生命周期</h5>
<p><img data-src="%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="vue生命周期"></p>
<p>完整版解析：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">beforeCreate(创建前): 在实例初始化之后，数据代理和事件配置之前被调用，此时组件的选项对象还未创建，el 和 data 并未初始化，因此无法访问methods, data等上的方法和数据，这个钩子一般不会做太多功能，会初始化自己的生命周期，事件方法如：$on $emit</span><br><span class="line"></span><br><span class="line">created(创建完成): 此时已经完成了数据响应式监听和数据代理，可以获取数据和调用方法 但是DOM未渲染 在这个周期里面，可以去发送请求, 因为请求是异步的，不会阻碍实例加载，除非是那些同步操走才会导致页面空白。站在这个角度说来，在这个周期里面进行请求，渲染速度反而会更快。</span><br><span class="line"></span><br><span class="line">beforeMount(挂载前): 检测有没有template属性 有的话会把template渲染成一个render函数，开始解析模板，生成虚拟dom，没有则将外部的html作为模板进行解析。此时数据虽然初始化完成，DOM未完成挂载，页面还不能显示解析好的内容，数据的双向绑定还是显示&#123;&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">上下两者中间还有一个创建vm.$el保存真实dom的过程，将来虚拟dom对比发现可复用的元素，就从该属性身上取出来渲染 同学们切记 !!!</span><br><span class="line"></span><br><span class="line">mounted(挂载完成): 数据和真实DOM都完成挂载，这个周期适合执行初始化需要操作DOM的方法。至此初始化操作完成，一般在此进行：开启定时器，发送网络请求，订阅消息，绑定自定义事件等初始化操作</span><br><span class="line"></span><br><span class="line">beforeUpdate(更新前): 只要是页面数据改变了都会触发，数据更新之前，页面数据还是原来的数据，页面和数据没有同步，当你请求赋值一个数据的时候会执行这个周期，如果没有数据改变不执行。</span><br><span class="line"></span><br><span class="line">中间还有个虚拟DOM对比的过程，根据新数据，生成新的虚拟DOM，随后与旧的虚拟DOM进行比较，最终完成页面更新，如果真实DOM可以复用 则从vm.$el中取出对应的真实DOM直接渲染 即:完成了Model =&gt; View的更新，同学们切记 !!!</span><br><span class="line"></span><br><span class="line">updated(更新完成): 只要是页面数据改变了都会触发，数据更新完毕，页面的数据是更新完成的。beforeUpdate和updated要谨慎使用，因为页面更新数据的时候都会触发，在这里操作数据很影响性能和容易死循环。此时页面和数据保持同步</span><br><span class="line"></span><br><span class="line">beforeDestroy(销毁前): 这个周期是在组件销毁之前执行，此时: vm中所有的: data、methods、指令等等，都处于可用状态，马上要执行销毁过程，一般在此阶段:关闭定时器、取消订阅消息、解绑自定义事件等收尾操作</span><br><span class="line"></span><br><span class="line">destroyed(销毁完成): 在实例销毁之后调用，调用后，所以的事件监听器会被移出，所有的子实例也会被销毁，自定义事件会被移除</span><br></pre></td></tr></table></figure>
<h5 id="vue动画">vue动画</h5>
<p>为什么要有动画：动画能够提高用户的体验，帮助用户更好的理解页面中的功能；</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* v-enter 【这是一个时间点】 是进入之前，元素的起始状态，此时还没有开始进入 */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* v-leave-to 【这是一个时间点】 是动画离开之后，离开的终止状态，此时，元素 动画已经结束了 */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-enter</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-leave-to</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">150px</span>);</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* v-enter-active 【入场动画的时间段】 */</span></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* v-leave-active 【离场动画的时间段】 */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-enter-active</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: all .<span class="number">5s</span> ease</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.my-enter</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.my-leave-to</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transform</span>: <span class="built_in">translateY</span>(<span class="number">150px</span>);</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.my-enter-active</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.my-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: all .<span class="number">5s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0</span>, <span class="number">1.95</span>, .<span class="number">89</span>, .<span class="number">38</span>)</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;flag = !flag&#x27;</span>&gt;</span>Toggle<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用 transition 元素，把 需要被动画控制的元素，包裹起来 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transition</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-if</span>=<span class="string">&#x27;flag&#x27;</span>&gt;</span>有些同学的心已经到家了<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对于这些在过渡中切换的类名来说，如果你使用一个没有名字的 &lt;transition&gt;，则 v- 是这些类名的默认前缀。</span></span><br><span class="line"><span class="comment">        如果需要自定义类名 可以通过name属性: name=&#x27;my&#x27;  .my-enter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&#x27;my&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-if</span>=<span class="string">&#x27;flag&#x27;</span>&gt;</span>有些同学的心已经到家了<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">flag</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用第三方库实现动画</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;flag = !flag&#x27;</span>&gt;</span>Toggle<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用 :duration=&quot;毫秒值&quot; 来统一设置 入场 和 离场 时候的动画时长 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">enter-active-class</span>=<span class="string">&quot;animate__bounce&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">leave-active-class</span>=<span class="string">&quot;animate__wobble&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">class</span>=<span class="string">&quot;animate__animated&quot;</span>&gt;</span>鲜衣怒马少年时 一日看尽长安花<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">flag</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实现小球半场动画</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.ball</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;flag = !flag&#x27;</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transition</span> </span></span><br><span class="line"><span class="tag">            @<span class="attr">before-enter</span>=<span class="string">&quot;beforeEnter&quot;</span> </span></span><br><span class="line"><span class="tag">            @<span class="attr">enter</span>=<span class="string">&quot;enter&quot;</span> </span></span><br><span class="line"><span class="tag">            @<span class="attr">after-enter</span>=<span class="string">&quot;afterEnter&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">enter-cancelled</span>=<span class="string">&quot;enterCancelled&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ball&quot;</span> <span class="attr">v-if</span>=<span class="string">&#x27;flag&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">flag</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 注意： 动画钩子函数的第一个参数：el，表示 要执行动画的那个DOM元素，是个原生的 JS DOM对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 大家可以认为 ， el 是通过 document.getElementById(&#x27;&#x27;) 方式获取到的原生JS DOM对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">beforeEnter</span>(<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// beforeEnter 表示动画入场之前，此时，动画尚未开始，可以 在 beforeEnter 中，设置元素开始动画之前的起始样式</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 设置小球开始动画之前的，起始位置</span></span></span><br><span class="line"><span class="language-javascript">                    el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    el.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translate(0, 0)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">enter</span>(<span class="params">el, done</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 这句话，没有实际的作用，但是，如果不写，出不来动画效果；</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 可以认为 el.offsetWidth 会强制动画刷新</span></span></span><br><span class="line"><span class="language-javascript">                    el.<span class="property">offsetTop</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// enter 表示动画 开始之后的样式，这里，可以设置小球完成动画之后的，结束状态</span></span></span><br><span class="line"><span class="language-javascript">                    el.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translate(150px, 350px)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    el.<span class="property">style</span>.<span class="property">transition</span> = <span class="string">&#x27;all 2s ease&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 这里的 done， 其实就是 afterEnter 这个函数，也就是说：done 是 afterEnter 函数的引用</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">done</span>()</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">afterEnter</span>(<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 动画完成之后，会调用 afterEnter</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">flag</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">enterCancelled</span>(<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>列表案例</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        * &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#app</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">list-style</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding-left</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-enter</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-leave-to</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">150px</span>);</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-enter-active</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: all .<span class="number">5s</span> ease</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-move</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: all .<span class="number">5s</span> ease</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.v-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            Id:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;id&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;id&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">            Name:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">v-model</span>=<span class="string">&#x27;name&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;add&#x27;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 在实现列表过渡的时候，如果需要过渡的元素，是通过 v-for 循环渲染出来的，不能使用 transition 包裹，需要使用 transitionGroup --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 给 transition-group 添加 appear 属性，实现页面刚展示出来时候，入场时候的效果 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 通过 为 transition-group 元素，设置 tag 属性，指定 transition-group 渲染为指定的元素，如果不指定 tag 属性，默认，渲染为 span 标签 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transition-group</span> <span class="attr">tag</span>=<span class="string">&quot;ul&quot;</span> <span class="attr">appear</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&#x27;(item, index) in nameList&#x27;</span> <span class="attr">:key</span>=<span class="string">&#x27;item.id&#x27;</span>&gt;</span>&#123;&#123;item.name&#125;&#125; ------------ <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span></span></span><br><span class="line"><span class="tag">                        @<span class="attr">click</span>=<span class="string">del(index)</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">transition-group</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">nameList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;路飞&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;鸣人&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;犬夜叉&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;悟空&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">nameList</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>: <span class="variable language_">this</span>.<span class="property">id</span>, <span class="attr">name</span>: <span class="variable language_">this</span>.<span class="property">name</span> &#125;)</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">del</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">nameList</span>.<span class="title function_">splice</span>(id, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="vue响应式原理">vue响应式原理</h5>
<h6 id="高阶函数-AOP思想">高阶函数&amp;AOP思想</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 高阶函数</span></span><br><span class="line"><span class="comment">// 1、函数当作参数传递 这个函数就叫高阶函数 回调函数就是高阶函数</span></span><br><span class="line"><span class="comment">// 2、函数当作返回值返回</span></span><br><span class="line"><span class="comment">// 假设现在公司有一个业务say需要拓展 而这个业务在很多地方都已经被引用到了 </span></span><br><span class="line"><span class="comment">// 所以如果直接修改该业务 就会导致引用的地方受到影响</span></span><br><span class="line"><span class="comment">// 我们就需要保证在不破坏业务的情况下 进行拓展 =&gt; AOP</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">say</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say&#x27;</span> + <span class="string">&#x27; &#x27;</span> + a + <span class="string">&#x27; &#x27;</span> + b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">before</span> = <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(this); // 指向say</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...<span class="variable language_">arguments</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行自己的业务逻辑</span></span><br><span class="line">    <span class="title function_">callback</span>()</span><br><span class="line">    <span class="comment">// 执行say方法本身的业务逻辑</span></span><br><span class="line">    <span class="comment">// console.log(this); // 箭头函数往上找 =&gt; say</span></span><br><span class="line">    <span class="comment">// say(&#x27;hello&#x27;, &#x27;world&#x27;)</span></span><br><span class="line">    <span class="title function_">this</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> beforeSay = say.<span class="title function_">before</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 这里写的是我们自己的业务逻辑</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before say&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">beforeSay</span>(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;world&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h6 id="vue2响应式原理">vue2响应式原理</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue2.x 双向数据绑定原理是通过Objcet.defineProperty来实现的</span></span><br><span class="line"><span class="comment">// 这种方式有缺点: 数组的长度 数组的内容发生变化检测不到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">phone</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;iphone&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// let obj = [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment">// 视图更新的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;视图更新了 ~&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> methods = [<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;reverse&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>]</span><br><span class="line"><span class="comment">// 将数组的原型保存一份</span></span><br><span class="line"><span class="keyword">let</span> arrProto = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="comment">// 创建原型 将数组原型拷贝一份</span></span><br><span class="line"><span class="keyword">let</span> proto = <span class="title class_">Object</span>.<span class="title function_">create</span>(arrProto)</span><br><span class="line"><span class="comment">// 重写数组的方法</span></span><br><span class="line">methods.<span class="title function_">forEach</span>(<span class="function"><span class="params">method</span> =&gt;</span> &#123;</span><br><span class="line">  proto[method] = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// AOP 面向切面编程</span></span><br><span class="line">    <span class="comment">// 改变了数组的数据</span></span><br><span class="line">    arrProto[method].<span class="title function_">call</span>(<span class="variable language_">this</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">    <span class="comment">// 重新渲染视图</span></span><br><span class="line">    <span class="title function_">render</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者模式 </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="comment">// 判断一个对象是不是数组</span></span><br><span class="line">  <span class="comment">// if(Object.prototype.toString.call(obj) === &#x27;[object Array]&#x27;)&#123;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj)) &#123;</span><br><span class="line">    <span class="comment">// 让观测的对象的原型和我们自己重写的原型建立关系</span></span><br><span class="line">    obj.<span class="property">__proto__</span> = proto</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果观察的是一个对象的话 对其属性进行响应式监听(set、get)</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj) === <span class="string">&#x27;[object Object]&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 取出对象中的每一个键和值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="comment">// 调用响应式处理函数</span></span><br><span class="line">      <span class="title function_">defineReactive</span>(obj, key, obj[key])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 观察obj对象</span></span><br><span class="line"><span class="title function_">observe</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应式处理</span></span><br><span class="line"><span class="comment">// Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">obj, key, val</span>) &#123;</span><br><span class="line">  <span class="comment">// 检测对象的属性值是否还是对象</span></span><br><span class="line">  <span class="title function_">observe</span>(val)</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="comment">// 获取</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> val</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 设置</span></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;</span><br><span class="line">      <span class="comment">// 检测设置的值是不是对象</span></span><br><span class="line">      <span class="title function_">observe</span>(newVal)</span><br><span class="line">      <span class="comment">// 新值和旧值不相等的时候</span></span><br><span class="line">      <span class="keyword">if</span> (newVal !== val) &#123;</span><br><span class="line">        <span class="comment">// 覆盖掉原来的val值</span></span><br><span class="line">        val = newVal</span><br><span class="line">        <span class="comment">// 通知render函数重新渲染视图</span></span><br><span class="line">        <span class="title function_">render</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.name = &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">// obj.age = 20</span></span><br><span class="line"><span class="comment">// console.log(obj.name, obj.age);</span></span><br><span class="line"><span class="comment">// 至此 基本可以实现数据发生变化 视图更新的效果</span></span><br><span class="line"><span class="comment">// 但是 如果数据有多层呢 也就是属性对应的值也是对象?</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;huawei&#x27;</span></span><br><span class="line"><span class="comment">// console.log(obj.phone.name);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改的值和原来的值一样 不需要重新渲染视图</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;iphone&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果重新为对象obj的phone赋值一个新的对象呢? 视图要重新渲染</span></span><br><span class="line"><span class="comment">// obj.phone = &#123;name: &#x27;huawei&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 并且当修改新的对象的属性值时 视图也要重新渲染</span></span><br><span class="line"><span class="comment">// obj.phone.name = &#x27;zs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为对象新增属性值呢? 也是没有办法监测到的</span></span><br><span class="line"><span class="comment">// obj.sex = &#x27;man&#x27;</span></span><br><span class="line"><span class="comment">// $set来解决这个</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$myset</span>(<span class="params">obj, key, val</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj))&#123;</span><br><span class="line">    <span class="keyword">return</span> obj.<span class="title function_">splice</span>(key, val)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">defineReactive</span>(obj, key, val)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $myset(obj, &#x27;sex&#x27;, &#x27;man&#x27;)</span></span><br><span class="line"><span class="comment">// 修改新增的属性值 视图也能更新</span></span><br><span class="line"><span class="comment">// obj.sex = &#x27;woman&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.phone = Object.assign(obj.phone, &#123;price: &#x27;666&#x27;&#125;)</span></span><br><span class="line"><span class="comment">// obj.phone.price = 888</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.phone = &#123;...obj.phone, ...&#123;price: &#x27;666&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">// obj.phone.price = &#x27;888&#x27;</span></span><br><span class="line"><span class="comment">// 以后vue涉及到给data中的对象新增属性时 有三种方式</span></span><br><span class="line"><span class="comment">// 1、this.$set() || Vue.set()</span></span><br><span class="line"><span class="comment">// 2、obj = Object.assign(原对象, 新对象(新增的属性:值))</span></span><br><span class="line"><span class="comment">// 2、obj = &#123;...原对象, ...新对象(新增的属性:值)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// =================== 数组 ======================</span></span><br><span class="line"><span class="comment">// 数组的响应式数据处理依赖的并不是Object.defineProperty 而是对数组的能够引起数据变化的方法进行重写</span></span><br><span class="line"><span class="comment">// obj.push(6)</span></span><br><span class="line"><span class="comment">// obj.length ++ </span></span><br><span class="line"><span class="comment">// obj[0] = 88</span></span><br><span class="line"><span class="comment">// $myset(obj, &#x27;0&#x27;, 66)</span></span><br></pre></td></tr></table></figure>
<h6 id="vue3响应式原理">vue3响应式原理</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue3双向数据绑定原理利用了es6提供的proxy Api</span></span><br><span class="line"><span class="comment">// 可以直接监听到对象和数组内容及长度的变化</span></span><br><span class="line"><span class="comment">// 缺点: 兼容性差 支持就用proxy 不支持就用Objcet.defineProperty</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">grilFriend</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;刘亦菲&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;视图重新渲染 ~&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="comment">// Reflect.get(target, propertyKey[, receiver])</span></span><br><span class="line">    <span class="comment">// 获取对象身上某个属性的值，类似于 target[name]。</span></span><br><span class="line">    <span class="comment">// 如果属性的值是一个对象的话 则重新进行代理 设置set&amp;get</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> target[key] == <span class="string">&#x27;object&#x27;</span> &amp;&amp; target[key] != <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(target[key], handler)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">target, key, val</span>) &#123;</span><br><span class="line">    <span class="comment">// if(target[key] == &#x27;length&#x27;) return true</span></span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, val)</span><br><span class="line">    <span class="title function_">render</span>()</span><br><span class="line">    <span class="comment">// return true表示赋值成功 如果不返回true 在严格模式下可能会报TypeError</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, handler)</span><br><span class="line"><span class="comment">// 使用代理后的对象</span></span><br><span class="line"><span class="comment">// console.log(proxy.name);</span></span><br><span class="line"><span class="comment">// console.log(proxy.grilFriend);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// proxy.name = &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">// 修改深层次的对象的属性 无法监听到</span></span><br><span class="line"><span class="comment">// proxy.grilFriend.name = &#x27;黄圣依&#x27;</span></span><br><span class="line"><span class="comment">// console.log(proxy.name);</span></span><br><span class="line"><span class="comment">// console.log(proxy.grilFriend);</span></span><br><span class="line"><span class="comment">// console.log(obj.name);</span></span><br><span class="line"><span class="comment">// console.log(obj.grilFriend);</span></span><br><span class="line"></span><br><span class="line">proxy.<span class="property">arr</span>[<span class="number">0</span>] = <span class="string">&#x27;11&#x27;</span></span><br><span class="line">proxy.<span class="property">arr</span>.<span class="property">length</span> ++</span><br><span class="line"><span class="comment">// console.log(proxy.arr.length);</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">arr</span>.<span class="property">length</span>);</span><br></pre></td></tr></table></figure>
<h5 id="ref-refs">ref &amp; $refs</h5>
<p>1、作用：给元素或者子组件注册引用信息（相当于id, 值得注意的是引用信息注册在父组件的<code>$refs</code>对象上, <code>$refs</code>只在组件渲染完成后才填充）<br>
1、html标签上获取dom元素 || 组件标签上获取组件实例对象<br>
2、从而能获取子组件中的data &amp;&amp; 调用子组件中的方法传递数据<br>
注意：<br>
1、这里我们只能取到组件的值或调用方法，不可以通过这个方法改变组件的相关属性值。<br>
2、因为ref本身是作为渲染结果被创建的，在初始渲染的时候你不能访问它们 - 它们还不存在！$refs也不是响应式的，因此不可以用它在模板中做数据绑定。</p>
<p>可实现父传子</p>
<h5 id="scoped">scoped</h5>
<p>1、给HTML的DOM节点加一个不重复data属性(形如：data-v-19fca230)来表示他的唯一性<br>
2、在每句css选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如[data-v-19fca230]）来私有化样式<br>
3、如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性</p>
<p>注意: scoped的作用域，因为权重的问题，如果是在子组件使用了scoped，那么在父组件中是不能直接修改子组件的样式的，需要在父组件中使用vue的深度作用选择器。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sass和less的样式穿透 使用 /deep/</span><br><span class="line">外层 /deep/ 第三方组件 &#123;</span><br><span class="line">    样式</span><br><span class="line">&#125;</span><br><span class="line">注意: 如果报错 SassError: expected selector 则将/deep/替换为::deep</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stylus的样式穿透 使用 &gt;&gt;&gt;</span><br><span class="line">外层 &gt;&gt;&gt; 第三方组件</span><br><span class="line"> 样式</span><br></pre></td></tr></table></figure>
<h5 id="props-父传子">props (父传子)</h5>
<p>父组件要正向地向子组件传递数据或参数，子组件收到后，根据传递过来的数据不同，渲染不同的页面内容，或者执行操作。<br>
这个正向传递数据的过程是通过props来实现的。子组件使用props来声明需要从父组件接受的数据。</p>
<p>注意:<br>
1、所有的 prop 都使得其父子 prop 之间形成了一个单向下行绑定：父级 prop 的更新会向下流动到子组件中，但是反过来则不行。这样会防止从子组件意外变更父级组件的状态，从而导致你的应用的数据流向难以理解。<br>
2、每次父级组件发生变更时，子组件中所有的 prop 都将会刷新为最新的值。这意味着你不应该在一个子组件内部改变 prop。如果你这样做了，Vue 会在浏览器的控制台中发出警告。</p>
<p><strong>两种常见的试图变更一个 prop 的情形</strong><br>
1、这个 prop 用来传递一个初始值 这个子组件接下来希望将其作为一个本地的 prop 数据来使用。在这种情况下，最好定义一个本地的 data property 并将这个 prop 用作其初始值<br>
2、这个 prop 以一种原始的值传入且需要进行转换。在这种情况下，最好使用这个 prop 的值来定义一个计算属性</p>
<p><a href="https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E9%AA%8C%E8%AF%81">props验证</a></p>
<h5 id="nextTick">$nextTick</h5>
<p>作用: 当我们修改 Vue 组件中的数据时，Vue.js 会在下次事件循环前自动更新视图，并异步执行 $nextTick() 中的回调函数。这个过程可以确保 DOM 已经被更新，以及可以操作到最新的 DOM。</p>
<p>Vue 是异步执行 DOM 更新的，简单来说，Vue 实现响应式并不是数据发生变化之后 DOM 立即变化，而是按一定的策略进行 DOM 的更新。Vue 会将修改的数据记录下来，并在下一次事件循环时才更新视图。 $nextTick() 方法则是用于等待这个事件循环结束后再执行回调函数。这样可以确保我们操作 DOM 的时候，DOM 已经被 Vue 更新过了。</p>
<h5 id="mixin">mixin</h5>
<p>Vue.mixin给我们提供了一种混入Vue实例的方法，创建了混入对象之后，我们自定义的方法或者变量可以很轻松的挂载在Vue实例上，给我们带来方便</p>
<p>Vue.mixin为我们提供了两种混入方式：局部混入和全局混入<br>
局部混入：<br>
顾名思义就是部分混入，也就是只有引入了mixin的混入对象才可以使用，并且只有在引入了mixin混入对象的组件中才生效</p>
<p>全局混入：<br>
全局混入我们只需要把mixin.js引入到main.js中，然后将mixin放入到Vue.mixin()方法中即可；<br>
全局混入更为便捷，我们将不用在子组件声明，全局混入将会影响每一个组件的实例，使用的时候需要小心谨慎；这样全局混入之后，我们可以直接在组件中通过this.变量/方法来调用mixin混入对象的变量/方法；</p>
<p>mixin可以定义公用的变量或方法，但是mixin中的数据是不共享的，也就是每个组件中的mixin实例都是不一样的，都是单独存在的个体，不存在相互影响的；</p>
<h6 id="mixin合并策略">mixin合并策略</h6>
<p>1、data<br>
mixins中的data会合并到data中，有冲突的话，data中数据覆盖mixins中的数据。</p>
<p>2、methods、components 和 directives<br>
methods、components 和 directives会执行，但有冲突时，组件中的methods、components 和 directives会覆盖 mixins 中的methods、components 和 directives。</p>
<p>3、特殊的钩子函数（生命周期）</p>
<p>组件和mixin的生命周期都要执行，但是mixin的生命周期优先于组件生命周期执行<br>
mixin beforeCreate -&gt; component beforeCreate -&gt; mixin created -&gt; component created</p>
<h5 id="plugins-2">plugins</h5>
<p>详情参见：<a href="https://cn.vuejs.org/v2/guide/plugins.html">https://cn.vuejs.org/v2/guide/plugins.html</a></p>
<h5 id="动态组件">动态组件</h5>
<p>什么是动态组件？</p>
<p><strong>动态组件指的是动态切换组件的显示与隐藏</strong></p>
<p>如何实现？</p>
<p>vue提供了一个内置的组件，专门用来实现动态组件的渲染</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;button @click=<span class="string">&quot;comName=&#x27;MyLeft&#x27;&quot;</span>&gt;显示<span class="title class_">Left</span>组件&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;comName=&#x27;MyRight&#x27;&quot;</span>&gt;</span>显示Right组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">MyLeft</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Left.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">MyRight</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Right.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 组件的交互</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">comName</span>: <span class="string">&#x27;MyLeft&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">MyLeft</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">MyRight</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="keep-alive">keep-alive</h6>
<p>默认情况下，切换动态组件时无法保持组件的状态。此时可以使用 vue 内置的  组件保持动态组件的状态。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&#x27;组件名&#x27;</span> <span class="attr">exclude</span>=<span class="string">&#x27;组件名&#x27;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>keep-alive 对应的生命周期函数</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;left组件被创建了&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">destroyed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;left组件被销毁了&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">deactivated</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件被缓存了&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">activated</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件被激活了&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>keep-alive 的 include 属性</strong></p>
<p>include 属性用来指定：只有名称匹配的组件会被缓存。多个组件名之间使用英文的逗号分隔</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;right&quot;</span> <span class="attr">exclude</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="递归组件">递归组件</h5>
<p>组件递归调用组件自身就称为递归组件，调用的前提是组件需要有name属性</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">App.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 组件的结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DiGui</span> <span class="attr">:list</span>=<span class="string">&#x27;list&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">DiGui</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">DiGui</span> <span class="keyword">from</span> <span class="string">&quot;./components/DiGui.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 组件的交互</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">name</span>: <span class="string">&quot;董老师: 可爱的小老头儿&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">id</span>: <span class="string">&quot;2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">name</span>: <span class="string">&quot;js&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;3&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;dom&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;4&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;bom&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              ],</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">id</span>: <span class="string">&quot;5&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">name</span>: <span class="string">&quot;jQ&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;jsonp&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              ],</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          ],</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">id</span>: <span class="string">&quot;6&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">name</span>: <span class="string">&quot;武老师: 坏坏的大胖子&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">id</span>: <span class="string">&quot;7&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">name</span>: <span class="string">&quot;html&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;8&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;float&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;9&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;position&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              ],</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          ],</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">id</span>: <span class="string">&quot;10&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">name</span>: <span class="string">&quot;老许: 一表人才两袖清风三尺讲台四季耕耘五天忙碌六七不休八思九想十分用心&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">id</span>: <span class="string">&quot;11&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">name</span>: <span class="string">&quot;vue&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">list</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;12&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;生命周期&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">id</span>: <span class="string">&quot;13&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  <span class="attr">name</span>: <span class="string">&quot;vue指令&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">              ],</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">          ],</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      ],</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">DiGui</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">DiGui.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;[&#x27;item&#x27;, &#123;ext: item.list &amp;&amp; extArr.indexOf(item.id)!=-1&#125;]&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&#x27;item.id&#x27;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">&#x27;item.list&amp;&amp;extArr.indexOf(item.id)!=-1&#x27;</span> @<span class="attr">click</span>=<span class="string">&#x27;change(item.id)&#x27;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-else-if</span>=<span class="string">&#x27;item.list&#x27;</span> @<span class="attr">click</span>=<span class="string">&#x27;change(item.id)&#x27;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;input type=&quot;checkbox&quot;&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">DiGui</span> <span class="attr">:list</span>=<span class="string">&#x27;item.list&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">DiGui</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- &lt;div v-for=&#x27;(item2, index) in item1.list&#x27; :key=&#x27;index&#x27;&gt;</span></span><br><span class="line"><span class="comment">        &lt;span&gt;&#123;&#123;item2.name&#125;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="comment">      &lt;/div&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&quot;DiGui&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: [<span class="string">&quot;list&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">extArr</span>: [],</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">change</span>(<span class="params">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">extArr</span>.<span class="title function_">indexOf</span>(id);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 不存在</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">extArr</span>.<span class="title function_">push</span>(id);</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">extArr</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">extArr</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> &gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.ext</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220818223322981.png" alt=""></p>
<h5 id="devServer代理跨域">devServer代理跨域</h5>
<h6 id="vue-config-js配置">vue.config.js配置</h6>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, dir);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">chainWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        config.<span class="property">resolve</span>.<span class="property">alias</span></span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&quot;@&quot;</span>, <span class="title function_">resolve</span>(<span class="string">&quot;src&quot;</span>))</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&quot;assets&quot;</span>, <span class="title function_">resolve</span>(<span class="string">&quot;src/assets&quot;</span>))</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&quot;components&quot;</span>, <span class="title function_">resolve</span>(<span class="string">&quot;src/components&quot;</span>))</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&quot;base&quot;</span>, <span class="title function_">resolve</span>(<span class="string">&quot;baseConfig&quot;</span>))</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&quot;public&quot;</span>, <span class="title function_">resolve</span>(<span class="string">&quot;public&quot;</span>));</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">pages</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: &#123;</span><br><span class="line">            <span class="comment">// page 的入口</span></span><br><span class="line">            <span class="attr">entry</span>: <span class="string">&#x27;src/index.js&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 关闭eslint语法校验</span></span><br><span class="line">    <span class="attr">lintOnSave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="comment">// 代理的方式配置跨域</span></span><br><span class="line">        <span class="comment">// 缺点: </span></span><br><span class="line">        <span class="comment">// 1、会先从本地public下查找有没有对应接口的文件 如果有 先返回本地的文件数据 没有再去发起请求访问服务器的数据 (优先匹配前端资源)</span></span><br><span class="line">        <span class="comment">// 2、没法配置多个代理</span></span><br><span class="line">        <span class="comment">// proxy: &#x27;http://localhost:3000/&#x27;,</span></span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="comment">// 正则匹配所有以&#x27;/api&#x27;开头的请求路径</span></span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// http://localhost:8080/api/teachers</span></span><br><span class="line">                <span class="comment">// http://localhost:3000/teachers</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// target: 代理目标的基础路径</span></span><br><span class="line">                <span class="comment">// http://localhost:8080/teachers</span></span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://localhost:3000/&#x27;</span>,</span><br><span class="line">                <span class="comment">// 路径重写</span></span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// ws：websocket</span></span><br><span class="line">                <span class="comment">// ws: true,</span></span><br><span class="line">                <span class="comment">// 改变源, 也就是控制host</span></span><br><span class="line">                <span class="comment">// changeOrigin: true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;/v1&#x27;</span>: &#123;</span><br><span class="line">                <span class="comment">// target: 代理目标的基础路径</span></span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;http://localhost:3001&#x27;</span>,</span><br><span class="line">                <span class="comment">// 路径重写</span></span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;^/v1&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="发起请求">发起请求</h6>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 组件的结构 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;getData&#x27;</span>&gt;</span>发送请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;getCars&#x27;</span>&gt;</span>发送请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 组件的交互</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://localhost:8080/teachers&#x27;</span>).<span class="title function_">then</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="function">(<span class="params">resonpse</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> &#123; data &#125; = resonpse</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求失败, 原因:&#x27;</span> + err)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">getCars</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;http://localhost:8080/v1/cars&#x27;</span>).<span class="title function_">then</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="function">(<span class="params">resonpse</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> &#123; data &#125; = resonpse</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求失败, 原因:&#x27;</span> + err)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="服务端">服务端</h6>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello, 我是server1&#x27;</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求来自于&#x27;</span>,request.<span class="title function_">get</span>(<span class="string">&#x27;Host&#x27;</span>));</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求的地址&#x27;</span>,request.<span class="property">url</span>);</span><br><span class="line">	<span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/teachers&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> teachers = [</span><br><span class="line">		&#123; <span class="attr">id</span>: <span class="string">&#x27;001&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;laoxu&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">id</span>: <span class="string">&#x27;002&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;laoliu&#x27;</span>, <span class="attr">age</span>: <span class="number">26</span> &#125;,</span><br><span class="line">		&#123; <span class="attr">id</span>: <span class="string">&#x27;003&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;laosong&#x27;</span>, <span class="attr">age</span>: <span class="number">22</span> &#125;,</span><br><span class="line">	]</span><br><span class="line">	response.<span class="title function_">send</span>(teachers)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (!err) <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://localhost:3000/teachers =&gt; server1已启动&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="slot-插槽">slot 插槽</h5>
<p>概念：插槽就是子组件中的提供给父组件使用的一个占位符，用slot表示，父组件可以在这个占位符中填充任何模板代码，如 HTML、组件等，填充的内容会替换子组件的slot标签。简单理解就是子组件中留下个 “坑” ，父组件可以使用指定内容来补“坑”。</p>
<p><img data-src="image-20220806221424270.png" alt="image-20220806221424270"></p>
<p>分类：匿名插槽，具名插槽， 作用域插槽</p>
<p>匿名插槽：不带有name属性的普通插槽就是匿名插槽</p>
<p>具名插槽：带有name属性的插槽就是具名插槽</p>
<p>作用域插槽：为预留的 <slot> 插槽绑定props 数据，这种带有props 数据的 <slot> 叫做 &quot; 作用域插槽 &quot;。</p>
<p>匿名插槽</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">A组件</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        vue官方规定:每一个slot插槽,都要有一个 name 名称</span><br><span class="line">        一个不带 name 的 <span class="tag">&lt;<span class="name">slot</span>&gt;</span> 出口会带有隐含的名字 &quot;default&quot;</span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;default&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">B组件</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">A</span>&gt;</span></span><br><span class="line">            1、v-slot: 后面跟上插槽的名字</span><br><span class="line">            2、v-slot 作用在template标签或者组件上</span><br><span class="line">            3、v-slot简写: #</span><br><span class="line">            4、template是一个虚拟标签 只起到包裹性质的作用 不会被渲染为任何实质性的html元素</span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是匿名插槽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是匿名插槽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是匿名插槽<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">A</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> A <span class="keyword">from</span> <span class="string">&#x27;./A.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>:&#123; A &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>具名插槽</p>
<p>有时候，也许子组件内的slot不止一个，那么我们如何在父组件中，精确的在想要的位置，插入对应的内容呢？ 给插槽命一个名即可，即添加name属性。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">A组件</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;one&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;two&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">B组件</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">A</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:one</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是具名插槽one<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:two</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>我是具名插槽two<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">A</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> A <span class="keyword">from</span> <span class="string">&#x27;./A.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>:&#123; A &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>作用域插槽</p>
<p>通过slot 我们可以在父组件为子组件自定义内容（匿名插槽），通过给slot命名的方式，我们可以添加不止一个位置的内容（具名插槽）。但是我们添加的数据都是父组件内的。上面我们说过不能直接使用子组件内的数据，但是我们是否有其他的方法，让我们能够使用子组件的数据呢？ 其实我们也可以使用v-slot的方式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//子组件 ： (假设名为：ebutton)</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;app&#x27;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      // 绑定child1的数据</span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>= <span class="string">&#x27;one&#x27;</span> <span class="attr">:value1</span>=<span class="string">&#x27;child1&#x27;</span>&gt;</span> 这就是默认值1<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">      // 绑定child2的数据，这里我没有命名slot</span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:value2</span>=<span class="string">&#x27;child2&#x27;</span>&gt;</span> 这就是默认值2 <span class="tag">&lt;/<span class="name">slot</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>           </span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el:&#x27;.app&#x27;,</span><br><span class="line">  data:&#123;</span><br><span class="line">    child1:&#x27;数据1&#x27;,</span><br><span class="line">    child2:&#x27;数据2&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//父组件：（引用子组件 ebutton）</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>= <span class="string">&#x27;app&#x27;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">ebutton</span>&gt;</span> </span><br><span class="line">        // 通过v-slot的语法 将插槽 one 的值赋值给slotonevalue </span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:one</span> = <span class="string">&#x27;slotonevalue&#x27;</span>&gt;</span>  </span><br><span class="line">           &#123;&#123; slotonevalue.value1 &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        // 同上，由于子组件没有给slot命名，默认值就为default</span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span> = <span class="string">&#x27;slottwovalue&#x27;</span>&gt;</span> </span><br><span class="line">           &#123;&#123; slottwovalue.value2 &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ebutton</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>总结来说就是：</p>
<ul>
<li>首先在子组件的slot上动态绑定一个值( :key=‘value’)</li>
<li>然后在父组件通过v-slot : name = 'values’的方式将这个值赋值给 values</li>
<li>最后通过的方式获取数据</li>
</ul>
<h4 id="路由-3">路由</h4>
<h5 id="SPA应用">SPA应用</h5>
<ol>
<li>单页 Web 应用（single page web application，SPA）</li>
<li>整个应用只有一个完整的页面。</li>
<li>点击页面中的导航链接不会刷新页面，只会做页面的局部更新。</li>
</ol>
<p>总结：SPA 指的是一个 web 网站只有唯一的一个 HTML 页面，所有组件的展示与切换都在这唯一的一个页面内完成。 此时，不同组件之间的切换需要通过前端路由来实现。</p>
<h5 id="什么是路由？">什么是路由？</h5>
<ol>
<li>一个路由就是一组映射关系（key - value）</li>
<li>key 为路径, value 可能是 function 或 component</li>
</ol>
<p><strong>路由分为前端路由和后端路由</strong></p>
<h5 id="什么是后端路由？">什么是后端路由？</h5>
<p>理解：value 是 function，用于处理客户端提交的请求。</p>
<p>工作过程：服务器接收到一个请求时，根据请求路径找到匹配的函数来处理请求，返回响应数据。</p>
<h5 id="什么是前端路由？">什么是前端路由？</h5>
<p>理解：value 是 component，用于展示页面内容</p>
<p>工作过程：当浏览器的路径改变时, 对应的组件就会显示。</p>
<p>大白话：url地址与组件之间的对应关系。</p>
<p>前端路由的工作方式</p>
<p>① 用户点击了页面上的路由链接</p>
<p>② 导致了 URL 地址栏中的 Hash 值发生了变化</p>
<p>③ 前端路由监听了到 Hash 地址的变化</p>
<p>④ 前端路由把当前 Hash 地址对应的组件渲染都浏览器中</p>
<p><img data-src="image-20220807162559080.png" alt=""></p>
<h5 id="实现简易的前端路由">实现简易的前端路由</h5>
<p>通过component标签，结合 is属性 动态渲染组件</p>
<p><img data-src="image-20220807164044643.png" alt=""></p>
<p>Home组件、Movie组件、About组件 ( 稍作修改 )</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;movie-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Movie 组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Movie&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.movie-container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">min-height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: lightsalmon;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Tab1、Tab2组件（ 稍作修改 ）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab1-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h5</span>&gt;</span>Tab1 组件<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Tab1&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.tab1-container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">min-height</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: greenyellow;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>App组件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>App 根组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/home&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/movie&quot;</span>&gt;</span>电影<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/about&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;comName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入组件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Home.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Movie</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/Movie.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/About.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注册组件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Home</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Movie</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">About</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">comName</span>: <span class="string">&#x27;Home&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 在mounted生命周期中监听hash的变化</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onhashchange</span> = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span> (location.<span class="property">hash</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;#/movie&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">comName</span> = <span class="string">&#x27;Movie&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;#/home&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">comName</span> = <span class="string">&#x27;Home&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;#/about&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">comName</span> = <span class="string">&#x27;About&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">comName</span> = <span class="string">&#x27;Home&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.app-container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#efefef</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">  &gt; <span class="selector-tag">a</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="vue-router">vue-router</h5>
<p>vue 的一个插件库，是 vue.js 官方给出的路由解决方案。它只能结合 vue 项目进行使用，能够轻松的管理 SPA 项目 中组件的切换。</p>
<h6 id="基本使用">基本使用</h6>
<ol>
<li>安装vue-router，命令：<code>npm i vue-router@3</code></li>
<li>引入插件: <code>import VueRouter form 'vue-router'</code></li>
<li>应用插件：<code>Vue.use(VueRouter)</code></li>
<li>编写router配置项：</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//引入VueRouter</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">//引入Vue</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">//使用vueRouter</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"><span class="comment">//引入路由组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;../components/About&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Home&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建router实例对象，去管理一组一组的路由规则</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">	<span class="attr">routes</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">path</span>:<span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">			<span class="attr">component</span>:<span class="title class_">About</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">			<span class="attr">component</span>:<span class="title class_">Home</span></span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露router</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"><span class="comment">//main.js中引入挂载router</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>实现切换（active-class可配置高亮样式）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;router-link active-class=&quot;active&quot; to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>指定展示位置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;router-view&gt;&lt;/router-view&gt;</span><br></pre></td></tr></table></figure>
<h6 id="几个注意点">几个注意点</h6>
<ol>
<li>
<p>路由组件通常存放在<code>pages</code>或者<code>view</code>文件夹，一般组件(可复用)通常存放在<code>components</code>文件夹。</p>
</li>
<li>
<p>通过切换，“隐藏”了的路由组件，默认是被销毁掉的，需要的时候再去挂载（keep-alive）。</p>
</li>
<li>
<p>每个组件都有自己的<code>$route</code>属性，里面存储着自己的路由信息。</p>
</li>
<li>
<p>整个应用只有一个router，可以通过组件的<code>$router</code>属性获取到。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">router : 是路由操作对象，只写对象</span><br><span class="line">route : 路由信息对象，只读对象</span><br><span class="line"></span><br><span class="line">// 操作 路由跳转</span><br><span class="line">this.$router.push(&#123;</span><br><span class="line">      name:&#x27;hello&#x27;,</span><br><span class="line">      params:&#123;</span><br><span class="line">          name:&#x27;word&#x27;,</span><br><span class="line">          age:&#x27;11&#x27;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 读取 路由参数接收</span><br><span class="line">this.name = this.route.params.name;</span><br><span class="line">this.age = this.route.params.age;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="嵌套路由（多级路由）">嵌套路由（多级路由）</h6>
<p>缺图 ~</p>
<ol>
<li>
<p>配置路由规则，使用children配置项：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">routes</span>:[</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">path</span>:<span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">		<span class="attr">component</span>:<span class="title class_">About</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">		<span class="attr">component</span>:<span class="title class_">Home</span>,</span><br><span class="line">		<span class="attr">children</span>:[ <span class="comment">//通过children配置子级路由</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">path</span>:<span class="string">&#x27;news&#x27;</span>, <span class="comment">//此处一定不要写：/news</span></span><br><span class="line">				<span class="attr">component</span>:<span class="title class_">News</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">path</span>:<span class="string">&#x27;message&#x27;</span>,<span class="comment">//此处一定不要写：/message</span></span><br><span class="line">				<span class="attr">component</span>:<span class="title class_">Message</span></span><br><span class="line">			&#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">                <span class="comment">// 路由懒加载写法</span></span><br><span class="line">                <span class="attr">component</span>:<span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="comment">/*webpackChunkName*:&#x27;user&#x27;/, User)</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">		]</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">]</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>跳转（要写完整路径）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;router-link to=&quot;/home/news&quot;&gt;News&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="路由懒加载">路由懒加载</h6>
<p>懒加载简单来说就是延迟加载或按需加载，就是用到的时候再进行加载。</p>
<p>作用: 首屏组件加载速度更快一些，解决白屏问题；更好的客户体验；也是性能优化的一种方式；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    <span class="comment">// 首屏没有做路由懒加载</span></span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/center&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="comment">// 路由懒加载: 懒加载简单来说就是延迟加载或按需加载，就是用到的时候再进行加载。</span></span><br><span class="line">    <span class="comment">// 作用: 首屏组件加载速度更快一些，解决白屏问题；更好的客户体验；</span></span><br><span class="line">    <span class="comment">// 也是性能优化的一种方式；</span></span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;center&quot; */</span> <span class="string">&#x27;../views/Center.vue&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">()=&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;../views/Search.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="路由的query参数">路由的query参数</h6>
<ol>
<li>
<p>传递参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 跳转并携带query参数，to的字符串写法 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;/home/message/detail?id=666&amp;title=你好&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line">				</span><br><span class="line">&lt;!-- 跳转并携带query参数，to的对象写法 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">	:to=&quot;&#123;</span><br><span class="line">		path:&#x27;/home/message/detail&#x27;,</span><br><span class="line">		query:&#123;</span><br><span class="line">		   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>接收参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$route.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line">$route.<span class="property">query</span>.<span class="property">title</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="命名路由">命名路由</h6>
<ol>
<li>
<p>作用：可以简化路由的跳转。</p>
</li>
<li>
<p>如何使用</p>
<p>给路由命名：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">path</span>:<span class="string">&#x27;/demo&#x27;</span>,</span><br><span class="line">	<span class="attr">component</span>:<span class="title class_">Demo</span>,</span><br><span class="line">	<span class="attr">children</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">path</span>:<span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">			<span class="attr">component</span>:<span class="title class_">Test</span>,</span><br><span class="line">			<span class="attr">children</span>:[</span><br><span class="line">				&#123;</span><br><span class="line">                    <span class="attr">name</span>:<span class="string">&#x27;hello&#x27;</span> <span class="comment">//给路由命名</span></span><br><span class="line">					<span class="attr">path</span>:<span class="string">&#x27;welcome&#x27;</span>,</span><br><span class="line">					<span class="attr">component</span>:<span class="title class_">Hello</span>,</span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简化跳转：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--简化前，需要写完整的路径 --&gt;</span><br><span class="line">&lt;router-link to=&quot;/demo/test/welcome&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--简化后，直接通过名字跳转 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;&#123;name:&#x27;hello&#x27;&#125;&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--简化写法配合传递参数 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">	:to=&quot;&#123;</span><br><span class="line">		name:&#x27;hello&#x27;,</span><br><span class="line">		query:&#123;</span><br><span class="line">		   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="路由的params参数">路由的params参数</h6>
<blockquote>
<p>动态路由指的是：把 Hash 地址中可变的部分定义为参数项，从而提高路由规则的复用性。 在 vue-router 中使用英文的冒号（:）来定义路由的参数项</p>
</blockquote>
<ol>
<li>
<p>配置路由，声明接收params参数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">path</span>:<span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">	<span class="attr">component</span>:<span class="title class_">Home</span>,</span><br><span class="line">	<span class="attr">children</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">path</span>:<span class="string">&#x27;news&#x27;</span>,</span><br><span class="line">			<span class="attr">component</span>:<span class="title class_">News</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">component</span>:<span class="title class_">Message</span>,</span><br><span class="line">			<span class="attr">children</span>:[</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line">					<span class="attr">path</span>:<span class="string">&#x27;detail/:id/:title&#x27;</span>, <span class="comment">//使用占位符声明接收params参数</span></span><br><span class="line">					<span class="attr">component</span>:<span class="title class_">Detail</span></span><br><span class="line">				&#125;</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>传递参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- 跳转并携带params参数，to的字符串写法 --&gt;</span><br><span class="line">&lt;router-link :to=&quot;/home/message/detail/666/你好&quot;&gt;跳转&lt;/router-link&gt;</span><br><span class="line">				</span><br><span class="line">&lt;!-- 跳转并携带params参数，to的对象写法 --&gt;</span><br><span class="line">&lt;router-link </span><br><span class="line">	:to=&quot;&#123;</span><br><span class="line">		name:&#x27;xiangqing&#x27;,</span><br><span class="line">		params:&#123;</span><br><span class="line">		   id:666,</span><br><span class="line">            title:&#x27;你好&#x27;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;&quot;</span><br><span class="line">&gt;跳转&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>特别注意：</p>
<p>1、路由携带params参数时，若使用to的对象写法，则不能使用path配置项，必须使用name配置！</p>
<p>2、params是路由的一部分，必须要在路由path后面添加参数名。query是拼接在url后面的参数，没有也没关系。</p>
<p>3、params一旦设置在路由，params就是路由的一部分，如果这个路由有params传参，但是在跳转的时候没有传这个参数，会导致跳转失败或者页面会没有内容。</p>
<p>4、所以到底用哪种好呢？看需求</p>
<p>a：query传参有问题，数据在url上，会暴漏给用户</p>
<p>b：不妨假设一个场景, 一个页面通过侧边栏点击一下列表, 右侧内容区显示, 此时用户想将此页面分享给朋友, 那么他只需要copy url发过去, 朋友点击就直接可以看，而用params会造成刷新页面数据丢失的情况</p>
</blockquote>
</li>
<li>
<p>接收参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$route.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">$route.<span class="property">params</span>.<span class="property">title</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="路由的props配置">路由的props配置</h6>
<p>作用：让路由组件更方便的收到参数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line">	<span class="attr">path</span>:<span class="string">&#x27;detail/:id&#x27;</span>,</span><br><span class="line">	<span class="attr">component</span>:<span class="title class_">Detail</span>,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//第一种写法：props值为对象，该对象中所有的key-value的组合最终都会通过props传给Detail组件</span></span><br><span class="line">	<span class="comment">// props:&#123;a:900&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//第二种写法：props值为布尔值，布尔值为true，则把路由收到的所有params参数通过props传给Detail组件</span></span><br><span class="line">	<span class="comment">// props:true</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//第三种写法：props值为函数，该函数返回的对象中每一组key-value都会通过props传给Detail组件</span></span><br><span class="line">	<span class="title function_">props</span>(<span class="params">route</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			<span class="attr">id</span>:route.<span class="property">query</span>.<span class="property">id</span>,</span><br><span class="line">			<span class="attr">title</span>:route.<span class="property">query</span>.<span class="property">title</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="replace属性">replace属性</h6>
<ol>
<li>作用：控制路由跳转时操作浏览器历史记录的模式</li>
<li>浏览器的历史记录有两种写入方式：分别为<code>push</code>和<code>replace</code>，<code>push</code>是追加历史记录，<code>replace</code>是替换当前记录。路由跳转时候默认为<code>push</code></li>
<li>如何开启<code>replace</code>模式：<code>&lt;router-link replace .......&gt;News&lt;/router-link&gt;</code></li>
</ol>
<h6 id="编程式路由导航">编程式路由导航</h6>
<ol>
<li>
<p>作用：不借助<code>&lt;router-link&gt; </code>实现路由跳转，让路由跳转更加灵活</p>
</li>
<li>
<p>具体编码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//$router的两个API</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line">		<span class="attr">params</span>:&#123;</span><br><span class="line">			<span class="attr">id</span>:xxx,</span><br><span class="line">			<span class="attr">title</span>:xxx</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;xiangqing&#x27;</span>,</span><br><span class="line">		<span class="attr">params</span>:&#123;</span><br><span class="line">			<span class="attr">id</span>:xxx,</span><br><span class="line">			<span class="attr">title</span>:xxx</span><br><span class="line">		&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">forward</span>() <span class="comment">//前进</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">back</span>() <span class="comment">//后退</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">go</span>() <span class="comment">//可前进也可后退</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="缓存路由组件">缓存路由组件</h6>
<ol>
<li>
<p>作用：让不展示的路由组件保持挂载，不被销毁。</p>
</li>
<li>
<p>具体编码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;keep-alive include=&quot;News&quot;&gt; </span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="两个新的生命周期钩子">两个新的生命周期钩子</h6>
<ol>
<li>作用：路由组件所独有的两个钩子，用于捕获路由组件的激活状态。</li>
<li>具体名字：
<ol>
<li><code>activated</code>路由组件被激活时触发。</li>
<li><code>deactivated</code>路由组件失活时触发。</li>
</ol>
</li>
</ol>
<h6 id="路由守卫">路由守卫</h6>
<ol>
<li>
<p>作用：对路由进行权限控制</p>
</li>
<li>
<p>分类：全局守卫、独享守卫、组件内守卫</p>
</li>
<li>
<p>全局守卫:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局前置守卫：初始化时执行、每次路由切换前执行</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeEach&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line">	<span class="keyword">if</span>(to.<span class="property">meta</span>.<span class="property">isAuth</span>)&#123; <span class="comment">//判断当前路由是否需要进行权限控制</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;username&#x27;</span>) === <span class="string">&#x27;admin&#x27;</span>)&#123; <span class="comment">//权限控制的具体规则</span></span><br><span class="line">			<span class="title function_">next</span>() <span class="comment">//放行</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">&#x27;暂无权限查看&#x27;</span>)</span><br><span class="line">			<span class="comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_">next</span>() <span class="comment">//放行</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局后置守卫：初始化时执行、每次路由切换后执行</span></span><br><span class="line">router.<span class="title function_">afterEach</span>(<span class="function">(<span class="params">to,<span class="keyword">from</span></span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;afterEach&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line">	<span class="keyword">if</span>(to.<span class="property">meta</span>.<span class="property">title</span>)&#123; </span><br><span class="line">		<span class="variable language_">document</span>.<span class="property">title</span> = to.<span class="property">meta</span>.<span class="property">title</span> <span class="comment">//修改网页的title</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable language_">document</span>.<span class="property">title</span> = <span class="string">&#x27;vue_test&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>独享守卫:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">beforeEnter</span>(<span class="params">to,<span class="keyword">from</span>,next</span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeEnter&#x27;</span>,to,<span class="keyword">from</span>)</span><br><span class="line">	<span class="keyword">if</span>(to.<span class="property">meta</span>.<span class="property">isAuth</span>)&#123; <span class="comment">//判断当前路由是否需要进行权限控制</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;username&#x27;</span>) === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">			<span class="title function_">next</span>()</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="title function_">alert</span>(<span class="string">&#x27;暂无权限查看&#x27;</span>)</span><br><span class="line">			<span class="comment">// next(&#123;name:&#x27;guanyu&#x27;&#125;)</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_">next</span>()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>组件内守卫：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//进入守卫：通过路由规则，进入该组件时被调用</span></span><br><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//离开守卫：通过路由规则，离开该组件时被调用</span></span><br><span class="line">beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h6 id="路由器的两种工作模式">路由器的两种工作模式</h6>
<ol>
<li>对于一个url来说，什么是hash值？—— #及其后面的内容就是hash值。</li>
<li>hash值不会包含在 HTTP 请求中，即：hash值不会带给服务器。</li>
<li>hash模式：
<ol>
<li>地址中永远带着#号，不美观 。</li>
<li>若以后将地址通过第三方手机app分享，若app校验严格，则地址会被标记为不合法。</li>
<li>兼容性较好。</li>
</ol>
</li>
<li>history模式：
<ol>
<li>地址干净，美观 。</li>
<li>兼容性和hash模式相比略差。底层是h5 api history对象</li>
<li>应用部署上线时需要后端人员支持，解决刷新页面服务端404的问题。可以安装connect-history-api-fallback插件解决</li>
</ol>
</li>
</ol>
<p><strong>addRouter刷新404解决方案</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="案例-2">案例</h5>
<h5 id="vue-admin">vue-admin</h5>
<p><img data-src="image-20220810195202522.png" alt=""></p>
<p><img data-src="image-20220810195246652.png" alt=""></p>
<p><img data-src="image-20220810195301394.png" alt=""></p>
<h4 id="Vuex-3">Vuex</h4>
<h5 id="什么是vuex？">什么是vuex？</h5>
<p>vue中实现集中式状态（数据）管理的vue插件（vue.use(vuex)），对vue应用中多个组件的共享状态进行集中式管理（读/写），是一种任意组件之间通信的方式，适用于较大型项目</p>
<h5 id="使用场景？">使用场景？</h5>
<p>1、多个视图依赖于同一状态</p>
<p>2、来自不同视图的行为需要变更同一状态</p>
<p><img data-src="image-20220814212828028.png" alt="image-20220814212828028"></p>
<p><strong>思考一个问题：什么样的数据适合存储到Vuex中？</strong></p>
<p>答案是：<strong>需要共享的数据</strong></p>
<p>Vuex的作用就是：频繁、大范围的数据共享</p>
<p><img data-src="image-20220814213141375.png" alt="image-20220814213141375"></p>
<h5 id="Vuex的工作流程">Vuex的工作流程</h5>
<p>一、安装vuex <code>npm i vuex@3 </code></p>
<p>二、引入Vue，引入VueX，Vue.use(VueX)</p>
<p>三、在项目创建store文件夹，及index.js<br>
定义相关的vuex的state，getters，actions，mutations，</p>
<p>并创建vuex实例：const sotre  = new Vue.Store({state，getters，actions，mutations})</p>
<p>四、在入口文件main.js中引入store,并在根实例注册挂载</p>
<p>五、在任意组件中，通过this.$store.state就可以访问到共享数据</p>
<p>六、当通过组件要修改store中的数据时，</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 如果该操作是同步的并且不需要共用，可以用this.$store.commit()来触发mutations, 只有mutations才可以直接更改state共享数据</span><br><span class="line">2. mutations中只能有同步操作，不能有异步操作</span><br><span class="line">3. 如果修改数据的操作是异步的，通过this.$store.dispatch()触发actions, actions中可以发起异步请求，获取数据后，再调用 commit触发mutations,通过mutations修改共享数据</span><br></pre></td></tr></table></figure>
<p><strong>使用vuex的好处</strong></p>
<p>1、数据的存取一步到位，不需要层层传递</p>
<p>2、数据的流动非常清晰</p>
<p>3、存储在Vuex中的数据都是响应式的</p>
<h5 id="基础总结：">基础总结：</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. state中的数据，不能直接修改，如果想要修改，必须通过mutations，通过this.$store.commit(&#x27;方法的名称&#x27;，唯一的一个参数)，这种调用mutations方法的格式，和 this.$emit(&#x27;父组件中方法名&#x27;)类似</span><br><span class="line">2. mutations的函数参数列表中，最多支持两个参数，其中，参数1:是state 数据；参数2: 通过commit提交过来的参数。</span><br><span class="line">3. 如果组件想要直接从state上获取数据:需要this.$store.state.xx。</span><br><span class="line">4. 如果 store 中 state 上的数据，在对外提供的时候，需要做一层包装，那么，推荐使用getters，如果需要使用getters，则用 this.$store.getters.xx，getters只负责对外提供数据，不负责修改数据。</span><br><span class="line">   如果想要修改 state 中的数据，请去找 mutations，getters 中的方法，和组件中的过滤器比较类似，因为过滤器和 getters 都没有修改原数据，都是把原数据做了一层包装，提供给了调用者；其次，getters 也和computed比较像，只要state 中的数据发生变化了，那么，如果getters正好也引用了这个数据，那么就会立即触发getters 的重新求值。</span><br><span class="line">5. 如果要操作 store 中的 state值，只能通过调用mutations 提供的方法，才能操作对应的数据，不推荐直接操作 state 中的数据，因为每个组件都可能有操作数据的方法，万一导致了数据的紊乱，不能快速定位到错误的原因。</span><br><span class="line">6. 各个对象之间一定是各司其职，所有逻辑在actions中完成，mutations中只负责做最终的修改数据，如果有多个逻辑，可以在actions中写多个函数，每个函数负责自己的功能，函数内可通过context.dispatch调用下一个函数继续处理数据逻辑，大家在封装函数的时候尽量遵循高内聚，低耦合原则，保证每个函数职能单一</span><br><span class="line">目前我们学了</span><br><span class="line">actions: 用于响应dispatch触发的事件，即组件调用的方法</span><br><span class="line">mutation: 用于操作数据state</span><br><span class="line">state: 存储共享的数据</span><br><span class="line">getter: 对外提供数据并进行加工</span><br></pre></td></tr></table></figure>
<h5 id="辅助函数">辅助函数</h5>
<h6 id="mapState">mapState</h6>
<p>当一个组件需要获取多个状态的时候，将这些状态都声明为计算属性会有些重复和冗余。为了解决这个问题，我们可以使用 <code>mapState</code> 辅助函数帮助我们生成计算属性，让你少按几次键</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品名称: &#123;&#123;goodName&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品价格: &#123;&#123;goodPrice&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品描述: &#123;&#123;goodDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品最新描述: &#123;&#123;goodNewDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 引入辅助函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// mapState: 映射状态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">n</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 封装思路</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// function mapState(obj)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 需要取出对象的键值对</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// for(let key in obj)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return function [key]()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//     return this.$store.state[obj[key]]</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// mapState(&#123;name: &#x27;goodName&#x27;, price: &#x27;goodPrice&#x27;&#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 手写计算属性 + state</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// name() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodName</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// price() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodPrice</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// desc() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodDesc</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 生成计算属性 =&gt; 对象的写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 传入的对象键为: 生成的计算属性名字</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 传入的对象值为: 需要访问state中的哪个属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ...mapState(&#123; name: &#x27;goodName&#x27;, price: &#x27;goodPrice&#x27;, desc: &#x27;goodDesc&#x27; &#125;),</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// goodName() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodName</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// goodPrice() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodPrice</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// goodDesc() &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.state.goodDesc</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 当计算属性的名字和需要访问state的属性名字一样时 可以使用数组的写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>([<span class="string">&#x27;goodName&#x27;</span>, <span class="string">&#x27;goodPrice&#x27;</span>, <span class="string">&#x27;goodDesc&#x27;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 返回值是一个对象  &#123;name:function&#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> res = <span class="title function_">mapState</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;goodName&#x27;</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="mapGetters">mapGetters</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品名称: &#123;&#123;goodName&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品价格: &#123;&#123;goodPrice&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品描述: &#123;&#123;goodDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品最新描述: &#123;&#123;goodNewDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 引入辅助函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// mapState: 映射状态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">n</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 手写的计算属性 + getter</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// newDesc()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.getters.goodNewDesc</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// newDesc()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.getters.goodNewDesc</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// newDesc()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   return this.$store.getters.goodNewDesc</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 利用辅助函数生成</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 对象写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ...mapGetters(&#123;newDesc: &#x27;goodNewDesc&#x27;&#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 数组写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>([<span class="string">&#x27;goodNewDesc&#x27;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 返回值是一个对象  &#123;name:function&#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> res = <span class="title function_">mapGetters</span>(&#123; <span class="attr">newDesc</span>: <span class="string">&#x27;goodNewDesc&#x27;</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="mapMutations">mapMutations</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品名称: &#123;&#123;goodName&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品价格: &#123;&#123;goodPrice&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品描述: &#123;&#123;goodDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      商品最新描述: &#123;&#123;goodNewDesc&#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入要涨价的金额&quot;</span> <span class="attr">v-model.number</span>=<span class="string">&quot;money&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;increase(money)&#x27;</span>&gt;</span>涨价<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;increaseDouble(money)&#x27;</span>&gt;</span>翻倍的涨价<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 引入辅助函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// mapState: 映射状态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; mapState, mapGetters, mapMutations, mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">money</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// increase()&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   this.$store.commit(&#x27;INCREASE&#x27;, this.money)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 没有手动传参会将$event事件参数对象当作第二个参数传过去</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// increase(e)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   this.$store.commit(&#x27;INCREASE&#x27;, e)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 手动传参就使用我们的参数当作第二个参数传过去</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// increase(money)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   this.$store.commit(&#x27;INCREASE&#x27;, money)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 对象的写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ...mapMutations(&#123; increase: &#x27;INCREASE&#x27; &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 数组的写法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapMutations</span>([<span class="string">&#x27;increase&#x27;</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">computed</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapState</span>([<span class="string">&#x27;goodName&#x27;</span>, <span class="string">&#x27;goodPrice&#x27;</span>, <span class="string">&#x27;goodDesc&#x27;</span>]),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ...<span class="title function_">mapGetters</span>([<span class="string">&#x27;goodNewDesc&#x27;</span>])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 返回值是一个对象  &#123;name:function&#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> res = <span class="title function_">mapState</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;goodName&#x27;</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="mapActions">mapActions</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// increaseDouble()&#123;</span></span><br><span class="line"><span class="comment">//   // 逻辑稍微复杂且需要共用 dispatch</span></span><br><span class="line"><span class="comment">//   this.$store.dispatch(&#x27;increaseDouble&#x27;, this.money)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// ...mapActions(&#123;increaseDouble: &#x27;increaseDouble&#x27;&#125;)</span></span><br><span class="line">...<span class="title function_">mapActions</span>([<span class="string">&#x27;increaseDouble&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h5 id="模块化">模块化</h5>
<p><strong>index.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入vue</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// 引入vuex</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="comment">// 使用vuex</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"><span class="comment">// 引入商品相关</span></span><br><span class="line"><span class="keyword">import</span> productsAbout <span class="keyword">from</span> <span class="string">&#x27;./productsAbout&#x27;</span></span><br><span class="line"><span class="comment">// 引入员工相关</span></span><br><span class="line"><span class="keyword">import</span> staffsAbout <span class="keyword">from</span> <span class="string">&#x27;./staffsAbout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建vuex实例</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// 开启严格模式</span></span><br><span class="line">  <span class="comment">// 作用: 在严格模式下，无论何时发生了状态变更且不是由 mutation 函数引起的，将会抛出错误。</span></span><br><span class="line">  <span class="comment">// 目的: 这能保证所有的状态变更都能被调试工具跟踪到。</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面刷新vuex中的数据丢失如何解决？</span></span><br><span class="line">  <span class="comment">// 1、考虑本地存储 localstroage || sessionStorage</span></span><br><span class="line">  <span class="comment">// 2、利用 vuex-persistedstate 插件</span></span><br><span class="line">  <span class="comment">// 插件的原理其实也是结合了存储方式,只是统一的配置就不需要手动每次都写存储方法</span></span><br><span class="line">  <span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    productsAbout,</span><br><span class="line">    staffsAbout</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p><strong>productsAbout.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 商品相关</span></span><br><span class="line"><span class="keyword">const</span> productsAbout = &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 商品的方法</span></span><br><span class="line">    <span class="title function_">increaseDouble</span>(<span class="params">context, val</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (context.<span class="property">state</span>.<span class="property">goodPrice</span> * <span class="number">2</span> == val) &#123;</span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&#x27;INCREASEDOUBLE&#x27;</span>, val)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 商品的方法</span></span><br><span class="line">    <span class="title function_">increase</span>(<span class="params">state, val</span>) &#123;</span><br><span class="line">      state.<span class="property">goodPrice</span> += val</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">INCREASEDOUBLE</span>(<span class="params">state, val</span>) &#123;</span><br><span class="line">      state.<span class="property">goodPrice</span> += val</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="comment">// 商品的数据</span></span><br><span class="line">    <span class="attr">goodName</span>: <span class="string">&#x27;小米12&#x27;</span>,</span><br><span class="line">    <span class="attr">goodPrice</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">goodDesc</span>: <span class="string">&#x27;为发烧而生&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 商品数据的二次处理</span></span><br><span class="line">    <span class="title function_">goodNewDesc</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">goodDesc</span> + <span class="string">&#x27;~哈哈哈哈哈&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> productsAbout</span><br></pre></td></tr></table></figure>
<p><strong>staffsAbout.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 员工相关</span></span><br><span class="line"><span class="keyword">const</span> staffsAbout = &#123;</span><br><span class="line">  <span class="comment">// 开启命名空间</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 员工的方法</span></span><br><span class="line">    <span class="title function_">addDoubleSalary</span>(<span class="params">context, val</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (context.<span class="property">state</span>.<span class="property">staffSalary</span> * <span class="number">2</span> == val) &#123;</span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&#x27;ADD_DOUBLE_SALARY&#x27;</span>, val)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 员工的方法</span></span><br><span class="line">    <span class="title function_">addSalary</span>(<span class="params">state, val</span>) &#123;</span><br><span class="line">      state.<span class="property">staffSalary</span> += val</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">ADD_DOUBLE_SALARY</span>(<span class="params">state, val</span>) &#123;</span><br><span class="line">      state.<span class="property">staffSalary</span> += val</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="comment">// 员工的数据</span></span><br><span class="line">    <span class="attr">staffName</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">    <span class="attr">staffSalary</span>: <span class="number">1800</span>,</span><br><span class="line">    <span class="attr">staffDesc</span>: <span class="string">&#x27;月薪1800水群笑哈哈&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 员工数据的二次处理</span></span><br><span class="line">    <span class="title function_">staffNewDesc</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">staffDesc</span> + <span class="string">&#x27;~呜呜呜呜呜&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> staffsAbout</span><br></pre></td></tr></table></figure>
<h5 id="持久化">持久化</h5>
<p>在VUE项目中，由于是单页应用，vuex中的数据在页面刷新时就会被清除，所以我们要考虑怎样让vuex中的数据持久保存在浏览器中，至少不能每次刷新时都丢失登录状态，这篇文章介绍VUE项目中常用到的两种vuex持久化的方法，底层实现原理一直，方法不太一样，可以在项目中根据实际来区分<br>
方法一、浏览器监听+本地存储<br>
我们可以监听浏览器的刷新，在页面刷新时将vuex内的数据保存在本地存储中(根据项目需要可以考虑保存在sessionStorage或者localStorage中)<br>
在App.vue中，created生命周期写我们的监听方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;beforeunload&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;store&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后在进入到created生命周期时，去到sessionStorage/localStorage中的数据，将数据替换</p>
<p>到vuex中</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>)) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">replaceState</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;store&#x27;</span>))))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整体来说为一下代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 页面加载时，读取sessionStorage中的状态信息</span></span><br><span class="line">    <span class="keyword">if</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;store&quot;</span>)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">replaceState</span>(<span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="variable language_">this</span>.<span class="property">store</span>.<span class="property">state</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;store&#x27;</span>))))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 在页面刷新时，将vuex中的信息保存到sessionStorage里</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;beforeunload&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      sessionStorage.<span class="title function_">setItem</span>(<span class="string">&quot;store&quot;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>这个方法的好处是不需要借助其他三方组件库，实现vuex全量数据持久化，坏处是所有数据保存在本地，会有一些较敏感数据容易被查看到，另外如果做某些指定数据持久化时会比较麻烦，所以下面介绍第二种更为简单的方法</p>
<p>方法二、状态持久化插件<br>
推荐使用 vuex-persistedstate 插件<br>
使用方法如下<br>
1、在项目中安装该插件 cnpm i --save vuex-persistedstate<br>
2、在 src/store/index.js中引入该插件 import createPersistedState from ‘vuex-persistedstate’<br>
在vuex中使用 plugins: [createPersistedState()]<br>
整体代码如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&#x27;vuex-persistedstate&#x27;</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">    <span class="attr">storage</span>: <span class="variable language_">window</span>.<span class="property">sessionStorage</span>, <span class="comment">// 默认位置是 localStorage</span></span><br><span class="line">    <span class="attr">reducer</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 默认是全部缓存，在这里可以设置需要缓存的状态</span></span><br><span class="line">        ...state</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)],</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优点：<br>
1、可以更便捷设置存储位置 为sessionStorage或者 localStorage中，默认为 localStorage<br>
2、可以更便捷设置需要存储的内容，如当需要存储token时，只需要将token放入进入即可</p>
<h4 id="乱七八糟的知识点">乱七八糟的知识点</h4>
<h5 id="eslint">eslint</h5>
<p><a href="https://eslint.bootcss.com/">eslint中文官网</a></p>
<h6 id="初始化项目-2">初始化项目</h6>
<p>// eslint-disable-next-line</p>
<p>/* eslint-disable */</p>
<h6 id="创建并梳理项目的结构">创建并梳理项目的结构</h6>
<ol>
<li>
<p>运行如下的命令，基于 vue-cli 创建 Vue2 的工程化项目：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create eslint-demo</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重置 <code>App.vue</code> 根组件中的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;App 根组件&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>清空 <code>/src/router/index.js</code> 路由模块，删除创建项目时自带的路由规则：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueRouter</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueRouter</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空路由规则</span></span><br><span class="line"><span class="keyword">const</span> routes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除 <code>components</code> 目录下的 <code>HelloWorld.vue</code> 组件</p>
</li>
<li>
<p>删除 <code>views</code> 目录下的 <code>About.vue</code> 和 <code>Home.vue</code> 组件</p>
</li>
<li>
<p>执行 <code>npm run serve</code> 命令，把项目运行起来看效果</p>
</li>
</ol>
<h6 id="了解-ESLint-常见的语法规则">了解 ESLint 常见的语法规则</h6>
<p>ESLint 提供了许多<strong>校验代码格式</strong>的语法规则，常见的语法规则列表如下：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>规则名称</th>
<th>规则约束/默认约束</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>quotes</td>
<td>默认：字符串需要使用单引号包裹</td>
</tr>
<tr>
<td>2</td>
<td>key-spacing</td>
<td>默认：对象的属性和值之间，需要有一个空格分割</td>
</tr>
<tr>
<td>3</td>
<td>comma-dangle</td>
<td>默认：对象或数组的末尾，不允许出现多余的逗号</td>
</tr>
<tr>
<td>4</td>
<td>no-multiple-empty-lines</td>
<td>不允许出现多个空行</td>
</tr>
<tr>
<td>5</td>
<td>no-trailing-spaces</td>
<td>不允许在行尾出现多余的空格</td>
</tr>
<tr>
<td>6</td>
<td>eol-last</td>
<td>默认：文件的末尾必须保留一个空行</td>
</tr>
<tr>
<td>7</td>
<td>spaced-comment</td>
<td>在注释中的<code>//</code>或<code>/*</code>后强制使用一致的间距</td>
</tr>
<tr>
<td>8</td>
<td>indent</td>
<td>强制一致的缩进</td>
</tr>
<tr>
<td>9</td>
<td>import/first</td>
<td><code>import</code> 导入模块的语句必须声明在文件的顶部</td>
</tr>
<tr>
<td>10</td>
<td>space-before-function-paren</td>
<td>方法的形参之前是否需要保留一个空格</td>
</tr>
</tbody>
</table>
<blockquote>
<p>详细的 ESLint 语法规则列表，请参考官方文档 <a href="https://eslint.org/docs/rules/">https://eslint.org/docs/rules/</a></p>
<p>常见规则总结：<a href="https://zhuanlan.zhihu.com/p/28906725">https://zhuanlan.zhihu.com/p/28906725</a></p>
</blockquote>
<h6 id="自定义-ESLint-的-rules-规则">自定义 ESLint 的 rules 规则</h6>
<p>如果希望修改 ESLint 默认的校验规则，可以在 <code>.eslintrc.js</code> 文件的 <code>rules</code> 节点下进行自定义。例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line">  <span class="comment">// 默认情况下，ESLint 规定：方法的形参之前必须保留一个空格</span></span><br><span class="line">  <span class="comment">// &#x27;space-before-function-paren&#x27;: [&#x27;error&#x27;, &#x27;always&#x27;]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果指定了规则的值为 never，则不允许在方法的形参之前保留任何空格</span></span><br><span class="line">  <span class="string">&#x27;space-before-function-paren&#x27;</span>: [<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;never&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="安装-vscode-的-ESLint-插件">安装 vscode 的 ESLint 插件</h6>
<blockquote>
<p>为了让开发者<strong>专注于业务功能的开发</strong>，推荐大家在 vscode 中安装并配置 <strong>ESLint</strong> 插件。</p>
<p>它可以在保存文件的时候，遵循 ESLint 的语法规则，自动对代码进行格式化。</p>
</blockquote>
<ol>
<li>
<p>在 vscode 中搜索并安装 <code>ESLint</code> <code>Prettier - Code formatter</code>插件。</p>
</li>
<li>
<p>打开 vscode 的 <code>settings.json</code> 配置文件，新增如下的配置节点：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ESLint 插件的配置</span></span><br><span class="line"><span class="attr">&quot;editor.codeActionsOnSave&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;source.fixAll&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">// 。。。</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>点击 vscode 状态栏右下角的 <code>ESLint</code> 按钮，在弹出层中选择 <code>Allow Everywhere</code>。</p>
<p><img data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArkAAADyCAMAAAB+gC0AAAADAFBMVEVES1wyOk1+wv//4ataOk0yOm6g4f//wo7U1Nd9gY3//8h+Ok0ygsj///8yOo7B///Bgk36+PcyX6vg//9ao+Tgo25+wuSgX03//+T/wqvg/+R+o6tao8j/4cjB4f/Bo27B/+Sg4eTgwo5agsjBgm7P3el/psVAeqgwb6EATozv8/cgZJoAU5UAXqgAaLsAbsQAeNcQWZMAW6MAWZ8AcMmfvNMAZrYAUZG2ZgAAOpDb/////9uQOgD/25A6AAAAAAA6kNvbkDpmtv//tmYAAGa2/////7ZmAAAAADqQ2/86ADoAZpC2kDq2kJDbkGaQtv86OgDb/9s6AGaQtpBmtrZmADo6ZrZmkNtmZmYAOjo6OpBmttvbtmY6kLYAOmZmOgDb25C225CQZgDf39/w8PCtra3h4eGgWgAAM3/B4eEAWqDBfzPh4aBaADN/weHhwX8zM38zAFqg4eFaAFozf8FaoOEAADPh4cF/MwAAAFrhwcHBoFpaAAAAWn/BweFaWlozAADhoFqgwX+gfzN/WgDBwX8zADOgf3/Bf1p/MzMzMwDB4cF/oH9aoKAAMzMzWqAAM1paMwBaf8Ezf6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAC0AAB363ePTFAAAAgAALkAAAAAAAAAAAAAAAAAAAAAAAAAAABkAAAAAAAAAAAE8AAaCI4AAAAAAAAAFwDwABoIjz+PTFAE4AgACI4AuQAAAAD11AC2ABl35zrorFkAAHcAAAAAAAAAAAAAAAAAAAAAAABMON33jCF4dmAAGfZg960AAHYAAAAAAAAAAAD3y8BgdmAAAAAAAAAABQCAAAAAAAAQAIAAAMDMAAAAAAYAAAAAAgBqAAAAbACPTFAAAAhQAAAIj0wAAAD3KACEABl35ykAAAAAGAAAAAAAAAAZ9hgAQAAAAAAAAAAZ9mgAAAAAAAAAAAAAAAAAAACQAAAAxPgAAA8ADAACAADvNO2EAAAAAWJLR0QN9rRh9QAAAAlwSFlzAAASdAAAEnQB3mYfeAAAHG9JREFUeNrtXYmfHMV1NgJJJlEDEVKU+0YgBOwCohkJpLlskHBCEufyEedw4l3QyigoWoNiJdb6yH3nH06dr96ro4+Znt0Z7ff9fjqmu45Xr76pfl3TX78vfAEANhNPAMDmAcwFwFwAAHMBAMwFwFwAAHMBAMwFwFwA2FDmnnjyqWLhpnOEk6dOdyzJygNADl982v/v6S9mmXvip37akejkqS7MPVNVVamcZmK2lWeeVbWeA3OB7nj6Z56O/hMx94xl1Nnnn2tsxzP3nCb6mfOajN2ZeM708bMXwFygN3VT4jrmPvPsaWJkO3OfefY8LaOdmXvm5y4gWgAWo26GuD7ONZw9eeq8Zae+rj/nCKo/nzxVVboAMfe0X0YVzodyJor4eYpzzz4fwgPTtkM4TuXNse6xMXCsqJsjrmeuiRPO/sIFwzlDxV98KjDyly7YyNVHCyeq02zNDeVM0GFO0qezz59/IgpEwvFQXq/IjSE2cIypmyOuZ665ZJ/TzFGccyxja6nmm1p06Q5NLbanU+ba//i9BRdTuAjEfCueYLGGOh7Knzz1nCgDAB2Zq4lkL+iKcyo40BRlzD1RmXCB7XWdqHTcKplrGe+Z6/jv4tvAynA8lDfxQ3bnAQBxG6MFzSdLLh+hPvkUW0sVa89I5irCqQPdmRvu6vLMBWeBhe7QFNdOnzvN9g9UCGpv+tVnQ75zEXMNlQ1zqZxlp7l/S6IFv2WcRgu6fOA1APTZFdNE/OVfec4x9+yv2qVSk+2MWnz1jdTZ5wNzn/m1C46vbrl15Z44oSlOd2hmA/dM2FzQJ0/++gV2PJQ3x87+BmYKyBG3/EuEWfrsoqg5p8JaQ7NT6kbMcrB68jfZmmt+DTvvtrXOh3ImHv4t2hXTe15sF/ec/xiOU3lzElsLQITWX38BYNMA5gJgLgCAuQAA5gJgLgCAuQAA5gJgLgCAuQCwUuZWALB5AHMBMBcAwFwAAHMBMBcAwFwAAHMBMBcAwFwAAHMBAMwFwFwAAHMBYDjmvnDxxZcuKbz04sUX4CtgQ5j78sXLr7z62ta2wtZrr75y+eLLcBew/sx9+eLrbxjWemy98Tq4C6w9c1+4/OaV7QhX3ryMmAFYb+a+danezqC+9BZcBqwxc996e2s7i623QV1gfZn71ttXtgu4AuoCa8vcFy5tbRexdQmxLrCezH35soxxq0rGupexwwCsJXMvvrndxNztNy+WmxvVvXofXb02xCA6NqOL+T9L4Z1366VqdDegzdzrN8aT3u1kzO/hEppiXmfUMLz2tvOjbPFyytyXX7+y3Ygrr8eL7nRsMSkw156fVdVc/aMtnH7py9a2QZjbsRlTrDNzmwqtiLnOK5EVudH5Bt57f9L5GxDaSc3vMxF+ikUdPu9RYx3aHoi5F9/YbsEbmUV3fvNWec2dOqvM1Mwn2TnS0zArWdlwaoHluRtz68Nec3OtJiWtJ7xx1z+4tcBVSXTU27VZx/S81ka9DsTcy1ttzN26vBhzwwoB5uau/BkatjDXeR3MNRsLr8REjePc7e1XXigzV0UGhpYqAht7Y4i5dcRccxFzVaY23vDhm6481RGGquVPucNURZ0zQYgZtT6pP4SzfsbsX3Uc59ovkv7gmpE2T3hLvnEb8HzF+JSX9kO/eq1cI/RH9up/fefZo6507KSp9dNIfVB+p65GV3/bWjTyf7/zrjWHeiXz3RnXYNmDqRf9yZG3U7fNa3CXRpPsjrteE+vIpcHL3Zl78dV25r56schcZc9776vO9WeKcHy0MBrXGeaaKjX/HlJlO2h/yh+mKoYLv2NHPdeOun7DuGNCXxJd5b33Tb1Zkbm+GWGz+dL7lqhx+z8zjri0HrryfF2sIZnrq/vO7en4KDE3dRJ5PXRF/jXHr9+YVR/ekuF9MN+fcYt40YOpF/0U2zp6QfndcLCSLo0n2R+3vSbWeZcGM3sw98XX2pn72otF5rr7Lz3EcP0zXzFNVvWfOmGuv2WjSQmV1UCn9ps6Y4epip4b7irXNbsH1BXnN39vYlorMdc1I22mewvVUmjc/k9/m5LSdk1yS0iuhmAuVfdjqOaqanKUSidOYpTyXdnereXsZkI37NoJxtAZYm7Bg1kv2t7cssLn3X+gUUWT7I+zVSpYR6OPzOzI3Je22pm79VJjnGssHPv9BLbmmpVJF5TRQhVNCqt8/YZp15yiw1RFfZX9ZdG5RJkRGnQGTWvV/5SxNmaua0baTK4L/laN2//pE0lpM3Q7g9ycUEMwlw3GjsF0lhwdsQtPgbmhKxYrTnWdiQsoAjeCMXSGmFvyYOJFf5ITdFQnV1Kyhdvvj7thxNa50XMzuzP30nY7c7cvtTN3ltlbsHTQ0VULc2dhv5IzdxYxykw1n5PU79Orv//u7PpXvzyaVOU41zYjbW5n7ixzk9KDuWyMegzmQHJ0Ueaqg/aaparMc8ylM52YK7zYhbne/mSS3XHTa946IsDRMFduNHLmGlObmRsqq3Vjau8DZuyw8KwOiaJrHffi9Q/+4Kvq0B/+0a2EuW7psR9UM8nmKLUUX/spYisyN1cj9BfsdS7RNy1Xr0X7s25kbczl0QK7ttVTF4vTGepVG0NnstFCzFzhRcZcsjdlrou/E+ba46bXvHVEAB5pHx5z7bbA9T+Wewt64GYQBebSppmvHO7QJuxwWAv/JKw1U/tLx0zyWn36mu7v69+4lv6GpsPCuV5sXTPCZvENocarkR6nuXeISwvmZmv4/oK9qrrr3PNGHs0xdxJ7nXUVmKvCUnf0+o3AjWAMnQlXgowHw68OzIuMua7OLGGutz+eZH/c3o7G1oV5J58dPnPNXRntMJnwpTZbIuMJOyC/jnPaFXOVR/YWufan3GHmWbMrFPZ7bt6KVmTPhRuTzK+/elOmNgdsTWGzXNt94zY0+6Y9MY52xThzczVCf6aUq24799Msj6bMZU4ir1NXjLnuRl9v1P0p40Ywxp+xDeY9aEPl2IucuaZOnVlzvUvj5ckfN70m1pFLg5dXfocGLPkLSb2GRpmL5MY8cbPgrhiwFJL7vbXAfJgHog6JuQv+EgEAR8zcBX/9PbYwsbsIeIGjYW76xE3C3NwTNwBw1MxNnnJMmPsGggVgDZmbPFkeMzd9shwA1oC5S6l5AODomLuAgrL5We3cg8NpDSmpahJNdcVo5bdNXZ9TH2i3ttuAIkfWPb2xkNcaKmVPFZ4j79P3MKr13sxNxUnRcwCtzG0fZEEAxSua3/Ju3toQ5nZTi8WOrPOVB9UGNlTKn8ozt1ffw7wppP+am64UUsvSzty6QYnSJFHhLJrap5rq1TFXqm8WRg/NDTmyueultYEDXz16X1uHeTvTAMyNJFWHyNzuCtqNYC45shNzF9cGridz+74RT8iYSJwUyYxGTCIlxUlVTlJ1Laf5IqWVlmJxedp4xh64ZeIqb0NoeTpJps8/OMqlU+7vpG3n5oyAip7W8ootf02eFOR5sdyOnbUezA2opBYjC8bs8SHedaQO66kNlB4JU9GqBIxm2uvW2ODYPMuy+vC3ioQe5i2kQsZE4qRIZmQWA/8lFuIqWiqYpEqokYIwTTz55uRpvhKXRHr2f8iVTfZhp3Th0RdYUYBMzbStkZV36WJCscUWvqw8L5HbMR2W8WBuQAW1GPN+tOYy2RhXh/XUBpKyTU5FuxJQtke6Nc7cMM+i7LRZjDbMm58zDyb7axeXGU3sZxoPFy+lD0nnNF8jcUnjD5zTQ9xyop0NrOUcc2/MZAFvaq7tzMh4MabYYvTJyfMSuR0T2tXsZksMqKi3I/Nj5jLZGH+up7c2cBKNYGQvVG1KQNEe161JASvtLUTiv3d6r7lVr7ftj1L9ig8B+IPDXhxVpQ/KZ4QpOc2XjI+4yIeezo6Ya21gLefX3KiAMzXXdmZk3G6m2IqCzViel8jtIh1WlrkFzQ2zIBfnkuBxzJVqNHsdtIHBI2IquigB+YPlN2Ypc5l2Jy27EHOr7hlOssyNZUaGIB/cWoi5s2xk385cb0Mzc6dJAWdqgbkFAZXRVTDFVo65M77vGsntIh3W8Mzl6rCe2kCvbEumolUJeDTM7XGrGF9YU5kRqcqKzM1FC1LzlWFuHKaIifY2NEYL+mRUwJmaa7sqCqj0Ea7YSukjdjESuV2kw+JKuTa1WEO0IJgb1GE9tYFe2ZaZihYlIG8v6Nb8QTHPmbJlMdpgzGVyKCdOSmRG1fzP/px9Y1PmRpKqjOYrZi7J02wlL/Si7zPZEApxdzjdTS1aseZYUzNtVyUB1dzeVwfFFls28/K8WG5HB0jelQyopLcLFjDmxuIbrg7rqw10yrZoKjooAUV7NDDtOJLlBaWeEP40i9GGYy5TXjlxUiIzMlfZJuZGkqpU8xXtA1pRFlUioVcQV3G5Ff1aRpcguk2pZIFgaqbtKjOyUHkabWLM6RWXiTwvldvRWefBzIBKejuyIEREsutIHdZbG+hfYSOnol0JmLTnKMoGR/MsyzaL0Q41B+USzyAcNjbI1Mca76wHczu/NPPosUGmPtYoC/QOlbmjzVnHRlhyjxr6x056y96RMne6OWKtKXRl67B6jMcNLwtBrnVgMwHmAmAuAIC5AHCYzM0/aV149rqf4KnTBquWYPVJ7dWSaazpwfFy3eSVkeVeBtk1zrSf7Iz4hxYmYO7yzO0peOoyyfq3yh7NNhWlpgq8K9dN0q6tC3PNL7n6Wa8ZmLvcmtsPXSa5+88HrSoV/lDbAq2sI3PNo17fuFZNb94Cc9eMuZ3Tg7Uzd37zsWOuH9KqtGUbydxEl2Wc9Rc37E5yKjr6ViI6Ygop11gkSArZsZyUKZU9WQmW6ITnZtCyqa5ZwEJT+dxlXB1WNaddi0R6JIyTgypncyvI4YIiLzg6aMR8I2xiRukjOWBuosuyk288XkfMnWZFR1wh9WGU9SzKjuWlTBnZ09w/tjTN5CAz9TtnAZuzN4anucsq/tRs1Zx2LRLpfZhN+VXO5laSw4XH/5yjJ0Ku58RnfGLm/kG+x+M2bbhogasfjEPNwiGeEi+LjuIHK+ZMzSQFSVKjJWVPnm7ZHGT0gGWnLGBz8a77OHdZzNymtGvRo+fOAjmoghVNcrgwHnI004iJobiJscxNVKTHnLmR4ixc6txjx23SDa6Qco0VZB2ePTnxiKdbIZMTM7Q1lxJnbpKlLGFuU9q1SO4jhHHRoDI5sYpyuJGwxMmoSCMmnnEVzB09Lk9kDMLcRHHWm7lMIeUbWwVzu2cBk8yNspSlzG1IuyZ7kcK4NuY2yOGyzJ3xOzSzRLOJAXMLN+LTbLQgksuURUcU64XGCoIkry/JyZ5ktJDkIKt6ZAHjzE2ylKXMbUi7JnuRwrhoUIkVDXI4xlzvaKYRq2VvYm8Bv0TI2ZSKs8q/4oM0Zc2iI6aQ8o2VBEleypSRPQW65XOQdcwCltyhxVnKxN6+o1hD2jXeS3BVZlCJFQ1yOMZccnTQiHnm8omxlmdfwnR849xEl1XZt/eENy21iY6kQko3VhQkOSlTRvZEdCvlIOuUBSxlbpylrGI7fBNGvXzaNSlUIwvSQWXUZWU5HI8WvKODnUGxGCYGzF18g3zYHfghfrtYd0AOt2bMPZT0X+uZY6znGCCHWxvmtqiLhsGhdHIYgBxujdbcZnXRUJ0fRicrB+RwR8JcAABzAQDMBcBcAABzAQDMBcBcAABzAQDMBQAwFwBzAQDMBQAwFwBzAQDMBQAwFwBzAQDMBQAwFwDAXADMBQAwFwDAXADMBQAwN4OmjGOLN1ofwSiWsilzttxmW1qzrj49ZDflErFE7wA+AuaaXB+dOncmTp3z2708da/hHpK5Q39XVsDccr418TbfI2WubaD40j779tXwEsrOzO02PQMx17xntEuHfrRf83llWpnbn2XtzK09CWarZ657yXQ9FIlaX5K3Nsyt3eyZNDfNfpPM7TQ9wzG327sTrVXzL/2lLQzm9iZR66vH1465xcvEujBXd+SydEX5w1gasanNH1a78YqMY/795pRZjDFXpgazhVRX33aHvy0SklFKMVE2VLVG+KxoIVeZ7UgUNW2Z1GeyQXE4l5HMpyvzqdcSm9zkmA/yLL0uW6R+o1fBm8svK+fzomWS0klvRnX0IZt+ynneD4JStsXds3mMmOvP8MFpL7vZ8y/8d8WCpSxlXtVpelaz5up0RvZt4jJ/GE8j5u4xZi6HJ2Uc86/8FpnFGHPNSqPrsZxfdcgYJhOS+Wxgsmz4KJfDkKvMMkMU1W0p19Uh4VrmcDYjWS3X3MQmMyqX2y2cJVusV1zqN1FHD5mVo44ySemEW+I6Op+QOuRnJ+SvCynbZPfxPAbm+jOJh93suUxXvhhZSn4bXb3WbXpWwVw7hzbxocwfloQR+iso3kzPE36xzGL0zdPv3p/EOb9sVz5jWJSQLFt2FoWJxjVRrrKoqF2w3FJWOJzNSEYvtQ9JA2UJfqEdidRvfokKKeC44ZaNoZx4e36UIIm7Jakzqi013eyE/HWuoaT7eB4Dc92Z1MOeuTdmUZIjaylPmddtelaytzDhqz7PHyaSnVUuI80777IrG8sXxjOL8TiXUoNRzi97MbaHZUIySkclyoaPwjU8V1kyAtuWJRZLjCYPZzOSsYCA4lxhE/9Kj0QCLZ+KKyTQ4obPb/I0UzxCzCWlC25J6oy+fsNmExxTJJZJ2ZZOZ4a57kzqYbnmUgPMUjbaLtOzkmiBzXucPyykEbPXSLIxZS7PLMabVkVYajDytMsYJhOSSR5kzGpnrsgsFpibPZzNSFZk7kxGTZ2YO4vu0HLMzSalY27JMdeviGM+CJmyLTedYox2aTZnUg9Hca4tJixNRlsdIXNz+cPm4bvkYhkek7FLAs8sJpuupzVv2/tt4oJslpBMJFLLm1WOFmRRQdHC4WxGsgJzhRH0ITorUs7GhsfRgu8om5SOuSWpM6ppu0rPDg1CpmzLT2cVXOZ3ANSZ1MNsb8GH3uNZsJSnzOs2Patlbpw/jKcRY99h/+0X+cJEZjHRtIrXZhXP+eU8YTOGiYRkIaeSKEsfJXNC3+kIIooWDucykjHmTqqcTVUVcrvJs5RETqR+83XsvItyxKkkKR13S1xnVJsbMj87NAhqKO7elaSs3uae0ixAvo3Ew1ObUct5yxULloqUeZ2mZ8XMjfOHsTRidCtgw92QHdL/1sIzi4Xf0OqQsYTaZslWZbWQ9TYqO41/6bP5zELfmREIihYO5zKShX5s6rXEJgqcam4x2UJeqSPD7Rogy3lPJUnphDejOiNDm6vX/CTRIHjSONG9LRk2cPXult3aGIVsb8LD7v6aNkBtsWApT5nXaXrW5rmF5YGMYYf3E/ZaYeOZi4xhYO6GOhxLLpi7gUDGMDAXAMBcAABzAQDMBcDcHMzO6kBqo1LJZg0W7TP0utsY4SYPzO2jNrJbA+7Jm7n7+cT9PF1SBrVosDxzuwmLqgUKA4/tmtu4pqXM9Y80md8aJ7kHKyqu6ij+7NBFMgOAuUMzNyylLcwtarDAXDB3Meir/Vd8nNtNbSSYW0fMtYoAK86ix9bLGqxY7MWssO1LlZSUxwkdHPUKHAvm2ifVxnXVU200JVlgnWGuEWfVyZqb02BFYq+REE3FKqlIHid0cKFX4Bgw117t/d5CD7URPQQ3dU/LCeb6WzbJ3KwGS4q9IitilVQkjxNPtodegWPAXMsBz9weaqMpF1H5J+VDtFDlmJvVYEnhgbCiSlRSkTxOqIlCr8CxY24PtRF/DYiRVA7HXCGailVSQh4H5h73aMHK1nupjcQLbObdmJvTYGWZKzQgsUqKyeOiaAHMPU53aCOr2an7qo383oLWPRrOFJg74XdoGQ1WLPYKVpgVNlJJRfI4oYOjXnGXdjx2xXRI+00fLXRXG3mRmd6fGk/YAcFcp0eqGjRYkdiLWeGsEyopKY8TOjjqFSqh48FcAABzAQDMBcBcAABzAQDMBcBcAABzAQDMBQAwFwBzAQDMBQAwFwBzAQDMBQAwFwDAXADMBQAwFwDAXADMBQAwFwDAXOC4MvevAGDzoJj71wCweQBzATAXAMBcAABzATAXAMBcAABzATAXAMBcAABzAeCwmbu9MQg2f2elQD/L9gPmFpm7s0J8B/0s289hMXdnIwDmgrlgLpgL5oK56AfMBXPBXDAXjAJzdz/62PwZFLu3D4G5C1q+hozKjCIcahtij372THLcsZ+cO9/9ZOfu33y8c/fTezt3/vbepjB3b3y/4/zb8e6vDXO7W77UTJthf++TlTE3tP/Z54fE3J292/qPndAH9/7u+2pW9x7cU8y98/Dv/2FDmPvZ5z+wHunA3P7sWCVze1i+HHN103cf3V4ZcxvbXyVz9VprFtudgwf3dnbvK+bu3d+YaOHgwQ8f7W8kc3tYvjxzd+48vL9K5hbbXxFzTbDw2efKfwe3DY81dLSwOXHurrL/tpj/u49sTGA+2L9uc+ZaD+q/dUlb6Efjj37sDv+YV9vVV6QH2h+ibKi6BHN7WD4Ac/XVlEahOrbjCr5Ylrmmfd3QnYdmDJ99bh23+9FPHtmIlIZY6K3/mquW2R395ycPVaTwyMa+drY2gLl31bK1Z4IsP/8H2m93H93fOVCH7zxUf5mvZnCxPm7qHZhzupr2rDl85+G+qLarQtE7D3Wromz4uDhz+1g+BHPv/uMnZLailR7XbRr08muuaV+Nwqy9//Txzj+Tv8z3/L4dZoPfFmGuWm8/+5dP9Nfkvl9vN+YOTX/TjV/8/LurljquJ+Tge/963/iULjEP7qlhmvOWFsbh+ntqDh9E1cw6kSvrPy7O3D6WD8LcR/tktiXPnvPFQfMy1ZW56puoRnH30T6Lh+5Zf/kFuclvC0QLOjwwYa67Jm7SmqvXDcUje1n6mHlOf7l3dQSk/OrjW/avnjE/1n13tXSHRTVztd4L16J9dlkv7FN0ZG4vywdac8lsG6ZoOvlBD7bmquXcBWVjFo+YQekhlv22yJq7s7uvAwa9LbZpa+7BmFyRzv/eR//2+b4a0e59eYemimg3h9XBeldPrV4NeLXAXFGWLywLMreX5QPFuWR2YK4f9HBxrv5a6wuI+niQMneA6Icz98DdhHx6b8OY60ImG1DF11w1K//+qboe/sd3P4n2FtR9121+N7zrWrlvN3hYNc/cqGzTjXo35vazfKC9BTI7MNcPepi9BXerpwJ2E0DvUbQghzgEc803f99cuQyJNyxa8N9h95U2f/b0MnZgb29/oL+a/+kiocBcFUPum2BJ3xH9V3D4f//P/o6stktXVVmWPi7K3H6WL8/cA3Nj6c0OzPWDXpa5B3774O7/mkHpYdx9pJlr7n79paXBb71+q9NBrqHr/+lQx8R+m7Xm7rovmP7q0d7SAf1ktOdv1vlvaGa1dRe4sd/p+ti2Yptj1Yi5cVn/cVHm9rN8+d/QXHfObMZcP+glf0OzjZiR2DGoox9930QLP3KBrb3bHQ+yK2YX2j23Q2J+/XXMbd/TfQyfuHHbq0tiw564aR/0uj5xs+d/cr6t42nD2IPy9+KxZm7brcpjydz2QeNZsbVn7u4QS+6mMbd90GDumjN3bzzMI5IbxdwugwZz8WT5xs80mAvmglHHibl43wKYC+biHTfo57CYCwCrAJgLgLkAAOYCAJgLgLkAAOYCAJgLgLkAAOYCAJgLAGAu8JgwFwA2Ef8PXgyzZSEUD6MAAAAASUVORK5CYII=" alt="img"></p>
</li>
<li>
<p>c盘用户下添加文件 .prettierrc</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;printWidth&quot;</span>: <span class="number">200</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改setting.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;prettier.configPath&quot;</span>: <span class="string">&quot;C:\\你的用户路径\\.prettierrc&quot;</span></span><br><span class="line">    <span class="string">&quot;eslint.alwaysShowStatus&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;prettier.trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">    <span class="string">&quot;prettier.semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 每行文字个数超出此限制将会被迫换行&quot;</span></span><br><span class="line">    <span class="string">&quot;prettier.printWidth&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="comment">//使用单引号替换双引号</span></span><br><span class="line">    <span class="string">&quot;prettier.singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;prettier.arrowParens&quot;</span>: <span class="string">&quot;avoid&quot;</span>,</span><br><span class="line">    <span class="comment">//设置.vue文件中，HTML代码的格式化插件</span></span><br><span class="line">    <span class="string">&quot;vetur.format.defaultFormatter.html&quot;</span>: <span class="string">&quot;js-beautify-html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vetur.ignoreProjectWarning&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;vetur.format.defaultFormatterOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;prettier&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;trailingComma&quot;</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">      <span class="string">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;arrowParens&quot;</span>: <span class="string">&quot;avoid&quot;</span>,</span><br><span class="line">      <span class="string">&quot;printWidth&quot;</span>: <span class="number">300</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;prettyhtml&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;printWidth&quot;</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;wrapAttributes&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&quot;sortAttributes&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;js-beautify-html&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;wrap_attributes&quot;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="传参方式汇总"><strong>传参方式汇总</strong></h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. 父组件通过props向下传递数据给子组件。在引入的子组件中绑定自定义属性 = 数据名</span><br><span class="line">子组件通过props中定义绑定的自定义属性接收,  注：组件中的数据共有三种形式：data、props、computed</span><br><span class="line">子组件向父组件传值（通过事件形式） 父组件使用子组件,  子事件中通过$emit触发父组件绑定的事件并把参数传过去</span><br><span class="line"></span><br><span class="line">2. $attrs和$listeners: 多级组件嵌套需要传递数据时，通常使用的方法是通过vuex。但如果仅仅是传递数据，而不做中间处理，使用 vuex 处理，未免有点大材小用</span><br><span class="line">$attrs:包含了父作用域中不被 prop 所识别 (且获取) 的特性绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (class 和 style 除外)，并且可以通过 v-bind=&quot;$attrs&quot; 传入内部组件。</span><br><span class="line">通常配合 interitAttrs 选项一起使用。如果你不希望组件的根元素继承特性，你可以在组件的选项中设置 inheritAttrs: false</span><br><span class="line">$listeners:包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on=&quot;$listeners&quot; 传入内部组件</span><br><span class="line">简单来说: $attrs 与 $listeners是两个对象, $attrs里存放的是父组件中绑定的非 Props 属性,$listeners里存放的是父组件中绑定的非原生事件。</span><br><span class="line"></span><br><span class="line">3. 中央事件总线 如果两个组件不是父子关系呢？这种情况下可以使用中央事件总线的方式。</span><br><span class="line">新建一个Vue事件bus对象，然后通过bus.$emit触发事件，bus.$on监听触发的事件。</span><br><span class="line">平级(兄弟)组件之间的通信 一个全局的发布订阅方式  eventBus 比较适合简单的数据流</span><br><span class="line"></span><br><span class="line">4. provide和inject 他们成对出现，用于父级组件向下传递数据</span><br><span class="line">父组件中通过provide来提供变量，然后在子组件中通过inject来注入变量。不论子组件有多深，只要调用了inject,那么就可以注入provide中的数据。而不是局限于只能从当前父组件的prop属性来获取数据，只要在父组件的生命周期内，子组件都可以调用。 provide / inject API 主要解决了跨级组件间的通信问题，不过它的使用场景，主要是子组件获取上级组件的状态，跨级组件间建立了一种主动提供与依赖注入的关系</span><br><span class="line"></span><br><span class="line">5. $parent / $children </span><br><span class="line">$parent / $children : 访问父/子实例</span><br><span class="line">需要注意的是：这两种都是直接得到组件实例，使用后可以直接调用组件的方法或访问数据。</span><br><span class="line">这种方法的弊端是，无法在兄弟间通信,另外,$parent只能是直系后代获取，多个层级后代组件就只能$parent.$parent, 同时父级获取孙子级$children[0].$children[0]</span><br><span class="line"></span><br><span class="line">6. ref: 如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例, 所以可以访问子组件的数据和方法, 通过调用方法实现父传子</span><br><span class="line"></span><br><span class="line">7. vuex处理组件之间的数据交互</span><br><span class="line">如果业务逻辑复杂，很多组件之间需要同时处理一些公共的数据，这个时候使用上面这一些方法可能不利于项目的维护，vuex的做法就是将这一些公共的数据抽离出来，然后其他组件就可以对这个公共数据进行读写操作，这样达到了解耦的目的。</span><br><span class="line"></span><br><span class="line">8. slot插槽 此方式用于父组件向子组件传递&quot;标签数据&quot;。也即子组件先有一个&quot;占位符&quot;, 等待父组件传入具体的标签，子组件再进行渲染。注意： 因为传递的具体的标签是在父组件，所以操作也应该放在父组件中。也就是说应该在父组件运行好之后再传入子组件。 </span><br><span class="line">v-slot: +插槽名+ =&quot;自定义数据名&quot;，子组件所传参数都是其属性 :自定义数据名=父级传来的自定义数据名</span><br><span class="line">在某个组件中写出插槽的位置和name 在其它组件中通过slot与name关联</span><br><span class="line"></span><br><span class="line">总结: 常见使用场景如下</span><br><span class="line">父向子传递数据是通过 props，子向父是通过$emit, </span><br><span class="line">通过父链 / 子链也可以通信($parent/$children)</span><br><span class="line">ref 也可以访问组件实例; provide/inject; $attrs/$listeners</span><br><span class="line">兄弟通信 Bus; Vuex</span><br><span class="line">跨级通信 Bus; Vuex; provide/inject; $attrs/$listeners</span><br></pre></td></tr></table></figure>
<h5 id="parent-children">$parent &amp; $children</h5>
<p>$parent / $children : 访问父/子实例</p>
<p>需要注意的是：这两种都是直接得到组件实例，使用后可以直接调用组件的方法或访问数据。</p>
<p>这种方法的弊端是，无法在兄弟间通信，另外，$parent只能是直系后代获取，多个层级后代组件就只能$parent.$parent, 同时父级获取孙子级$children[0].$children[0]</p>
<p>GrandFather.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">html</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;grandFatherMsg&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;changeFather&#x27;</span>&gt;</span>改变Father的数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">father</span>&gt;</span><span class="tag">&lt;/<span class="name">father</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Father</span> <span class="keyword">from</span> <span class="string">&#x27;./Father.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;grandFather&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">grandFatherMsg</span>: <span class="string">&#x27;爷爷的数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Father</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeFather</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$children</span>[<span class="number">0</span>].<span class="property">fatherMsg</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$children</span>[<span class="number">0</span>].<span class="property">fatherMsg</span> = <span class="string">&#x27;爷爷修改了数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$children</span>[<span class="number">0</span>].<span class="title function_">changeGrandFather</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Father.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;fatherMsg&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeGrandFather&quot;</span>&gt;</span>修改grandFather的数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">son</span>&gt;</span><span class="tag">&lt;/<span class="name">son</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;father&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fatherMsg</span>: <span class="string">&#x27;father组件的数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Son</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeGrandFather</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$parent</span>.<span class="property">grandFatherMsg</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$parent</span>.<span class="property">grandFatherMsg</span> = <span class="string">&#x27;father组件修改了数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;悄悄说爷爷坏话&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Son.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;sonMsg&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;changeGrandFather&#x27;</span>&gt;</span>修改爷爷组件数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;son&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">sonMsg</span>: <span class="string">&#x27;son组件数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeGrandFather</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$parent</span>.<span class="property">$parent</span>.<span class="property">grandFatherMsg</span> = <span class="string">&#x27;xxx&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="attrs-listeners">$attrs &amp; $listeners</h5>
<p>$attrs和$listeners: 多级组件嵌套需要传递数据时，通常使用的方法是通过vuex。但如果仅仅是传递数据，而不做中间处理，使用 vuex 处理，未免有点大材小用</p>
<p>$attrs:包含了父作用域中不被 prop 所识别 (且获取) 的特性绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (class 和 style 除外)，并且可以通过 v-bind=“$attrs” 传入内部组件。</p>
<p>通常配合 interitAttrs 选项一起使用。如果你不希望组件的根元素继承特性，你可以在组件的选项中设置 inheritAttrs: false</p>
<p>$listeners:包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on=“$listeners” 传入内部组件</p>
<p>简单来说: $attrs 与 $listeners是两个对象, $attrs里存放的是父组件中绑定的非 Props 属性,</p>
<p>$listeners里存放的是父组件中绑定的非原生事件。</p>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    用户名: <span class="tag">&lt;<span class="name">grand-father</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">:msg</span>=<span class="string">&#x27;msg&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">grand-father</span>&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">grand-father</span> <span class="attr">type</span>=<span class="string">&#x27;password&#x27;</span> <span class="attr">:msg2</span>=<span class="string">&#x27;msg2&#x27;</span> @<span class="attr">appHandle</span>=<span class="string">&#x27;appHandle&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">grand-father</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">GrandFather</span> <span class="keyword">from</span> <span class="string">&#x27;./components/GrandFather.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>: <span class="string">&#x27;111&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg2</span>: <span class="string">&#x27;222&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">appHandle</span>(<span class="params">msg</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;app的方法&#x27;</span> + msg)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">GrandFather</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>GrandFather.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &#123;&#123;grandFatherMsg&#125;&#125;</span></span><br><span class="line"><span class="comment">    &lt;button @click=&#x27;changeFather&#x27;&gt;改变Father的数据&lt;/button&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">father</span>&gt;</span><span class="tag">&lt;/<span class="name">father</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-bind</span>=<span class="string">&#x27;$attrs&#x27;</span> <span class="attr">v-on</span>=<span class="string">&#x27;$listeners&#x27;</span> @<span class="attr">click</span>=<span class="string">&#x27;changeFather&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Father</span> <span class="keyword">from</span> <span class="string">&#x27;./Father.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;grandFather&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: [<span class="string">&#x27;msg2&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 不希望组件的根元素继承特性</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">grandFatherMsg</span>: <span class="string">&#x27;爷爷的数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Father</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeFather</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$listeners</span>.<span class="title function_">appHandle</span>(e.<span class="property">target</span>.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Father.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;fatherMsg&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeGrandFather&quot;</span>&gt;</span>修改grandFather的数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind</span>=<span class="string">&#x27;$attrs&#x27;</span> <span class="attr">v-on</span>=<span class="string">&#x27;$listeners&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">son</span>&gt;</span><span class="tag">&lt;/<span class="name">son</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Son</span> <span class="keyword">from</span> <span class="string">&#x27;./Son.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;father&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fatherMsg</span>: <span class="string">&#x27;father组件的数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Son</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeGrandFather</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">msg</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Son.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;&#123;sonMsg&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&#x27;changeGrandFather&#x27;</span>&gt;</span>修改爷爷组件数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;son&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">sonMsg</span>: <span class="string">&#x27;son组件数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeGrandFather</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="面试题汇总">面试题汇总</h4>
<p><strong>1、在data，props，computed中如果定义了相同名字的数据，那么在页面中会优先显示哪个数据，为什么？</strong></p>
<p>答：在vue的源码中有一个 initState 的方法 ，该方法就是用来初始化所有组件配置项内容，在该方法中，判断的优先顺序是 props &gt; methods &gt; data &gt; computed 所以props中的内容会优先级最高，后面一旦有重名出现，会报错。</p>
<hr>
<p><strong>2、为什么v-if和v-for不建议用在同一标签 ?</strong></p>
<p><strong>优先级</strong><br>
v-if与v-for都是vue模板系统中的指令</p>
<p>在vue模板编译的时候，会将指令系统转化成可执行的render函数</p>
<p><strong>示例</strong></p>
<p>编写一个p标签，同时使用v-if与 v-for</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in items&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.title &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建<code>vue</code>实例，存放<code>isShow</code>与<code>items</code>数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">items</span>: [</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;foo&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">title</span>: <span class="string">&quot;baz&quot;</span> &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">isShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span> &gt; <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>模板指令的代码都会生成在render函数中，通过app.$options.render就能得到渲染函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ƒ <span class="title function_">anonymous</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">with</span> (<span class="variable language_">this</span>) &#123; <span class="keyword">return</span> </span><br><span class="line">    <span class="title function_">c</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">attrs</span>: &#123; <span class="string">&quot;id&quot;</span>: <span class="string">&quot;app&quot;</span> &#125; &#125;, </span><br><span class="line">    <span class="title function_">_l</span>((items), <span class="keyword">function</span> (<span class="params">item</span>) </span><br><span class="line">    &#123; <span class="keyword">return</span> (isShow) ? <span class="title function_">_c</span>(<span class="string">&#x27;p&#x27;</span>, [<span class="title function_">v</span>(<span class="string">&quot;\n&quot;</span> + <span class="title function_">_s</span>(item.<span class="property">title</span>) + <span class="string">&quot;\n&quot;</span>)]) : <span class="title function_">_e</span>() &#125;), <span class="number">0</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>_l是vue的列表渲染函数，函数内部都会进行一次if判断</p>
<p>初步得到结论：v-for优先级是比v-if高</p>
<p>再将v-for与v-if置于不同标签</p>
<p>再输出下render函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ƒ <span class="title function_">anonymous</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">with</span>(<span class="params"><span class="variable language_">this</span></span>)&#123;<span class="keyword">return</span> </span><br><span class="line">    <span class="title function_">c</span>(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="attr">attrs</span>:&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;app&quot;</span>&#125;&#125;,</span><br><span class="line">    [(isShow)?[<span class="title function_">v</span>(<span class="string">&quot;\n&quot;</span>),</span><br><span class="line">    <span class="title function_">l</span>((items),<span class="keyword">function</span>(<span class="params">item</span>)&#123;<span class="keyword">return</span> <span class="title function_">_c</span>(<span class="string">&#x27;p&#x27;</span>,[<span class="title function_">v</span>(<span class="title function_">s</span>(item.<span class="property">title</span>))])&#125;)]:<span class="title function_">e</span>()],<span class="number">2</span>)&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时候我们可以看到，v-for与v-if作用在不同标签时候，是先进行判断，再进行列表的渲染</p>
<p>我们再在查看下vue源码</p>
<p><strong>源码位置：\vue-dev\src\compiler\codegen\index.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">genElement</span> (<span class="attr">el</span>: <span class="title class_">ASTElement</span>, <span class="attr">state</span>: <span class="title class_">CodegenState</span>): string &#123;</span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">parent</span>) &#123;</span><br><span class="line">    el.<span class="property">pre</span> = el.<span class="property">pre</span> || el.<span class="property">parent</span>.<span class="property">pre</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">staticRoot</span> &amp;&amp; !el.<span class="property">staticProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genStatic</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">once</span> &amp;&amp; !el.<span class="property">onceProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genOnce</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">for</span> &amp;&amp; !el.<span class="property">forProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genFor</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">if</span> &amp;&amp; !el.<span class="property">ifProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genIf</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;template&#x27;</span> &amp;&amp; !el.<span class="property">slotTarget</span> &amp;&amp; !state.<span class="property">pre</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genChildren</span>(el, state) || <span class="string">&#x27;void 0&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;slot&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genSlot</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// component or element</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在进行if判断的时候，v-for是比v-if先进行判断</p>
<p>最终结论：v-for优先级比v-if高</p>
<p><strong>注意事项</strong><br>
1、永远不要把 v-if 和 v-for 同时用在同一个元素上，带来性能方面的浪费（每次渲染都会先循环再进行条件判断）<br>
2、如果避免出现这种情况，则在外层嵌套template（页面渲染不生成dom节点），在这一层进行v-if判断，然后在内部进行v-for循环</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in items&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、如果条件出现在循环内部，可通过计算属性computed提前过滤掉那些不需要显示的项</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="attr">items</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> item.<span class="property">isShow</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>3、vue的优点？</strong><br>
1、Vue.js 可以进行组件化开发，使代码编写量大大减少，读者更加易于理解。<br>
2、Vue.js 最突出的优势在于可以对数据进行双向绑定（在之后的编写中我们会明显地感觉到这个特点的便捷）。<br>
3、使用 Vue.js 编写出来的界面效果本身就是响应式的，这使网页在各种设备上都能显示出非常好看的效果。<br>
4、相比传统的页面通过超链接实现页面的切换和跳转，Vue 使用路由不会刷新页面。<br>
说明：Vue必须在ES5版本以上的环境下使用，一些不支持ES5的旧浏览器中无法运行Vue。</p>
<hr>
<p><strong>4、什么是虚拟dom ?</strong><br>
Virtual DOM 其实就是一棵以 JavaScript 对象( VNode 节点)作为基础的树，用对象属性来描述节点，实际上它只是一层对真实 DOM 的抽象。最终可以通过一系列操作使这棵树映射到真实环境上。<br>
简单来说，可以把Virtual DOM 理解为一个简单的JS对象，并且最少包含标签名( tag)、属性(attrs)和子元素对象( children)三个属性。不同的框架对这三个属性的命名会有点差别。</p>
<hr>
<p><strong>5、为什么要使用虚拟dom</strong></p>
<p>1、虚拟dom相对于真实dom体积小 操作性能消耗比较小</p>
<p>2、虚拟dom的操作不会引起回流和重绘</p>
<p>3、频繁操作虚拟dom 过程中会调用patch方法进行比对和修改 最后将发生变化的一部分dom进行回流重绘 减少过多的dom回流重绘</p>
<p>4、虚拟dom可以跨平台 如果我们直接操作真实dom 只能在浏览器上使用</p>
<hr>
<p><strong>5、如何解决vue打包后静态资源失效的问题？</strong><br>
答: 设置assetsPublicPath将 assetsPublicPath: ‘/’ 改为 assetsPublicPath: ‘./’<br>
找到config/index.js 配置文件，找build打包对象里的assetsPublicPath属性<br>
默认值为/，更改为./就好了</p>
<hr>
<p><strong>6、vue组件里写的原生addEventListeners监听事件，要手动去销毁吗？为什么？vue会帮我们移除哪些事件？</strong><br>
答: 原生的document.addEventListener事件比如keydown，keyup，vue当然监测不到，无法移除监听，你需要自己销毁<br>
Vue会帮你移除的，只有使用Vue事件绑定语法绑定的事件（例如@click）</p>
<hr>
<p><strong>7、vue如何优化首页的加载速度？</strong><br>
答:<br>
(1) 减少请求的次数:<br>
a.请求合并：将同一时间需要的js合并，目的是节省dns查找的时间<br>
b.按需加载 —（1）单页应用下的按照路由的需要加载 （2）缓存<br>
c.css sprite base64 iconfont<br>
d.cdn托管<br>
e.延迟加载：图片的延迟加载、js的延迟加载<br>
(2) a.精简代码（tree-shaking）----(1)去除无用的代码 (2)规范些代码的方式 (3)外部cdn的引入<br>
b.懒加载 —（1）路由的懒加载<br>
c.压缩 —（1）webpack 压缩UglifyJsPlugin；（2）gzip压缩 (3)图片压缩、JPG优化<br>
d.缓存http代码：—浏览器的强缓存（max-age Etag）和协商(弱)缓存（last-modified）<br>
(3) a.减少全局变量；b.减少全局组件；c.减少dom操作， 减少DOM访问，使用事件代理<br>
css样式放在页面前面<br>
延迟js加载<br>
避免CSS表达式，避免@import</p>
<p><strong>8、diff算法原理</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">理解：</span><br><span class="line"><span class="number">1.</span> 先同级比较，在比较子节点</span><br><span class="line"><span class="number">2.</span> 先判断一方有儿子一方没儿子的情况</span><br><span class="line"><span class="number">3.</span> 比较都有儿子的情况</span><br><span class="line"><span class="number">4.</span> 递归比较子节点</span><br><span class="line">原理: core / vdom / patch.<span class="property">js</span></span><br><span class="line"><span class="keyword">const</span> oldCh = oldVnode.<span class="property">children</span> <span class="comment">// 老的儿子</span></span><br><span class="line"><span class="keyword">const</span> ch = vnode.<span class="property">children</span> <span class="comment">// 新的儿子</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isUndef</span>(vnode.<span class="property">text</span>)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh) &amp;&amp; <span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">    <span class="comment">// 比较孩子</span></span><br><span class="line">    <span class="keyword">if</span> (oldCh !== ch) <span class="title function_">updateChildren</span>(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(ch)) &#123;</span><br><span class="line">    <span class="comment">// 新的儿子有 老的没有</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="title function_">addVnodes</span>(elm, <span class="literal">null</span>, ch, <span class="number">0</span>, ch.<span class="property">length</span> - <span class="number">1</span>, insertedVnodeQueue)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldCh)) &#123;</span><br><span class="line">    <span class="comment">// 如果老的有新的没有 就删除</span></span><br><span class="line">    <span class="title function_">removeVnodes</span>(oldCh, <span class="number">0</span>, oldCh.<span class="property">length</span> - <span class="number">1</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isDef</span>(oldVnode.<span class="property">text</span>)) &#123;</span><br><span class="line">    <span class="comment">// 老的有文本 新的没文本</span></span><br><span class="line">    nodeOps.<span class="title function_">setTextContent</span>(elm, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 将老的清空</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVnode.<span class="property">text</span> !== vnode.<span class="property">text</span>) &#123;</span><br><span class="line">  <span class="comment">// 文本不相同替换</span></span><br><span class="line">  nodeOps.<span class="title function_">setTextContent</span>(elm, vnode.<span class="property">text</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateChildren</span>(<span class="params">parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> oldStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> newStartIdx = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldEndIdx = oldCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line">  <span class="keyword">let</span> newEndIdx = newCh.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">  <span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class="line">  <span class="keyword">let</span> oldKeyToIdx, idxInOld, vnodeToMove, refElm</span><br><span class="line">  <span class="comment">// removeOnly is a special flag used only by &lt;transition-group&gt;</span></span><br><span class="line">  <span class="comment">// to ensure removed elements stay in correct relative positions</span></span><br><span class="line">  <span class="comment">// during leaving transitions</span></span><br><span class="line">  <span class="keyword">const</span> canMove = !removeOnly</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">checkDuplicateKeys</span>(newCh)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldStartVnode)) &#123;</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx] <span class="comment">// Vnode has been moved left</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldEndVnode)) &#123;</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">      <span class="comment">// Vnode moved right</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldStartVnode.<span class="property">elm</span>, nodeOps.<span class="title function_">nextSibling</span>(oldEndVnode.<span class="property">elm</span>))</span><br><span class="line">      oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">      newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">      <span class="comment">// Vnode moved left</span></span><br><span class="line">      <span class="title function_">patchVnode</span>(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, oldEndVnode.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">      oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldKeyToIdx)) oldKeyToIdx = <span class="title function_">createKeyToOldIdx</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      idxInOld = <span class="title function_">isDef</span>(newStartVnode.<span class="property">key</span>) ? oldKeyToIdx[newStartVnode.<span class="property">key</span>] : <span class="title function_">findIdxInOld</span>(newStartVnode, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isUndef</span>(idxInOld)) &#123;</span><br><span class="line">        <span class="comment">// New element</span></span><br><span class="line">        <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vnodeToMove = oldCh[idxInOld]</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">sameVnode</span>(vnodeToMove, newStartVnode)) &#123;</span><br><span class="line">          <span class="title function_">patchVnode</span>(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">          oldCh[idxInOld] = <span class="literal">undefined</span></span><br><span class="line">          canMove &amp;&amp; nodeOps.<span class="title function_">insertBefore</span>(parentElm, vnodeToMove.<span class="property">elm</span>, oldStartVnode.<span class="property">elm</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// same key but different element. treat as new element</span></span><br><span class="line">          <span class="title function_">createElm</span>(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.<span class="property">elm</span>, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    refElm = <span class="title function_">isUndef</span>(newCh[newEndIdx + <span class="number">1</span>]) ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].<span class="property">elm</span></span><br><span class="line">    <span class="title function_">addVnodes</span>(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    <span class="title function_">removeVnodes</span>(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>vue2</category>
      </categories>
      <tags>
        <tag>vue2</tag>
      </tags>
  </entry>
  <entry>
    <title>uniapp 学习</title>
    <url>/blog/2023/08/09/uniapp/</url>
    <content><![CDATA[<h4 id="uniapp直播app全栈开发">uniapp直播app全栈开发</h4>
<p><code>uni-app</code> 是一个使用 <a href="https://vuejs.org/">Vue.js</a> 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、Web（响应式）、以及各种小程序</p>
<p><code>uni-app</code>在手，做啥都不愁。即使不跨端，<code>uni-app</code>也是更好的小程序开发框架（<a href="https://ask.dcloud.net.cn/article/35947">详见</a>）、更好的App跨平台框架、更方便的H5开发框架</p>
<p><a href="https://uniapp.dcloud.net.cn/">一套代码编到十几个平台，这不是梦想，眼见为实，扫描以下二维码，亲自体验最全面的跨平台效果！</a></p>
<span id="more"></span>
<p><img data-src="image-20240331192251944.png" alt="image-20240331192251944"></p>
<p><img data-src="image-20240331192329137.png" alt="image-20240331192329137"></p>
<p><img data-src="image-20240331192354083.png" alt="image-20240331192354083"></p>
<h4 id="课程大纲">课程大纲</h4>
<p><img data-src="image-20240331192542004.png" alt="image-20240331192542004"></p>
<h4 id="课程特色">课程特色</h4>
<p><img data-src="image-20240331192609468.png" alt="image-20240331192609468"></p>
<p><img data-src="image-20240331192631417.png" alt="image-20240331192631417"></p>
<h4 id="前端项目创建">前端项目创建</h4>
<ul>
<li>新建默认模板项目</li>
<li>引入全局样式文件</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    <span class="comment">/*每个页面公共css */</span></span><br><span class="line">    <span class="keyword">@import</span> url(<span class="string">&#x27;common/free.css&#x27;</span>);</span><br><span class="line">    <span class="keyword">@import</span> url(<span class="string">&#x27;common/common.css&#x27;</span>);</span><br><span class="line">    <span class="comment">/* #ifndef APP-NVUE */</span></span><br><span class="line">    <span class="keyword">@import</span> url(<span class="string">&#x27;common/iconfont.css&#x27;</span>);</span><br><span class="line">    <span class="comment">/* #endif */</span></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>引入图标库</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">onLaunch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> domModule = uni.requireNativePlugin(<span class="string">&#x27;dom&#x27;</span>)</span><br><span class="line">    domModule.<span class="title function_">addRule</span>(<span class="string">&#x27;fontFace&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;fontFamily&#x27;</span>: <span class="string">&quot;iconfont&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;src&#x27;</span>: <span class="string">&quot;url(&#x27;http://at.alicdn.com/t/c/font_4489745_elaicw45h77.ttf?t=1711886201103&#x27;)&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">测试</span><br><span class="line">&lt;text <span class="keyword">class</span>=<span class="string">&quot;iconfont&quot;</span>&gt;&amp;#xe619;&lt;/text&gt;</span><br></pre></td></tr></table></figure>
<h5 id="底部导航栏配置">底部导航栏配置</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;tabBar&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;color&quot;</span>:<span class="string">&quot;#707070&quot;</span>,</span><br><span class="line">    <span class="string">&quot;selectedColor&quot;</span>:<span class="string">&quot;#8745FF&quot;</span>,</span><br><span class="line">    <span class="string">&quot;backgroundColor&quot;</span>:<span class="string">&quot;#FFFFFF&quot;</span>,</span><br><span class="line">    <span class="string">&quot;borderStyle&quot;</span>:<span class="string">&quot;black&quot;</span>,</span><br><span class="line">    <span class="string">&quot;midButton&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;static/tabbar/min.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iconWidth&quot;</span>:<span class="string">&quot;60px&quot;</span>,</span><br><span class="line">        <span class="string">&quot;height&quot;</span>:<span class="string">&quot;65px&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;list&quot;</span>:[&#123;</span><br><span class="line">        <span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;./static/tabbar/find.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;selectedIconPath&quot;</span>:<span class="string">&quot;static/tabbar/find-selected.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pagePath&quot;</span>:<span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>:<span class="string">&quot;发现&quot;</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        <span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;static/tabbar/my.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;selectedIconPath&quot;</span>:<span class="string">&quot;static/tabbar/my-selected.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pagePath&quot;</span>:<span class="string">&quot;pages/my/my&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>:<span class="string">&quot;我的&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>监听midButton</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">onLaunch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="comment">// 监听底部导航中间凸起按钮</span></span><br><span class="line">	uni.<span class="title function_">onTabBarMidButtonTap</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了中间按钮&#x27;</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h5 id="首页开发">首页开发</h5>
<p><img data-src="image-20240403083223403.png" alt="image-20240403083223403"></p>
<p>pages.json</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;enablePullDownRefresh&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;app-plus&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;titleNView&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;titleText&quot;</span>:<span class="string">&quot;直播&quot;</span>,</span><br><span class="line">                <span class="string">&quot;titleAlign&quot;</span>:<span class="string">&quot;left&quot;</span>,</span><br><span class="line">                <span class="string">&quot;buttons&quot;</span>:[&#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>:<span class="string">&quot;menu&quot;</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>轮播图</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:indicator-dots</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:autoplay</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:interval</span>=<span class="string">&quot;3000&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;200&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 750rpx;height: 250rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../static/img/banner/1.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 750rpx;height: 250rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../static/img/banner/2.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 750rpx;height: 250rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>列表</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-wrap&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 375rpx; padding: 5rpx;box-sizing: border-box; position: relative;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../static/logo.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 365rpx; height: 365rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFill&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle px-2 flex align-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;left: 15rpx;top: 15rpx;background-color: rgba(0,0,0,0.4);&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-bizhongguanli text-warning mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle px-2 flex align-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;right: 15rpx;top: 15rpx;background-color: rgba(0,0,0,0.4);&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-sm text-white&quot;</span>&gt;</span>人气：<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle flex align-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;left: 15rpx;bottom: 15rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle px-2 flex align-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: absolute;right: 15rpx;bottom: 15rpx;background-color: rgba(0,0,0,0.4);&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">style</span>=<span class="string">&quot;width: 20rpx;height: 20rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle mr-1 bg-danger&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>已结束<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="直播间开发">直播间开发</h5>
<p><img data-src="image-20240403083253974.png" alt="image-20240403083253974"></p>
<ul>
<li>引入动画</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="基础布局">基础布局</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">video</span> <span class="attr">class</span>=<span class="string">&quot;flex-1&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app-video-courses.mp4&quot;</span> <span class="attr">auto-play</span> <span class="attr">controls</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- 头部 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;right: 0;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!-- 个人信息 观看详细信息 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 80rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!-- 金币 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 80rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-dark&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!-- 收到的礼物 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 500rpx;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 500rpx; width: 520rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-main&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- 弹幕 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed; bottom: 120rpx; left: 0; right: 0; width: 520rpx; height: 300rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-primary&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- 底部 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;bottom: 0;right: 0;height: 120rpx;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">class</span>=<span class="string">&quot;flex align-center justify-between bg-danger&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 导航栏高度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// statusBarHeight: 0</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 获取导航栏高度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// let res = uni.getSystemInfoSync()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// this.statusBarHeight = res.statusBarHeight</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.page</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">	<span class="attribute">flex</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">	<span class="comment">/* #ifdef H5 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">	<span class="attribute">height</span>: <span class="number">100vh</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">	<span class="comment">/* #endif */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h6 id="个人信息和观看情况">个人信息和观看情况</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 个人信息 观看详细信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 80rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;px-2 flex justify-between align-center&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 左边 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 325rpx;background-color: rgba(0,0,0,0.4);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-row justify-between align-center rounded-circle&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p flex-row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/tabbar/min.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex flex-column justify-center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>老许<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle flex align-center justify-center bg-danger&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white text-center&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 右边 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 325rpx;background-color: rgba(0,0,0,0.4);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex rounded-circle&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 实时在线观看用户情况 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-x</span>=<span class="string">&quot;true&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;i in 5&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/tabbar/min.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle flex align-center justify-center bg-danger&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 实时在线观看人数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>&#123;&#123; 1000 &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="金币">金币</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 金币 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 80rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;px-2 my-2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 325rpx;background-color: rgba(0,0,0,0.4);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex rounded-circle align-center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-warning&quot;</span>&gt;</span>金币<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex flex-column justify-center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="接收礼物组件">接收礼物组件</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 收到的礼物 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">style</span>=<span class="string">&quot;width: 520rpx;height: 500rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center px-3 pt-3&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 325rpx;background-image: linear-gradient(to right, #BCABB1 , #65AAF0);&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex rounded-circle&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;../../static/logo.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex flex-column justify-center&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>送小花<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/tabbar/find-selected.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-warning font-lg ml-1&quot;</span>&gt;</span>X 100<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="封装接收礼物组件">封装接收礼物组件</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">components/live/gift.<span class="property">vue</span></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">list</span> <span class="attr">style</span>=<span class="string">&quot;height: 500rpx; width: 520rpx;&quot;</span> <span class="attr">:show-scrollbar</span>=<span class="string">&quot;false&quot;</span> <span class="attr">:bounce</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">cell</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center px-3 pt-3&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in gifts&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">:ref</span>=<span class="string">&quot;&#x27;gift&#x27;+index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 325rpx;background-image: linear-gradient(to right, #BCABB1 , #65AAF0);&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">class</span>=<span class="string">&quot;flex rounded-circle&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.avatar || defaultAvatar&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex flex-column justify-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>&#123;&#123;item.username&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm&quot;</span>&gt;</span>送&#123;&#123;item.gift&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.giftImg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 70rpx;height: 70rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-warning font-lg ml-1&quot;</span>&gt;</span>X &#123;&#123;item.giftNum&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">cell</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">cell</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendGift&quot;</span>&gt;</span>送礼<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">cell</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> dom = uni.requireNativePlugin(<span class="string">&#x27;dom&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">defaultAvatar</span>: <span class="string">&#x27;/static/img/1.jpg&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">		<span class="attr">gifts</span>: []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 送礼</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">sendGift</span>(<span class="params">gift</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="property">gifts</span>.<span class="title function_">push</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">id</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">username</span>: <span class="string">&quot;小姐姐&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">avatar</span>: <span class="string">&quot;/static/img/2.jpg&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">gift</span>: <span class="string">&quot;小心心&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">giftImg</span>: <span class="string">&quot;/static/gift/7.png&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">giftNum</span>: <span class="number">100</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 调用滚动到指定位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="title function_">scrollTo</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 自动移除第一个元素</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">autoRemove</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 滚动到指定位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">scrollTo</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">gifts</span>.<span class="property">length</span> - <span class="number">1</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> ref = <span class="string">&#x27;gift&#x27;</span> + index</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$refs</span>[ref]) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        dom.<span class="title function_">scrollToElement</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>[ref][<span class="number">0</span>], &#123;&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 自动移除第一个元素</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">autoRemove</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">gifts</span>.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">5000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">   &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后将sendGift方法暴露给live.nvue使用即可</span></span><br></pre></td></tr></table></figure>
<h6 id="底部导航栏">底部导航栏</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;bottom: 0;right: 0;height: 120rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-between&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;px-2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn px-3&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openInput&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>说点什么...<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 40px;&quot;</span>&gt;</span><span class="symbol">&amp;#xe620;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon bg-warning&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont&quot;</span>&gt;</span><span class="symbol">&amp;#xe63e;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon&quot;</span> @<span class="attr">click</span>=<span class="string">&#x27;back&#x27;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white&quot;</span>&gt;</span><span class="symbol">&amp;#xeaf2;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.btn</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">80</span>rpx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">100</span>rpx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.12</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.btn-icon</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">80</span>rpx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-right</span>: <span class="number">20</span>rpx;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 封装成组件</span><br></pre></td></tr></table></figure>
<h6 id="导航栏关闭按钮">导航栏关闭按钮</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;bottom: 0;right: 0;height: 120rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn px-5&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-right: 220rpx;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openInput&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;b1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>说点什么...<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;b2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 40px;&quot;</span>&gt;</span><span class="symbol">&amp;#xe620;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon bg-warning&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;b3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont&quot;</span>&gt;</span><span class="symbol">&amp;#xe63e;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-icon&quot;</span> @<span class="attr">click</span>=<span class="string">&#x27;clickBtn&#x27;</span> <span class="attr">ref</span>=<span class="string">&quot;main_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;main_image&quot;</span>&gt;</span><span class="symbol">&amp;#xeaf2;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title class_">Binding</span> = uni.requireNativePlugin(<span class="string">&#x27;bindingx&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 控制展开收缩</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">isExpanded</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">getEl</span>: <span class="keyword">function</span>(<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> el === <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> el === <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> el;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="title class_">WXEnvironment</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> el.<span class="property">ref</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> el <span class="keyword">instanceof</span> <span class="title class_">HTMLElement</span> ? el : el.<span class="property">$el</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">collapse</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_btn = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">main_btn</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_image = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">main_image</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b1 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b1</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b2 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b2</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b3 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b3</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_binding = <span class="title class_">Binding</span>.<span class="title function_">bind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">exitExpression</span>: <span class="string">&#x27;t&gt;800&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">props</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: main_image,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.rotateZ&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&#x27;easeOutQuint(t,45,0-45,800)&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: main_btn,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;background-color&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;evaluateColor(&#x27;#607D8B&#x27;,&#x27;#ff0000&#x27;,min(t,800)/800)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;]</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (res.<span class="property">state</span> === <span class="string">&#x27;exit&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Binding</span>.<span class="title function_">unbind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">token</span>: main_binding.<span class="property">token</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> btn_binding = <span class="title class_">Binding</span>.<span class="title function_">bind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">exitExpression</span>: <span class="string">&#x27;t&gt;800&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">props</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b1,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;easeOutQuint(t,-150,150,-550)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b2,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;t&lt;=100?0:easeOutQuint(t-100,-300,300,-450)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b3,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;t&lt;=200?0:easeOutQuint(t-200,-450,450,-350)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;]</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (res.<span class="property">state</span> === <span class="string">&#x27;exit&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Binding</span>.<span class="title function_">unbind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">token</span>: btn_binding.<span class="property">token</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">expand</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_btn = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">main_btn</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_image = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">main_image</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b1 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b1</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b2 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b2</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> b3 = <span class="variable language_">this</span>.<span class="title function_">getEl</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">b3</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> main_binding = <span class="title class_">Binding</span>.<span class="title function_">bind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">exitExpression</span>: <span class="string">&#x27;t&gt;100&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">props</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: main_image,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.rotateZ&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&#x27;linear(t,0,45,100)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: main_btn,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;background-color&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;evaluateColor(&#x27;#ff0000&#x27;,&#x27;#607D8B&#x27;,min(t,100)/100)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;]</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (res.<span class="property">state</span> === <span class="string">&#x27;exit&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Binding</span>.<span class="title function_">unbind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">token</span>: main_binding.<span class="property">token</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> btn_binding = <span class="title class_">Binding</span>.<span class="title function_">bind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">exitExpression</span>: <span class="string">&#x27;t&gt;800&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">props</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b1,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;easeOutBounce(t,0,550,800)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b2,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;t&lt;=100?0:easeOutBounce(t-100,0,450,700)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">element</span>: b3,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">property</span>: <span class="string">&#x27;transform.translateX&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">expression</span>: <span class="string">&quot;t&lt;=200?0:easeOutBounce(t-200,0,300,600)&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;]</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (res.<span class="property">state</span> === <span class="string">&#x27;exit&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title class_">Binding</span>.<span class="title function_">unbind</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">token</span>: btn_binding.<span class="property">token</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">eventType</span>: <span class="string">&#x27;timing&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">clickBtn</span>: <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isExpanded</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">collapse</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">expand</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">isExpanded</span> = !<span class="variable language_">this</span>.<span class="property">isExpanded</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="弹幕组件">弹幕组件</h6>
<p><a href="https://uniapp.dcloud.net.cn/component/uniui/uni-popup.html#uni-popup-%E5%BC%B9%E5%87%BA%E5%B1%82"><strong>popup弹出层</strong></a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 底部弹出层 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uni-popup</span> <span class="attr">ref</span>=<span class="string">&quot;popup&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-white flex align-center px-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;border rounded flex-1 px-3 font-md&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;说点什么...&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 80rpx;&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center py-2 px-2 ml-3 rounded&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;content === &#x27;&#x27; ? &#x27;bg-main-disabled&#x27; : &#x27;bg-main&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-white&quot;</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">uni-popup</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// 关闭指定的弹出层</span></span><br><span class="line">  <span class="title function_">close</span>(<span class="params">str</span>) &#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">$refs</span>[str].<span class="title function_">close</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">openInput</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">popup</span>.<span class="title function_">open</span>(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">submit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">trim</span>() == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">barrageCom</span>.<span class="title function_">sendBarrage</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>),</span><br><span class="line">        <span class="attr">username</span>: <span class="string">&#x27;河南匿名吴彦祖&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="variable language_">this</span>.<span class="property">content</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">content</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">popup</span>.<span class="title function_">close</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">back</span>(<span class="params"></span>)&#123;</span><br><span class="line">    uni.<span class="title function_">navigateBack</span>(&#123;<span class="attr">delta</span>:<span class="number">1</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>弹幕</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 弹幕 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed; bottom: 120rpx; left: 0; right: 0; width: 520rpx; height: 300rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 520rpx;height: 300rpx;&quot;</span> <span class="attr">scroll-with-animation</span> <span class="attr">class</span>=<span class="string">&quot;pl-3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:scroll-into-view</span>=<span class="string">&quot;scrollInToView&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>  <span class="attr">class</span>=<span class="string">&quot;flex justify-start align-start rounded p-2 mb-2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;background-color: rgba(255,255,255,0.125);&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;i in 5&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md text-danger&quot;</span>&gt;</span>骑着蜗牛泡妞：<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md text-white&quot;</span>&gt;</span>小姐姐你好鸭<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>提取成组件barrage.vue</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed; bottom: 120rpx; left: 0; right: 0; width: 520rpx; height: 300rpx;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">scroll-y</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 520rpx;height: 300rpx;&quot;</span> <span class="attr">scroll-with-animation</span> <span class="attr">class</span>=<span class="string">&quot;pl-3&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:scroll-into-view</span>=<span class="string">&quot;scrollInToView&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">:id</span>=<span class="string">&quot;&#x27;danmu&#x27;+item.id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex justify-start align-start rounded p-2 mb-2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: rgba(255,255,255,0.125);&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">v-for</span>=<span class="string">&quot;item in barrageList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md text-info&quot;</span>&gt;</span>&#123;&#123;item.username&#125;&#125;:<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md text-white&quot;</span>&gt;</span>&#123;&#123;item.content&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">scrollInToView</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">barrageList</span>: [&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">id</span>: <span class="number">1</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">username</span>: <span class="string">&#x27;骑着蜗牛泡妞&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">content</span>: <span class="string">&#x27;小姐姐你好鸭&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">id</span>: <span class="number">2</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">username</span>: <span class="string">&#x27;河南吴彦祖&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">content</span>: <span class="string">&#x27;小姐姐单身吗&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">id</span>: <span class="number">3</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">username</span>: <span class="string">&#x27;京城彭于晏&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">       <span class="attr">content</span>: <span class="string">&#x27;小姐姐处对象吗&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> id = <span class="number">3</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">barrageList</span>.<span class="title function_">push</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            id,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">username</span>: <span class="string">&#x27;河南匿名吴彦祖&#x27;</span> + id,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">content</span>: <span class="string">&#x27;讲真的老许比老何帅!&#x27;</span> + id</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 置于底部</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="title function_">toBottom</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        id++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;, <span class="number">3000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">toBottom</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">let</span> len = <span class="variable language_">this</span>.<span class="property">barrageList</span>.<span class="property">length</span> - <span class="number">1</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (len &gt; <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">barrageList</span>[len]) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">             <span class="variable language_">this</span>.<span class="property">scrollInToView</span> = <span class="string">&#x27;danmu&#x27;</span> + <span class="variable language_">this</span>.<span class="property">barrageList</span>[len].<span class="property">id</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, <span class="number">300</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后将sendBarrage方法暴露给live.nvue使用即可</span></span><br></pre></td></tr></table></figure>
<h6 id="送礼物组件">送礼物组件</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- 送礼物弹出层 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uni-popup</span> <span class="attr">type</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;giftPopup&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-white&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 750rpx;height: 550rpx;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex justify-between align-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-main font-md ml-3&quot;</span>&gt;</span>礼物<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100rpx;height: 100rpx;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;closeGift&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont&quot;</span>&gt;</span><span class="symbol">&amp;#xe607;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">:indicator-dots</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;500&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 350rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;border-bottom border-top&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-wrap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 187.5rpx;height: 175rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column justify-center align-center&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in gifts&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;giftActiveId === item.id ? &#x27;border border-main&#x27; : &#x27;&#x27;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    @<span class="attr">click</span>=<span class="string">&quot;giftActiveId = item.id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;item.image&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100rpx;height: 100rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex mt-1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-warning font mr-1&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-secondary font&quot;</span>&gt;</span>&#123;&#123;item.coin&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-end&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center py-2 px-2 mr-3 rounded bg-warning&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openCoin&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font&quot;</span>&gt;</span>充值<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center py-2 px-2 mr-3 rounded bg-main&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;sendGift&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-white&quot;</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">uni-popup</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">content</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">gifts</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/1.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;鸡蛋&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/2.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;666&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/3.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;雪糕&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">3</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/4.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;龙虾&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/5.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;精灵球&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">5</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/6.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;胶囊&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">6</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/7.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;爱心&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">7</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;image&quot;</span>: <span class="string">&quot;/static/gift/8.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;花&quot;</span>,</span><br><span class="line">        <span class="string">&quot;coin&quot;</span>: <span class="number">8</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="attr">giftActiveId</span>: <span class="number">0</span>,</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">back</span>(<span class="params"></span>) &#123;</span><br><span class="line">        uni.<span class="title function_">navigateBack</span>(&#123;</span><br><span class="line">            <span class="attr">delta</span>: <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">openGift</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">giftPopup</span>.<span class="title function_">open</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">sendGift</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">giftActiveId</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;请选择要发送的礼物&#x27;</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">gifts</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === <span class="variable language_">this</span>.<span class="property">giftActiveId</span>)</span><br><span class="line">        <span class="keyword">if</span> (index === -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> g = <span class="variable language_">this</span>.<span class="property">gifts</span>[index]</span><br><span class="line">        <span class="comment">// 发送礼物</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">giftCom</span>.<span class="title function_">sendGift</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>),</span><br><span class="line">            <span class="attr">username</span>: <span class="string">&quot;小姐姐&quot;</span>,</span><br><span class="line">            <span class="attr">avatar</span>: <span class="string">&quot;/static/img/2.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">gift</span>: g.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">giftImg</span>: g.<span class="property">image</span>,</span><br><span class="line">            <span class="attr">giftNum</span>: <span class="number">1</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">giftActiveId</span> = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">closeGift</span>(<span class="string">&#x27;giftPopup&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="充值金币页">充值金币页</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;border-top border-light-secondary p-3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;rounded py-4 flex flex-column align-center justify-center bg-main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-sm mb-2&quot;</span>&gt;</span>当前金币<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-weight-bold text-white&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 60rpx;&quot;</span>&gt;</span>50<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;border-top border-light-secondary my-3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-sm text-muted&quot;</span>&gt;</span>请选择充值金币<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-wrap&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: -20rpx;margin-right: -20rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;width: 33.3%;box-sizing: border-box;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;p-2&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;chooseCoin(index)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;item.price &gt; 0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 130rpx;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;border rounded flex flex-column align-center justify-center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">&quot; activeIndex === index ? &#x27;border-main&#x27; : &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-warning mr-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe631;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md font-weight-bold&quot;</span>&gt;</span>&#123;&#123;item.coin&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-light-muted&quot;</span>&gt;</span>￥&#123;&#123;item.price&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span> <span class="attr">style</span>=<span class="string">&quot;height: 130rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;border rounded flex flex-column align-center justify-center&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-light-muted&quot;</span>&gt;</span>自定义<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;position-fixed left-0 bottom-0 right-0 border-top flex px-3 align-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-warning mr-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe631;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md font-weight-bold&quot;</span>&gt;</span>&#123;&#123;price&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-main rounded flex align-center justify-center ml-auto&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 150rpx;height: 70rpx;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-md&quot;</span>&gt;</span>去充值<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 自定义充值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">activeIndex</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">list</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">coin</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">10</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">coin</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">20</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">coin</span>: <span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">30</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">coin</span>: <span class="number">50</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">50</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">coin</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">price</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    &#125;],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">price</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">chooseCoin</span>(<span class="params">index</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">activeIndex</span> = index</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> p = <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">price</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (p &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">price</span> = p</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="自定义充值弹出层">自定义充值弹出层</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义充值弹出层 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uni-popup</span> <span class="attr">ref</span>=<span class="string">&quot;coinPopup&quot;</span> <span class="attr">type</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uni-popup-dialog</span> <span class="attr">mode</span>=<span class="string">&quot;input&quot;</span> <span class="attr">title</span>=<span class="string">&quot;自定义充值&quot;</span> <span class="attr">:duration</span>=<span class="string">&quot;2000&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;充值金额&quot;</span> <span class="attr">inputType</span>=<span class="string">&quot;number&quot;</span> <span class="attr">:before-close</span>=<span class="string">&quot;true&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;close&quot;</span> @<span class="attr">confirm</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">uni-popup-dialog</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">uni-popup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">price</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">chooseCoin</span>(<span class="params">index</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">activeIndex</span> = index</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> p = <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">price</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (p &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">price</span> = p</span></span><br><span class="line"><span class="language-javascript">      &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 自定义价格</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">coinPopup</span>.<span class="title function_">open</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">close</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// before-close 为true的情况下，手动执行 close 才会关闭对话框</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">coinPopup</span>.<span class="title function_">close</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">confirm</span>(<span class="params">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!value) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> uni.<span class="title function_">showToast</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&#x27;请输入要充值的金额&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 充值</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">price</span> = value</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">coinPopup</span>.<span class="title function_">close</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">pay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">currentPrice</span> += <span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">price</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 发请求</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">showToast</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>: <span class="string">&#x27;充值成功&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// uni.navigateBack(&#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   delta: 1</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="直播预览">直播预览</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建nvue页面</span></span><br><span class="line"><span class="comment">// 修改page.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;path&quot;</span> : <span class="string">&quot;pages/clive/clive&quot;</span>,</span><br><span class="line">  <span class="string">&quot;style&quot;</span> : </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;app-plus&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;titleNView&quot;</span>: <span class="literal">false</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="直播推流组件">直播推流组件</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">live-pusher</span> <span class="attr">id</span>=<span class="string">&#x27;livePusher&#x27;</span> <span class="attr">ref</span>=<span class="string">&quot;livePusher&quot;</span> <span class="attr">class</span>=<span class="string">&quot;livePusher&quot;</span> <span class="attr">:url</span>=<span class="string">&quot;url&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;HD&quot;</span> <span class="attr">:muted</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:enable-camera</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:auto-focus</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:beauty</span>=<span class="string">&quot;5&quot;</span> <span class="attr">whiteness</span>=<span class="string">&quot;5&quot;</span> <span class="attr">aspect</span>=<span class="string">&quot;9:16&quot;</span> @<span class="attr">statechange</span>=<span class="string">&quot;statechange&quot;</span> @<span class="attr">netstatus</span>=<span class="string">&quot;netstatus&quot;</span> @<span class="attr">error</span>=<span class="string">&quot;error&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;`height:$&#123;windowHeight&#125;px;`&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 750rpx;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">live-pusher</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">context</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 窗口高度</span></span></span><br><span class="line"><span class="language-javascript">		<span class="attr">windowHeight</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 状态栏高度 </span></span></span><br><span class="line"><span class="language-javascript">		<span class="attr">statusBarHeight</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> res = uni.<span class="title function_">getSystemInfoSync</span>()</span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">this</span>.<span class="property">windowHeight</span> = res.<span class="property">windowHeight</span></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">this</span>.<span class="property">statusBarHeight</span> = res.<span class="property">statusBarHeight</span></span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">this</span>.<span class="property">context</span> = uni.<span class="title function_">createLivePusherContext</span>(<span class="string">&#x27;livePusher&#x27;</span>, <span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">this</span>.<span class="title function_">startPreview</span>()</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// 开启直播预览</span></span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">startPreview</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">startPreview</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="attr">success</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">				<span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">			&#125;</span></span><br><span class="line"><span class="language-javascript">		&#125;)</span></span><br><span class="line"><span class="language-javascript">	&#125;,</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// 直播状态变化</span></span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">statechange</span>(<span class="params">e</span>) &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// 直播网络变化</span></span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">netstatus</span>(<span class="params">e</span>) &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">	<span class="comment">// 错误</span></span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">error</span>(<span class="params">e</span>) &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">back</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	  uni.<span class="title function_">navigateBack</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">delta</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">	  &#125;);</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="直播页布局">直播页布局</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;right: 0;height: 500rpx;&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;`top:$&#123;statusBarHeight&#125;px`&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 90rpx;height: 90rpx;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;back&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white&quot;</span>&gt;</span><span class="symbol">&amp;#xeaf2;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;position-absolute rounded p-2 flex align-center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;left: 90rpx;right: 100rpx;height: 160rpx;background-color: rgba(0,0,0,0.2);&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 120rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;position-relative rounded&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/gift/3.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 120rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white position-absolute font&quot;</span> <span class="attr">style</span>=<span class="string">&quot;left: 0;right: 0;bottom: 0;&quot;</span>&gt;</span>更换封面<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 ml-2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入直播标题&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mb-2&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-md&quot;</span>&gt;</span>#请选择分类<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;position-absolute right-0 flex flex-column &quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100rpx;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;switchCamera&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white mb-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe605;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>翻转<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openPopup(&#x27;mode&#x27;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white mb-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe60c;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>画质<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openPopup(&#x27;beauty&#x27;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white mb-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe632;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>美颜<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;height: 120rpx;width: 100rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openPopup(&#x27;whiteness&#x27;)&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white mb-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe631;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>美白<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;position-fixed bg-main flex align-center justify-center rounded-circle&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;left: 100rpx;right: 100rpx;bottom: 100rpx;height: 120rpx;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-md&quot;</span>&gt;</span>开始视频直播<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="镜头翻转">镜头翻转</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 切换摄像头</span></span><br><span class="line"><span class="title function_">switchCamera</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">switchCamera</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>:<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">position</span> = <span class="variable language_">this</span>.<span class="property">position</span> === <span class="string">&#x27;back&#x27;</span> ? <span class="string">&#x27;front&#x27;</span> : <span class="string">&#x27;back&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h6 id="画质切换">画质切换</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-popup</span> <span class="attr">type</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;popup&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-white&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center border-bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 90rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>&#123;&#123;popupTitle&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 画质选择 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;popupType === &#x27;mode&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center py-2&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in modeList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;mode === item.type ? &#x27;bg-main&#x27; : &#x27;&#x27;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;chooseMode(item)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;mode === item.type ? &#x27;text-white&#x27; : &#x27;&#x27;&quot;</span>&gt;</span>&#123;&#123;item.desc&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;f-divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>  <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 90rpx;&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-light&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;closePopup&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">uni-popup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">context</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">windowHeight</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">statusBarHeight</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">modeList</span>:[&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>:<span class="string">&quot;SD&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">desc</span>:<span class="string">&quot;标清&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>:<span class="string">&quot;HD&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">desc</span>:<span class="string">&quot;高清&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>:<span class="string">&quot;FHD&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">desc</span>:<span class="string">&quot;超清&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">popupTitle</span>: <span class="string">&#x27;画质选择&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">popupType</span>:<span class="string">&quot;mode&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"> &#125;,</span></span><br><span class="line"><span class="language-javascript"> <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 画质选择</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">chooseMode</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">mode</span> = item.<span class="property">type</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">showToast</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&#x27;画质切换为&#x27;</span> + item.<span class="property">desc</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">closePopup</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">openPopup</span>(<span class="params">type</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">popupType</span> = type</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">popup</span>.<span class="title function_">open</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">closePopup</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">popup</span>.<span class="title function_">close</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;   </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>	</span><br></pre></td></tr></table></figure>
<h6 id="美颜美白">美颜美白</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else-if</span>=<span class="string">&quot;popupType === &#x27;beauty&#x27;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slider</span> <span class="attr">:min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">:step</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;beauty&quot;</span> <span class="attr">:block-size</span>=<span class="string">&quot;18&quot;</span> <span class="attr">show-value</span> @<span class="attr">change</span>=<span class="string">&quot;handleSliderChange&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slider</span> <span class="attr">:min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">:step</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;whiteness&quot;</span> <span class="attr">:block-size</span>=<span class="string">&quot;18&quot;</span> <span class="attr">show-value</span></span></span><br><span class="line"><span class="tag">@<span class="attr">change</span>=<span class="string">&quot;handleSliderChange&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 美颜</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">beauty</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 美白</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">whiteness</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"> &#125;,</span></span><br><span class="line"><span class="language-javascript"> <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSliderChange</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">	   <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">popupType</span>] = e.<span class="property">detail</span>.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;   </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>	</span><br></pre></td></tr></table></figure>
<h6 id="退出黑边问题">退出黑边问题</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">v-<span class="keyword">if</span>控制data中的showBars</span><br><span class="line">在返回的生命中修改状态即可</span><br><span class="line"><span class="title function_">onBackPress</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">showBars</span> = <span class="literal">false</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h5 id="主播直播间">主播直播间</h5>
<h6 id="携带参数跳转">携带参数跳转</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">openLiveRoom</span>(<span class="params"></span>)&#123;</span><br><span class="line">  uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/pages/liveroom/liveroom?options=&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">mode</span>: <span class="variable language_">this</span>.<span class="property">mode</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="variable language_">this</span>.<span class="property">position</span>,</span><br><span class="line">        <span class="attr">beauty</span>: <span class="variable language_">this</span>.<span class="property">beauty</span>,</span><br><span class="line">        <span class="attr">whiteness</span>: <span class="variable language_">this</span>.<span class="property">whiteness</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="直播间布局">直播间布局</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- live.nuve、clive内容修改 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 底部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;position: fixed;left: 0;bottom: 0;right: 0;height: 120rpx;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-between&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex-1 flex flex-column align-center justify-center&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in btns&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;handleBottomEvent(item)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont text-white mb-1&quot;</span>&gt;</span>&#123;&#123;item.icon&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">uni-popup</span> <span class="attr">type</span>=<span class="string">&quot;bottom&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;popup&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-white&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center border-bottom&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 90rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>&#123;&#123;popupTitle&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 画质选择 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;popupType === &#x27;mode&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center py-2&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in modeList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;mode === item.type ? &#x27;bg-main&#x27; : &#x27;&#x27;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;chooseMode(item)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;mode === item.type ? &#x27;text-white&#x27; : &#x27;&#x27;&quot;</span>&gt;</span>&#123;&#123;item.desc&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美颜 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else-if</span>=<span class="string">&quot;popupType === &#x27;beauty&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slider</span> <span class="attr">:min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">:step</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;beauty&quot;</span> <span class="attr">:block-size</span>=<span class="string">&quot;18&quot;</span> <span class="attr">show-value</span> @<span class="attr">change</span>=<span class="string">&quot;handleSliderChange&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 美白 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else-if</span>=<span class="string">&quot;popupType === &#x27;whiteness&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slider</span> <span class="attr">:min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">:max</span>=<span class="string">&quot;9&quot;</span> <span class="attr">:step</span>=<span class="string">&quot;1&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;whiteness&quot;</span> <span class="attr">:block-size</span>=<span class="string">&quot;18&quot;</span> <span class="attr">show-value</span> @<span class="attr">change</span>=<span class="string">&quot;handleSliderChange&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 更多 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 150rpx;height: 150rpx;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;pauseOrPlay&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont mb-1&quot;</span>&gt;</span>&#123;&#123; isPause ? &#x27;<span class="symbol">&amp;#xe667;</span>&#x27;: &#x27;<span class="symbol">&amp;#xe662;</span>&#x27;  &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font&quot;</span>&gt;</span>&#123;&#123; isPause ? &#x27;继续&#x27; : &#x27;暂停&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 150rpx;height: 150rpx;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;back&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont mb-1&quot;</span>&gt;</span><span class="symbol">&amp;#xe630;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;f-divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>  <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;height: 90rpx;&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-light&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;closePopup&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">uni-popup</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">btns</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;翻转&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&quot;\ue605&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">event</span>: <span class="string">&quot;switchCamera&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;画质&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&quot;\ue60c&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">event</span>: <span class="string">&quot;openPopup&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">params</span>: <span class="string">&quot;mode&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;美颜&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&quot;\ue619&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">event</span>: <span class="string">&quot;openPopup&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">params</span>: <span class="string">&quot;beauty&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;美白&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&quot;\ue60b&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">event</span>: <span class="string">&quot;openPopup&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">params</span>: <span class="string">&quot;whiteness&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&quot;更多&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: <span class="string">&quot;\ue620&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">event</span>: <span class="string">&quot;openPopup&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">params</span>: <span class="string">&quot;more&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">mode</span>: <span class="string">&quot;HD&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">enableCamera</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">position</span>: <span class="string">&quot;front&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">beauty</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">whiteness</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">windowHeight</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">statusBarHeight</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">isPause</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onLoad</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> res = uni.<span class="title function_">getSystemInfoSync</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">statusBarHeight</span> = res.<span class="property">statusBarHeight</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (e.<span class="property">options</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> options = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(e.<span class="property">options</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">mode</span> = options.<span class="property">mode</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">position</span> = options.<span class="property">position</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">beauty</span> = options.<span class="property">beauty</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">whiteness</span> = options.<span class="property">whiteness</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">context</span> = uni.<span class="title function_">createLivePusherContext</span>(<span class="string">&#x27;livePusher&#x27;</span>, <span class="variable language_">this</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">startPreview</span>()</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleBottomEvent</span>(<span class="params">item</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>[item.<span class="property">event</span>](item.<span class="property">params</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">openPopup</span>(<span class="params">type</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">popupType</span> = type</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">popup</span>.<span class="title function_">open</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换摄像头</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">switchCamera</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">switchCamera</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>:<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">position</span> = <span class="variable language_">this</span>.<span class="property">position</span> === <span class="string">&#x27;back&#x27;</span> ? <span class="string">&#x27;front&#x27;</span> : <span class="string">&#x27;back&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSliderChange</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">popupType</span>] = e.<span class="property">detail</span>.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">pauseOrPlay</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">isPause</span> = !<span class="variable language_">this</span>.<span class="property">isPause</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">back</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">showModal</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">content</span>: <span class="string">&#x27;是否要退出直播间？&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (res.<span class="property">cancel</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          uni.<span class="title function_">navigateBack</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">delta</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">          uni.<span class="title function_">showToast</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">title</span>: <span class="string">&#x27;退出直播间成功&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 开启预览</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">startPreview</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">startPreview</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>:<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// console.log(e);</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="个人中心">个人中心</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;!user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">style</span>=<span class="string">&quot;width: 180rpx;height: 180rpx;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/2.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 105rpx;height: 105rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>未登录<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-muted&quot;</span>&gt;</span>登录体验更多功能<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;ml-auto mr-3&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;border border-main rounded flex align-center justify-center p-2&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-light&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;openLogin&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-main font&quot;</span>&gt;</span>立即登录<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">v-else</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">style</span>=<span class="string">&quot;width: 180rpx;height: 180rpx;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/2.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 105rpx;height: 105rpx;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex flex-column&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font text-muted&quot;</span>&gt;</span>个签<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;ml-auto mr-3&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;border border-main rounded flex align-center justify-center p-2&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-light&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-main font&quot;</span>&gt;</span>编辑资料<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;f-divider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">f-list-item</span> <span class="attr">icon</span>=<span class="string">&quot;iconfaxian&quot;</span> <span class="attr">title</span>=<span class="string">&quot;我的金币&quot;</span> <span class="attr">:showRight</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font&quot;</span>&gt;</span>50金币 立即充值<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">f-list-item</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">f-list-item</span> <span class="attr">icon</span>=<span class="string">&quot;iconfaxian&quot;</span> <span class="attr">title</span>=<span class="string">&quot;我的直播&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">f-list-item</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">f-list-item</span> <span class="attr">icon</span>=<span class="string">&quot;iconfaxian&quot;</span> <span class="attr">title</span>=<span class="string">&quot;我的关注&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font&quot;</span>&gt;</span>0<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">f-list-item</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">f-list-item</span> <span class="attr">icon</span>=<span class="string">&quot;iconfaxian&quot;</span> <span class="attr">title</span>=<span class="string">&quot;历史记录&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">f-list-item</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> fListItem <span class="keyword">from</span> <span class="string">&#x27;@/components/common/f-list-item.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    fListItem</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">user</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">openLogin</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">navigateTo</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="list-item-vue">list-item.vue</h6>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p-3 flex align-center&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-light&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;iconfont mr-3&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;font-md&quot;</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;ml-auto&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">v-if</span>=<span class="string">&quot;showRight&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font ml-2&quot;</span>&gt;</span>&gt;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">icon</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">showRight</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">default</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="后端项目创建">后端项目创建</h4>
<h5 id="egg基础讲解">egg基础讲解</h5>
<p><a href="https://www.eggjs.org/zh-CN">egg官网</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">创建项目</span><br><span class="line">mkdir egg-example &amp;&amp; cd egg-example</span><br><span class="line">npm init egg --type=simple</span><br><span class="line">npm i</span><br><span class="line"></span><br><span class="line">启动项目</span><br><span class="line">npm run dev</span><br><span class="line">open <span class="attr">http</span>:<span class="comment">//localhost:7001</span></span><br></pre></td></tr></table></figure>
<h5 id="创建控制器">创建控制器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Controller</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;egg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;hi, egg&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">HomeController</span>;</span><br></pre></td></tr></table></figure>
<h5 id="路由编写接口">路由编写接口</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controll/home.js</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">list</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;</span><br><span class="line">   <span class="attr">msg</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">   <span class="attr">data</span>: [</span><br><span class="line">     &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">     &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">     &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span>, <span class="attr">age</span>: <span class="number">16</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.js</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/list&#x27;</span>, controller.<span class="property">home</span>.<span class="property">list</span>);</span><br></pre></td></tr></table></figure>
<h6 id="路由传参两种方式">路由传参两种方式</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controll/user.js</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 用户列表</span></span><br><span class="line">  <span class="keyword">let</span> userList = [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;小明&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;小红&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;小王&quot;</span>, <span class="attr">age</span>: <span class="number">16</span> &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Controller</span> <span class="keyword">extends</span> <span class="title class_ inherited__">app.Controller</span> &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">userlist</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: userList</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getUserById</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 获取params传参</span></span><br><span class="line">      <span class="comment">// let id = this.ctx.params.id</span></span><br><span class="line">      <span class="comment">// 获取query传参 =&gt; 注意路由不需要添加占位符</span></span><br><span class="line">      <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">query</span>.<span class="property">id</span></span><br><span class="line">      <span class="comment">// 查询</span></span><br><span class="line">      <span class="keyword">let</span> user = userList.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> == id)</span><br><span class="line">      <span class="comment">// 修改状态码</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">status</span> = <span class="number">201</span></span><br><span class="line">      <span class="comment">// 响应</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: user</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Controller</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.js</span></span><br><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>, controller.<span class="property">user</span>.<span class="property">userlist</span>);</span><br><span class="line"><span class="comment">// 获取某个用户的信息</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/user/:id&#x27;</span>, controller.<span class="property">user</span>.<span class="property">getUserById</span>);</span><br></pre></td></tr></table></figure>
<h6 id="关闭csrf开启跨域">关闭csrf开启跨域</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">createUser</span>(<span class="params"></span>)&#123;</span><br><span class="line">  userList.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;小黑&quot;</span>, <span class="attr">age</span>: <span class="number">16</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 修改状态码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">status</span> = <span class="number">201</span></span><br><span class="line">  <span class="comment">// 响应</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: userList</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// post请求 创建用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/create&#x27;</span>, controller.<span class="property">user</span>.<span class="property">createUser</span>)</span><br></pre></td></tr></table></figure>
<p>安装<code>npm i egg-cors --save</code></p>
<p>配置插件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#123;app_root&#125;/config/plugin.js</span></span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-cors&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>config/config.default.js</code> 配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">config.<span class="property">security</span> = &#123;</span><br><span class="line">  <span class="comment">// 关闭 csrf</span></span><br><span class="line">  <span class="attr">csrf</span>: &#123;</span><br><span class="line">    <span class="attr">enable</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 跨域白名单</span></span><br><span class="line">  <span class="attr">domainWhiteList</span>: [<span class="string">&quot;http://localhost:3000&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 允许跨域的方法</span></span><br><span class="line">config.<span class="property">cors</span> = &#123;</span><br><span class="line">  <span class="attr">origin</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="attr">allowMethods</span>: <span class="string">&quot;GET, PUT, POST, DELETE, PATCH&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="资源路由">资源路由</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; router, controller &#125; = app;</span><br><span class="line">  router.<span class="title function_">resources</span>(<span class="string">&#x27;/posts&#x27;</span>, <span class="string">&#x27;/api/posts&#x27;</span>, controller.<span class="property">posts</span>)</span><br><span class="line">  router.<span class="title function_">resources</span>(<span class="string">&#x27;/users&#x27;</span>, <span class="string">&#x27;/api/v1/users&#x27;</span>, controller.<span class="property">v1</span>.<span class="property">users</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码就在/posts路径上部署了一组CRUD 路径结构，对应的Controller为 <code>app/controller/posts.js</code> 接下来,你只需要在<code>posts.is</code>里面实现对应的函数就可以了。</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Path</th>
<th>Route Name</th>
<th>Controller.Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/posts</td>
<td>posts</td>
<td>app.controllers.posts.index</td>
</tr>
<tr>
<td>GET</td>
<td>/posts/new</td>
<td>new_post</td>
<td>app.controllers.posts.new</td>
</tr>
<tr>
<td>GET</td>
<td>/posts/:id</td>
<td>post</td>
<td>app.controllers.posts.show</td>
</tr>
<tr>
<td>GET</td>
<td>/posts/:id/edit</td>
<td>edit_post</td>
<td>app.controllers.posts.edit</td>
</tr>
<tr>
<td>POST</td>
<td>/posts</td>
<td>posts</td>
<td>app.controllers.posts.create</td>
</tr>
<tr>
<td>PUT</td>
<td>/posts/:id</td>
<td>post</td>
<td>app.controllers.posts.update</td>
</tr>
<tr>
<td>DELETE</td>
<td>/posts/:id</td>
<td>post</td>
<td>app.controllers.posts.destory</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/posts.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 列表页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;列表页&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增表单页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">new</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;新增表单页&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;新增逻辑&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 详情页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">show</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;详情页&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 编辑表单页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">edit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;编辑表单页&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;更新逻辑&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">destory</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = <span class="string">&#x27;删除逻辑&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="路由分组">路由分组</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/new&#x27;</span>)(app)</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;./router/admin&#x27;</span>)(app)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/news.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/news/list&#x27;</span>, app.<span class="property">controller</span>.<span class="property">news</span>.<span class="property">list</span>),</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/news/detail&#x27;</span>, app.<span class="property">controller</span>.<span class="property">news</span>.<span class="property">detail</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/router/admin.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/admin/user&#x27;</span>, app.<span class="property">controller</span>.<span class="property">admin</span>.<span class="property">user</span>),</span><br><span class="line">  app.<span class="property">router</span>.<span class="title function_">get</span>(<span class="string">&#x27;/admin/log&#x27;</span>, app.<span class="property">controller</span>.<span class="property">admin</span>.<span class="property">log</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数据库迁移"><a href="https://www.eggjs.org/zh-CN/tutorials/sequelize">数据库迁移</a></h5>
<ul>
<li>安装并配置<a href="https://github.com/eggjs/egg-sequelize">egg-sequelize</a>插件（它会辅助我们将定义好的 Model 对象加载到 app 和 ctx上）和<a href="https://github.com/sidorares/node-mysql2">mysql2</a>模块：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save egg-sequelize mysql2</span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>config/plugin.js</code>中引入 egg-sequelize 插件</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">sequelize</span> = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&quot;egg-sequelize&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>config/config.default.js</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">config.<span class="property">sequelize</span> = &#123;</span><br><span class="line">  <span class="attr">dialect</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&quot;egg-video&quot;</span>,</span><br><span class="line">  <span class="comment">// 中国时区</span></span><br><span class="line">  <span class="attr">timezone</span>: <span class="string">&quot;+08:00&quot;</span>,</span><br><span class="line">  <span class="attr">define</span>: &#123;</span><br><span class="line">    <span class="comment">// 取消数据表名复数</span></span><br><span class="line">    <span class="attr">freezeTableName</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 自动写入时间戳 created_at updated_at</span></span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 字段生成软删除时间戳 deleted_at</span></span><br><span class="line">    <span class="comment">// paranoid: true,</span></span><br><span class="line">    <span class="attr">createdAt</span>: <span class="string">&quot;created_time&quot;</span>,</span><br><span class="line">    <span class="attr">updatedAt</span>: <span class="string">&quot;updated_time&quot;</span>,</span><br><span class="line">    <span class="comment">// deletedAt: &#x27;deleted_time&#x27;,</span></span><br><span class="line">    <span class="comment">// 所有驼峰命名格式化</span></span><br><span class="line">    <span class="attr">underscored</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="初始化数据库和Migrations">初始化数据库和Migrations</h6>
<p>接下来我们先暂时离开 egg 项目的代码，设计和初始化一下我们的数据库。首先我们通过 MySQL 命令在本地快速创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">不执行: mysql -u root -e &#x27;CREATE DATABASE IF NOT EXISTS `egg-sequelize-doc-default`;&#x27;</span><br></pre></td></tr></table></figure>
<p>然后我们开始设计 <code>users</code> 表，它有如下的数据结构：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">不执行: <span class="variable constant_">CREATE</span> <span class="variable constant_">TABLE</span> <span class="string">`users`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="title function_">INT</span>(<span class="number">11</span>) <span class="variable constant_">NOT</span> <span class="variable constant_">NULL</span> <span class="variable constant_">AUTO_INCREMENT</span> <span class="variable constant_">COMMENT</span> <span class="string">&#x27;primary key&#x27;</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="title function_">VARCHAR</span>(<span class="number">30</span>) <span class="variable constant_">DEFAULT</span> <span class="variable constant_">NULL</span> <span class="variable constant_">COMMENT</span> <span class="string">&#x27;user name&#x27;</span>,</span><br><span class="line">  <span class="string">`age`</span> <span class="title function_">INT</span>(<span class="number">11</span>) <span class="variable constant_">DEFAULT</span> <span class="variable constant_">NULL</span> <span class="variable constant_">COMMENT</span> <span class="string">&#x27;user age&#x27;</span>,</span><br><span class="line">  <span class="string">`created_at`</span> <span class="variable constant_">DATETIME</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">NULL</span> <span class="variable constant_">COMMENT</span> <span class="string">&#x27;created time&#x27;</span>,</span><br><span class="line">  <span class="string">`updated_at`</span> <span class="variable constant_">DATETIME</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">NULL</span> <span class="variable constant_">COMMENT</span> <span class="string">&#x27;updated time&#x27;</span>,</span><br><span class="line">  <span class="variable constant_">PRIMARY</span> <span class="variable constant_">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="variable constant_">ENGINE</span>=<span class="title class_">InnoDB</span> <span class="variable constant_">DEFAULT</span> <span class="variable constant_">CHARSET</span>=utf8mb4 <span class="variable constant_">COMMENT</span>=<span class="string">&#x27;user&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>我们可以直接通过 MySQL 命令将表直接建好，但是这并不是一个对多人协作非常友好的开发模式。在项目的演进过程中，每一个迭代都有可能对数据库数据结构做变更，怎样跟踪每一个迭代的数据变更，并在不同的环境（开发、测试、CI）和迭代切换中，快速变更数据结构呢？这时候我们就需要 <code>Migrations</code> 来帮我们管理数据结构的变更了。</p>
<p>sequelize 提供了 <code>sequelize-cli</code> 工具来实现 <code>Migrations</code>，我们也可以在 egg 项目中引入 sequelize-cli。</p>
<ul>
<li>安装 <a href="https://sequelize.org/docs/v6/">sequelize-cli</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev sequelize-cli</span><br></pre></td></tr></table></figure>
<p>在 egg 项目中，我们希望将所有数据库 Migrations 相关的内容都放在 <code>database</code> 目录下，所以我们在项目根目录下新建一个 <code>.sequelizerc</code> 配置文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="string">&quot;config&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;database/config.json&#x27;</span>),</span><br><span class="line">  <span class="string">&quot;migrations-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;database/migrations&#x27;</span>),</span><br><span class="line">  <span class="string">&quot;seeders-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;database/seeders&#x27;</span>),</span><br><span class="line">  <span class="string">&quot;models-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;app/model&#x27;</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>初始化 Migrations 配置文件和目录</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npx sequelize <span class="attr">init</span>:config</span><br><span class="line">npx sequelize <span class="attr">init</span>:migrations</span><br></pre></td></tr></table></figure>
<p>执行完后会生成 <code>database/config.json</code> 文件和 <code>database/migrations</code> 目录，我们修改一下 <code>database/config.json</code> 中的内容，将其改成我们项目中使用的数据库配置：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;development&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;自己填&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;egg-sequelize-doc-default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dialect&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysql&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>创建数据库</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize db:create</span><br></pre></td></tr></table></figure>
<p>此时 sequelize-cli 和相关的配置也都初始化好了，我们可以开始编写项目的第一个 Migration 文件来创建我们的一个 <code>users</code> 表了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npx sequelize <span class="attr">migration</span>:generate --name=init-users</span><br></pre></td></tr></table></figure>
<p>执行完后会在 <code>database/migrations</code> 目录下生成一个 migration 文件（<code>$&#123;timestamp&#125;-init-users.js</code>），我们修改它来处理初始化 <code>users</code> 表：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;sequelize-cli&#x27;).Migration</span>&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="keyword">async</span> (queryInterface, <span class="title class_">Sequelize</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="comment">// 创建表await </span></span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>).<span class="property">UNSIGNED</span>, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户名称&#x27;</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">      <span class="attr">password</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">      <span class="attr">avatar_url</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">      <span class="attr">sex</span>: &#123; <span class="attr">type</span>: <span class="variable constant_">ENUM</span>, <span class="attr">values</span>: [<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;保密&#x27;</span>], <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;男&#x27;</span>, <span class="attr">comment</span>: <span class="string">&quot;用户性别&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">created_at</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_at</span>: <span class="variable constant_">DATE</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 在执行数据库降级时调用的函数，删除 users 表</span></span><br><span class="line">  <span class="attr">down</span>: <span class="keyword">async</span> (queryInterface) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&#x27;users&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>执行 migrate 进行数据库变更</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 升级数据库</span><br><span class="line">npx sequelize <span class="attr">db</span>:migrate</span><br><span class="line"></span><br><span class="line"># 如果有问题需要回滚，可以通过 <span class="string">`db:migrate:undo`</span> 回退一个变更</span><br><span class="line"></span><br><span class="line"># npx sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:undo</span><br><span class="line"></span><br><span class="line"># 可以通过 <span class="string">`db:migrate:undo:all`</span> 回退到初始状态</span><br></pre></td></tr></table></figure>
<h5 id="模型">模型</h5>
<h6 id="创建模型">创建模型</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">User</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>).<span class="property">UNSIGNED</span>, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">username</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;用户名称&#x27;</span>, <span class="attr">unique</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    <span class="attr">password</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">false</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">avatar_url</span>: &#123; <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">200</span>), <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    <span class="attr">sex</span>: &#123; <span class="attr">type</span>: <span class="variable constant_">ENUM</span>, <span class="attr">values</span>: [<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;保密&#x27;</span>], <span class="attr">allowNull</span>: <span class="literal">true</span>, <span class="attr">defaultValue</span>: <span class="string">&#x27;男&#x27;</span>, <span class="attr">comment</span>: <span class="string">&quot;用户性别&quot;</span> &#125;,</span><br><span class="line">    <span class="attr">created_at</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_at</span>: <span class="variable constant_">DATE</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">true</span>, <span class="comment">// 是否自动写入时间戳</span></span><br><span class="line">    <span class="attr">tableName</span>: <span class="string">&#x27;user&#x27;</span> <span class="comment">// 自定义数据库表名称</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">User</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个Model就可以在Controll和Service中通过app.model.User或者ctx.model.User访问到了，例如，我们编写 <code>app/controller/users.js</code></p>
<h6 id="创建用户">创建用户</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 获取User模型</span></span><br><span class="line">  <span class="comment">// app.model.User</span></span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="comment">// 获取请求体提交的数据</span></span><br><span class="line">  <span class="keyword">let</span> body = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">  <span class="comment">// 加密场景</span></span><br><span class="line">  <span class="comment">// 1、获取body中的password字段 加密 body.password = jsonwebtoken(body.password)</span></span><br><span class="line">  <span class="comment">// 2、使用数据模型的set修改器</span></span><br><span class="line">  <span class="comment">// 创建用户</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> user.<span class="title function_">create</span>(body)</span><br><span class="line">  <span class="comment">// 如果创建失败</span></span><br><span class="line">  <span class="keyword">if</span>(!res) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = &#123;<span class="attr">msg</span>: <span class="string">&quot;创建用户失败&quot;</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设置状态码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">status</span> = <span class="number">201</span></span><br><span class="line">  <span class="comment">// 响应</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="修改器">修改器</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 密码</span></span><br><span class="line"><span class="attr">password</span>: &#123; </span><br><span class="line">  <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">200</span>), </span><br><span class="line">  <span class="attr">allowNull</span>: <span class="literal">false</span>, </span><br><span class="line">  <span class="attr">defaultValue</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="comment">// 修改器</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">val</span>)&#123;</span><br><span class="line">    <span class="comment">// 加密</span></span><br><span class="line">    <span class="keyword">let</span> hash = val + <span class="string">&#x27;token&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setDataValue</span>(<span class="string">&#x27;password&#x27;</span>, hash);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="获取器">获取器</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建时间</span></span><br><span class="line"><span class="attr">created_at</span>: &#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="variable constant_">DATE</span>,</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> created_at = <span class="variable language_">this</span>.<span class="title function_">getDataValue</span>(<span class="string">&#x27;created_at&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(created_at).<span class="title function_">getTime</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="批量创建">批量创建</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">bulkCreate</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> user.<span class="title function_">bulkCreate</span>([</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&quot;用户7&quot;</span>, <span class="attr">password</span>: <span class="string">&quot;333&quot;</span>, <span class="attr">sex</span>: <span class="string">&quot;0&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&quot;用户8&quot;</span>, <span class="attr">password</span>: <span class="string">&quot;333&quot;</span>, <span class="attr">sex</span>: <span class="string">&quot;1&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&quot;用户9&quot;</span>, <span class="attr">password</span>: <span class="string">&quot;333&quot;</span>, <span class="attr">sex</span>: <span class="string">&quot;1&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">username</span>: <span class="string">&quot;用户10&quot;</span>, <span class="attr">password</span>: <span class="string">&quot;333&quot;</span>, <span class="attr">sex</span>: <span class="string">&quot;0&quot;</span>&#125;</span><br><span class="line">  ])</span><br><span class="line">  <span class="comment">// 设置状态码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">status</span> = <span class="number">201</span></span><br><span class="line">  <span class="comment">// 响应</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="主键查询">主键查询</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 主键查询</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">findById</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="comment">// 接收前端传来的id</span></span><br><span class="line">  <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> user.<span class="title function_">findByPk</span>(id)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="查询单个用户">查询单个用户</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询单个用户 =&gt; where查询</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">findOne</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="comment">// 接收前端传来的gender</span></span><br><span class="line">  <span class="keyword">let</span> sex = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">params</span>.<span class="property">gender</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询符合条件的第一个元素</span></span><br><span class="line">  <span class="comment">// let res = await user.findOne(&#123;</span></span><br><span class="line">  <span class="comment">//   where: &#123; sex &#125;</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询符合条件的所有元素</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> user.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">    <span class="attr">where</span>: &#123; sex &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="查询多个用户">查询多个用户</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">findAll</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="comment">// 查询多个</span></span><br><span class="line">  <span class="comment">// let res = await user.findAll()</span></span><br><span class="line">  <span class="comment">// 查询多个并统计</span></span><br><span class="line">  res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findAndCountAll</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="分页查询">分页查询</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">findByPaging</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">model</span>.<span class="property">User</span></span><br><span class="line">  <span class="comment">// page: 第几页</span></span><br><span class="line">  <span class="comment">// limit: 每页几条</span></span><br><span class="line">  <span class="comment">// offset: 偏移量</span></span><br><span class="line">  <span class="comment">// 第一页: 0 - 4</span></span><br><span class="line">  <span class="comment">// 第二页: 5 - 9</span></span><br><span class="line">  <span class="comment">// 第三页: 10 - 14</span></span><br><span class="line">  <span class="keyword">let</span> &#123;limit = <span class="number">3</span>, page&#125; = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">query</span></span><br><span class="line">  <span class="comment">// 计算偏移量</span></span><br><span class="line">  <span class="keyword">let</span> offset = (page - <span class="number">1</span>) * limit</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> user.<span class="title function_">findAll</span>(&#123;<span class="attr">limit</span>: limit - <span class="number">0</span>, <span class="attr">offset</span>: offset - <span class="number">0</span> &#125;)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span> = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="where操作符">where操作符</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">findByWhere</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">// 拿到数据</span></span><br><span class="line"><span class="keyword">let</span> result = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Op</span> = <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">Sequelize</span>.<span class="property">Op</span>;</span><br><span class="line"><span class="comment">// 查询多个</span></span><br><span class="line">result = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line"><span class="comment">// where 查询条件</span></span><br><span class="line">   <span class="attr">where</span>:&#123;</span><br><span class="line">      <span class="attr">sex</span>:<span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">      <span class="attr">username</span>:&#123;</span><br><span class="line">          [<span class="title class_">Op</span>.<span class="property">like</span>]:<span class="string">&quot;%张三%&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">id</span>:&#123;</span><br><span class="line">          [<span class="title class_">Op</span>.<span class="property">gt</span>]:<span class="number">6</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">Op</span> = <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">Sequelize</span>.<span class="property">Op</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">model</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">  <span class="attr">where</span>: &#123;</span><br><span class="line">    [<span class="title class_">Op</span>.<span class="property">and</span>]: [&#123; <span class="attr">a</span>: <span class="number">5</span> &#125;, &#123; <span class="attr">b</span>: <span class="number">6</span> &#125;],            <span class="comment">// (a = 5) AND (b = 6)</span></span><br><span class="line">    [<span class="title class_">Op</span>.<span class="property">or</span>]: [&#123; <span class="attr">a</span>: <span class="number">5</span> &#125;, &#123; <span class="attr">b</span>: <span class="number">6</span> &#125;],             <span class="comment">// (a = 5) OR (b = 6)</span></span><br><span class="line">    <span class="attr">someAttribute</span>: &#123;</span><br><span class="line">      <span class="comment">// 基本</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">eq</span>]: <span class="number">3</span>,                              <span class="comment">// = 3</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">ne</span>]: <span class="number">20</span>,                             <span class="comment">// != 20</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">is</span>]: <span class="literal">null</span>,                           <span class="comment">// IS NULL</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">not</span>]: <span class="literal">true</span>,                          <span class="comment">// IS NOT TRUE</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">or</span>]: [<span class="number">5</span>, <span class="number">6</span>],                         <span class="comment">// (someAttribute = 5) OR (someAttribute = 6)</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 使用方言特定的列标识符 (以下示例中使用 PG):</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">col</span>]: <span class="string">&#x27;user.organization_id&#x27;</span>,        <span class="comment">// = &quot;user&quot;.&quot;organization_id&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 数字比较</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">gt</span>]: <span class="number">6</span>,                              <span class="comment">// &gt; 6</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">gte</span>]: <span class="number">6</span>,                             <span class="comment">// &gt;= 6</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">lt</span>]: <span class="number">10</span>,                             <span class="comment">// &lt; 10</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">lte</span>]: <span class="number">10</span>,                            <span class="comment">// &lt;= 10</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">between</span>]: [<span class="number">6</span>, <span class="number">10</span>],                   <span class="comment">// BETWEEN 6 AND 10</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notBetween</span>]: [<span class="number">11</span>, <span class="number">15</span>],               <span class="comment">// NOT BETWEEN 11 AND 15</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 其它操作符</span></span><br><span class="line"></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">all</span>]: sequelize.<span class="title function_">literal</span>(<span class="string">&#x27;SELECT 1&#x27;</span>), <span class="comment">// &gt; ALL (SELECT 1)</span></span><br><span class="line"></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">in</span>]: [<span class="number">1</span>, <span class="number">2</span>],                         <span class="comment">// IN [1, 2]</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notIn</span>]: [<span class="number">1</span>, <span class="number">2</span>],                      <span class="comment">// NOT IN [1, 2]</span></span><br><span class="line"></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">like</span>]: <span class="string">&#x27;%hat&#x27;</span>,                       <span class="comment">// LIKE &#x27;%hat&#x27;</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notLike</span>]: <span class="string">&#x27;%hat&#x27;</span>,                    <span class="comment">// NOT LIKE &#x27;%hat&#x27;</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">startsWith</span>]: <span class="string">&#x27;hat&#x27;</span>,                  <span class="comment">// LIKE &#x27;hat%&#x27;</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">endsWith</span>]: <span class="string">&#x27;hat&#x27;</span>,                    <span class="comment">// LIKE &#x27;%hat&#x27;</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">substring</span>]: <span class="string">&#x27;hat&#x27;</span>,                   <span class="comment">// LIKE &#x27;%hat%&#x27;</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">iLike</span>]: <span class="string">&#x27;%hat&#x27;</span>,                      <span class="comment">// ILIKE &#x27;%hat&#x27; (不区分大小写) (仅 PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notILike</span>]: <span class="string">&#x27;%hat&#x27;</span>,                   <span class="comment">// NOT ILIKE &#x27;%hat&#x27;  (仅 PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">regexp</span>]: <span class="string">&#x27;^[h|a|t]&#x27;</span>,                 <span class="comment">// REGEXP/~ &#x27;^[h|a|t]&#x27; (仅 MySQL/PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notRegexp</span>]: <span class="string">&#x27;^[h|a|t]&#x27;</span>,              <span class="comment">// NOT REGEXP/!~ &#x27;^[h|a|t]&#x27; (仅 MySQL/PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">iRegexp</span>]: <span class="string">&#x27;^[h|a|t]&#x27;</span>,                <span class="comment">// ~* &#x27;^[h|a|t]&#x27; (仅 PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">notIRegexp</span>]: <span class="string">&#x27;^[h|a|t]&#x27;</span>,             <span class="comment">// !~* &#x27;^[h|a|t]&#x27; (仅 PG)</span></span><br><span class="line"></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">any</span>]: [<span class="number">2</span>, <span class="number">3</span>],                        <span class="comment">// ANY ARRAY[2, 3]::INTEGER (仅 PG)</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">match</span>]: <span class="title class_">Sequelize</span>.<span class="title function_">fn</span>(<span class="string">&#x27;to_tsquery&#x27;</span>, <span class="string">&#x27;fat &amp; rat&#x27;</span>) <span class="comment">// 匹配文本搜索字符串 &#x27;fat&#x27; 和 &#x27;rat&#x27; (仅 PG)</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在 Postgres 中, Op.like/Op.iLike/Op.notLike 可以结合 Op.any 使用:</span></span><br><span class="line">      [<span class="title class_">Op</span>.<span class="property">like</span>]: &#123; [<span class="title class_">Op</span>.<span class="property">any</span>]: [<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;hat&#x27;</span>] &#125;  <span class="comment">// LIKE ANY ARRAY[&#x27;cat&#x27;, &#x27;hat&#x27;]</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="字段限制-排序">字段限制&amp;排序</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">findByWhere</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">// 拿到数据</span></span><br><span class="line"><span class="keyword">let</span> result = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Op</span> = <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">Sequelize</span>.<span class="property">Op</span>;</span><br><span class="line"><span class="comment">// 查询多个</span></span><br><span class="line">result = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line"><span class="comment">// where 查询条件</span></span><br><span class="line">   <span class="attr">where</span>:&#123;</span><br><span class="line">      <span class="attr">sex</span>:<span class="string">&#x27;男&#x27;</span>,</span><br><span class="line">      <span class="attr">username</span>:&#123;</span><br><span class="line">          [<span class="title class_">Op</span>.<span class="property">like</span>]:<span class="string">&quot;%张三%&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">id</span>:&#123;</span><br><span class="line">          [<span class="title class_">Op</span>.<span class="property">gt</span>]:<span class="number">6</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">// attributes:[&#x27;id&#x27;,&#x27;username&#x27;,&#x27;sex&#x27;]</span></span><br><span class="line">    <span class="attr">attributes</span>:&#123;</span><br><span class="line">     <span class="comment">// 排除</span></span><br><span class="line">       <span class="attr">exclude</span>:[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">     <span class="comment">// 排序</span></span><br><span class="line">    <span class="attr">order</span>:[</span><br><span class="line">       <span class="comment">// id 降序</span></span><br><span class="line">       [<span class="string">&#x27;updated_at&#x27;</span>,<span class="string">&#x27;DESC&#x27;</span>],</span><br><span class="line">       [<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;DESC&#x27;</span>]</span><br><span class="line">     ],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="修改和限制字段">修改和限制字段</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> id = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">params</span>.<span class="property">id</span> ? <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">params</span>.<span class="property">id</span>) : <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 拿到这条记录</span></span><br><span class="line">  <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findByPk</span>(id);</span><br><span class="line">  <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span>=&#123;</span><br><span class="line">          <span class="attr">msg</span>:<span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">          <span class="attr">data</span>:<span class="string">&#x27;该记录不存在&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//   data.username = &#x27;被修改了&#x27;;</span></span><br><span class="line">  <span class="comment">//   let res = await data.save(&#123;</span></span><br><span class="line">  <span class="comment">//       // 限制字段</span></span><br><span class="line">  <span class="comment">//       fields:[&#x27;username&#x27;]</span></span><br><span class="line">  <span class="comment">//   &#125;);</span></span><br><span class="line"><span class="keyword">let</span> params = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line"><span class="keyword">let</span> res = <span class="keyword">await</span> data.<span class="title function_">update</span>(params,&#123;</span><br><span class="line">    <span class="attr">fields</span>:[<span class="string">&#x27;username&#x27;</span>] <span class="comment">// 限制字段</span></span><br><span class="line">&#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span>=&#123;</span><br><span class="line">          <span class="attr">msg</span>:<span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">          <span class="attr">data</span>:res</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="删除和批量删除">删除和批量删除</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">deleted</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">//   let id = this.ctx.params.id ? parseInt(this.ctx.params.id) : 0;</span></span><br><span class="line"><span class="comment">//   let data = await this.app.model.User.findByPk(id);</span></span><br><span class="line"><span class="comment">//   if(!data)&#123;</span></span><br><span class="line"><span class="comment">//       return this.ctx.body=&#123;</span></span><br><span class="line"><span class="comment">//           msg:&#x27;fail&#x27;,</span></span><br><span class="line"><span class="comment">//           data:&#x27;该记录不存在&#x27;</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   // 删除单个</span></span><br><span class="line"><span class="comment">//   let res = await data.destroy();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   return this.ctx.body=&#123;</span></span><br><span class="line"><span class="comment">//           msg:&#x27;ok&#x27;,</span></span><br><span class="line"><span class="comment">//           data:res</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量删除</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Op</span> = <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">Sequelize</span>.<span class="property">Op</span>;</span><br><span class="line"><span class="keyword">let</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">destroy</span>(&#123;</span><br><span class="line">   <span class="attr">where</span>:&#123;</span><br><span class="line">       <span class="attr">id</span>:&#123;</span><br><span class="line">           [<span class="title class_">Op</span>.<span class="property">lte</span>]:<span class="number">10</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">body</span>=&#123;</span><br><span class="line">      <span class="attr">msg</span>:<span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>:res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="错误和异常处理">错误和异常处理</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/middleware/errorHandle.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">errorHandle</span>(<span class="params">ctx,next</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(error)&#123;</span><br><span class="line">            <span class="comment">// 错误日志</span></span><br><span class="line">            <span class="comment">// 所有异常都在app上触发一个error事件 框架会记录一条错误日志</span></span><br><span class="line">            ctx.<span class="property">app</span>.<span class="title function_">emit</span>(<span class="string">&#x27;error&#x27;</span>,err,ctx);</span><br><span class="line">            <span class="keyword">const</span> status = err.<span class="property">status</span> || <span class="number">500</span></span><br><span class="line">            <span class="comment">// 生产环境时 500 错误的详细错误内容不返回给客户端 因为可能包含敏感信息</span></span><br><span class="line">            <span class="keyword">const</span> error = status === <span class="number">500</span> &amp;&amp; ctx.<span class="property">app</span>.<span class="property">config</span>.<span class="property">env</span> === <span class="string">&#x27;prod&#x27;</span> ? <span class="string">&#x27;Internal Server Error&#x27;</span> : err.<span class="property">message</span>;</span><br><span class="line">            ctx.<span class="property">body</span> = &#123;error&#125;</span><br><span class="line">            <span class="keyword">if</span>(status === <span class="number">422</span>)&#123;</span><br><span class="line">               ctx.<span class="property">body</span>.<span class="property">detail</span> = err.<span class="property">errors</span>;</span><br><span class="line">           &#125;</span><br><span class="line">            ctx.<span class="property">status</span> = status</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用中间件之前需要到config/config.defult.js中注册</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// add your middleware config here &#x27;errorHandle&#x27;</span></span><br><span class="line">config.<span class="property">middleware</span> = [<span class="string">&#x27;errorHandle&#x27;</span>];</span><br></pre></td></tr></table></figure>
<p><strong>页面中调用</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="keyword">throw</span>(<span class="number">500</span>,<span class="string">&#x27;故意出错&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="中间件配置">中间件配置</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js中修改的</span></span><br><span class="line"><span class="comment">// add your middleware config here &#x27;errorHandle&#x27;</span></span><br><span class="line">config.<span class="property">middleware</span> = [<span class="string">&#x27;errorHandle&#x27;</span>];</span><br><span class="line">config.<span class="property">errorHandle</span>=&#123;</span><br><span class="line">  <span class="comment">//   enable:false, // 是否开启中间件</span></span><br><span class="line">  <span class="attr">ignore</span>:[<span class="string">&#x27;/index&#x27;</span>], <span class="comment">// 除了这个其他需要</span></span><br><span class="line">  <span class="attr">match</span>:[<span class="string">&#x27;/create&#x27;</span>]   <span class="comment">// 需要用中间件的路由</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="参数验证">参数验证</h5>
<p><a href="https://github.com/D780/egg-valparams">我们需要先下载一个插件：参数验证参考</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-valparams</span><br></pre></td></tr></table></figure>
<p>其次我们修改config中的两个文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个</span></span><br><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">valparams</span> = &#123;</span><br><span class="line">  enable : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-valparams&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config.defult.js</span></span><br><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">valparams</span> = &#123;</span><br><span class="line">  locale : <span class="string">&#x27;zh-cn&#x27;</span>,</span><br><span class="line">  <span class="attr">throwError</span>: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/module/error_handle.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">errorHandle</span>(<span class="params">ctx,next</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(error)&#123;</span><br><span class="line">        <span class="comment">// 错误日志</span></span><br><span class="line">        <span class="comment">// ctx.app.emit(&#x27;error&#x27;,error,ctx);</span></span><br><span class="line"></span><br><span class="line">        ctx.<span class="property">status</span> = error.<span class="property">status</span>;</span><br><span class="line">        <span class="comment">// 判断参数类型</span></span><br><span class="line">        <span class="keyword">if</span>(ctx.<span class="property">status</span> === <span class="number">422</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ctx.<span class="property">body</span> = &#123;</span><br><span class="line">                <span class="attr">msg</span>:<span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>:error.<span class="property">errors</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.<span class="property">body</span>=&#123;</span><br><span class="line">            <span class="attr">msg</span>:<span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>:error.<span class="property">mssage</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app/controller/user.<span class="property">js</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;ctx&#125; = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">//   ctx.validate(&#123;</span></span><br><span class="line">  <span class="comment">//   username  : &#123;type: &#x27;string&#x27;, required: false, defValue: &#x27;account&#x27;, desc: &#x27;系统名称&#x27;&#125;,</span></span><br><span class="line">  <span class="comment">//   password   : &#123;type: &#x27;string&#x27;, required: true, desc: &#x27;token 验证&#x27;&#125;,</span></span><br><span class="line">  <span class="comment">//   sex: &#123;type: &#x27;string&#x27;, required: false, desc: &#x27;登录跳转&#x27;&#125;</span></span><br><span class="line">  <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> params = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">  <span class="comment">// 验证参数</span></span><br><span class="line">  ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">  username  : &#123;<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span>&#125;,</span><br><span class="line">  password   : &#123;<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">sex</span>: &#123;<span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">desc</span>: <span class="string">&#x27;性别&#x27;</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="comment">// 写入数据库</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="直播后台编写">直播后台编写</h4>
<h5 id="创建项目-2">创建项目</h5>
<blockquote>
<p>参照egg官网</p>
</blockquote>
<h5 id="跨域配置">跨域配置</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm i egg-cors --save</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;app_root&#125;/config/plugin.js</span></span><br><span class="line"><span class="attr">cors</span>: &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-cors&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">config.<span class="property">security</span> = &#123;</span><br><span class="line">  <span class="comment">// 关闭 csrf</span></span><br><span class="line">  <span class="attr">csrf</span>: &#123;</span><br><span class="line">    <span class="attr">headerName</span>: <span class="string">&#x27;x-csrf-token&#x27;</span>,</span><br><span class="line">    <span class="attr">ignore</span>: <span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ctx.<span class="property">request</span>.<span class="property">url</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/api&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 跨域白名单</span></span><br><span class="line">  <span class="comment">// domainWhiteList: [&quot;http://localhost:3000&quot;],</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 允许跨域的方法</span></span><br><span class="line">config.<span class="property">cors</span> = &#123;</span><br><span class="line">  <span class="attr">origin</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="attr">allowMethods</span>: <span class="string">&quot;GET, PUT, POST, DELETE, PATCH&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="全局相关">全局相关</h5>
<h6 id="封装api返回格式扩展">封装api返回格式扩展</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 成功提示</span></span><br><span class="line">  <span class="title function_">apiSuccess</span>(<span class="params">data = <span class="string">&quot;&quot;</span>, msg = <span class="string">&quot;ok&quot;</span>, code = <span class="number">200</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">body</span> = &#123; msg, data &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = code;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 失败提示</span></span><br><span class="line">  <span class="title function_">apiFail</span>(<span class="params">data = <span class="string">&quot;&quot;</span>, msg = <span class="string">&quot;fail&quot;</span>, code = <span class="number">400</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">body</span> = &#123; msg, data &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = code;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="全局抛出异常处理">全局抛出异常处理</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/middleware/error_handler.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">errorHandler</span>(<span class="params">ctx, next</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">      <span class="comment">// 404 处理</span></span><br><span class="line">      <span class="keyword">if</span> (ctx.<span class="property">status</span> === <span class="number">404</span> &amp;&amp; !ctx.<span class="property">body</span>) &#123;</span><br><span class="line">        ctx.<span class="property">body</span> = &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="string">&quot;404 错误&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 记录一条错误日志</span></span><br><span class="line">      app.<span class="title function_">emit</span>(<span class="string">&quot;error&quot;</span>, err, ctx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> status = err.<span class="property">status</span> || <span class="number">500</span>;</span><br><span class="line">      <span class="comment">// 生产环境时 500 错误的详细错误内容不返回给客户端，因为可能包含敏感信息</span></span><br><span class="line">      <span class="keyword">const</span> error = status === <span class="number">500</span> &amp;&amp; app.<span class="property">config</span>.<span class="property">env</span> === <span class="string">&quot;prod&quot;</span></span><br><span class="line">        ? <span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">        : err.<span class="property">message</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 从 error 对象上读出各个属性，设置到响应中</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: error,</span><br><span class="line">      &#125;;</span><br><span class="line">      ctx.<span class="property">status</span> = status;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="sequelize数据库配置">sequelize数据库配置</h6>
<p>安装并配置<a href="https://github.com/eggjs/egg-sequelize">egg-sequelize</a>插件（它会辅助我们将定义好的 Model 对象加载到 app 和 ctx上）和<a href="https://github.com/sidorares/node-mysql2">mysql2</a>模块：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save egg-sequelize mysql2</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在config/plugin.js中引入 egg-sequelize 插件</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">sequelize</span> = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&quot;egg-sequelize&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在config/config.default.js</span></span><br><span class="line">config.<span class="property">sequelize</span> = &#123;</span><br><span class="line">  <span class="attr">dialect</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3306</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&quot;egg-video&quot;</span>,</span><br><span class="line">  <span class="comment">// 中国时区</span></span><br><span class="line">  <span class="attr">timezone</span>: <span class="string">&quot;+08:00&quot;</span>,</span><br><span class="line">  <span class="attr">define</span>: &#123;</span><br><span class="line">    <span class="comment">// 取消数据表名复数</span></span><br><span class="line">    <span class="attr">freezeTableName</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 自动写入时间戳 created_at updated_at</span></span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 字段生成软删除时间戳 deleted_at</span></span><br><span class="line">    <span class="comment">// paranoid: true,</span></span><br><span class="line">    <span class="attr">createdAt</span>: <span class="string">&quot;created_time&quot;</span>,</span><br><span class="line">    <span class="attr">updatedAt</span>: <span class="string">&quot;updated_time&quot;</span>,</span><br><span class="line">    <span class="comment">// deletedAt: &#x27;deleted_time&#x27;,</span></span><br><span class="line">    <span class="comment">// 所有驼峰命名格式化</span></span><br><span class="line">    <span class="attr">underscored</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="数据库迁移配置">数据库迁移配置</h6>
<p>sequelize 提供了<a href="https://github.com/sequelize/cli">sequelize-cli</a>工具来实现<a href="http://docs.sequelizejs.com/manual/tutorial/migrations.html">Migrations</a>，我们也可以在 egg 项目中引入 sequelize-cli。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install --save-dev sequelize-cli</span><br></pre></td></tr></table></figure>
<p>egg 项目中，我们希望将所有数据库 Migrations 相关的内容都放在<code>database</code>目录下，所以我们在项目根目录下新建一个<code>.sequelizerc</code>配置文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">config</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;database/config.json&quot;</span>),</span><br><span class="line">  <span class="string">&quot;migrations-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;database/migrations&quot;</span>),</span><br><span class="line">  <span class="string">&quot;seeders-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;database/seeders&quot;</span>),</span><br><span class="line">  <span class="string">&quot;models-path&quot;</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;app/model&quot;</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>初始化 Migrations 配置文件和目录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize init:config</span><br><span class="line">npx sequelize init:migrations</span><br><span class="line"># npx sequelize init:models</span><br></pre></td></tr></table></figure>
<p>执行完后会生成<code>database/config.json</code>文件和<code>database/migrations</code>目录，我们修改一下<code>database/config.json</code>中的内容，将其改成我们项目中使用的数据库配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;development&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&quot;database&quot;</span>: <span class="string">&quot;egg-video&quot;</span>,</span><br><span class="line">    <span class="string">&quot;host&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dialect&quot;</span>: <span class="string">&quot;mysql&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timezone&quot;</span>: <span class="string">&quot;+08:00&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建数据库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize db:create</span><br><span class="line"></span><br><span class="line"># 升级数据库</span><br><span class="line">npx sequelize db:migrate</span><br><span class="line"># 如果有问题需要回滚，可以通过 `db:migrate:undo` 回退一个变更</span><br><span class="line"># npx sequelize db:migrate:undo</span><br><span class="line"># 可以通过 `db:migrate:undo:all` 回退到初始状态</span><br><span class="line"># npx sequelize db:migrate:undo:all</span><br></pre></td></tr></table></figure>
<h6 id="模型关联">模型关联</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">User</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">  <span class="comment">// 关联用户资料 一对一</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="title function_">hasOne</span>(app.<span class="property">model</span>.<span class="property">Userinfo</span>);</span><br><span class="line">  <span class="comment">// 反向一对一关联</span></span><br><span class="line">  <span class="comment">// Userinfo.belongsTo(app.model.User);</span></span><br><span class="line">  <span class="comment">// 一对多关联</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="title function_">hasMany</span>(app.<span class="property">model</span>.<span class="property">Post</span>);</span><br><span class="line">  <span class="comment">// 反向一对多关联</span></span><br><span class="line">  <span class="comment">// Post.belongsTo(app.model.User);</span></span><br><span class="line">  <span class="comment">// 多对多</span></span><br><span class="line">  <span class="comment">// User.belongsToMany(Project, &#123; as: &#x27;Tasks&#x27;, through: &#x27;worker_tasks&#x27;, foreignKey: &#x27;userId&#x27; &#125;)</span></span><br><span class="line">  <span class="comment">// 反向多对多</span></span><br><span class="line">  <span class="comment">// Project.belongsToMany(User, &#123; as: &#x27;Workers&#x27;, through: &#x27;worker_tasks&#x27;, foreignKey: &#x27;projectId&#x27; &#125;)</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="模板引擎">模板引擎</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-view-nunjucks --save</span><br></pre></td></tr></table></figure>
<p><a href="https://nunjucks.bootcss.com/templating.html">Nunjuck文档</a></p>
<p><strong>配置插件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#123;app_root&#125;/config/plugin.js</span></span><br><span class="line"><span class="attr">nunjucks</span>: &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-view-nunjucks&#x27;</span>, </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><code>config/config.default.js</code> 目录下配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">config.<span class="property">view</span> = &#123;</span><br><span class="line">  <span class="attr">mapping</span>: &#123;</span><br><span class="line">    <span class="string">&quot;.html&quot;</span>: <span class="string">&quot;nunjucks&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="参数验证-2">参数验证</h6>
<p><strong>插件地址：</strong></p>
<blockquote>
<p><a href="https://www.npmjs.com/package/egg-valparams">https://www.npmjs.com/package/egg-valparams</a></p>
</blockquote>
<p><strong>安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-valparams --save</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line">valparams : &#123;</span><br><span class="line">  enable : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&#x27;egg-valparams&#x27;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line">config.<span class="property">valparams</span> = &#123;</span><br><span class="line">  locale : <span class="string">&#x27;zh-cn&#x27;</span>,</span><br><span class="line">  <span class="attr">throwError</span>: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>中间件：app/middleware/errorHandler.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">errorHandler</span>(<span class="params">ctx, next</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">      <span class="comment">// 404 处理</span></span><br><span class="line">      <span class="keyword">if</span> (ctx.<span class="property">status</span> === <span class="number">404</span> &amp;&amp; !ctx.<span class="property">body</span>) &#123;</span><br><span class="line">        ctx.<span class="property">body</span> = &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="string">&quot;404 错误&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// 记录一条错误日志</span></span><br><span class="line">      app.<span class="title function_">emit</span>(<span class="string">&quot;error&quot;</span>, err, ctx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> status = err.<span class="property">status</span> || <span class="number">500</span>;</span><br><span class="line">      <span class="comment">// 生产环境时 500 错误的详细错误内容不返回给客户端，因为可能包含敏感信息</span></span><br><span class="line">      <span class="keyword">let</span> error = status === <span class="number">500</span> &amp;&amp; app.<span class="property">config</span>.<span class="property">env</span> === <span class="string">&quot;prod&quot;</span></span><br><span class="line">        ? <span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">        : err.<span class="property">message</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 从 error 对象上读出各个属性，设置到响应中</span></span><br><span class="line">      ctx.<span class="property">body</span> = &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: error,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 参数验证异常</span></span><br><span class="line">      <span class="keyword">if</span> (status === <span class="number">422</span> &amp;&amp; err.<span class="property">message</span> === <span class="string">&quot;Validation Failed&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (err.<span class="property">errors</span> &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(err.<span class="property">errors</span>)) &#123;</span><br><span class="line">          error = err.<span class="property">errors</span>[<span class="number">0</span>].<span class="property">err</span>[<span class="number">0</span>]</span><br><span class="line">            ? err.<span class="property">errors</span>[<span class="number">0</span>].<span class="property">err</span>[<span class="number">0</span>]</span><br><span class="line">            : err.<span class="property">errors</span>[<span class="number">0</span>].<span class="property">err</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.<span class="property">body</span> = &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&quot;fail&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>: error,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      ctx.<span class="property">status</span> = status;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>在控制器里使用</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XXXController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">app.Controller</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">XXX</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">      <span class="attr">system</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defValue</span>: <span class="string">&quot;account&quot;</span>,</span><br><span class="line">        <span class="attr">desc</span>: <span class="string">&quot;系统名称&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">token</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">desc</span>: <span class="string">&quot;token 验证&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">redirect</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">desc</span>: <span class="string">&quot;登录跳转&quot;</span> &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// if (config.throwError === false)</span></span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">paramErrors</span>) &#123;</span><br><span class="line">      <span class="comment">// get error infos from `ctx.paramErrors`;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> params = ctx.<span class="property">params</span>;</span><br><span class="line">    <span class="keyword">let</span> &#123; query, body &#125; = ctx.<span class="property">request</span>;</span><br><span class="line">    <span class="comment">// ctx.params        = validater.ret.params;</span></span><br><span class="line">    <span class="comment">// ctx.request.query = validater.ret.query;</span></span><br><span class="line">    <span class="comment">// ctx.request.body  = validater.ret.body;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    ctx.<span class="property">body</span> = query;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>参数验证处理</strong></p>
<p>Valparams.setParams(req, params, options);</p>
<p><a href="https://github.com/D780/valparams/blob/master/doc/api.md#%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81%E5%A4%84%E7%90%86">具体参数验证处理</a></p>
<h5 id="管理员模块">管理员模块</h5>
<h6 id="新增管理员">新增管理员</h6>
<p><strong>创建数据迁移表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=manager</span><br></pre></td></tr></table></figure>
<p>执行完命令后，会在 <code>database/migrations/</code> 目录下生成数据表迁移文件，然后定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// database/migrations//manager.js</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;manager&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">username</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">        <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">password</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;manager&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>执行 migrate 进行数据库变更</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 升级数据库</span><br><span class="line">npx sequelize <span class="attr">db</span>:migrate</span><br><span class="line"></span><br><span class="line"># 如果有问题需要回滚，可以通过 <span class="string">`db:migrate:undo`</span> 回退一个变更</span><br><span class="line"></span><br><span class="line"># npx sequelize <span class="attr">db</span>:<span class="attr">migrate</span>:undo</span><br><span class="line"></span><br><span class="line"># 可以通过 <span class="string">`db:migrate:undo:all`</span> 回退到初始状态</span><br></pre></td></tr></table></figure>
<p><strong>安装 crypto 模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install crypto-js</span><br></pre></td></tr></table></figure>
<p>配置文件配置 config / config.default.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">config.<span class="property">crypto</span> = &#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&quot;qhdgw@45ncashdaksh2!#@3nxjdas*_672&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/model/manager.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Manager</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;manager&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">username</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>),</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">      <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">password</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> hmac = crypto.<span class="title function_">createHash</span>(<span class="string">&quot;sha256&quot;</span>, app.<span class="property">config</span>.<span class="property">crypto</span>.<span class="property">secret</span>);</span><br><span class="line">        hmac.<span class="title function_">update</span>(val);</span><br><span class="line">        <span class="keyword">let</span> hash = hmac.<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setDataValue</span>(<span class="string">&quot;password&quot;</span>, hash);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> app.<span class="title function_">formatTime</span>(<span class="variable language_">this</span>.<span class="title function_">getDataValue</span>(<span class="string">&quot;created_time&quot;</span>));</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Manager</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>封装格式化时间方法</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/application.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="title function_">formatTime</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>(time);</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Month</span> = (d.<span class="title function_">getMonth</span>() + <span class="number">1</span>) &gt;= <span class="number">10</span></span><br><span class="line">      ? (d.<span class="title function_">getMonth</span>() + <span class="number">1</span>)</span><br><span class="line">      : <span class="string">&quot;0&quot;</span> + (d.<span class="title function_">getMonth</span>() + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Day</span> = d.<span class="title function_">getDate</span>() &gt;= <span class="number">10</span> ? d.<span class="title function_">getDate</span>() : <span class="string">&quot;0&quot;</span> + d.<span class="title function_">getDate</span>();</span><br><span class="line">    <span class="keyword">const</span> h = d.<span class="title function_">getHours</span>() &gt;= <span class="number">10</span> ? d.<span class="title function_">getHours</span>() : <span class="string">&quot;0&quot;</span> + d.<span class="title function_">getHours</span>();</span><br><span class="line">    <span class="keyword">const</span> m = d.<span class="title function_">getMinutes</span>() &gt;= <span class="number">10</span> ? d.<span class="title function_">getMinutes</span>() : <span class="string">&quot;0&quot;</span> + d.<span class="title function_">getMinutes</span>();</span><br><span class="line">    <span class="keyword">const</span> s = d.<span class="title function_">getSeconds</span>() &gt;= <span class="number">10</span> ? d.<span class="title function_">getSeconds</span>() : <span class="string">&quot;0&quot;</span> + d.<span class="title function_">getSeconds</span>();</span><br><span class="line">    <span class="keyword">return</span> d.<span class="title function_">getFullYear</span>() + <span class="string">&quot;-&quot;</span> + <span class="title class_">Month</span> + <span class="string">&quot;-&quot;</span> + <span class="title class_">Day</span> + <span class="string">&quot; &quot;</span> + h + <span class="string">&quot;:&quot;</span> + m + <span class="string">&quot;:&quot;</span> +</span><br><span class="line">      s;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>控制器</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/manager.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新增页面</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 渲染公共模板</span></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="comment">// 页面标题</span></span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;创建管理员&quot;</span>,</span><br><span class="line">        <span class="comment">// 模板类型 form表单，table表格分页</span></span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="comment">// 表单配置</span></span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/manager&quot;</span>,</span><br><span class="line">            <span class="comment">// 字段配置</span></span><br><span class="line">            <span class="attr">fields</span>:[&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;username&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;密码&quot;</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/manager&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证用户是否已经存在</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123; username &#125;</span><br><span class="line">    &#125;)) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;用户名已存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建用户</span></span><br><span class="line">    <span class="keyword">let</span> manager = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        username,</span><br><span class="line">        password,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!manager) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;创建用户失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(manager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>context扩展</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染公共模板</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">renderTemplate</span>(<span class="params">params = &#123;&#125;</span>) &#123;</span><br><span class="line"><span class="comment">// 获取cookie中的消息提示（闪存）</span></span><br><span class="line">   <span class="keyword">let</span> toast = <span class="variable language_">this</span>.<span class="property">cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;toast&#x27;</span>,&#123;</span><br><span class="line">    <span class="comment">// 中文需要解密</span></span><br><span class="line">       <span class="attr">encrypt</span>: <span class="literal">true</span></span><br><span class="line">   &#125;);</span><br><span class="line"><span class="comment">// 合并到参数中</span></span><br><span class="line">   params.<span class="property">toast</span> = toast ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(toast) : <span class="literal">null</span></span><br><span class="line"><span class="comment">// 渲染公共模板</span></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">render</span>(<span class="string">&#x27;admin/common/template.html&#x27;</span>, params)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 消息提示</span></span><br><span class="line"><span class="title function_">toast</span>(<span class="params">msg,type = <span class="string">&#x27;danger&#x27;</span></span>)&#123;</span><br><span class="line"><span class="comment">// 设置消息提示到cookie中</span></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;toast&#x27;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">       msg,type</span><br><span class="line">   &#125;),&#123;</span><br><span class="line">    <span class="comment">// 过期时间</span></span><br><span class="line">       <span class="attr">maxAge</span>: <span class="number">1500</span>, </span><br><span class="line">    <span class="comment">// 中文需要加密</span></span><br><span class="line">       <span class="attr">encrypt</span>: <span class="literal">true</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>模板部分</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app\view\admin\common\template.<span class="property">html</span></span><br><span class="line"></span><br><span class="line">&lt;!--引入主布局--&gt;</span><br><span class="line">&#123;% <span class="keyword">extends</span> <span class="string">&quot;admin/layout/main_app.html&quot;</span> %&#125;</span><br><span class="line">&lt;!--替换页面标题--&gt;</span><br><span class="line">&#123;% block title %&#125; &#123;&#123; title &#125;&#125; &#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><strong>模板部分</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app\view\admin\layout\main_app.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, user-scalable=0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;后台&#123;% endblock %&#125; - 直播后台<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Favicon --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/img/favicon.png&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://cdn.bootstrapmb.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Fontawesome CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Feathericon CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/css/feathericon.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Main CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/css/style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">			&lt;script src=&quot;/public/assets/js/html5shiv.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">			&lt;script src=&quot;/public/assets/js/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">        &lt;![endif]--&gt;</span></span><br><span class="line">    &#123;% block css %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-attr">[v-cloak]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.fade-enter-active</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.fade-leave-active</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: opacity .<span class="number">3s</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.fade-enter</span>,</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.fade-leave-to</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* .fade-leave-active below version 2.1.8 */</span></span></span><br><span class="line"><span class="language-css">            &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jQuery --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/jquery-3.2.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap Core JS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/popper.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.bootstrapmb.com/bootstrap/4.3.1/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Slimscroll JS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/plugins/slimscroll/jquery.slimscroll.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom JS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/script.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/vue.components.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Main Wrapper --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main-wrapper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;vueapp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">confirm</span> <span class="attr">ref</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">confirm</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">toast</span> <span class="attr">ref</span>=<span class="string">&quot;toast&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">toast</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 公共头部 --&gt;</span></span><br><span class="line">        &#123;% include &quot;admin/layout/_header.html&quot; %&#125;</span><br><span class="line">        <span class="comment">&lt;!-- /公共头部 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 公共侧边栏 --&gt;</span></span><br><span class="line">        &#123;% include &quot;admin/layout/_sidebar.html&quot; %&#125;</span><br><span class="line">        <span class="comment">&lt;!-- /公共侧边栏 --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 页面主布局 --&gt;</span></span><br><span class="line">        &#123;% block pagewrapper %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-wrapper&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content container-fluid&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row align-items-center&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;page-title&quot;</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/admin&quot;</span>&gt;</span>后台首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item active&quot;</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-12&quot;</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!--根据不同的模板类型渲染不同模板--&gt;</span></span><br><span class="line">                        &#123;% if tempType === &#x27;form&#x27; %&#125;</span><br><span class="line">                        &#123;% include &quot;admin/layout/_form.html&quot; %&#125;</span><br><span class="line">                        &#123;% else %&#125;</span><br><span class="line">                        &#123;% include &quot;admin/layout/_table.html&quot; %&#125;</span><br><span class="line">                        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% endblock %&#125;</span><br><span class="line">        <span class="comment">&lt;!-- /页面主布局 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /Main Wrapper --&gt;</span></span><br><span class="line">    &#123;% block js %&#125;&#123;% endblock %&#125;</span><br><span class="line">    &#123;% if toast %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">		// 消息提示</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        if(Vueapp &amp;&amp; Vueapp.$refs.toast)&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            Vueapp.$refs.toast.show(&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                msg: &quot;</span><span class="template-variable">&#123;&#123;<span class="name">toast.msg</span>&#125;&#125;</span><span class="language-xml">&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">                type:&quot;</span><span class="template-variable">&#123;&#123;<span class="name">toast.type</span>&#125;&#125;</span><span class="language-xml">&quot;,</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">            &#125;)</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        &#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>模板部分（公共头部）</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app\view\admin\layout\ _header.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Logo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/img/logo (1).png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;logo logo-small&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/img/logo-small.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span> <span class="attr">width</span>=<span class="string">&quot;30&quot;</span> <span class="attr">height</span>=<span class="string">&quot;30&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /Logo --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">id</span>=<span class="string">&quot;toggle_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fe fe-text-align-left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- &lt;div class=&quot;top-nav-search&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;form&gt;</span></span><br><span class="line"><span class="comment">            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;搜索直播间&quot;&gt;</span></span><br><span class="line"><span class="comment">            &lt;button class=&quot;btn&quot; type=&quot;submit&quot;&gt;&lt;i class=&quot;fa fa-search&quot;&gt;&lt;/i&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="comment">        &lt;/form&gt;</span></span><br><span class="line"><span class="comment">    &lt;/div&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Mobile Menu Toggle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;mobile_btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mobile_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-bars&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /Mobile Menu Toggle --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Header Right Menu --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav user-menu&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- User Menu --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item dropdown has-arrow&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-toggle nav-link&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;dropdown&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;user-img&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/img/profiles/avatar-01.jpg&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">width</span>=<span class="string">&quot;31&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            &#123;% if ctx.session.auth %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-menu&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-header&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;avatar avatar-sm&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/img/profiles/avatar-01.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar-img rounded-circle&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-text&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h6</span>&gt;</span>&#123;&#123;ctx.session.auth.username&#125;&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-muted mb-0&quot;</span>&gt;</span>超级管理员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dropdown-item&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/admin/logout&quot;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- /User Menu --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /Header Right Menu --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>模板部分（公共侧边）</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app\view\admin\layout\ _sidebar.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-inner slimscroll&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;sidebar-menu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-menu&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                &#123;% for item in ctx.locals.sidebar %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123; item.active &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;item.url&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fe &#123;&#123;item.icon&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>模板部分（公共表格）</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app\view\admin\layout\ _table.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card card-table&quot;</span>&gt;</span></span><br><span class="line">    &#123;% if table.buttons %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if table.buttons.add %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-primary&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; table.buttons.add &#125;&#125;&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;% if table.tabs %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav nav-tabs nav-tabs-top&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for item in table.tabs %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;nav-link &#123;% if item.active %&#125;active&#123;% endif %&#125;&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; item.url &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-hover table-center mb-0&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        &#123;% for item in table.columns %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">th</span> &#123;% <span class="attr">if</span> <span class="attr">item.fixed</span> %&#125; <span class="attr">class</span>=<span class="string">&quot;text-&#123;&#123;item.fixed&#125;&#125;&quot;</span> &#123;% <span class="attr">endif</span> %&#125; &#123;% <span class="attr">if</span> <span class="attr">item.width</span> %&#125;</span></span><br><span class="line"><span class="tag">                            <span class="attr">width</span>=<span class="string">&quot;&#123;&#123;item.width&#125;&#125;&quot;</span> &#123;% <span class="attr">endif</span> %&#125;&gt;</span>&#123;&#123;item.title&#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                        &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                    &#123;% if table.data %&#125;</span><br><span class="line">                    &#123;% for item in table.data %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                        &#123;% for c in table.columns %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">td</span> &#123;% <span class="attr">if</span> <span class="attr">c.fixed</span> %&#125; <span class="attr">class</span>=<span class="string">&quot;text-&#123;&#123;c.fixed&#125;&#125;&quot;</span> &#123;% <span class="attr">endif</span> %&#125;&gt;</span></span><br><span class="line">                            &#123;% if c.key %&#125;</span><br><span class="line">                            &#123;&#123; item[c.key] &#125;&#125;</span><br><span class="line">                            &#123;% elif c.action %&#125;</span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;actions&quot;</span>&gt;</span></span><br><span class="line">                                &#123;% if c.action.edit %&#125;</span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;c.action.edit(item.id) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm bg-success-light mr-2&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                &#123;% endif %&#125;</span><br><span class="line">                                &#123;% if c.action.delete %&#125;</span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;del(&#x27;&#123;&#123;c.action.delete(item.id) &#125;&#125;&#x27;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm bg-danger-light mr-2&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                &#123;% endif %&#125;</span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            &#123;% elif c.render %&#125;</span><br><span class="line">                            &#123;&#123; c.render(item) | safe&#125;&#125;</span><br><span class="line">                            &#123;% endif %&#125;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-footer d-flex justify-content-center&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; ctx.locals.pageRender | safe &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Vueapp</span> = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#vueapp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">del</span>(<span class="params">url</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">confirm</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">content</span>:<span class="string">&quot;是否要删除该记录？&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = url</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">modal</span>(<span class="params">url,content</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">confirm</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    content,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = url</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">openInfo</span>(<span class="params">url,title</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> _t = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    url,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">confirm</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">isconfirm</span>:<span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">ths</span>:result.<span class="property">data</span>.<span class="property">ths</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>:result.<span class="property">data</span>.<span class="property">data</span>,</span></span><br><span class="line"><span class="language-javascript">                            title</span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: e.<span class="property">responseJSON</span>.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>模板部分（公共表单）</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app\view\admin\layout\ _form.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if form %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">v-cloak</span> <span class="attr">action</span>=<span class="string">&quot;&#123;&#123; form.action &#125;&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;&#123;&#123; form.method if form.method else &#x27;POST&#x27; &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for item in form.fields %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group row&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;col-form-label col-md-2&quot;</span>&gt;</span>&#123;&#123;item.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-10&quot;</span>&gt;</span></span><br><span class="line">                    &#123;% if item.name === &#x27;coin&#x27; %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-group-prepend&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;input-group-text&quot;</span>&gt;</span>￥<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">type</span>=<span class="string">&quot;&#123;&#123;item.type&#125;&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.&#123;&#123; item.name &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% else %&#125;</span><br><span class="line">                        &#123;% if item.type === &#x27;file&#x27; %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;fileUpload($event,&#x27;&#123;&#123;item.name&#125;&#125;&#x27;)&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;form[&#x27;&#123;&#123;item.name&#125;&#125;&#x27;]&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;form[&#x27;&#123;&#123;item.name&#125;&#125;&#x27;]&quot;</span> <span class="attr">class</span>=<span class="string">&quot;avatar-lg border rounded p-1 mt-2&quot;</span>&gt;</span></span><br><span class="line">                        &#123;% else %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;&#123;&#123;item.type&#125;&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;&#123;&#123;item.name&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">placeholder</span>=<span class="string">&quot;&#123;&#123;item.placeholder&#125;&#125;&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.&#123;&#123; item.name &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                        &#123;% endif %&#125;</span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text-right mt-3&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @<span class="attr">click.stop.prevent</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提</span><br><span class="line">                    交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> <span class="title class_">Vueapp</span> = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#vueapp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">form</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    &#123;% <span class="keyword">for</span> item <span class="keyword">in</span> form.<span class="property">fields</span> %&#125; &#123;&#123; item.<span class="property">name</span> &#125;&#125;: <span class="string">&quot;&#123;&#123; form.data[item.name] if form.data[item.name] else item.default &#125;&#125;&quot;</span>,&#123;% endfor %&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">fileUpload</span>:<span class="keyword">function</span>(<span class="params">event,name</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> _t = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 上传文件</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> file = event.<span class="property">target</span>.<span class="property">files</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>()</span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">url</span>:<span class="string">&quot;/admin/upload?_csrf=&#123;&#123;ctx.csrf|safe&#125;&#125;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>:<span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>: formData,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">contentType</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">processData</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">res</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">form</span>[name] = res.<span class="property">data</span>.<span class="property">url</span></span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: <span class="string">&#x27;上传成功&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>:<span class="string">&quot;success&quot;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">submit</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> _t = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&quot;&#123;&#123; form.method if form.method else &#x27;POST&#x27; &#125;&#125;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">url</span>: <span class="string">&quot;&#123;&#123; form.action &#125;&#125;?_csrf=&#123;&#123;ctx.csrf|safe&#125;&#125;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">form</span>),</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: <span class="string">&quot;&#123;&#123; &#x27;修改&#x27; if id else &#x27;创建&#x27; &#125;&#125;成功&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>:<span class="string">&quot;success&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;&#123;&#123;successUrl&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">delay</span>:<span class="number">1000</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: e.<span class="property">responseJSON</span>.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="管理员列表">管理员列表</h6>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/manager.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;Manager&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;管理员管理&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;table&quot;</span>,</span><br><span class="line">        <span class="attr">table</span>: &#123;</span><br><span class="line">            <span class="comment">// 按钮</span></span><br><span class="line">            <span class="attr">buttons</span>: &#123;</span><br><span class="line">                <span class="attr">add</span>: <span class="string">&quot;/admin/manager/create&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 表头</span></span><br><span class="line">            <span class="attr">columns</span>: [&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;管理员&#x27;</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&quot;username&quot;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">action</span>:&#123;</span><br><span class="line">                    <span class="attr">edit</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/manager/edit/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">delete</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/manager/delete/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">page</span>(<span class="params">modelName, where, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> page = <span class="variable language_">this</span>.<span class="property">query</span>.<span class="property">page</span> ? <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">query</span>.<span class="property">page</span>) : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> limit = <span class="variable language_">this</span>.<span class="property">query</span>.<span class="property">limit</span> ? <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="property">query</span>.<span class="property">limit</span>) : <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> offset = (page - <span class="number">1</span>) * limit;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">order</span>) &#123;</span><br><span class="line">        options.<span class="property">order</span> = [</span><br><span class="line">            [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;DESC&#x27;</span>]</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">model</span>[modelName].<span class="title function_">findAndCountAll</span>(&#123;</span><br><span class="line">        where,</span><br><span class="line">        offset,</span><br><span class="line">        limit,</span><br><span class="line">        ...options</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 总共有多少页</span></span><br><span class="line">    <span class="keyword">let</span> totalPage = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(res.<span class="property">count</span> / limit)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他参数</span></span><br><span class="line">    <span class="keyword">let</span> query = &#123; ...<span class="variable language_">this</span>.<span class="property">query</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (query.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;page&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">delete</span> query.<span class="property">page</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (query.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;limit&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">delete</span> query.<span class="property">limit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对象转&amp;拼接字符串</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">urlEncode</span> = (<span class="params">param, key, encode</span>)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span> (param==<span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> paramStr = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> t = <span class="keyword">typeof</span> (param);</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="string">&#x27;string&#x27;</span> || t == <span class="string">&#x27;number&#x27;</span> || t == <span class="string">&#x27;boolean&#x27;</span>) &#123;</span><br><span class="line">            paramStr += <span class="string">&#x27;&amp;&#x27;</span> + key + <span class="string">&#x27;=&#x27;</span>  + ((encode==<span class="literal">null</span>||encode) ? <span class="built_in">encodeURIComponent</span>(param) : param); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> param) &#123;</span><br><span class="line">                <span class="keyword">var</span> k = key == <span class="literal">null</span> ? i : key + (param <span class="keyword">instanceof</span> <span class="title class_">Array</span> ? <span class="string">&#x27;[&#x27;</span> + i + <span class="string">&#x27;]&#x27;</span> : <span class="string">&#x27;.&#x27;</span> + i)</span><br><span class="line">                paramStr += <span class="title function_">urlEncode</span>(param[i], k, encode)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> paramStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    query = <span class="title function_">urlEncode</span>(query)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> pageEl = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">1</span>; index &lt;= totalPage; index++) &#123;</span><br><span class="line">        <span class="comment">// 当前页码</span></span><br><span class="line">        <span class="keyword">let</span> active = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span>(index === page)&#123;</span><br><span class="line">            active = <span class="string">&#x27;active&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        pageEl += <span class="string">`&lt;li class=&quot;page-item <span class="subst">$&#123;active&#125;</span>&quot;&gt;&lt;a class=&quot;page-link&quot; href=&quot;?page=<span class="subst">$&#123;index&#125;</span>&amp;limit=<span class="subst">$&#123;limit&#125;</span><span class="subst">$&#123;query&#125;</span>&quot;&gt;<span class="subst">$&#123;index&#125;</span>&lt;/a&gt;&lt;/li&gt;`</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> preDisabled = page &lt;= <span class="number">1</span> ? <span class="string">&#x27;disabled&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> nextDisabled = page &gt;= totalPage ? <span class="string">&#x27;disabled&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> pageRender = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;pagination&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;li class=&quot;page-item <span class="subst">$&#123;preDisabled&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;page-link&quot; href=&quot;?page=<span class="subst">$&#123;page - <span class="number">1</span>&#125;</span>&amp;limit=<span class="subst">$&#123;limit&#125;</span><span class="subst">$&#123;query&#125;</span>&quot; aria-label=&quot;Previous&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;span aria-hidden=&quot;true&quot;&gt;«&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;sr-only&quot;&gt;Previous&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;pageEl&#125;</span></span></span><br><span class="line"><span class="string">        &lt;li class=&quot;page-item <span class="subst">$&#123;nextDisabled&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;a class=&quot;page-link&quot; href=&quot;?page=<span class="subst">$&#123;page + <span class="number">1</span>&#125;</span>&amp;limit=<span class="subst">$&#123;limit&#125;</span><span class="subst">$&#123;query&#125;</span>&quot; aria-label=&quot;Next&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;span aria-hidden=&quot;true&quot;&gt;»&lt;/span&gt;</span></span><br><span class="line"><span class="string">                &lt;span class=&quot;sr-only&quot;&gt;Next&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">locals</span>.<span class="property">pageRender</span> = pageRender</span><br><span class="line">    <span class="keyword">return</span> res.<span class="property">rows</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/manager&quot;</span>, controller.<span class="property">admin</span>.<span class="property">manager</span>.<span class="property">index</span>);</span><br></pre></td></tr></table></figure>
<h6 id="修改管理员">修改管理员</h6>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/manager.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑表单页</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">edit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> ctx.<span class="title function_">pageFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">    <span class="keyword">delete</span> data.<span class="property">password</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;修改管理员&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/manager/&quot;</span> + ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">            fields,</span><br><span class="line">            data</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/manager&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新逻辑</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">username</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">const</span> &#123; username,password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 用户名是否被使用</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Op</span> = app.<span class="property">Sequelize</span>.<span class="property">Op</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">id</span>:&#123;</span><br><span class="line">                [<span class="title class_">Op</span>.<span class="property">ne</span>]: id,</span><br><span class="line">            &#125;,</span><br><span class="line">            username</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;))&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该用户名已存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当前管理员是否存在</span></span><br><span class="line">    <span class="keyword">let</span> manager = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!manager)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    manager.<span class="property">username</span> = username</span><br><span class="line">    <span class="keyword">if</span>(password)&#123;</span><br><span class="line">        manager.<span class="property">password</span> = password</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(<span class="keyword">await</span> manager.<span class="title function_">save</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面失败提示</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">pageFail</span>(<span class="params">data = <span class="string">&#x27;&#x27;</span>, code = <span class="number">404</span></span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">render</span>(<span class="string">&#x27;admin/common/404.html&#x27;</span>, &#123;</span><br><span class="line">       data, code</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><strong>模板</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/view/admin/common/404.html</span></span><br><span class="line"></span><br><span class="line">&#123;% <span class="keyword">extends</span> <span class="string">&quot;admin/layout/main.html&quot;</span> %&#125;</span><br><span class="line">&#123;% block title %&#125;<span class="number">404</span>&#123;% endblock %&#125;</span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;error-page&quot;</span>&gt;	</span><br><span class="line">    &lt;!-- <span class="title class_">Main</span> <span class="title class_">Wrapper</span> --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;error-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; code &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;h2 mb-3&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-warning&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; data &#125;&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/admin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>返回后台首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/manager/edit/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">manager</span>.<span class="property">edit</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/manager/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">manager</span>.<span class="property">update</span>);</span><br></pre></td></tr></table></figure>
<h6 id="删除管理员">删除管理员</h6>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/manager.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">destroy</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    ctx.<span class="title function_">toast</span>(<span class="string">&#x27;删除成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/manager`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>扩展</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">toast</span>(<span class="params">msg,type = <span class="string">&#x27;danger&#x27;</span></span>)&#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">cookies</span>.<span class="title function_">set</span>(<span class="string">&#x27;toast&#x27;</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">       msg,type</span><br><span class="line">   &#125;),&#123;</span><br><span class="line">       <span class="attr">maxAge</span>: <span class="number">1500</span>, </span><br><span class="line">       <span class="attr">encrypt</span>: <span class="literal">true</span></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/manager/delete/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">manager</span>.<span class="property">delete</span>);</span><br></pre></td></tr></table></figure>
<h5 id="登录模块">登录模块</h5>
<h6 id="登录功能">登录功能</h6>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">session</span> = &#123;</span><br><span class="line">  <span class="comment">// 在有些场景下，我们希望用户如果长时间都在访问我们的站点，则延长他们的 Session 有效期，不让用户退出登录态</span></span><br><span class="line">  <span class="attr">renew</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// key 代表了存储 Session 的 Cookie 键值对的 key 是什么</span></span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;EGG_SESS&quot;</span>,</span><br><span class="line">  <span class="comment">// 最长保存时间（毫秒）</span></span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span> * <span class="number">30</span>, <span class="comment">// 30 天</span></span><br><span class="line">  <span class="comment">// 设置键值对是否可以被 js 访问，默认为 true，不允许被 js 访问。</span></span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 加密</span></span><br><span class="line">  <span class="attr">encrypt</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/home.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入crypto</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="comment">// 登录页</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; ctx &#125; = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">let</span> toast = ctx.<span class="property">cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;toast&#x27;</span>,&#123; <span class="attr">encrypt</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        toast = toast ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(toast) : <span class="literal">null</span></span><br><span class="line">        <span class="keyword">await</span> ctx.<span class="title function_">render</span>(<span class="string">&#x27;admin/home/login.html&#x27;</span>,&#123;</span><br><span class="line">            toast</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录逻辑</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loginevent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="comment">// 参数验证</span></span><br><span class="line">        ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">            <span class="attr">username</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">                <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">password</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">                <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">        <span class="comment">// 验证该用户是否存在|验证该用户状态是否启用</span></span><br><span class="line">        <span class="keyword">let</span> manager = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Manager</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">            <span class="attr">where</span>: &#123;</span><br><span class="line">                username,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (!manager) &#123;</span><br><span class="line">            ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;用户不存在或已被禁用&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 验证密码</span></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkPassword</span>(password, manager.<span class="property">password</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录到session中</span></span><br><span class="line">        ctx.<span class="property">session</span>.<span class="property">auth</span> = manager</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiSuccess</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 验证密码</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">checkPassword</span>(<span class="params">password, hash_password</span>) &#123;</span><br><span class="line">        <span class="comment">// 先对需要验证的密码进行加密</span></span><br><span class="line">        <span class="keyword">const</span> hmac = crypto.<span class="title function_">createHash</span>(<span class="string">&quot;sha256&quot;</span>, <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">config</span>.<span class="property">crypto</span>.<span class="property">secret</span>);</span><br><span class="line">        hmac.<span class="title function_">update</span>(password);</span><br><span class="line">        password = hmac.<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> res = password === hash_password;</span><br><span class="line">        <span class="keyword">if</span> (!res) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;密码错误&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>模板</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app/view/admin/home/login.html</span><br><span class="line"></span><br><span class="line">&#123;% extends &quot;admin/layout/main.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125; 后台登录 &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main-wrapper login-body&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-wrapper&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loginbox&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-left&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;img-fluid&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/img/logo (1).png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login-right-wrap&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;account-subtitle&quot;</span>&gt;</span>Access to our dashboard<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- Form --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户名...&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.username&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入密码...&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.password&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> @<span class="attr">click.stop.prevent</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block js %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#vueapp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">form</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">username</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">password</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            &#123;% <span class="keyword">if</span> toast %&#125;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="language-javascript">                    msg: <span class="string">&quot;&#123;&#123;toast.msg&#125;&#125;&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="language-javascript">                    type: <span class="string">&quot;&#123;&#123;toast.type&#125;&#125;&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="language-javascript">                &#125;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#123;% endif %&#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">submit</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> _t = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">url</span>: <span class="string">&quot;/admin/loginevent?_csrf=&#123;&#123;ctx.csrf|safe&#125;&#125;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">form</span>),</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: <span class="string">&quot;登录成功&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>:<span class="string">&quot;success&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/admin&quot;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">delay</span>:<span class="number">1000</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        _t.<span class="property">$refs</span>.<span class="property">toast</span>.<span class="title function_">show</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">msg</span>: e.<span class="property">responseJSON</span>.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;)</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p><strong>主布局2</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app/view/admin/layout/main.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, user-scalable=0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;后台&#123;% endblock %&#125; - 直播后台 <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Favicon --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/img/favicon.png&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://cdn.bootstrapmb.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Fontawesome CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Main CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/assets/css/style.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">			&lt;script src=&quot;/public/assets/js/html5shiv.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">			&lt;script src=&quot;/public/assets/js/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">        &lt;![endif]--&gt;</span></span><br><span class="line">    &#123;% block css %&#125;&#123;% endblock %&#125;</span><br><span class="line">    <span class="comment">&lt;!-- jQuery --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/jquery-3.2.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap Core JS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/popper.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.bootstrapmb.com/bootstrap/4.3.1/js/bootstrap.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Custom JS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/script.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/public/assets/js/vue.components.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;vueapp&quot;</span>&gt;</span></span><br><span class="line">        &#123;% block body %&#125;&#123;% endblock %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">confirm</span> <span class="attr">ref</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">confirm</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">toast</span> <span class="attr">ref</span>=<span class="string">&quot;toast&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">toast</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- /Main Wrapper --&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% block js %&#125;&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/login&quot;</span>, controller.<span class="property">admin</span>.<span class="property">home</span>.<span class="property">login</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/loginevent&quot;</span>, controller.<span class="property">admin</span>.<span class="property">home</span>.<span class="property">loginevent</span>);</span><br></pre></td></tr></table></figure>
<h6 id="权限验证">权限验证</h6>
<p><strong>中间件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/middleware/admin_auth.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!ctx.<span class="property">session</span>.<span class="property">auth</span>) &#123;</span><br><span class="line">      ctx.<span class="title function_">toast</span>(<span class="string">&quot;请先登录&quot;</span>, <span class="string">&quot;danger&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/login`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">status</span> === <span class="number">404</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> ctx.<span class="title function_">pageFail</span>(<span class="string">&quot;页面不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">middleware</span> = [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">&quot;adminAuth&quot;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line">config.<span class="property">adminAuth</span> = &#123;</span><br><span class="line">  <span class="attr">ignore</span>: [</span><br><span class="line">    <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/admin/login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/admin/loginevent&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="退出登录">退出登录</h6>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/home.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, service &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 清除session</span></span><br><span class="line">    ctx.<span class="property">session</span>.<span class="property">auth</span> = <span class="literal">null</span></span><br><span class="line">    ctx.<span class="title function_">toast</span>(<span class="string">&#x27;退出登录成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/login`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/logout&quot;</span>, controller.<span class="property">admin</span>.<span class="property">home</span>.<span class="property">logout</span>);</span><br></pre></td></tr></table></figure>
<h5 id="公共模块">公共模块</h5>
<h6 id="后台菜单">后台菜单</h6>
<p><strong>中间件</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/middleware/admin_sidebar.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> menus = [&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;主面板&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-home&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-user-plus&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin/user&quot;</span>,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;直播间管理&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-document&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin/live&quot;</span>,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;礼物管理&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-vector&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin/gift&quot;</span>,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;订单管理&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-cart&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin/order&quot;</span>,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;管理员管理&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;fe-table&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/admin/manager&quot;</span>,</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    ctx.<span class="property">locals</span>.<span class="property">sidebar</span> = menus.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        (ctx.<span class="property">request</span>.<span class="property">url</span> === <span class="string">&quot;/admin&quot;</span> &amp;&amp; item.<span class="property">url</span> === <span class="string">&quot;/admin&quot;</span>) ||</span><br><span class="line">        (ctx.<span class="property">request</span>.<span class="property">url</span>.<span class="title function_">startsWith</span>(item.<span class="property">url</span>) &amp;&amp; ctx.<span class="property">request</span>.<span class="property">url</span> != <span class="string">&quot;/admin&quot;</span>) &amp;&amp;</span><br><span class="line">          item.<span class="property">url</span> !== <span class="string">&quot;/admin&quot;</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        item.<span class="property">active</span> = <span class="string">&quot;active&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> item;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">middleware</span> = [</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">&quot;adminSidebar&quot;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line">config.<span class="property">adminSidebar</span> = &#123;</span><br><span class="line">  <span class="attr">ignore</span>: [</span><br><span class="line">    <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/admin/login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/admin/loginevent&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/public&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>模板</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// app/view/admin/layout/ _slider.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-inner slimscroll&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;sidebar-menu&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sidebar-menu&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                &#123;% for item in ctx.locals.sidebar %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;&#123;&#123; item.active &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123;item.url&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fe &#123;&#123;item.icon&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="上传图片">上传图片</h6>
<p><strong>安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i await-stream-ready stream-wormhole dayjs --save</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">multipart</span> = &#123;</span><br><span class="line">  <span class="attr">fileSize</span>: <span class="string">&quot;50mb&quot;</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;stream&quot;</span>,</span><br><span class="line">  <span class="attr">fileExtensions</span>: [</span><br><span class="line">    <span class="string">&quot;.xls&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.txt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.jpg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.JPG&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.png&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.PNG&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.gif&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.GIF&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.jpeg&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.JPEG&quot;</span>,</span><br><span class="line">  ], <span class="comment">// 扩展几种上传的文件格式</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>控制器</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/controller/admin/common.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">//故名思意 异步二进制 写入流</span></span><br><span class="line"><span class="keyword">const</span> awaitWriteStream = <span class="built_in">require</span>(<span class="string">&#x27;await-stream-ready&#x27;</span>).<span class="property">write</span>;</span><br><span class="line"><span class="comment">//管道读入一个虫洞。</span></span><br><span class="line"><span class="keyword">const</span> sendToWormhole = <span class="built_in">require</span>(<span class="string">&#x27;stream-wormhole&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> dayjs = <span class="built_in">require</span>(<span class="string">&#x27;dayjs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传图片</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">upload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">getFileStream</span>();</span><br><span class="line">    <span class="comment">// 基础的目录</span></span><br><span class="line">    <span class="keyword">const</span> uploadBasePath = <span class="string">&#x27;app/public/uploads&#x27;</span>;</span><br><span class="line">    <span class="comment">// 生成文件名</span></span><br><span class="line">    <span class="keyword">const</span> filename = <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span><span class="subst">$&#123;<span class="built_in">Number</span>.<span class="built_in">parseInt</span>(</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="built_in">Math</span>.random() * <span class="number">1000</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    )&#125;</span><span class="subst">$&#123;path.extname(stream.filename).toLocaleLowerCase()&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// 生成文件夹</span></span><br><span class="line">    <span class="keyword">const</span> dirname = <span class="title function_">dayjs</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>()).<span class="title function_">format</span>(<span class="string">&#x27;YYYY/MM/DD&#x27;</span>);</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">mkdirsSync</span>(<span class="params">dirname</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(dirname)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">mkdirsSync</span>(path.<span class="title function_">dirname</span>(dirname))) &#123;</span><br><span class="line">                fs.<span class="title function_">mkdirSync</span>(dirname);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">mkdirsSync</span>(path.<span class="title function_">join</span>(uploadBasePath, dirname));</span><br><span class="line">    <span class="comment">// 生成写入路径</span></span><br><span class="line">    <span class="keyword">const</span> target = path.<span class="title function_">join</span>(uploadBasePath, dirname, filename);</span><br><span class="line">    <span class="comment">// 写入流</span></span><br><span class="line">    <span class="keyword">const</span> writeStream = fs.<span class="title function_">createWriteStream</span>(target);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//异步把文件流 写入</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">awaitWriteStream</span>(stream.<span class="title function_">pipe</span>(writeStream));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">//如果出现错误，关闭管道</span></span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">sendToWormhole</span>(stream);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="keyword">throw</span>(<span class="number">500</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; protocol, host &#125; = <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">request</span>;</span><br><span class="line">    <span class="keyword">let</span> url = path.<span class="title function_">join</span>(<span class="string">&#x27;/public/uploads&#x27;</span>, dirname, filename).<span class="title function_">replace</span>(<span class="regexp">/\\|\//g</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">apiSuccess</span>(&#123; url &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>路由</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/upload&quot;</span>, controller.<span class="property">admin</span>.<span class="property">common</span>.<span class="property">upload</span>);</span><br></pre></td></tr></table></figure>
<h5 id="创建订单和微信支付">创建订单和微信支付</h5>
<p>安装插件：<a href="https://www.npmjs.com/package/egg-tenpay">egg-tenpay</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-tenpay --save</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line"><span class="attr">tenpay</span>: &#123;</span><br><span class="line">	<span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">package</span>: <span class="string">&#x27;egg-tenpay&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//config/config.default.js</span></span><br><span class="line">config.<span class="property">webUrl</span> = <span class="string">&#x27;http://127.0.0.1:7001&#x27;</span></span><br><span class="line"><span class="comment">// 微信支付配置（最好改成你自己的）</span></span><br><span class="line">config.<span class="property">tenpay</span> = &#123;</span><br><span class="line"><span class="attr">client</span>: &#123;</span><br><span class="line">  <span class="attr">appid</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">mchid</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">partnerKey</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">notify_url</span>: config.<span class="property">webUrl</span> + <span class="string">&#x27;/api/gift/notify&#x27;</span>,</span><br><span class="line">  <span class="comment">// sandbox: true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/gift.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 微信支付</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">wxpay</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx,app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> user_id = ctx.<span class="property">authUser</span>.<span class="property">id</span></span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">price</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>:<span class="string">&quot;充值费用&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> &#123; price &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="keyword">if</span>(price &lt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;至少充值1元&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建订单</span></span><br><span class="line">    <span class="keyword">let</span> no = ctx.<span class="title function_">randomString</span>(<span class="number">20</span>)</span><br><span class="line">    <span class="keyword">let</span> order = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Order</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        no,</span><br><span class="line">        user_id,</span><br><span class="line">        price</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!order)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;创建订单失败&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 支付</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> app.<span class="property">tenpay</span>.<span class="title function_">getAppParams</span>(&#123;</span><br><span class="line">        <span class="attr">out_trade_no</span>:no,</span><br><span class="line">        <span class="attr">body</span>: <span class="string">&#x27;支付测试&#x27;</span>,</span><br><span class="line">        <span class="attr">total_fee</span>: price * <span class="number">100</span>,</span><br><span class="line">        <span class="attr">trade_type</span>: <span class="string">&quot;APP&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ctx.logger.error(&#x27;开始支付&#x27;);</span></span><br><span class="line">    <span class="comment">// ctx.logger.error(result);</span></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 支付回调</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx,app,service &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> info = ctx.<span class="property">request</span>.<span class="property">weixin</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!info || info.<span class="property">result_code</span> !== <span class="string">&#x27;SUCCESS&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">reply</span>(<span class="string">&#x27;支付失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询当前订单</span></span><br><span class="line">    <span class="keyword">let</span> order = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Order</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">no</span>:info.<span class="property">out_trade_no</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!order)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">reply</span>(<span class="string">&#x27;订单不存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改订单状态</span></span><br><span class="line">    order.<span class="property">status</span> = <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    order.<span class="title function_">save</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改用户余额</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> service.<span class="property">user</span>.<span class="title function_">exist</span>(order.<span class="property">user_id</span>)</span><br><span class="line">    <span class="keyword">if</span>(user)&#123;</span><br><span class="line">        user.<span class="property">coin</span> += <span class="built_in">parseInt</span>(info.<span class="property">total_fee</span>)/<span class="number">100</span></span><br><span class="line">        user.<span class="title function_">save</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 回复消息(参数为空回复成功, 传值则为错误消息)</span></span><br><span class="line">    ctx.<span class="title function_">reply</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/gift/wxpay&quot;</span>, controller.<span class="property">api</span>.<span class="property">gift</span>.<span class="property">wxpay</span>);</span><br><span class="line">router.<span class="title function_">post</span>(</span><br><span class="line">  <span class="string">&quot;/api/gift/notify&quot;</span>,</span><br><span class="line">  app.<span class="property">middleware</span>.<span class="title function_">tenpay</span>(<span class="string">&quot;pay&quot;</span>, app),</span><br><span class="line">  controller.<span class="property">api</span>.<span class="property">gift</span>.<span class="property">notify</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h5 id="判断移动端还是pc端">判断移动端还是pc端</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展：app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">ismobile</span>(<span class="params">ctx</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> userAgent = <span class="variable language_">this</span>.<span class="property">request</span>.<span class="property">header</span>[<span class="string">&#x27;user-agent&#x27;</span>].<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="keyword">let</span> pat_phone = <span class="regexp">/ipad|iphone os|midp|rv:1.2.3.4|ucweb|android|windows ce|windows mobile/</span>;</span><br><span class="line">    <span class="keyword">return</span> pat_phone.<span class="title function_">test</span>(userAgent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="用户模块">用户模块</h5>
<h6 id="创建用户-2">创建用户</h6>
<p><strong>数据表迁移文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=user</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;user&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">username</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">        <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">password</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">avatar</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;头像&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">coin</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;创建用户&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/user&quot;</span>,</span><br><span class="line">            <span class="attr">fields</span>:[&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;username&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;密码&quot;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;头像&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;avatar&quot;</span>,</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;coin&quot;</span>,</span><br><span class="line">                <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/user&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">avatar</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">coin</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> &#123; username, password,avatar,coin &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证用户是否已经存在</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123; username &#125;</span><br><span class="line">    &#125;)) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;用户名已存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建用户</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        username,</span><br><span class="line">        password,</span><br><span class="line">        avatar,coin</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;创建用户失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/user/create&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">create</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/user&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">save</span>);</span><br></pre></td></tr></table></figure>
<h6 id="用户列表">用户列表</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;User&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;table&quot;</span>,</span><br><span class="line">        <span class="attr">table</span>: &#123;</span><br><span class="line">            <span class="comment">// 按钮</span></span><br><span class="line">            <span class="attr">buttons</span>: &#123;</span><br><span class="line">                <span class="attr">add</span>: <span class="string">&quot;/admin/user/create&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 表头</span></span><br><span class="line">            <span class="attr">columns</span>: [&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> avatar = item.<span class="property">avatar</span> || <span class="string">&#x27;/public/assets/img/profiles/avatar-01.jpg&#x27;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h2 class=&quot;table-avatar&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a class=&quot;avatar avatar-sm mr-2&quot;&gt;&lt;img class=&quot;avatar-img rounded-circle bg-light&quot; src=&quot;<span class="subst">$&#123;avatar&#125;</span>&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;a&gt;<span class="subst">$&#123;item.username&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/h2&gt;`</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;金币&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;coin&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">action</span>:&#123;</span><br><span class="line">                    <span class="attr">edit</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/user/edit/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">delete</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/user/delete/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/user&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">index</span>);</span><br></pre></td></tr></table></figure>
<h6 id="编辑用户">编辑用户</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">edit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> ctx.<span class="title function_">pageFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">    <span class="keyword">delete</span> data.<span class="property">password</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;修改用户&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/user/&quot;</span> + ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">fields</span>:[&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;username&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;用户名&quot;</span>,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;密码&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;password&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;密码&quot;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;头像&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;avatar&quot;</span>,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;coin&quot;</span>,</span><br><span class="line">                <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/user&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">username</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">avatar</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">coin</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">const</span> &#123; username,password,avatar,coin &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 用户名是否被使用</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Op</span> = app.<span class="property">Sequelize</span>.<span class="property">Op</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">id</span>:&#123;</span><br><span class="line">                [<span class="title class_">Op</span>.<span class="property">ne</span>]: id,</span><br><span class="line">            &#125;,</span><br><span class="line">            username</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;))&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该用户名已存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 当前管理员是否存在</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!user)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    user.<span class="property">username</span> = username</span><br><span class="line">    user.<span class="property">avatar</span> = avatar</span><br><span class="line">    user.<span class="property">coin</span> = coin</span><br><span class="line">    <span class="keyword">if</span>(password)&#123;</span><br><span class="line">        user.<span class="property">password</span> = password</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(<span class="keyword">await</span> user.<span class="title function_">save</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/user/edit/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">edit</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/user/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">update</span>);</span><br></pre></td></tr></table></figure>
<h6 id="删除用户">删除用户</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">destroy</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    ctx.<span class="title function_">toast</span>(<span class="string">&#x27;删除成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/user`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/user/delete/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">user</span>.<span class="property">delete</span>);</span><br></pre></td></tr></table></figure>
<h5 id="礼物模块">礼物模块</h5>
<h6 id="创建礼物">创建礼物</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=gift</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;gift&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">30</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">image</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;礼物图标&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">coin</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;gift&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">模型：app/model/gift.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Gift</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;gift&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">image</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;礼物图标&quot;</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> ctx = app.<span class="title function_">createAnonymousContext</span>();</span><br><span class="line">        <span class="keyword">const</span> &#123; protocol, host &#125; = ctx.<span class="property">request</span>;</span><br><span class="line">        <span class="keyword">return</span> app.<span class="property">config</span>.<span class="property">webUrl</span> + <span class="variable language_">this</span>.<span class="title function_">getDataValue</span>(<span class="string">&quot;image&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">coin</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Gift</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">配置：config/config.<span class="property">default</span>.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">webUrl</span> = <span class="string">&quot;http://127.0.0.1:7001/&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">控制器：app/controller/admin/gift.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;创建礼物&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/gift&quot;</span>,</span><br><span class="line">            <span class="attr">fields</span>:[&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;礼物图标&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;coin&quot;</span>,</span><br><span class="line">                <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/gift&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;礼物名称&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">image</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">coin</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> &#123; name, image,coin &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建礼物</span></span><br><span class="line">    <span class="keyword">let</span> gift = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Gift</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        name,</span><br><span class="line">        image,</span><br><span class="line">        coin</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!gift) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;创建礼物失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(gift);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/gift/create&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">create</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/gift&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">save</span>);</span><br></pre></td></tr></table></figure>
<h6 id="礼物列表">礼物列表</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">控制器：app/controller/admin/gift.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;Gift&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;礼物管理&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;table&quot;</span>,</span><br><span class="line">        <span class="attr">table</span>: &#123;</span><br><span class="line">            <span class="comment">// 按钮</span></span><br><span class="line">            <span class="attr">buttons</span>: &#123;</span><br><span class="line">                <span class="attr">add</span>: <span class="string">&quot;/admin/gift/create&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 表头</span></span><br><span class="line">            <span class="attr">columns</span>: [&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;礼物图标&#x27;</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h2 class=&quot;table-avatar&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a class=&quot;avatar avatar-sm mr-2&quot;&gt;&lt;img class=&quot;avatar-img rounded-circle bg-light&quot; src=&quot;<span class="subst">$&#123;item.image&#125;</span>&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/h2&gt;`</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;礼物名称&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;金币&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;coin&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">action</span>:&#123;</span><br><span class="line">                    <span class="attr">edit</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/gift/edit/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">delete</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/gift/delete/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/gift&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">index</span>);</span><br></pre></td></tr></table></figure>
<h6 id="修改礼物">修改礼物</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">控制器：app/controller/admin/gift.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">edit</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Gift</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> ctx.<span class="title function_">pageFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;修改礼物&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;form&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>: &#123;</span><br><span class="line">            <span class="comment">// 提交地址</span></span><br><span class="line">            <span class="attr">action</span>: <span class="string">&quot;/admin/gift/&quot;</span> + ctx.<span class="property">params</span>.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">fields</span>:[&#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                <span class="attr">placeholder</span>: <span class="string">&quot;礼物名称&quot;</span>,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;礼物图标&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;file&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;image&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">label</span>: <span class="string">&quot;金币&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&quot;coin&quot;</span>,</span><br><span class="line">                <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 新增成功跳转路径</span></span><br><span class="line">        <span class="attr">successUrl</span>:<span class="string">&quot;/admin/gift&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">update</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">name</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">image</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">coin</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;int&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name,image,coin &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 当前管理员是否存在</span></span><br><span class="line">    <span class="keyword">let</span> gift = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Gift</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123; id &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(!gift)&#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该记录不存在&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gift.<span class="property">name</span> = name</span><br><span class="line">    gift.<span class="property">image</span> = image</span><br><span class="line">    gift.<span class="property">coin</span> = coin</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(<span class="keyword">await</span> gift.<span class="title function_">save</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/gift/edit/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">edit</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/admin/gift/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">update</span>);</span><br></pre></td></tr></table></figure>
<h6 id="删除礼物">删除礼物</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">控制器：app/controller/admin/gift.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Gift</span>.<span class="title function_">destroy</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123; id &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    ctx.<span class="title function_">toast</span>(<span class="string">&#x27;删除成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/gift`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/gift/delete/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">gift</span>.<span class="property">delete</span>);</span><br></pre></td></tr></table></figure>
<h5 id="直播间模块">直播间模块</h5>
<h6 id="直播间列表">直播间列表</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=live</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;live&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">title</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">100</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间标题&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">cover</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间封面&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">user_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">look_count</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;总观看人数&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">coin</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;总金币&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">key</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;唯一标识&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">status</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">1</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间状态 0未开播 1直播中 2暂停直播 3直播结束&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;live&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">模型：app/model/live.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Live</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;live&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">100</span>),</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间标题&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cover</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间封面&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">look_count</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;总观看人数&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">coin</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;总金币&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">key</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">STRING</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;唯一标识&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">status</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">1</span>),</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间状态 0未开播 1直播中 2暂停直播 3直播结束&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> app.<span class="title function_">formatTime</span>(<span class="variable language_">this</span>.<span class="title function_">getDataValue</span>(<span class="string">&quot;created_time&quot;</span>));</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关联关系</span></span><br><span class="line">  <span class="title class_">Live</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// 关联主播</span></span><br><span class="line">    <span class="title class_">Live</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">User</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Live</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">控制器：app/controller/admin/live.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> tabs = [&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;全部&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;/admin/live&quot;</span>,</span><br><span class="line">        <span class="attr">active</span>:<span class="literal">false</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;直播中&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;?status=1&quot;</span>,</span><br><span class="line">        <span class="attr">status</span>:<span class="number">1</span>,</span><br><span class="line">        <span class="attr">active</span>:<span class="literal">false</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;未开播&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;?status=0&quot;</span>,</span><br><span class="line">        <span class="attr">status</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">active</span>:<span class="literal">false</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;直播结束&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;?status=3&quot;</span>,</span><br><span class="line">        <span class="attr">status</span>:<span class="number">3</span>,</span><br><span class="line">        <span class="attr">active</span>:<span class="literal">false</span></span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> where = (!ctx.<span class="property">query</span>.<span class="property">status</span> &amp;&amp; ctx.<span class="property">query</span>.<span class="property">status</span> != <span class="number">0</span>) ? &#123;&#125; : &#123; <span class="attr">status</span>:ctx.<span class="property">query</span>.<span class="property">status</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;Live&#x27;</span>,where,&#123;</span><br><span class="line">        <span class="attr">include</span>:[&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>:[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    tabs = tabs.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((!ctx.<span class="property">query</span>.<span class="property">status</span> &amp;&amp; ctx.<span class="property">query</span>.<span class="property">status</span> != <span class="number">0</span> &amp;&amp; item.<span class="property">url</span> === <span class="string">&#x27;/admin/live&#x27;</span>) || item.<span class="property">status</span> == ctx.<span class="property">query</span>.<span class="property">status</span>)&#123;</span><br><span class="line">            item.<span class="property">active</span> = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;直播间管理&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;table&quot;</span>,</span><br><span class="line">        <span class="attr">table</span>: &#123;</span><br><span class="line">            tabs,</span><br><span class="line">            <span class="comment">// 表头</span></span><br><span class="line">            <span class="attr">columns</span>: [&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;直播间&#x27;</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h2 class=&quot;table-avatar&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a class=&quot;avatar mr-2&quot;&gt;&lt;img class=&quot;rounded&quot; src=&quot;<span class="subst">$&#123;item.cover&#125;</span>&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;a&gt;<span class="subst">$&#123;item.title&#125;</span> &lt;span&gt;创建人：ceshi&lt;/span&gt;&lt;/a&gt;	</span></span><br><span class="line"><span class="string">                    &lt;/h2&gt;</span></span><br><span class="line"><span class="string">                    `</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;观看人数&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;look_count&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;金币数&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;coin&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> close = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    <span class="keyword">if</span>(item.<span class="property">status</span> !== <span class="number">3</span>)&#123;</span><br><span class="line">                        close = <span class="string">`&lt;a @click=&quot;modal(&#x27;/admin/live/close/<span class="subst">$&#123;item.id&#125;</span>&#x27;,&#x27;是否要关闭该直播间？&#x27;)&quot; class=&quot;btn btn-sm bg-warning text-white&quot;&gt;关闭直播&lt;/a&gt;`</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;actions btn-group btn-group-sm&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a @click=&quot;openInfo(&#x27;/admin/live/look/<span class="subst">$&#123;item.id&#125;</span>&#x27;,&#x27;观看记录&#x27;)&quot; class=&quot;btn btn-sm bg-primary text-white&quot;&gt;观看记录&lt;/a&gt;						&lt;a @click=&quot;openInfo(&#x27;/admin/live/gift/<span class="subst">$&#123;item.id&#125;</span>&#x27;,&#x27;礼物记录&#x27;)&quot; class=&quot;btn btn-sm bg-purple text-white&quot;&gt;礼物记录&lt;/a&gt;					</span></span><br><span class="line"><span class="string">                        &lt;a @click=&quot;openInfo(&#x27;/admin/live/comment/<span class="subst">$&#123;item.id&#125;</span>&#x27;,&#x27;弹幕记录&#x27;)&quot; class=&quot;btn btn-sm bg-success text-white&quot;&gt;弹幕记录&lt;/a&gt;			</span></span><br><span class="line"><span class="string">                        <span class="subst">$&#123;close&#125;</span>		</span></span><br><span class="line"><span class="string">                        &lt;a @click=&quot;del(&#x27;/admin/live/delete/<span class="subst">$&#123;item.id&#125;</span>&#x27;)&quot; class=&quot;btn btn-sm bg-danger text-white&quot;&gt;删除&lt;/a&gt;	</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    `</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/live&quot;</span>, controller.<span class="property">admin</span>.<span class="property">live</span>.<span class="property">index</span>);</span><br></pre></td></tr></table></figure>
<h6 id="直播间观看情况">直播间观看情况</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=live_user</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;live_user&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">live_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">user_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;live_user&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模型：app/model/live_user.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">LiveUser</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;live_user&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">live_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关联关系</span></span><br><span class="line">  <span class="title class_">LiveUser</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// 关联用户</span></span><br><span class="line">    <span class="title class_">LiveUser</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">User</span>);</span><br><span class="line">    <span class="comment">// 关联直播间</span></span><br><span class="line">    <span class="title class_">LiveUser</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">Live</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">LiveUser</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观看记录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">look</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">LiveUser</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">live_id</span>:id</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">include</span>:[&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>:[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(&#123;</span><br><span class="line">        <span class="attr">ths</span>:[&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;观看时间&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">data</span>:res.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">id</span>:item.<span class="property">id</span>,</span><br><span class="line">                <span class="attr">username</span>:item.<span class="property">user</span>.<span class="property">username</span>,</span><br><span class="line">                <span class="attr">avatar</span>:item.<span class="property">user</span>.<span class="property">avatar</span>,</span><br><span class="line">                <span class="attr">created_time</span>:app.<span class="title function_">formatTime</span>(item.<span class="property">created_time</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/live/look/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">live</span>.<span class="property">look</span>);</span><br></pre></td></tr></table></figure>
<h6 id="直播间礼物情况">直播间礼物情况</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=live_gift</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;live_gift&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">live_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">user_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">gift_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;礼物id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;gift&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;live_gift&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模型：app/model/live_gift.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">LiveGift</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;live_gift&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">live_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">gift_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;礼物id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;gift&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关联关系</span></span><br><span class="line">  <span class="title class_">LiveGift</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// 关联用户</span></span><br><span class="line">    <span class="title class_">LiveGift</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">User</span>);</span><br><span class="line">    <span class="comment">// 关联直播间</span></span><br><span class="line">    <span class="title class_">LiveGift</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">Live</span>);</span><br><span class="line">    <span class="comment">// 关联礼物</span></span><br><span class="line">    <span class="title class_">LiveGift</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">Gift</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">LiveGift</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 礼物记录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">gift</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">LiveGift</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">live_id</span>:id</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">include</span>:[&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>:[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">Gift</span>,</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(&#123;</span><br><span class="line">        <span class="attr">ths</span>:[&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;礼物名称&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;gift_name&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;礼物图标&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;gift_image&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&quot;image&quot;</span></span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;礼物金币&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;gift_coin&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;赠送者&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;赠送时间&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">data</span>:res.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">created_time</span>:app.<span class="title function_">formatTime</span>(item.<span class="property">created_time</span>),</span><br><span class="line">                <span class="attr">gift_name</span>:item.<span class="property">gift</span>.<span class="property">name</span>,</span><br><span class="line">                <span class="attr">gift_coin</span>:item.<span class="property">gift</span>.<span class="property">coin</span>,</span><br><span class="line">                <span class="attr">gift_image</span>:item.<span class="property">gift</span>.<span class="property">image</span>,</span><br><span class="line">                <span class="attr">username</span>:item.<span class="property">user</span>.<span class="property">username</span>,</span><br><span class="line">                <span class="attr">avatar</span>:item.<span class="property">user</span>.<span class="property">avatar</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/live/gift/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">live</span>.<span class="property">gift</span>);</span><br></pre></td></tr></table></figure>
<h6 id="直播间评论情况">直播间评论情况</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=comment</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;comment&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">content</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">TEXT</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;评论内容&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">live_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">user_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;comment&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">模型：app/model/comment.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Comment</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;comment&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">TEXT</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;评论内容&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">live_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;直播间id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;live&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关联关系</span></span><br><span class="line">  <span class="title class_">Comment</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// 关联发布人</span></span><br><span class="line">    <span class="title class_">Comment</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">User</span>);</span><br><span class="line">    <span class="comment">// 关联直播间</span></span><br><span class="line">    <span class="title class_">Comment</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">Live</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Comment</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 弹幕记录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">comment</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Comment</span>.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            <span class="attr">live_id</span>:id</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">include</span>:[&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>:[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(&#123;</span><br><span class="line">        <span class="attr">ths</span>:[&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;内容&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;发送人&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;username&#x27;</span>,</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;发送时间&#x27;</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">        &#125;],</span><br><span class="line">        <span class="attr">data</span>:res.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">content</span>:item.<span class="property">content</span>,</span><br><span class="line">                <span class="attr">created_time</span>:app.<span class="title function_">formatTime</span>(item.<span class="property">created_time</span>),</span><br><span class="line">                <span class="attr">username</span>:item.<span class="property">user</span>.<span class="property">username</span>,</span><br><span class="line">                <span class="attr">avatar</span>:item.<span class="property">user</span>.<span class="property">avatar</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/live/comment/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">live</span>.<span class="property">comment</span>);</span><br></pre></td></tr></table></figure>
<h6 id="关闭直播间">关闭直播间</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">close</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> live = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Live</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live) &#123;</span><br><span class="line">        ctx.<span class="title function_">toast</span>(<span class="string">&#x27;该直播间不存在&#x27;</span>,<span class="string">&#x27;danger&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(live.<span class="property">status</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        ctx.<span class="title function_">toast</span>(<span class="string">&#x27;该直播间已结束&#x27;</span>,<span class="string">&#x27;danger&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        live.<span class="property">status</span> = <span class="number">3</span></span><br><span class="line">        <span class="keyword">await</span> live.<span class="title function_">save</span>()</span><br><span class="line">        ctx.<span class="title function_">toast</span>(<span class="string">&#x27;关闭成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/live`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/live/close/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">live</span>.<span class="property">close</span>);</span><br></pre></td></tr></table></figure>
<h5 id="订单模块">订单模块</h5>
<h6 id="订单列表">订单列表</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npx sequelize migration:generate --name=order</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">up</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="variable constant_">INTEGER</span>, <span class="variable constant_">STRING</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = <span class="title class_">Sequelize</span>;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">createTable</span>(<span class="string">&quot;order&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">no</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">100</span>),</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;订单号&quot;</span>,</span><br><span class="line">        <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">user_id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">        <span class="attr">references</span>: &#123;</span><br><span class="line">          <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">        <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">price</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;价格&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">status</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="variable constant_">ENUM</span>,</span><br><span class="line">        <span class="attr">values</span>: [<span class="string">&quot;pending&quot;</span>, <span class="string">&quot;success&quot;</span>, <span class="string">&quot;fail&quot;</span>],</span><br><span class="line">        <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">defaultValue</span>: <span class="string">&quot;pending&quot;</span>,</span><br><span class="line">        <span class="attr">comment</span>: <span class="string">&quot;支付状态&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">      <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">down</span>: <span class="function">(<span class="params">queryInterface, Sequelize</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> queryInterface.<span class="title function_">dropTable</span>(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模型：app/model/order.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="variable constant_">STRING</span>, <span class="variable constant_">INTEGER</span>, <span class="variable constant_">DATE</span>, <span class="variable constant_">ENUM</span>, <span class="variable constant_">TEXT</span> &#125; = app.<span class="property">Sequelize</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Order</span> = app.<span class="property">model</span>.<span class="title function_">define</span>(<span class="string">&quot;order&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">INTEGER</span>(<span class="number">20</span>),</span><br><span class="line">      <span class="attr">primaryKey</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">autoIncrement</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">no</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title function_">STRING</span>(<span class="number">100</span>),</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;订单号&quot;</span>,</span><br><span class="line">      <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">user_id</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;用户id&quot;</span>,</span><br><span class="line">      <span class="attr">references</span>: &#123;</span><br><span class="line">        <span class="attr">model</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onDelete</span>: <span class="string">&quot;cascade&quot;</span>,</span><br><span class="line">      <span class="attr">onUpdate</span>: <span class="string">&quot;restrict&quot;</span>, <span class="comment">// 更新时操作</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">price</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">INTEGER</span>,</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;价格&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">status</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="variable constant_">ENUM</span>,</span><br><span class="line">      <span class="attr">values</span>: [<span class="string">&quot;pending&quot;</span>, <span class="string">&quot;success&quot;</span>, <span class="string">&quot;fail&quot;</span>],</span><br><span class="line">      <span class="attr">allowNull</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">defaultValue</span>: <span class="string">&quot;pending&quot;</span>,</span><br><span class="line">      <span class="attr">comment</span>: <span class="string">&quot;支付状态&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">created_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">    <span class="attr">updated_time</span>: <span class="variable constant_">DATE</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关联关系</span></span><br><span class="line">  <span class="title class_">Order</span>.<span class="property">associate</span> = <span class="keyword">function</span> (<span class="params">models</span>) &#123;</span><br><span class="line">    <span class="comment">// 关联主播</span></span><br><span class="line">    <span class="title class_">Order</span>.<span class="title function_">belongsTo</span>(app.<span class="property">model</span>.<span class="property">User</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Order</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/order.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;Order&#x27;</span>,&#123;&#125;,&#123;</span><br><span class="line">        <span class="attr">include</span>:[&#123;</span><br><span class="line">            <span class="attr">model</span>:app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>:[<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line"></span><br><span class="line">    data = data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        item.<span class="property">username</span> = item.<span class="property">user</span>.<span class="property">username</span></span><br><span class="line">        item.<span class="property">avatar</span> = item.<span class="property">user</span>.<span class="property">avatar</span></span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">renderTemplate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">        <span class="attr">tempType</span>: <span class="string">&quot;table&quot;</span>,</span><br><span class="line">        <span class="attr">table</span>: &#123;</span><br><span class="line">            <span class="comment">// 表头</span></span><br><span class="line">            <span class="attr">columns</span>: [&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">60</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;订单号&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;no&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> avatar = item.<span class="property">avatar</span> || <span class="string">&#x27;/public/assets/img/profiles/avatar-01.jpg&#x27;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h2 class=&quot;table-avatar&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a class=&quot;avatar avatar-sm mr-2&quot;&gt;&lt;img class=&quot;avatar-img rounded-circle bg-light&quot; src=&quot;<span class="subst">$&#123;avatar&#125;</span>&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;a&gt;<span class="subst">$&#123;item.username&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/h2&gt;`</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;price&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;订单状态&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="title function_">render</span>(<span class="params">item</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> o = &#123;</span><br><span class="line">                        <span class="attr">pending</span>:&#123;</span><br><span class="line">                            <span class="attr">text</span>:<span class="string">&quot;未支付&quot;</span>,</span><br><span class="line">                            <span class="attr">color</span>:<span class="string">&quot;warning&quot;</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">success</span>:&#123;</span><br><span class="line">                            <span class="attr">text</span>:<span class="string">&quot;支付成功&quot;</span>,</span><br><span class="line">                            <span class="attr">color</span>:<span class="string">&quot;success&quot;</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">fail</span>:&#123;</span><br><span class="line">                            <span class="attr">text</span>:<span class="string">&quot;支付失败&quot;</span>,</span><br><span class="line">                            <span class="attr">color</span>:<span class="string">&quot;danger&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">let</span> v = o[item.<span class="property">status</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;span class=&quot;badge badge-<span class="subst">$&#123;v.color&#125;</span>&quot;&gt;<span class="subst">$&#123;v.text&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    `</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                <span class="attr">key</span>: <span class="string">&#x27;created_time&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">180</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">fixed</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">action</span>:&#123;</span><br><span class="line">                    <span class="attr">delete</span>:<span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`/admin/order/delete/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;],</span><br><span class="line">            data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">路由：app/router.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/order&quot;</span>, controller.<span class="property">admin</span>.<span class="property">order</span>.<span class="property">index</span>);</span><br></pre></td></tr></table></figure>
<h6 id="删除订单">删除订单</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/admin/order.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">delete</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span></span><br><span class="line">    <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Order</span>.<span class="title function_">destroy</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>:&#123;</span><br><span class="line">            id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    ctx.<span class="title function_">toast</span>(<span class="string">&#x27;删除成功&#x27;</span>,<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">redirect</span>(<span class="string">`/admin/order`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/admin/order/delete/:id&quot;</span>, controller.<span class="property">admin</span>.<span class="property">order</span>.<span class="property">delete</span>);</span><br></pre></td></tr></table></figure>
<h5 id="Api开发-用户模块">Api开发-用户模块</h5>
<h6 id="用户注册">用户注册</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">reg</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">range</span>: &#123;</span><br><span class="line">                <span class="attr">min</span>: <span class="number">5</span>,</span><br><span class="line">                <span class="attr">max</span>: <span class="number">20</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">repassword</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;确认密码&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">equals</span>: [</span><br><span class="line">            [<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;repassword&#x27;</span>]</span><br><span class="line">        ]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">    <span class="comment">// 验证用户是否已经存在</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            username,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;用户名已存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建用户</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;创建用户失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户注册</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/reg&quot;</span>, controller.<span class="property">api</span>.<span class="property">user</span>.<span class="property">reg</span>);</span><br></pre></td></tr></table></figure>
<h6 id="用户登录">用户登录</h6>
<p>jwt 加密鉴权插件地址：</p>
<blockquote>
<p><a href="https://www.npmjs.com/package/egg-jwt">https://www.npmjs.com/package/egg-jwt</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-jwt --save</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#123;app_root&#125;/config/plugin.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">jwt</span> = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&quot;egg-jwt&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;app_root&#125;/config/config.default.js</span></span><br><span class="line">config.<span class="property">jwt</span> = &#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&quot;qhdgw@45ncashdaksh2!#@3nxjdas*_672&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>安装crypto模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i crypto --save</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/extend/context.js</span></span><br><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="comment">// 生成token</span></span><br><span class="line"><span class="title function_">getToken</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">jwt</span>.<span class="title function_">sign</span>(value, <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">config</span>.<span class="property">jwt</span>.<span class="property">secret</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 验证token</span></span><br><span class="line"><span class="title function_">checkToken</span>(<span class="params">token</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">jwt</span>.<span class="title function_">verify</span>(token, <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">config</span>.<span class="property">jwt</span>.<span class="property">secret</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 验证密码</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">checkPassword</span>(<span class="params">password, hash_password</span>) &#123;</span><br><span class="line">	<span class="comment">// 先对需要验证的密码进行加密</span></span><br><span class="line">	<span class="keyword">const</span> hmac = crypto.<span class="title function_">createHash</span>(<span class="string">&quot;sha256&quot;</span>, <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">config</span>.<span class="property">crypto</span>.<span class="property">secret</span>);</span><br><span class="line">	hmac.<span class="title function_">update</span>(password);</span><br><span class="line">	password = hmac.<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> res = password === hash_password;</span><br><span class="line">	<span class="keyword">if</span> (!res) &#123;</span><br><span class="line">		<span class="variable language_">this</span>.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;密码错误&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>redis 缓存插件和封装 安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-redis --save</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">redis</span> = &#123;</span><br><span class="line">  <span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">package</span>: <span class="string">&quot;egg-redis&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// redis存储</span></span><br><span class="line">config.<span class="property">redis</span> = &#123;</span><br><span class="line">  <span class="attr">client</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">6379</span>, <span class="comment">// Redis port</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>, <span class="comment">// Redis host</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">db</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>缓存库封装</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/service/cache.js</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Service</span> = <span class="built_in">require</span>(<span class="string">&quot;egg&quot;</span>).<span class="property">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheService</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Service</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; key 键</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">boolean</span>&#125; isChildObject 元素是否为对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> array </span>&#125; 返回数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">getList</span>(<span class="params">key, isChildObject = <span class="literal">false</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> redis.<span class="title function_">lrange</span>(key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (isChildObject) &#123;</span><br><span class="line">      data = data.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 设置列表</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; key 键</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object|string</span>&#125; value 值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; type 类型：push和unshift</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Number</span>&#125; expir 过期时间 单位秒</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> Number </span>&#125; 返回索引</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">setList</span>(<span class="params">key, value, type = <span class="string">&quot;push&quot;</span>, expir = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">if</span> (expir &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> redis.<span class="title function_">expire</span>(key, expir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">&quot;push&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">rpush</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">lpush</span>(key, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 设置 redis 缓存</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; key 键</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">String | Object | array</span>&#125; value 值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> Number </span>&#125; expir 过期时间 单位秒</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> String </span>&#125; 返回成功字符串OK</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">set</span>(<span class="params">key, value, expir = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">if</span> (expir === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">set</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">set</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value), <span class="string">&quot;EX&quot;</span>, expir);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 获取 redis 缓存</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; key 键</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> String | array | Object </span>&#125; 返回获取的数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> redis.<span class="title function_">get</span>(key);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(result);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * redis 自增</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; key 键</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> Number </span>&#125; value 自增的值</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> Number </span>&#125; 返回递增值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">incr</span>(<span class="params">key, number = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">if</span> (number === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">incr</span>(key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">incrby</span>(key, number);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 查询长度</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &#123;<span class="type"> Number </span>&#125; 返回数据长度</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">strlen</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">strlen</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 删除指定key</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; <span class="variable">key</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">remove</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; redis &#125; = <span class="variable language_">this</span>.<span class="property">app</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> redis.<span class="title function_">del</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 清空缓存</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">redis</span>.<span class="title function_">flushall</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">CacheService</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">username</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">password</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> &#123; username, password &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line">    <span class="comment">// 验证该用户是否存在|验证该用户状态是否启用</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            username,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;用户不存在或已被禁用&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 验证密码</span></span><br><span class="line">    <span class="keyword">await</span> ctx.<span class="title function_">checkPassword</span>(password, user.<span class="property">password</span>);</span><br><span class="line"></span><br><span class="line">    user = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user));</span><br><span class="line">    <span class="comment">// 生成token</span></span><br><span class="line">    <span class="keyword">let</span> token = ctx.<span class="title function_">getToken</span>(user);</span><br><span class="line">    user.<span class="property">token</span> = token;</span><br><span class="line">    <span class="keyword">delete</span> user.<span class="property">password</span>;</span><br><span class="line">    <span class="comment">// 加入缓存中</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">service</span>.<span class="property">cache</span>.<span class="title function_">set</span>(<span class="string">&#x27;user_&#x27;</span> + user.<span class="property">id</span>, token)) &#123;</span><br><span class="line">        ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;登录失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回用户信息和token</span></span><br><span class="line">    <span class="keyword">return</span> ctx.<span class="title function_">apiSuccess</span>(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户登录</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/login&quot;</span>, controller.<span class="property">api</span>.<span class="property">user</span>.<span class="property">login</span>);</span><br></pre></td></tr></table></figure>
<h6 id="权限验证中间件">权限验证中间件</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 中间件：app/middleware/auth.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">option, app</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">//1. 获取 header 头token</span></span><br><span class="line">    <span class="keyword">let</span> token = ctx.<span class="property">header</span>.<span class="property">token</span> || ctx.<span class="property">query</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">      ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&quot;您没有权限访问该接口!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 根据token解密，换取用户信息</span></span><br><span class="line">    <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      user = ctx.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">let</span> fail = error.<span class="property">name</span> === <span class="string">&quot;TokenExpiredError&quot;</span></span><br><span class="line">        ? <span class="string">&quot;token 已过期! 请重新获取令牌&quot;</span></span><br><span class="line">        : <span class="string">&quot;Token 令牌不合法!&quot;</span>;</span><br><span class="line">      ctx.<span class="keyword">throw</span>(<span class="number">400</span>, fail);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 判断当前用户是否登录</span></span><br><span class="line">    <span class="keyword">let</span> t = <span class="keyword">await</span> ctx.<span class="property">service</span>.<span class="property">cache</span>.<span class="title function_">get</span>(<span class="string">&quot;user_&quot;</span> + user.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">if</span> (!t || t !== token) &#123;</span><br><span class="line">      ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&quot;Token 令牌不合法!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 获取当前用户，验证当前用户是否被禁用</span></span><br><span class="line">    user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findByPk</span>(user.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&quot;用户不存在或已被禁用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5. 把 user 信息挂载到全局ctx上</span></span><br><span class="line">    ctx.<span class="property">authUser</span> = user;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置：config/config.default.js</span></span><br><span class="line"></span><br><span class="line">config.<span class="property">middleware</span> = [</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="string">&quot;auth&quot;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">];</span><br><span class="line">config.<span class="property">auth</span> = &#123;</span><br><span class="line">  <span class="attr">match</span>: [</span><br><span class="line">    <span class="string">&quot;/api/logout&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/api/live/create&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/api/live/changestatus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/api/gift/wxpay&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/api/user/info&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="退出登录-2">退出登录</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; ctx, service &#125; = <span class="variable language_">this</span>;</span><br><span class="line">   <span class="comment">// 拿到当前用户id</span></span><br><span class="line">   <span class="keyword">let</span> current_user_id = ctx.<span class="property">authUser</span>.<span class="property">id</span>;</span><br><span class="line">   <span class="comment">// 移除redis当前用户信息</span></span><br><span class="line">   <span class="keyword">if</span> (!<span class="keyword">await</span> service.<span class="property">cache</span>.<span class="title function_">remove</span>(<span class="string">&#x27;user_&#x27;</span> + current_user_id)) &#123;</span><br><span class="line">       ctx.<span class="keyword">throw</span>(<span class="number">400</span>, <span class="string">&#x27;退出登录失败&#x27;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   ctx.<span class="title function_">apiSuccess</span>(<span class="string">&#x27;退出成功&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出登录</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/logout&quot;</span>, controller.<span class="property">api</span>.<span class="property">user</span>.<span class="property">logout</span>);</span><br></pre></td></tr></table></figure>
<h6 id="获取当前用户的信息">获取当前用户的信息</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/user.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前用户信息</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">info</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; ctx, service, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">   <span class="keyword">let</span> user = ctx.<span class="property">authUser</span></span><br><span class="line">   <span class="keyword">return</span> ctx.<span class="title function_">apiSuccess</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(user)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/user/info&quot;</span>, controller.<span class="property">api</span>.<span class="property">user</span>.<span class="property">info</span>);</span><br></pre></td></tr></table></figure>
<h5 id="Api开发-直播间模块">Api开发-直播间模块</h5>
<h6 id="创建直播间">创建直播间</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建直播间</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> user_id = ctx.<span class="property">authUser</span>.<span class="property">id</span>;</span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;直播间标题&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">cover</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;直播间封面&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> &#123;</span><br><span class="line">        title, cover</span><br><span class="line">    &#125; = ctx.<span class="property">request</span>.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成唯一key</span></span><br><span class="line">    <span class="keyword">let</span> key = ctx.<span class="title function_">randomString</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直接创建</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Live</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        title,</span><br><span class="line">        cover,</span><br><span class="line">        user_id,</span><br><span class="line">        key,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成签名</span></span><br><span class="line">    <span class="keyword">let</span> sign = <span class="variable language_">this</span>.<span class="title function_">sign</span>(key)</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: res,</span><br><span class="line">        sign</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成签名</span></span><br><span class="line"><span class="title function_">sign</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> secret = app.<span class="property">config</span>.<span class="property">mediaServer</span>.<span class="property">auth</span>.<span class="property">secret</span></span><br><span class="line">    <span class="keyword">const</span> expire = <span class="built_in">parseInt</span>((<span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">100000000</span>) / <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">const</span> hashValue = <span class="title function_">md5</span>(<span class="string">`/live/<span class="subst">$&#123;key&#125;</span>-<span class="subst">$&#123;expire&#125;</span>-<span class="subst">$&#123;secret&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;expire&#125;</span>-<span class="subst">$&#123;hashValue&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展：app/extend/context.js</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">randomString</span>(<span class="params">length</span>) &#123;</span><br><span class="line">   <span class="keyword">const</span> chars = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line">   <span class="keyword">var</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">var</span> i = length; i &gt; <span class="number">0</span>; --i) result += chars[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * chars.<span class="property">length</span>)];</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建直播间</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/live/create&quot;</span>, controller.<span class="property">api</span>.<span class="property">live</span>.<span class="property">save</span>);</span><br></pre></td></tr></table></figure>
<h6 id="修改直播间状态">修改直播间状态</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器:app/controller/api/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改直播间状态</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">changestatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> user_id = ctx.<span class="property">authUser</span>.<span class="property">id</span>;</span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;int&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&#x27;直播间ID&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">type</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">range</span>: &#123;</span><br><span class="line">                <span class="attr">in</span>: [<span class="string">&#x27;play&#x27;</span>, <span class="string">&#x27;pause&#x27;</span>, <span class="string">&#x27;stop&#x27;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> &#123; id, type &#125; = ctx.<span class="property">request</span>.<span class="property">body</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> live = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Live</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            id,</span><br><span class="line">            user_id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!live) &#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该直播间不存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (live.<span class="property">status</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;该直播间已结束&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> status = &#123;</span><br><span class="line">        <span class="attr">play</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pause</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">stop</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    live.<span class="property">status</span> = status[type]</span><br><span class="line">    <span class="keyword">await</span> live.<span class="title function_">save</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.<span class="title function_">apiSuccess</span>(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改直播间状态</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/api/live/changestatus&quot;</span>, controller.<span class="property">api</span>.<span class="property">live</span>.<span class="property">changestatus</span>);</span><br></pre></td></tr></table></figure>
<h6 id="直播间列表-2">直播间列表</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直播间列表</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">list</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">let</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">   ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">       <span class="attr">page</span>: &#123;</span><br><span class="line">           <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="attr">desc</span>: <span class="string">&quot;页码&quot;</span>,</span><br><span class="line">           <span class="attr">type</span>: <span class="string">&quot;int&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="keyword">let</span> rows = <span class="keyword">await</span> ctx.<span class="title function_">page</span>(<span class="string">&#x27;Live&#x27;</span>);</span><br><span class="line">   ctx.<span class="title function_">apiSuccess</span>(rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直播间列表</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/live/list/:page&quot;</span>, controller.<span class="property">api</span>.<span class="property">live</span>.<span class="property">list</span>);</span><br></pre></td></tr></table></figure>
<h6 id="查看指定直播间">查看指定直播间</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 控制器：app/controller/api/live.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看指定直播间</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 参数验证</span></span><br><span class="line">    ctx.<span class="title function_">validate</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: &#123;</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">desc</span>: <span class="string">&quot;直播间ID&quot;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;int&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> id = ctx.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> live = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Live</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            id,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">include</span>: [&#123;</span><br><span class="line">            <span class="attr">model</span>: app.<span class="property">model</span>.<span class="property">User</span>,</span><br><span class="line">            <span class="attr">attributes</span>: [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;avatar&#x27;</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!live) &#123;</span><br><span class="line">        <span class="keyword">return</span> ctx.<span class="title function_">apiFail</span>(<span class="string">&#x27;当前直播间不存在&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成签名</span></span><br><span class="line">    <span class="keyword">let</span> sign = <span class="variable language_">this</span>.<span class="title function_">sign</span>(live.<span class="property">key</span>);</span><br><span class="line"></span><br><span class="line">    live = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(live))</span><br><span class="line"></span><br><span class="line">    ctx.<span class="title function_">apiSuccess</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: live,</span><br><span class="line">        sign</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 路由：app/router.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看直播间</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/api/live/read/:id&quot;</span>, controller.<span class="property">api</span>.<span class="property">live</span>.<span class="property">read</span>);</span><br></pre></td></tr></table></figure>
<h6 id="搭建直播服务器">搭建直播服务器</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install node-media-server --save</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="https://github.com/illuspas/Node-Media-Server/blob/master/README_CN.md">https://github.com/illuspas/Node-Media-Server/blob/master/README_CN.md</a></p>
</blockquote>
<p><strong>配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 流媒体配置</span></span><br><span class="line">config.<span class="property">mediaServer</span> = &#123;</span><br><span class="line">  <span class="attr">rtmp</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">23480</span>,</span><br><span class="line">    <span class="attr">chunk_size</span>: <span class="number">60000</span>,</span><br><span class="line">    <span class="attr">gop_cache</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">ping</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">ping_timeout</span>: <span class="number">60</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">http</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">23481</span>,</span><br><span class="line">    <span class="attr">allow_origin</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="attr">play</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">publish</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&quot;nodemedia2017privatekey&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启动流媒体服务：app.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NodeMediaServer</span> = <span class="built_in">require</span>(<span class="string">&quot;node-media-server&quot;</span>);</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppBootHook</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">app</span> = app;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">configWillLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 此时 config 文件已经被读取并合并，但是还并未生效</span></span><br><span class="line">    <span class="comment">// 这是应用层修改配置的最后时机</span></span><br><span class="line">    <span class="comment">// 注意：此函数只支持同步调用</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">didLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 所有的配置已经加载完毕</span></span><br><span class="line">    <span class="comment">// 可以用来加载应用自定义的文件，启动自定义的服务</span></span><br><span class="line">    <span class="comment">// 启动流媒体服务</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span> = <span class="keyword">new</span> <span class="title class_">NodeMediaServer</span>(<span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">config</span>.<span class="property">mediaServer</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">run</span>();</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;preConnect&quot;</span>, <span class="function">(<span class="params">id, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on preConnect]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// let session = nms.getSession(id);</span></span><br><span class="line">        <span class="comment">// session.reject();</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;postConnect&quot;</span>, <span class="function">(<span class="params">id, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on postConnect]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;doneConnect&quot;</span>, <span class="function">(<span class="params">id, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on doneConnect]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;prePublish&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on prePublish]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// let session = nms.getSession(id);</span></span><br><span class="line">        <span class="comment">// session.reject();</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;postPublish&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on postPublish]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;donePublish&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on donePublish]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;prePlay&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on prePlay]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// let session = nms.getSession(id);</span></span><br><span class="line">        <span class="comment">// session.reject();</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;postPlay&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on postPlay]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">app</span>.<span class="property">nms</span>.<span class="title function_">on</span>(<span class="string">&quot;donePlay&quot;</span>, <span class="function">(<span class="params">id, StreamPath, args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">          <span class="string">&quot;[NodeEvent on donePlay]&quot;</span>,</span><br><span class="line">          <span class="string">`id=<span class="subst">$&#123;id&#125;</span> StreamPath=<span class="subst">$&#123;StreamPath&#125;</span> args=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(args)&#125;</span>`</span>,</span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">willReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 所有的插件都已启动完毕，但是应用整体还未 ready</span></span><br><span class="line">    <span class="comment">// 可以做一些数据初始化等操作，这些操作成功才会启动应用</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">didReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 应用已经启动完毕</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">serverDidReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// http / https server 已启动，开始接受外部请求</span></span><br><span class="line">    <span class="comment">// 此时可以从 app.server 拿到 server 的实例</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// this.app.server.on(&#x27;timeout&#x27;, socket =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     // handle socket timeout</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">AppBootHook</span>;</span><br></pre></td></tr></table></figure>
<h6 id="socket-io安装和通讯">socket.io安装和通讯</h6>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm i egg-socket.io --save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>文档地址：<a href="https://eggjs.org/zh-cn/tutorials/socketio.html">https://eggjs.org/zh-cn/tutorials/socketio.html</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// config/plugin.js</span></span><br><span class="line"><span class="attr">io</span>: &#123;</span><br><span class="line">	<span class="attr">enable</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">package</span>: <span class="string">&#x27;egg-socket.io&#x27;</span>,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line">config.<span class="property">io</span> = &#123;</span><br><span class="line">    <span class="attr">init</span>: &#123;</span><br><span class="line">      <span class="attr">wsEngine</span>: <span class="string">&#x27;ws&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">namespace</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">connectionMiddleware</span>: [</span><br><span class="line">          <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">packetMiddleware</span>: [],</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">redis</span>: &#123;</span><br><span class="line">      <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">      <span class="attr">port</span>: <span class="number">6379</span>,</span><br><span class="line">	  <span class="attr">db</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><strong>部署: package.json</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;egg-bin dev --sticky&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;egg-scripts start --sticky&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Nginx 配置</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">  proxy_set_header <span class="title class_">Upgrade</span> $http_upgrade;</span><br><span class="line">  proxy_set_header <span class="title class_">Connection</span> <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">  proxy_set_header X-<span class="title class_">Forwarded</span>-<span class="title class_">For</span> $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_set_header <span class="title class_">Host</span> $host;</span><br><span class="line">  proxy_pass   <span class="attr">http</span>:<span class="comment">//127.0.0.1:7001;</span></span><br><span class="line"></span><br><span class="line">  # <span class="attr">http</span>:<span class="comment">//nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_bind</span></span><br><span class="line">  # proxy_bind       $remote_addr transparent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// socket.io插件控制器：app/io/controller/nsp.js</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Controller</span> = <span class="built_in">require</span>(<span class="string">&quot;egg&quot;</span>).<span class="property">Controller</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PREFIX</span> = <span class="string">&quot;room&quot;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NspController</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Controller</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">checkToken</span>(<span class="params">token</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app, service, helper &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> nsp = app.<span class="property">io</span>.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> socket = ctx.<span class="property">socket</span>;</span><br><span class="line">    <span class="keyword">const</span> id = socket.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户验证</span></span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;您没有权限访问该接口!&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 根据token解密，换取用户信息</span></span><br><span class="line">    <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      user = ctx.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">let</span> fail = error.<span class="property">name</span> === <span class="string">&quot;TokenExpiredError&quot;</span></span><br><span class="line">        ? <span class="string">&quot;token 已过期! 请重新获取令牌&quot;</span></span><br><span class="line">        : <span class="string">&quot;Token 令牌不合法!&quot;</span>;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, fail));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 判断当前用户是否登录</span></span><br><span class="line">    <span class="keyword">let</span> t = <span class="keyword">await</span> ctx.<span class="property">service</span>.<span class="property">cache</span>.<span class="title function_">get</span>(<span class="string">&quot;user_&quot;</span> + user.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">if</span> (!t || t !== token) &#123;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;Token 令牌不合法!&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 获取当前用户，验证当前用户是否被禁用</span></span><br><span class="line">    user = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">User</span>.<span class="title function_">findByPk</span>(user.<span class="property">id</span>);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;用户不存在或已被禁用&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 直播间发送消息</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">comment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app, service, helper &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> nsp = app.<span class="property">io</span>.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = ctx.<span class="property">args</span>[<span class="number">0</span>] || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> socket = ctx.<span class="property">socket</span>;</span><br><span class="line">    <span class="keyword">const</span> id = socket.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; live_id, data, token &#125; = message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 验证当前直播间是否存在且是否处于开播中</span></span><br><span class="line">      <span class="keyword">let</span> msg = <span class="keyword">await</span> service.<span class="property">live</span>.<span class="title function_">checkStatus</span>(live_id);</span><br><span class="line">      <span class="keyword">if</span> (msg) &#123;</span><br><span class="line">        socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, msg));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> room = <span class="string">&quot;live_&quot;</span> + live_id;</span><br><span class="line">      <span class="comment">// 推送消息到直播间</span></span><br><span class="line">      nsp.<span class="title function_">to</span>(room).<span class="title function_">emit</span>(<span class="string">&quot;comment&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">name</span>: user.<span class="property">nickname</span> || user.<span class="property">username</span>,</span><br><span class="line">          <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">content</span>: data,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      app.<span class="property">model</span>.<span class="property">Comment</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        <span class="attr">content</span>: data,</span><br><span class="line">        live_id,</span><br><span class="line">        <span class="attr">user_id</span>: user.<span class="property">id</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      app.<span class="property">logger</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 进入直播间</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">joinLive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app, service, helper &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> nsp = app.<span class="property">io</span>.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = ctx.<span class="property">args</span>[<span class="number">0</span>] || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> socket = ctx.<span class="property">socket</span>;</span><br><span class="line">    <span class="keyword">const</span> id = socket.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; live_id, token &#125; = message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证当前直播间是否存在且是否处于开播中</span></span><br><span class="line">    <span class="keyword">let</span> msg = <span class="keyword">await</span> service.<span class="property">live</span>.<span class="title function_">checkStatus</span>(live_id);</span><br><span class="line">    <span class="keyword">if</span> (msg) &#123;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, msg));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> room = <span class="string">&quot;live_&quot;</span> + live_id;</span><br><span class="line">    <span class="comment">// 用户加入</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;#join&quot;</span>, room);</span><br><span class="line">    socket.<span class="title function_">join</span>(room);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rooms = [room];</span><br><span class="line">    <span class="comment">// 在线列表</span></span><br><span class="line">    <span class="comment">// nsp.adapter.clients(rooms, (err, clients) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(&#x27;#online_join&#x27;, clients);</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加入存储中</span></span><br><span class="line">    <span class="keyword">let</span> list = <span class="keyword">await</span> service.<span class="property">cache</span>.<span class="title function_">get</span>(<span class="string">&quot;userList_&quot;</span> + room);</span><br><span class="line">    list = list ? list : [];</span><br><span class="line">    list = list.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== user.<span class="property">id</span>);</span><br><span class="line">    list.<span class="title function_">unshift</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">      <span class="attr">name</span>: user.<span class="property">nickname</span> || user.<span class="property">username</span>,</span><br><span class="line">      <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    service.<span class="property">cache</span>.<span class="title function_">set</span>(<span class="string">&quot;userList_&quot;</span> + room, list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新在线用户列表</span></span><br><span class="line">    nsp.<span class="property">adapter</span>.<span class="title function_">clients</span>(rooms, <span class="function">(<span class="params">err, clients</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;#online_join&quot;</span>, clients);</span><br><span class="line">      nsp.<span class="title function_">to</span>(room).<span class="title function_">emit</span>(<span class="string">&quot;online&quot;</span>, &#123;</span><br><span class="line">        clients,</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;join&quot;</span>,</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">name</span>: user.<span class="property">nickname</span> || user.<span class="property">username</span>,</span><br><span class="line">          <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">data</span>: list,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加入播放历史记录</span></span><br><span class="line">    <span class="keyword">let</span> liveUser = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">LiveUser</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">      <span class="attr">where</span>: &#123;</span><br><span class="line">        <span class="attr">user_id</span>: user.<span class="property">id</span>,</span><br><span class="line">        live_id,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!liveUser) &#123;</span><br><span class="line">      app.<span class="property">model</span>.<span class="property">LiveUser</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        <span class="attr">user_id</span>: user.<span class="property">id</span>,</span><br><span class="line">        live_id,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 总观看人数+1</span></span><br><span class="line">      <span class="keyword">let</span> live = <span class="keyword">await</span> service.<span class="property">live</span>.<span class="title function_">exist</span>(live_id);</span><br><span class="line">      live.<span class="title function_">increment</span>(&#123;</span><br><span class="line">        <span class="attr">look_count</span>: <span class="number">1</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 离开直播间</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">leaveLive</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app, service, helper &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> nsp = app.<span class="property">io</span>.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = ctx.<span class="property">args</span>[<span class="number">0</span>] || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> socket = ctx.<span class="property">socket</span>;</span><br><span class="line">    <span class="keyword">const</span> id = socket.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; live_id, token &#125; = message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证当前直播间是否存在且是否处于开播中</span></span><br><span class="line">    <span class="keyword">let</span> msg = <span class="keyword">await</span> service.<span class="property">live</span>.<span class="title function_">checkStatus</span>(live_id);</span><br><span class="line">    <span class="keyword">if</span> (msg) &#123;</span><br><span class="line">      socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, msg));</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> room = <span class="string">&quot;live_&quot;</span> + live_id;</span><br><span class="line">    <span class="comment">// 用户离开</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;#leave&quot;</span>, room);</span><br><span class="line">    socket.<span class="title function_">leave</span>(room);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rooms = [room];</span><br><span class="line">    <span class="comment">// 在线列表</span></span><br><span class="line">    nsp.<span class="property">adapter</span>.<span class="title function_">clients</span>(rooms, <span class="function">(<span class="params">err, clients</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;#online_join&quot;</span>, clients);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 更新在线用户列表</span></span><br><span class="line">      nsp.<span class="title function_">to</span>(room).<span class="title function_">emit</span>(<span class="string">&quot;online&quot;</span>, &#123;</span><br><span class="line">        clients,</span><br><span class="line">        <span class="attr">action</span>: <span class="string">&quot;leave&quot;</span>,</span><br><span class="line">        <span class="attr">user</span>: &#123;</span><br><span class="line">          <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">name</span>: user.<span class="property">nickname</span> || user.<span class="property">username</span>,</span><br><span class="line">          <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> list = <span class="keyword">await</span> service.<span class="property">cache</span>.<span class="title function_">get</span>(<span class="string">&quot;userList_&quot;</span> + room);</span><br><span class="line">    <span class="keyword">if</span> (list) &#123;</span><br><span class="line">      list = list.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> !== user.<span class="property">id</span>);</span><br><span class="line">      service.<span class="property">cache</span>.<span class="title function_">set</span>(<span class="string">&quot;userList_&quot;</span> + room, list);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 直播间送礼物</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">gift</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ctx, app, service, helper &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> nsp = app.<span class="property">io</span>.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> message = ctx.<span class="property">args</span>[<span class="number">0</span>] || &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> socket = ctx.<span class="property">socket</span>;</span><br><span class="line">    <span class="keyword">const</span> id = socket.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; live_id, gift_id, token &#125; = message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">checkToken</span>(token);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 验证当前直播间是否存在且是否处于开播中</span></span><br><span class="line">      <span class="keyword">let</span> live = <span class="keyword">await</span> service.<span class="property">live</span>.<span class="title function_">checkStatus</span>(live_id, <span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> live === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, live));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 验证礼物是否存在</span></span><br><span class="line">      <span class="keyword">let</span> gift = <span class="keyword">await</span> app.<span class="property">model</span>.<span class="property">Gift</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123; <span class="attr">id</span>: gift_id &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (!gift) &#123;</span><br><span class="line">        socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;该礼物不存在&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 金币不足</span></span><br><span class="line">      <span class="keyword">if</span> (user.<span class="property">coin</span> &lt; gift.<span class="property">coin</span>) &#123;</span><br><span class="line">        socket.<span class="title function_">emit</span>(id, ctx.<span class="property">helper</span>.<span class="title function_">parseMsg</span>(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;金币不足，请先充值&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 扣除金币</span></span><br><span class="line">      user.<span class="property">coin</span> -= gift.<span class="property">coin</span>;</span><br><span class="line">      <span class="keyword">await</span> user.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 写入礼物记录表</span></span><br><span class="line">      app.<span class="property">model</span>.<span class="property">LiveGift</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">        live_id,</span><br><span class="line">        <span class="attr">user_id</span>: user.<span class="property">id</span>,</span><br><span class="line">        gift_id,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 直播间增加金币数</span></span><br><span class="line">      live.<span class="property">coin</span> += gift.<span class="property">coin</span>;</span><br><span class="line">      live.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> room = <span class="string">&quot;live_&quot;</span> + live_id;</span><br><span class="line">      <span class="comment">// 推送消息到直播间</span></span><br><span class="line">      nsp.<span class="title function_">to</span>(room).<span class="title function_">emit</span>(<span class="string">&quot;gift&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">        <span class="attr">username</span>: user.<span class="property">nickname</span> || user.<span class="property">username</span>,</span><br><span class="line">        <span class="attr">gift_image</span>: gift.<span class="property">image</span>,</span><br><span class="line">        <span class="attr">gift_name</span>: gift.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">num</span>: <span class="number">1</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      app.<span class="property">logger</span>.<span class="title function_">error</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">NspController</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 扩展：app/extend/helper.js</span></span><br><span class="line"><span class="title function_">parseMsg</span>(<span class="params">action, payload = &#123;&#125;, metadata = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> meta = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(),</span><br><span class="line">    &#125;, metadata);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        meta,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">            action,</span><br><span class="line">            payload,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 插件路由：app/router.js</span></span><br><span class="line"></span><br><span class="line">io.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">route</span>(<span class="string">&quot;comment&quot;</span>, io.<span class="property">controller</span>.<span class="property">nsp</span>.<span class="property">comment</span>);</span><br><span class="line">io.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">route</span>(<span class="string">&quot;joinLive&quot;</span>, io.<span class="property">controller</span>.<span class="property">nsp</span>.<span class="property">joinLive</span>);</span><br><span class="line">io.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">route</span>(<span class="string">&quot;leaveLive&quot;</span>, io.<span class="property">controller</span>.<span class="property">nsp</span>.<span class="property">leaveLive</span>);</span><br><span class="line">io.<span class="title function_">of</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">route</span>(<span class="string">&quot;gift&quot;</span>, io.<span class="property">controller</span>.<span class="property">nsp</span>.<span class="property">gift</span>);</span><br></pre></td></tr></table></figure>
<h5 id="uniapp-登录">uniapp-登录</h5>
<p><strong>结构</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">&quot;showLoading&quot;</span> <span class="attr">class</span>=<span class="string">&quot;position-fixed top-0 bottom-0 left-0 right-0 bg-light flex align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;z-index: 100;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-muted font&quot;</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 350rpx;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 50rpx;&quot;</span>&gt;</span>YOU-LOGO<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;px-3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-light px-3 mb-3 font&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入用户名&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-light px-3 mb-3 font&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入密码&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-if</span>=<span class="string">&quot;type != &#x27;login&#x27;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.repassword&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-light px-3 mb-3 font&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入确认密码&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100rpx;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;p-3 flex align-center justify-center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;bg-main rounded p-3 flex align-center justify-center flex-1 &quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;bg-main-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-white font-md&quot;</span>&gt;</span>&#123;&#123; type === &#x27;login&#x27;?&#x27;登 录&#x27; : &#x27;注 册&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;flex align-center justify-center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text-light-muted font p-2&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeType&quot;</span>&gt;</span>&#123;&#123; type === &#x27;login&#x27;?&#x27;注册账号&#x27; : &#x27;去登录&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:<span class="string">&quot;login&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">form</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">password</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">repassword</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">showLoading</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">changeType</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">type</span> = <span class="variable language_">this</span>.<span class="property">type</span> === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;reg&#x27;</span> : <span class="string">&#x27;login&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>登录实现</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;login&quot;</span>,</span><br><span class="line">        <span class="attr">form</span>:&#123;</span><br><span class="line">            <span class="attr">username</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">password</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">repassword</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">showLoading</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(!token)&#123;</span><br><span class="line">        <span class="comment">// 用户未登录</span></span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;请先登录&#x27;</span>,</span><br><span class="line">            <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">showLoading</span> = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 用户已登录</span></span><br><span class="line">    uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;../index/index&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">changeType</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = <span class="variable language_">this</span>.<span class="property">type</span> === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;reg&#x27;</span> : <span class="string">&#x27;login&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">submit</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> msg = <span class="variable language_">this</span>.<span class="property">type</span> === <span class="string">&#x27;login&#x27;</span> ? <span class="string">&#x27;登录&#x27;</span> : <span class="string">&#x27;注册&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$H</span>.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>+ <span class="variable language_">this</span>.<span class="property">type</span>,<span class="variable language_">this</span>.<span class="property">form</span>).<span class="title function_">then</span>( <span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: msg + <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">type</span> === <span class="string">&#x27;reg&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">changeType</span>()</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">form</span> = &#123;</span><br><span class="line">                    <span class="attr">username</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="attr">password</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="attr">repassword</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;login&#x27;</span>,res)</span><br><span class="line">                uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">                  <span class="attr">url</span>:<span class="string">&quot;../index/index&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>request.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// import $store from &#x27;@/store/index.js&#x27;;</span></span><br><span class="line"><span class="keyword">import</span> $C <span class="keyword">from</span> <span class="string">&#x27;./config.js&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="comment">// 全局配置</span></span><br><span class="line"><span class="attr">common</span>:&#123;</span><br><span class="line">    <span class="attr">baseUrl</span>:$C.<span class="property">baseUrl</span> +<span class="string">&quot;/api&quot;</span>,</span><br><span class="line">    <span class="attr">header</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">data</span>:&#123;&#125;,</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">dataType</span>:<span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">token</span>:<span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 请求 返回promise</span></span><br><span class="line"><span class="title function_">request</span>(<span class="params">options = &#123;&#125;</span>)&#123;</span><br><span class="line">    <span class="comment">// 组织参数</span></span><br><span class="line">    options.<span class="property">url</span> = <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">baseUrl</span> + options.<span class="property">url</span></span><br><span class="line">    options.<span class="property">header</span> = options.<span class="property">header</span> || <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">header</span></span><br><span class="line">    options.<span class="property">data</span> = options.<span class="property">data</span> || <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">data</span></span><br><span class="line">    options.<span class="property">method</span> = options.<span class="property">method</span> || <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">method</span></span><br><span class="line">    options.<span class="property">dataType</span> = options.<span class="property">dataType</span> || <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">dataType</span></span><br><span class="line">    options.<span class="property">token</span> = options.<span class="property">token</span> === <span class="literal">true</span> ?  <span class="literal">true</span> : <span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">token</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res,rej</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 请求之前验证...</span></span><br><span class="line">    <span class="comment">// token验证</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">token</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">        <span class="comment">// 二次验证</span></span><br><span class="line">        <span class="keyword">if</span> (!token &amp;&amp; options.<span class="property">noJump</span> !== <span class="literal">true</span>) &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;请先登录&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span> &#125;);</span><br><span class="line">            <span class="comment">// token不存在时跳转</span></span><br><span class="line">            uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;/pages/login/login&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">rej</span>(<span class="string">&quot;请先登录&quot;</span>) </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 往header头中添加token</span></span><br><span class="line">        options.<span class="property">header</span>.<span class="property">token</span> = token</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求中...</span></span><br><span class="line">    uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">        ...options,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 返回原始数据</span></span><br><span class="line">            <span class="keyword">if</span>(options.<span class="property">native</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">res</span>(result)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 服务端失败</span></span><br><span class="line">            <span class="keyword">if</span>(result.<span class="property">statusCode</span> !== <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (options.<span class="property">toast</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: result.<span class="property">data</span>.<span class="property">data</span> || <span class="string">&#x27;服务端失败&#x27;</span>,</span><br><span class="line">                        <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// token不合法，直接退出登录</span></span><br><span class="line">                <span class="keyword">if</span>(result.<span class="property">data</span>.<span class="property">data</span> === <span class="string">&#x27;Token 令牌不合法!&#x27;</span>)&#123;</span><br><span class="line">                    <span class="comment">// 退出登录操作</span></span><br><span class="line">                    <span class="comment">// $store.dispatch(&#x27;logout&#x27;)</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">rej</span>(result.<span class="property">data</span>) </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 其他验证...</span></span><br><span class="line">            <span class="comment">// 成功</span></span><br><span class="line">            <span class="keyword">let</span> data = result.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">            <span class="title function_">res</span>(data)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: error.<span class="property">errMsg</span> || <span class="string">&#x27;请求失败&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span> &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">rej</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// get请求</span></span><br><span class="line"><span class="title function_">get</span>(<span class="params">url,options = &#123;&#125;</span>)&#123;</span><br><span class="line">    options.<span class="property">url</span> = url</span><br><span class="line">    options.<span class="property">data</span> = &#123;&#125;</span><br><span class="line">    options.<span class="property">method</span> = <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(options)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// post请求</span></span><br><span class="line"><span class="title function_">post</span>(<span class="params">url,data = &#123;&#125;,options = &#123;&#125;</span>)&#123;</span><br><span class="line">    options.<span class="property">url</span> = url</span><br><span class="line">    options.<span class="property">data</span> = data</span><br><span class="line">    options.<span class="property">method</span> = <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(options)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// delete请求</span></span><br><span class="line"><span class="title function_">del</span>(<span class="params">url,data = &#123;&#125;,options = &#123;&#125;</span>)&#123;</span><br><span class="line">    options.<span class="property">url</span> = url</span><br><span class="line">    options.<span class="property">data</span> = data</span><br><span class="line">    options.<span class="property">method</span> = <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(options)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 上传文件</span></span><br><span class="line"><span class="title function_">upload</span>(<span class="params">url,data,onProgress = <span class="literal">false</span></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">result,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 上传</span></span><br><span class="line">    <span class="keyword">let</span> token = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">        uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;请先登录&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span> &#125;);</span><br><span class="line">        <span class="comment">// token不存在时跳转</span></span><br><span class="line">        <span class="keyword">return</span> uni.<span class="title function_">reLaunch</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/pages/login/login&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> uploadTask = uni.<span class="title function_">uploadFile</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="variable language_">this</span>.<span class="property">common</span>.<span class="property">baseUrl</span> + url,</span><br><span class="line">        <span class="attr">filePath</span>:data.<span class="property">filePath</span>,</span><br><span class="line">        <span class="attr">name</span>:data.<span class="property">name</span> || <span class="string">&quot;files&quot;</span>,</span><br><span class="line">        <span class="attr">header</span>:&#123; token &#125;,</span><br><span class="line">        <span class="attr">formData</span>:data.<span class="property">formData</span> || &#123;&#125;,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">statusCode</span> !== <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="title function_">result</span>(<span class="literal">false</span>)</span><br><span class="line">                <span class="keyword">return</span> uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&#x27;上传失败&#x27;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> message = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">            <span class="title function_">result</span>(message.<span class="property">data</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    uploadTask.<span class="title function_">onProgressUpdate</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> onProgress === <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_">onProgress</span>(res.<span class="property">progress</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">baseUrl</span>:<span class="string">&quot;http://liveapi2.dishait.cn&quot;</span>,</span><br><span class="line">  <span class="attr">socketUrl</span>:<span class="string">&quot;http://liveapi2.dishait.cn&quot;</span>,</span><br><span class="line">  <span class="attr">imageUrl</span>:<span class="string">&quot;http://liveapi2.dishait.cn&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拉流前缀</span></span><br><span class="line">  <span class="attr">livePlayBaseUrl</span>:<span class="string">&quot;http://liveapi2.dishait.cn:23481&quot;</span>,</span><br><span class="line">  <span class="comment">// 推流前缀</span></span><br><span class="line">  <span class="attr">livePushBaseUrl</span>:<span class="string">&quot;rtmp://liveapi2.dishait.cn:23480&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>uniapp</category>
      </categories>
      <tags>
        <tag>uniapp</tag>
      </tags>
  </entry>
  <entry>
    <title>ts 学习</title>
    <url>/blog/2023/08/09/ts/</url>
    <content><![CDATA[<h4 id="浅谈JavaScript">浅谈JavaScript</h4>
<p><strong>JavaScript是一门优秀的编程语言吗？</strong></p>
<p>每个人可能观点并不完全一致，但是从很多角度来看，JavaScript是一门非常优秀的编程语言；</p>
<p>而且，可以说在很长一段时间内这个语言不会被代替，并且会在更多的领域被大家广泛使用；</p>
<p><strong>著名的Atwood定律</strong>：</p>
<p>Stack Overflow的创立者之一的 <strong>Jeff</strong> <strong>Atwood</strong> 在2007年提出了著名的 <strong>Atwood定律</strong>。</p>
<p>any application that can be written in JavaScript, will eventually be written in JavaScript.</p>
<p>任何可以使用JavaScript来实现的应用都最终都会使用JavaScript实现。</p>
<span id="more"></span>
<p>其实我们已经看到了，这句话正在一步步被应验：</p>
<ul>
<li>
<p>Web端的开发我们一直都是使用JavaScript；</p>
</li>
<li>
<p>移动端开发可以借助于ReactNative、Weex、Uniapp等框架实现跨平台开发；</p>
</li>
<li>
<p>小程序端的开发也是离不开JavaScript；</p>
</li>
<li>
<p>桌面端应用程序我们可以借助于Electron来开发；</p>
</li>
<li>
<p>服务器端开发可以借助于Node环境使用JavaScript来开发。</p>
</li>
</ul>
<p><strong>JavaScript的痛点</strong></p>
<p>并且随着近几年前端领域的快速发展，让JavaScript迅速被普及和受广大开发者的喜爱，借助于JavaScript本身的 强大，也让使用JavaScript开发的人员越来越多。</p>
<p><strong>优秀的JavaScript没有缺点吗？</strong></p>
<p>其实上由于各种历史因素，JavaScript语言本身存在很多的缺点；</p>
<p>比如ES5以及之前的使用的var关键字关于作用域的问题；</p>
<p>比如最初JavaScript设计的数组类型并不是连续的内存空间；</p>
<p>比如直到今天JavaScript也没有加入类型检测这一机制；</p>
<p><strong>JavaScript正在慢慢变好</strong></p>
<p>不可否认的是，JavaScript正在慢慢变得越来越好，无论是从底层设计还是应用层面。</p>
<p>ES6、7、8等的推出，每次都会让这门语言更加现代、更加安全、更加方便。</p>
<p>但是知道今天，JavaScript在类型检测上依然是毫无进展（为什么类型检测如此重要，我后面会聊到）。</p>
<p><strong>类型带来的问题</strong></p>
<p>首先你需要知道，编程开发中我们有一个共识：<strong>错误出现的越早越好</strong></p>
<p>能在<strong>写代码的时候</strong>发现错误，就不要在<strong>代码编译时</strong>再发现（IDE的优势就是在代码编写过程中帮助我们发现错 误）。</p>
<p>能在<strong>代码编译期间</strong>发现错误，就不要在<strong>代码运行期间</strong>再发现（类型检测就可以很好的帮助我们做到这一点）。</p>
<p>能在开发阶段发现错误，就不要在测试期间发现错误，能在测试期间发现错误，就不要在上线后发现错误。</p>
<p>现在我们想探究的就是如何在 <strong>代码编译期间</strong> 发现代码的错误：</p>
<p>JavaScript可以做到吗？不可以，我们来看下面这段经常可能出现的代码问题。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLength</span>(<span class="params">str</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getLength</span>(<span class="string">&#x27;abc&#x27;</span>)</span><br><span class="line"><span class="title function_">getLength</span>()</span><br><span class="line"><span class="comment">// 报错: Uncaught TypeError: Cannot read properties of undefined (reading &#x27;length&#x27;)</span></span><br></pre></td></tr></table></figure>
<p><strong>这是我们一个非常常见的错误：</strong></p>
<p>这个错误很大的原因就是因为JavaScript没有对我们传入的参数进行任何的限制，只能等到运行期间才发现这个 错误；</p>
<p>并且当这个错误产生时，会影响后续代码的继续执行，也就是整个项目都因为一个小小的错误而深入崩溃；</p>
<p><strong>当然，你可能会想：我怎么可能犯这样低级的错误呢？</strong></p>
<p>当我们写像我们上面这样的简单的demo时，这样的错误很容易避免，并且当出现错误时，也很容易检查出来；</p>
<p>但是当我们开发一个大型项目时呢？你能保证自己一定不会出现这样的问题吗？而且如果我们是调用别人的类库，</p>
<p>又如何知道让我们传入的到底是什么样的参数呢？</p>
<p>但是，如果我们可以给JavaScript加上很多限制，在开发中就可以很好的避免这样的问题了：</p>
<p>比如我们的getLength函数中str是一个必传的类型，没有调用者没有传编译期间就会报错；</p>
<p>比如我们要求它的必须是一个String类型，传入其他类型就直接报错；</p>
<p>那么就可以知道很多的错误问题在编译期间就被发现，而不是等到运行时再去发现和修改；</p>
<p><strong>类型思维的缺失</strong></p>
<p>我们已经简单体会到没有类型检查带来的一些问题，JavaScript因为从设计之初就没有考虑类型的约束问题，所以造成了前端开发人员关于<strong>类型思维的缺失</strong>：</p>
<p><strong>前端开发人员</strong>通常不关心变量或者参数是什么类型的，如果在必须确定类型时，我们往往需要使用各种判断验 证；</p>
<p>从其他方向转到前端的人员，也会因为没有类型约束，而总是担心自己的代码不安全，不够健壮；</p>
<p>所以我们经常会说JavaScript<strong>不适合开发大型项目</strong>，因为当项目一旦庞大起来，这种宽松的类型约束会带来非常多 的安全隐患，多人员开发它们之间也没有<strong>良好的类型契约</strong>。</p>
<p>比如当我们去实现一个核心类库时，如果没有类型约束，那么需要对别人传入的参数进行各种验证来保证我们 代码的健壮性；</p>
<p>比如我们去调用别人的函数，对方没有对函数进行任何的注释，我们只能去看里面的逻辑来理解这个函数需要 传入什么参数，返回值是什么类型；</p>
<p><strong>为JavaScript添加类型约束的好处</strong></p>
<p>背景：JS的类型系统存在“先天缺陷“，代码中绝大部分错误都是类型错误(Uncaught TypeError )。<br>
问题∶增加了找Bug、改Bug 的时间，严重影响开发效率。</p>
<p>从编程语言的动静来区分</p>
<p>TypeScript属于静态类型的编程语言，JS属于动态类型的编程语言</p>
<p>静态类型︰编译期做类型检查；动态类型∶执行期做类型检查。</p>
<p>代码编译和代码执行的顺序∶1编译，2执行。</p>
<p>对于JS来说∶需要等到代码真正去执行的时候才能发现错误（晚）。</p>
<p>对于TS来说∶在代码编译的时候（代码执行前）就可以发现错误（早）。</p>
<p>并且，配合VSCode等开发工具，TS可以提前到在编写代码的同时就发现代码中的错误，减少找bug、改bug时间</p>
<p><strong>Ts相比Js的优势</strong></p>
<ul>
<li>更早（写代码的同时）发现错误，减少找Bug、改Bug 时间，提升开发效率。</li>
<li>程序中任何位置的代码都有代码提示，随时随地的安全感，增强了开发体验。</li>
<li>强大的类型系统提升了代码的可维护性，使得重构代码更加容易。</li>
<li>支持最新的ECMAScript语法，优先体验最新的语法，让你走在前端技术的最前沿。</li>
<li>TS类型推断机制，不需要在代码中的每个地方都显示标注类型，让你在享受优势的同时，尽量降低了成本。</li>
<li>除此之外，Vue 3源码使用TS重写、Angular默认支持TS、React与TS完美配合，TypeScript 已成为大中型前端项目的首选编程语言</li>
</ul>
<p><strong>为了弥补JavaScript类型约束上的缺陷，增加类型约束，很多公司推出了自己的方案：</strong></p>
<p>2014年，Facebook推出了flow来对JavaScript进行类型检查；</p>
<p>同年，Microsoft微软也推出了TypeScript1.0版本；</p>
<p>他们都致力于为JavaScript提供类型检查；</p>
<p>而现在，无疑<strong>TypeScript已经完全胜出</strong>：</p>
<p>Vue2.x的时候采用的就是flow来做类型检查；</p>
<p>Vue3.x已经全线转向TypeScript，98.3%使用TypeScript进行了重构；</p>
<p>而Angular在很早期就使用TypeScript进行了项目重构并且需要使用TypeScript来进行开发；</p>
<p>而甚至Facebook公司一些自己的产品也在使用TypeScript；</p>
<p>学习TypeScript不仅仅可以为我们的代码增加类型约束，而且可以培养我们前端程序员具备类型思维。</p>
<h4 id="TypeScript-介绍">TypeScript 介绍</h4>
<p><img data-src="image-20220830084416810.png" alt="image-20220830084416810"></p>
<p>虽然我们已经知道TypeScript是干什么的了，也知道它解决了什么样的问题，但是我们还是需要全面的来认识一下TypeScript到底是什么？</p>
<p><strong>我们来看一下TypeScript在GitHub和官方上对自己的定义：</strong></p>
<p>GitHub说法：TypeScript is a superset of JavaScript that compiles to clean JavaScript output.</p>
<p>TypeScript官网：TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.</p>
<p>翻译一下：TypeScript是拥有类型的JavaScript超集，它可以编译成普通、干净、完整的JavaScript代码。</p>
<p>怎么理解上面的话呢？</p>
<p>我们可以将TypeScript理解成加强版的JavaScript。</p>
<p>JavaScript所拥有的特性，TypeScript全部都是支持的，并且它紧随ECMAScript的标准，所以ES6、ES7、ES8等新语法标准，它都是 支持的；</p>
<p>并且在语言层面上，不仅仅增加了类型约束，而且包括一些语法的扩展，比如枚举类型（Enum）、元组类型（Tuple）等；</p>
<p>TypeScript在实现新特性的同时，总是保持和ES标准的同步甚至是领先；</p>
<p>并且TypeScript最终会被编译成JavaScript代码，所以你并不需要担心它的兼容性问题，在编译时也不需要借助于Babel这样的工具；</p>
<p>所以，我们可以把TypeScript理解成更加强大的JavaScript，不仅让JavaScript更加安全，而且给它带来了诸多好用的好用特性；</p>
<h4 id="TS初体验">TS初体验</h4>
<h5 id="Ts的编译环境">Ts的编译环境</h5>
<p>在前面我们提到过，TypeScript最终会被编译成JavaScript来运行，所以我们需要搭建对应的环境：</p>
<p>我们需要在电脑上安装TypeScript，这样就可以通过TypeScript的Compiler将其编译成JavaScript；</p>
<p><img data-src="image-20220830090507636.png" alt="image-20220830090507636"></p>
<p>所以，我们需要全局安装</p>
<p><strong>安装命令</strong></p>
<p><code>npm install typescript -g</code></p>
<p><strong>查看版本</strong></p>
<p><code>tsc --version</code></p>
<h5 id="TS的运行环境">TS的运行环境</h5>
<p>如果我们每次为了查看TypeScript代码的运行效果，都通过经过两个步骤的话就太繁琐了：</p>
<p>第一步：通过tsc编译TypeScript到JavaScript代码；</p>
<p>第二步：在浏览器或者Node环境下运行JavaScript代码；</p>
<p>是否可以简化这样的步骤呢？</p>
<p>比如编写了TypeScript之后可以直接运行在浏览器上？</p>
<p>比如编写了TypeScript之后，直接通过node的命令来执行？</p>
<p>上面我提到的两种方式，可以通过两个解决方案来完成：</p>
<p>方式一：通过webpack，配置本地的TypeScript编译环境和开启一个本地服务，可以直接运行在浏览器上；</p>
<p><code>npm init –y</code></p>
<p><code>npm i webpack webpack-cli –D</code></p>
<p><code>npm i ts-loader typescript –D</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index.ts&#x27;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.tsx&#x27;</span>,<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.ts$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;ts-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">其它配置项参考webpack章节 ~</span><br></pre></td></tr></table></figure>
<p>方式二：通过ts-node库，为TypeScript的运行提供执行环境；</p>
<p>安装 <code>npm install -g ts-node</code></p>
<p>另外ts-node需要依赖 tslib 和 @types/node 两个包：</p>
<p><code>npm install tslib @types/node -g</code></p>
<p>现在，我们可以直接通过 ts-node 来运行TypeScript的代码：</p>
<p><code>ts-node index.ts</code></p>
<p>注意：ts-node 7.0.0 以上就不自动识别 tsconfig.json 了，得加上 <code>--files</code> 才能识别</p>
<p><code>ts-node index.ts --files</code></p>
<h4 id="基础类型">基础类型</h4>
<p>基础类型：Boolean、Number、String、<code>null</code>、<code>undefined</code> 以及 ES6 的 <a href="http://es6.ruanyifeng.com/#docs/symbol">Symbol</a> 和 ES10 的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt">BigInt</a>。</p>
<h5 id="字符串类型">字符串类型</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串是使用string定义的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">string</span> = <span class="string">&#x27;hello ts&#x27;</span></span><br><span class="line"><span class="comment">//普通声明</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//也可以使用es6的字符串模板</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span> = <span class="string">`<span class="subst">$&#123;a&#125;</span> ~~~`</span></span><br></pre></td></tr></table></figure>
<h5 id="数字类型">数字类型</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 支持十六进制、十进制、八进制和二进制；</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">number</span> = <span class="number">123</span>;<span class="comment">// 普通数字</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">notANumber</span>: <span class="built_in">number</span> = <span class="title class_">NaN</span>;<span class="comment">//Nan</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">infinityNumber</span>: <span class="built_in">number</span> = <span class="title class_">Infinity</span>;<span class="comment">// 无穷大</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">decimal</span>: <span class="built_in">number</span> = <span class="number">6</span>;<span class="comment">// 十进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">hex</span>: <span class="built_in">number</span> = <span class="number">0xf00d</span>;<span class="comment">// 十六进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">binary</span>: <span class="built_in">number</span> = <span class="number">0b1010</span>;<span class="comment">// 二进制</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">octal</span>: <span class="built_in">number</span> = <span class="number">0o744</span>;<span class="comment">// 八进制s</span></span><br></pre></td></tr></table></figure>
<h5 id="布尔类型">布尔类型</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">booleand</span>: <span class="built_in">boolean</span> = <span class="literal">true</span> <span class="comment">// 可以直接使用布尔值</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">booleand2</span>: <span class="built_in">boolean</span> = <span class="title class_">Boolean</span>(<span class="number">1</span>) <span class="comment">// 也可以通过函数返回布尔值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，使用构造函数 Boolean 创造的对象不是布尔值</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">createdBoolean</span>: <span class="built_in">boolean</span> = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// 这样会报错 应为事实上 new Boolean() 返回的是一个 Boolean 对象 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事实上 new Boolean() 返回的是一个 Boolean 对象 需要改成</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">createdBoolean</span>: <span class="title class_">Boolean</span> = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h5 id="空值类型">空值类型</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JavaScript 没有空值（Void）的概念，在 TypeScript 中，可以用 void 表示没有任何返回值的函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">voidFn</span>(<span class="params"></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;test void&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>void</code> 类型的用法，主要是用在我们<strong>不希望</strong>调用者关心函数返回值的情况下，比如通常的<strong>异步回调函数</strong></p>
<p><strong>void也可以定义undefined 和 null类型</strong></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: <span class="built_in">void</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="built_in">void</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h5 id="Null和undefined类型">Null和undefined类型</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span>;<span class="comment">// 定义undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="literal">null</span> = <span class="literal">null</span>;<span class="comment">// 定义null</span></span><br></pre></td></tr></table></figure>
<h5 id="void-和-undefined-和-null-最大的区别">void 和 undefined 和 null 最大的区别</h5>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">与 <span class="built_in">void</span> 的区别是，<span class="literal">undefined</span> 和 <span class="literal">null</span> 是所有类型的子类型。也就是说 <span class="literal">undefined</span> 类型的变量，可以赋值给 <span class="built_in">string</span> 类型的变量：</span><br><span class="line"></span><br><span class="line"><span class="comment">//这样写会报错 void类型不可以分给其他类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">test</span>: <span class="built_in">void</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>: <span class="built_in">string</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"> </span><br><span class="line">num2 = test</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//这样是没问题的</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">test</span>: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>: <span class="built_in">string</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"> </span><br><span class="line">num2 = test</span><br><span class="line"> </span><br><span class="line"><span class="comment">//或者这样的</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">test</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num2</span>: <span class="built_in">string</span> = <span class="string">&quot;1&quot;</span></span><br><span class="line"> </span><br><span class="line">num2 = test</span><br></pre></td></tr></table></figure>
<p><strong>TIPS 注意</strong></p>
<p>如果配置文件 tsconfig.json 开启了严格模式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="keyword">void</span> = <span class="literal">null</span> <span class="comment">// null 不能 赋予 void 类型 </span></span><br></pre></td></tr></table></figure>
<h4 id="任意类型">任意类型</h4>
<h5 id="Any-类型-和-unknown-顶级类型">Any 类型 和 unknown 顶级类型</h5>
<ul>
<li>没有强制限定哪种类型，随时切换类型都可以 我们可以对 any 进行任何操作，不需要检查类型</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">anys</span>:any = <span class="number">123</span></span><br><span class="line">anys = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">anys = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>声明变量的时候没有指定任意类型默认为any</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> anys;</span><br><span class="line">anys = <span class="string">&#x27;123&#x27;</span></span><br><span class="line">anys = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>弊端：如果使用any 就失去了TS类型检测的作用</p>
</li>
<li>
<p>TypeScript 3.0中引入的 unknown 类型也被认为是 top type ，但它更安全。与 any 一样，所有类型都可以分配给unknown，unknow类型比any更加严格当你要使用any 的时候可以尝试使用unknow</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// unknown 可以定义任何类型的值</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">value</span>: unknown;</span><br><span class="line"> </span><br><span class="line">value = <span class="literal">true</span>;             <span class="comment">// OK</span></span><br><span class="line">value = <span class="number">42</span>;               <span class="comment">// OK</span></span><br><span class="line">value = <span class="string">&quot;Hello World&quot;</span>;    <span class="comment">// OK</span></span><br><span class="line">value = [];               <span class="comment">// OK</span></span><br><span class="line">value = &#123;&#125;;               <span class="comment">// OK</span></span><br><span class="line">value = <span class="literal">null</span>;             <span class="comment">// OK</span></span><br><span class="line">value = <span class="literal">undefined</span>;        <span class="comment">// OK</span></span><br><span class="line">value = <span class="title class_">Symbol</span>(<span class="string">&quot;type&quot;</span>);   <span class="comment">// OK</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 这样写会报错unknow类型不能作为子类型只能作为父类型 any可以作为父类型和子类型</span></span><br><span class="line"><span class="comment">// unknown类型不能赋值给其他类型</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">names</span>:unknown = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">names2</span>:string = names</span><br><span class="line"> </span><br><span class="line"><span class="comment">//这样就没问题 any类型是可以的</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">names</span>:any = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">names2</span>:string = names   </span><br><span class="line"> </span><br><span class="line"><span class="comment">//unknown可赋值对象只有unknown 和 any</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">bbb</span>:unknown = <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">aaa</span>:any= <span class="string">&#x27;456&#x27;</span></span><br><span class="line"> </span><br><span class="line">aaa = bbb</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 区别2</span></span><br><span class="line">如果是any类型在对象没有这个属性的时候还在获取是不会报错的</span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>:any = &#123;<span class="attr">b</span>:<span class="number">1</span>&#125;</span><br><span class="line">obj.<span class="property">a</span></span><br><span class="line"> </span><br><span class="line">如果是unknow 是不能调用属性和方法</span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>:unknown = &#123;<span class="attr">b</span>:<span class="number">1</span>,<span class="attr">ccc</span>:():<span class="function"><span class="params">number</span>=&gt;</span><span class="number">213</span>&#125;</span><br><span class="line">obj.<span class="property">b</span></span><br><span class="line">obj.<span class="title function_">ccc</span>()</span><br></pre></td></tr></table></figure>
<h4 id="接口">接口</h4>
<h4 id="数组">数组</h4>
<h4 id="元组">元组</h4>
<h4 id="联合类型">联合类型</h4>
<h4 id="类型推论">类型推论</h4>
<h4 id="类型别名">类型别名</h4>
<h4 id="字符串字面量类型">字符串字面量类型</h4>
<h4 id="交叉类型">交叉类型</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface <span class="title class_">People</span> &#123;</span><br><span class="line">  <span class="attr">age</span>: number,</span><br><span class="line">  <span class="attr">height</span>: number</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Man</span>&#123;</span><br><span class="line">  <span class="attr">sex</span>: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">xiaoman</span> = (<span class="params">man: People &amp; Man</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(man.<span class="property">age</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(man.<span class="property">height</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(man.<span class="property">sex</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">xiaoman</span>(&#123;<span class="attr">age</span>: <span class="number">18</span>,<span class="attr">height</span>: <span class="number">180</span>,<span class="attr">sex</span>: <span class="string">&#x27;male&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="函数">函数</h4>
<h4 id="类">类</h4>
<h5 id="抽象类与多态">抽象类与多态</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">abstract <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="comment">// 抽象类无法实例化 不能new</span></span><br><span class="line">  <span class="comment">// constructor(parameters) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 抽象方法不能有具体的实现 所以不要出现函数体</span></span><br><span class="line">  abstract <span class="title function_">eat</span>():<span class="keyword">void</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 具体的方法</span></span><br><span class="line">  <span class="title function_">run</span>():<span class="keyword">void</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;跑起来&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;</span><br><span class="line">  <span class="comment">// 继承了抽象类必须实现抽象方法</span></span><br><span class="line">  <span class="title function_">eat</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;狗吃肉&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span>&#123;</span><br><span class="line">  <span class="title function_">eat</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;猫吃鱼&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// var dog:Dog = new Dog()</span></span><br><span class="line"><span class="comment">// 子类具体实现</span></span><br><span class="line"><span class="comment">// dog.eat()</span></span><br><span class="line"><span class="comment">// 抽象类中的具体方法</span></span><br><span class="line"><span class="comment">// dog.run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var cat:Cat = new Cat()</span></span><br><span class="line"><span class="comment">// cat.eat()</span></span><br><span class="line"><span class="comment">// cat.run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类型引用指向子类型的实例 ==&gt; 多态</span></span><br><span class="line"><span class="comment">// 不同类型的对象针对相同的方法 产生了不同的行为</span></span><br><span class="line"><span class="comment">// 由继承而产生了相关的不同的类，对同一个方法可以有不同的响应。比如 Cat 和 Dog 都继承自 Animal，但是分别实现了自己的 eat 方法。此时针对某一个实例，我们无需了解它是 Cat 还是 Dog，就可以直接调用 eat 方法，程序会自动判断出来应该如何执行 eat</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">ani1</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Dog</span>()</span><br><span class="line"><span class="comment">// ani1.eat() // 狗吃肉</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">ani2</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Cat</span>()</span><br><span class="line"><span class="comment">// ani2.eat() // 猫吃鱼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">ani:Animal</span>)&#123;</span><br><span class="line">  ani.<span class="title function_">eat</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(ani1)</span><br><span class="line"><span class="title function_">fn</span>(ani2)</span><br></pre></td></tr></table></figure>
<h4 id="类型断言">类型断言</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">ele</span>: <span class="title class_">HTMLElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line"><span class="comment">// ! 非空断言 告诉编译器不要检查这个变量是否为null</span></span><br><span class="line">ele!.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;blue&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="枚举">枚举</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 枚举</span></span><br><span class="line"><span class="comment">// 尽可能去考虑一个变量的所有情况</span></span><br><span class="line"><span class="comment">// 比如: 性别 星期 月份 支付状态</span></span><br><span class="line"><span class="comment">// 普通枚举类型</span></span><br><span class="line">enum <span class="title class_">Gender</span> &#123;</span><br><span class="line">   <span class="title class_">Boy</span> = <span class="number">0</span>,</span><br><span class="line">   <span class="title class_">Girl</span> = <span class="number">1</span>,</span><br><span class="line">   <span class="title class_">Yao</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Gender</span>[<span class="number">0</span>], <span class="title class_">Gender</span>.<span class="property">Boy</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Gender</span>[<span class="number">10</span>], <span class="title class_">Gender</span>.<span class="property">Girl</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Gender</span>.<span class="property">Yao</span>)</span><br><span class="line"><span class="comment">// 限制变量的类型为枚举类型 取值只能从提前设置的可能性中取</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">sex</span>: <span class="title class_">Gender</span> = <span class="title class_">Gender</span>.<span class="property">Boy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量枚举类型</span></span><br><span class="line"><span class="keyword">const</span> enum <span class="title class_">Color</span> &#123;</span><br><span class="line">  <span class="title class_">Red</span>,</span><br><span class="line">  <span class="title class_">Green</span>,</span><br><span class="line">  <span class="title class_">Blue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>.<span class="property">Red</span>, <span class="title class_">Color</span>.<span class="property">Blue</span>, <span class="title class_">Color</span>.<span class="property">Green</span>)</span><br></pre></td></tr></table></figure>
<h4 id="never">never</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// never类型表示的是那些永不存在的值的类型</span></span><br><span class="line"><span class="comment">// never类型是那些总是会抛出异常或根本就不会有返回值的函数表达式或箭头函数表达式的返回值类型, 变量也可能是 never类型，当它们被永不为真的类型保护所约束时。</span></span><br><span class="line"><span class="comment">// never类型是任何类型的子类型，也可以赋值给任何类型；然而，没有类型是never的子类型或可以赋值给never类型（除了never本身之外）。 即使 any也不可以赋值给never。</span></span><br><span class="line"><span class="comment">// void和never</span></span><br><span class="line"><span class="comment">// void可以返回undefined|null   never不包含任何类型</span></span><br><span class="line"><span class="comment">// 声明void的函数一般都能正常执行  never不行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回never的函数必须存在无法达到的终点</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: string</span>): never &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">infiniteLoop</span>(<span class="params"></span>): never &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params">str:string | number</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> str == <span class="string">&#x27;string&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;11&#x27;</span>)</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> str == <span class="string">&#x27;number&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;22&#x27;</span>)</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;33&#x27;</span>) <span class="comment">// never</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="泛型">泛型</h4>
<h5 id="课堂练习">课堂练习</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">namespace A &#123;</span><br><span class="line">  <span class="comment">// 不使用泛型</span></span><br><span class="line">  <span class="comment">// interface SQL &#123;</span></span><br><span class="line">  <span class="comment">//   username: string | undefined</span></span><br><span class="line">  <span class="comment">//   password: number | undefined</span></span><br><span class="line">  <span class="comment">//   add(user: User): boolean</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// class User implements SQL &#123;</span></span><br><span class="line">  <span class="comment">//   username: string | undefined</span></span><br><span class="line">  <span class="comment">//   password: number | undefined</span></span><br><span class="line">  <span class="comment">//   constructor(username, password) &#123;</span></span><br><span class="line">  <span class="comment">//     this.username = username</span></span><br><span class="line">  <span class="comment">//     this.password = password</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   add(user: User): boolean &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;mongodb添加数据成功: &#x27; + user)</span></span><br><span class="line">  <span class="comment">//     return true</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// let user = new User(&#x27;张三&#x27;, 18)</span></span><br><span class="line">  <span class="comment">// user.add(new User(&#x27;李四&#x27;, 18))</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ========================================</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// interface SQL &#123;</span></span><br><span class="line">  <span class="comment">//   username: string | undefined</span></span><br><span class="line">  <span class="comment">//   price: number | undefined</span></span><br><span class="line">  <span class="comment">//   add(product: Product): boolean</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// class Product implements SQL&#123;</span></span><br><span class="line">  <span class="comment">//   username: string | undefined</span></span><br><span class="line">  <span class="comment">//   price: number | undefined</span></span><br><span class="line">  <span class="comment">//   constructor(username, price) &#123;</span></span><br><span class="line">  <span class="comment">//     this.username = username</span></span><br><span class="line">  <span class="comment">//     this.price = price</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   add(product: Product): boolean &#123;</span></span><br><span class="line">  <span class="comment">//     throw new Error(&quot;Method not implemented.&quot;)</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// let product = new Product(&quot;手机&quot;, 19)</span></span><br><span class="line">  <span class="comment">// product.add(new Product(&#x27;电脑&#x27;, 20))</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 声明泛型接口</span></span><br><span class="line">  interface <span class="variable constant_">SQL</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 添加用户信息</span></span><br><span class="line">    <span class="title function_">add</span>(<span class="attr">info</span>: T): boolean</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 用户类</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="attr">username</span>: string | <span class="literal">undefined</span></span><br><span class="line">    <span class="attr">password</span>: number | <span class="literal">undefined</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">username, password</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">username</span> = username</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">password</span> = password</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 文章类</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Article</span> &#123;</span><br><span class="line">    <span class="attr">title</span>: string | <span class="literal">undefined</span></span><br><span class="line">    <span class="attr">content</span>: string | <span class="literal">undefined</span></span><br><span class="line">    <span class="attr">author</span>: string | <span class="literal">undefined</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">title, content, author</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = title</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">content</span> = content</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">author</span> = author</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// MySQL类实现SQL接口</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">MySQL</span> implements <span class="variable constant_">SQL</span>&lt;<span class="title class_">User</span>&gt; &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="attr">info</span>: <span class="title class_">User</span>): boolean &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加用户数据成功: &#x27;</span> + info)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Mongo</span> implements <span class="variable constant_">SQL</span>&lt;<span class="title class_">Article</span>&gt; &#123;</span><br><span class="line">    <span class="title function_">add</span>(<span class="attr">info</span>: <span class="title class_">Article</span>): boolean &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加文章数据成功: &#x27;</span> + info)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 通过泛型规定类型</span></span><br><span class="line">  <span class="keyword">let</span> mysql = <span class="keyword">new</span> <span class="title class_">MySQL</span>()</span><br><span class="line">  mysql.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> mongo = <span class="keyword">new</span> <span class="title class_">Mongo</span>()</span><br><span class="line">  mongo.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">Article</span>(<span class="string">&#x27;俄罗斯攻打乌克兰&#x27;</span>, <span class="string">&#x27;乌克兰还能坚持多久 10 10天? 10小时? 987654...&#x27;</span>, <span class="string">&#x27;xx&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="声明文件">声明文件</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// import axios from &#x27;axios&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(axios.post());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// import express from &#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;../../node_modules/@types/express/index.d&#x27;</span></span><br><span class="line"><span class="comment">// app实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 路由</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="comment">// 使用路由</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, router)</span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/getUserList&#x27;</span>, <span class="function">(<span class="params">req:any, res:any</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;请求成功&quot;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已启动 请访问http://localhost:3000&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// typings/express.d.ts</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;express&#x27;</span> &#123;</span><br><span class="line">  interface <span class="title class_">Router</span> &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="attr">path</span>: string, <span class="attr">cb</span>:<span class="function">(<span class="params">req: any, res: any</span>)=&gt;</span> <span class="keyword">void</span>): <span class="keyword">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  interface <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="title function_">use</span>(<span class="attr">path</span>: string, <span class="attr">router</span>: <span class="title class_">Router</span>): <span class="keyword">void</span>;</span><br><span class="line">    <span class="title function_">listen</span>(<span class="attr">port</span>: number, cb?:<span class="function">()=&gt;</span> <span class="keyword">void</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  interface <span class="title class_">Express</span> &#123;</span><br><span class="line">    (): <span class="title class_">App</span>,</span><br><span class="line">    <span class="title class_">Router</span>(): <span class="title class_">Router</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">express</span>: <span class="title class_">Express</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> express</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="三斜线指令"><a href="https://www.tslang.cn/docs/handbook/triple-slash-directives.html">三斜线指令</a></h4>
<h4 id="内置对象">内置对象</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内置对象是指根据标准在全局作用域（Global）上存在的对象。这里的标准是指 ECMAScript 和其他环境（比如 DOM）的标准。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 左右一致</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="attr">r</span>: <span class="title class_">RegExp</span> = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="regexp">/\w/</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">e</span>: <span class="title class_">Error</span> = <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="title class_">Number</span> = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="title class_">String</span> = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="title class_">Boolean</span> = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">body</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">div</span>: <span class="title class_">HTMLElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;div&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">input</span>: <span class="title class_">HTMLInputElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">list</span>: <span class="title class_">NodeList</span> = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;li&quot;</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e: MouseEvent</span>)=&gt;</span> &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node.js 不是内置对象的一部分，如果想用 TypeScript 写 Node.js，则需要引入第三方声明文件：</span></span><br><span class="line"><span class="comment">// npm install @types/node --save-dev</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">l</span>: <span class="title class_">Storage</span> = <span class="variable language_">localStorage</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">ss</span>: <span class="title class_">Storage</span> = sessionStorage</span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: string  = <span class="variable language_">document</span>.<span class="property">cookie</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Promise</span>&lt;string&gt; = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">res: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Set-Map">Set&amp;Map</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Set 唯一</span></span><br><span class="line"><span class="comment">// let s: Set&lt;number&gt; = new Set([1, 4, 7, 8, 3, 11, 32, 2, 1, 4,3]);</span></span><br><span class="line"><span class="comment">// 自动去重</span></span><br><span class="line"><span class="comment">// s.add(66)</span></span><br><span class="line"><span class="comment">// s.delete(1)</span></span><br><span class="line"><span class="comment">// console.log(s.has(1));</span></span><br><span class="line"><span class="comment">// console.log(s.size);</span></span><br><span class="line"><span class="comment">// console.log(s);</span></span><br><span class="line"><span class="comment">// s.forEach(item =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(item);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// console.log(s.keys());</span></span><br><span class="line"><span class="comment">// console.log(s.values());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Map</span></span><br><span class="line"><span class="comment">// let obj: any = &#123; name: &#x27;zs&#x27; &#125;</span></span><br><span class="line"><span class="comment">// let m: Map&lt;object, any&gt; = new Map();</span></span><br><span class="line"><span class="comment">// m.set(obj, &#x27;qwe&#x27;)</span></span><br><span class="line"><span class="comment">// m.delete(obj)</span></span><br><span class="line"><span class="comment">// console.log(m.has(obj));</span></span><br><span class="line"><span class="comment">// console.log(m.get(obj));</span></span><br><span class="line"><span class="comment">// console.log(m.size);</span></span><br><span class="line"><span class="comment">// console.log(m);</span></span><br><span class="line"><span class="comment">// m.forEach((mm, index)=&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(mm);</span></span><br><span class="line"><span class="comment">//   console.log(index);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for(let [key, val] of m) &#123;</span></span><br><span class="line"><span class="comment">//   // console.log(key[0]);</span></span><br><span class="line"><span class="comment">//   // console.log(key[1]);</span></span><br><span class="line"><span class="comment">//   console.log(key, val);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">namespace A &#123;</span><br><span class="line">  <span class="comment">// WeakMap 和 Map的区别</span></span><br><span class="line">  <span class="comment">// WeakMap 是弱引用 不会被计入到垃圾回收策略中</span></span><br><span class="line">  <span class="comment">// WeakMap 的键只能对象 Map是任意类型</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// let wekmap: WeakMap&lt;object, any&gt; = new WeakMap()</span></span><br><span class="line">  <span class="comment">// let obj = &#123; name: &#x27;zs&#x27; &#125; // 1</span></span><br><span class="line">  <span class="comment">// let w = obj // 2</span></span><br><span class="line">  <span class="comment">// wekmap.set(obj, &#x27;666&#x27;) // 2</span></span><br><span class="line">  <span class="comment">// // 释放</span></span><br><span class="line">  <span class="comment">// obj = null // 1</span></span><br><span class="line">  <span class="comment">// w = null // 0</span></span><br><span class="line">  <span class="comment">// console.log(wekmap.get(obj));</span></span><br><span class="line">  <span class="comment">// 刷新的时候会时不时的获取到</span></span><br><span class="line">  <span class="comment">// 垃圾回收机制 GC 200ms</span></span><br><span class="line">  <span class="comment">// setTimeout(()=&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(wekmap.get(obj));</span></span><br><span class="line">  <span class="comment">// &#125;, 500)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="命名空间">命名空间</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// namespace A &#123;</span></span><br><span class="line"><span class="comment">//   export let a: number = 10</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(A.a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套命名空间</span></span><br><span class="line"><span class="comment">// namespace A &#123;</span></span><br><span class="line"><span class="comment">//   export namespace B &#123;</span></span><br><span class="line"><span class="comment">//     export let b: number = 10</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(A.B.b);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 命名空间合并</span></span><br><span class="line">namespace A &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">let</span> a : number = <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">namespace A &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">let</span> b : number = <span class="number">20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="虚拟dom实现">虚拟dom实现</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置项的规范</span></span><br><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">  <span class="attr">el</span>: string | <span class="title class_">HTMLElement</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// class Vue的规范</span></span><br><span class="line">interface <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span>,</span><br><span class="line">  <span class="title function_">init</span>(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 虚拟dom</span></span><br><span class="line">interface <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: string <span class="comment">// 标签: div、span、section,</span></span><br><span class="line">  text?: string<span class="comment">// 文本: hello vue</span></span><br><span class="line">  children?: <span class="title class_">VNode</span>[] <span class="comment">// 子节点</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dom</span> &#123;</span><br><span class="line">  <span class="comment">// 创建节点的方法</span></span><br><span class="line">  <span class="title function_">createElement</span>(<span class="params">el: string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(el)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 填充文本的方法</span></span><br><span class="line">  <span class="title function_">fillText</span>(<span class="params">el: HTMLElement, text: string</span>) &#123;</span><br><span class="line">    el.<span class="property">textContent</span> = text</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染视图</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">vnode: VNode</span>)&#123;</span><br><span class="line">    <span class="comment">// 创建根元素</span></span><br><span class="line">    <span class="keyword">let</span> root = <span class="variable language_">this</span>.<span class="title function_">createElement</span>(vnode.<span class="property">tag</span>) <span class="comment">// &lt;div&gt;&lt;/div&gt; &lt;section&gt;&lt;/section&gt; &lt;span&gt;&lt;/span&gt;</span></span><br><span class="line">    <span class="comment">// 是否还有子级节点</span></span><br><span class="line">    <span class="keyword">if</span>(vnode.<span class="property">children</span> &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode.<span class="property">children</span>))&#123;</span><br><span class="line">      vnode.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 递归</span></span><br><span class="line">        <span class="keyword">let</span> child = <span class="variable language_">this</span>.<span class="title function_">render</span>(ele) <span class="comment">// &#123;tag: &quot;section&quot;,text: &quot;子节点1&quot;&#125; &#123;tag: &quot;span&quot;,text: &quot;子节点2&quot;&#125;</span></span><br><span class="line">        <span class="comment">// 追加根元素</span></span><br><span class="line">        root.<span class="title function_">appendChild</span>(child) <span class="comment">// &lt;div&gt;&lt;section&gt;子节点1&lt;/section&gt;&lt;span&gt;子节点2&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// this.fillText(root, data.text ? data.text : null)</span></span><br><span class="line">      <span class="comment">// 没有子节点则直接渲染文本</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">fillText</span>(root, vnode.<span class="property">text</span>!) <span class="comment">// &lt;section&gt;子节点1&lt;/section&gt; &lt;span&gt;子节点2&lt;/span&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Dom</span> implements <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="comment">// 配置项</span></span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options</span><br><span class="line">    <span class="comment">// 执行初始化的方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  <span class="title function_">init</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 虚拟dom就是通过js去描述真实dom</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">data</span>: <span class="title class_">VNode</span> = &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&quot;section&quot;</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">&quot;子节点1&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&quot;span&quot;</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">&quot;子节点2&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取el</span></span><br><span class="line">    <span class="keyword">let</span> app = <span class="keyword">typeof</span> <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span> === <span class="string">&quot;string&quot;</span> ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span>) : <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span></span><br><span class="line">    <span class="comment">// 初始化渲染</span></span><br><span class="line">    app!.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="title function_">render</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建vue实例</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">index.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./20-课堂练习.js&quot;</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="tsconfig-json">tsconfig.json</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;incremental&quot;</span>: <span class="literal">true</span>, <span class="comment">// TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度</span></span><br><span class="line">  <span class="string">&quot;tsBuildInfoFile&quot;</span>: <span class="string">&quot;./buildFile&quot;</span>, <span class="comment">// 增量编译文件的存储位置</span></span><br><span class="line">  <span class="string">&quot;diagnostics&quot;</span>: <span class="literal">true</span>, <span class="comment">// 打印诊断信息 </span></span><br><span class="line">  <span class="string">&quot;target&quot;</span>: <span class="string">&quot;ES5&quot;</span>, <span class="comment">// 目标语言的版本</span></span><br><span class="line">  <span class="string">&quot;module&quot;</span>: <span class="string">&quot;CommonJS&quot;</span>, <span class="comment">// 生成代码的模板标准</span></span><br><span class="line">  <span class="string">&quot;outFile&quot;</span>: <span class="string">&quot;./app.js&quot;</span>, <span class="comment">// 将多个相互依赖的文件生成一个文件，可以用在AMD模块中，即开启时应设置&quot;module&quot;: &quot;AMD&quot;,</span></span><br><span class="line">  <span class="string">&quot;lib&quot;</span>: [<span class="string">&quot;DOM&quot;</span>, <span class="string">&quot;ES2015&quot;</span>, <span class="string">&quot;ScriptHost&quot;</span>, <span class="string">&quot;ES2019.Array&quot;</span>], <span class="comment">// TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入&quot;ES2019.Array&quot;,</span></span><br><span class="line">  <span class="string">&quot;allowJS&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许编译器编译JS，JSX文件</span></span><br><span class="line">  <span class="string">&quot;checkJs&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许在JS文件中报错，通常与allowJS一起使用</span></span><br><span class="line">  <span class="string">&quot;outDir&quot;</span>: <span class="string">&quot;./dist&quot;</span>, <span class="comment">// 指定输出目录</span></span><br><span class="line">  <span class="string">&quot;rootDir&quot;</span>: <span class="string">&quot;./&quot;</span>, <span class="comment">// 指定输出文件目录(用于输出)，用于控制输出目录结构</span></span><br><span class="line">  <span class="string">&quot;declaration&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成声明文件，开启后会自动生成声明文件</span></span><br><span class="line">  <span class="string">&quot;declarationDir&quot;</span>: <span class="string">&quot;./file&quot;</span>, <span class="comment">// 指定生成声明文件存放目录</span></span><br><span class="line">  <span class="string">&quot;emitDeclarationOnly&quot;</span>: <span class="literal">true</span>, <span class="comment">// 只生成声明文件，而不会生成js文件</span></span><br><span class="line">  <span class="string">&quot;sourceMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成目标文件的sourceMap文件</span></span><br><span class="line">  <span class="string">&quot;inlineSourceMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中</span></span><br><span class="line">  <span class="string">&quot;declarationMap&quot;</span>: <span class="literal">true</span>, <span class="comment">// 为声明文件生成sourceMap</span></span><br><span class="line">  <span class="string">&quot;typeRoots&quot;</span>: [], <span class="comment">// 声明文件目录，默认时node_modules/@types</span></span><br><span class="line">  <span class="string">&quot;types&quot;</span>: [], <span class="comment">// 加载的声明文件包</span></span><br><span class="line">  <span class="string">&quot;removeComments&quot;</span>:<span class="literal">true</span>, <span class="comment">// 删除注释 </span></span><br><span class="line">  <span class="string">&quot;noEmit&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不输出文件,即编译后不会生成任何js文件</span></span><br><span class="line">  <span class="string">&quot;noEmitOnError&quot;</span>: <span class="literal">true</span>, <span class="comment">// 发送错误时不输出任何文件</span></span><br><span class="line">  <span class="string">&quot;noEmitHelpers&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用</span></span><br><span class="line">  <span class="string">&quot;importHelpers&quot;</span>: <span class="literal">true</span>, <span class="comment">// 通过tslib引入helper函数，文件必须是模块</span></span><br><span class="line">  <span class="string">&quot;downlevelIteration&quot;</span>: <span class="literal">true</span>, <span class="comment">// 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现</span></span><br><span class="line">  <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span>, <span class="comment">// 开启所有严格的类型检查</span></span><br><span class="line">  <span class="string">&quot;alwaysStrict&quot;</span>: <span class="literal">true</span>, <span class="comment">// 在代码中注入&#x27;use strict&#x27;</span></span><br><span class="line">  <span class="string">&quot;noImplicitAny&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许隐式的any类型</span></span><br><span class="line">  <span class="string">&quot;strictNullChecks&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许把null、undefined赋值给其他类型的变量</span></span><br><span class="line">  <span class="string">&quot;strictFunctionTypes&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许函数参数双向协变</span></span><br><span class="line">  <span class="string">&quot;strictPropertyInitialization&quot;</span>: <span class="literal">true</span>, <span class="comment">// 类的实例属性必须初始化</span></span><br><span class="line">  <span class="string">&quot;strictBindCallApply&quot;</span>: <span class="literal">true</span>, <span class="comment">// 严格的bind/call/apply检查</span></span><br><span class="line">  <span class="string">&quot;noImplicitThis&quot;</span>: <span class="literal">true</span>, <span class="comment">// 不允许this有隐式的any类型</span></span><br><span class="line">  <span class="string">&quot;noUnusedLocals&quot;</span>: <span class="literal">true</span>, <span class="comment">// 检查只声明、未使用的局部变量(只提示不报错)</span></span><br><span class="line">  <span class="string">&quot;noUnusedParameters&quot;</span>: <span class="literal">true</span>, <span class="comment">// 检查未使用的函数参数(只提示不报错)</span></span><br><span class="line">  <span class="string">&quot;noFallthroughCasesInSwitch&quot;</span>: <span class="literal">true</span>, <span class="comment">// 防止switch语句贯穿(即如果没有break语句后面不会执行)</span></span><br><span class="line">  <span class="string">&quot;noImplicitReturns&quot;</span>: <span class="literal">true</span>, <span class="comment">//每个分支都会有返回值</span></span><br><span class="line">  <span class="string">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许export=导出，由import from 导入</span></span><br><span class="line">  <span class="string">&quot;allowUmdGlobalAccess&quot;</span>: <span class="literal">true</span>, <span class="comment">// 允许在模块中全局变量的方式访问umd模块</span></span><br><span class="line">  <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>, <span class="comment">// 模块解析策略，ts默认用node的解析策略，即相对的方式导入</span></span><br><span class="line">  <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>, <span class="comment">// 解析非相对模块的基地址，默认是当前目录</span></span><br><span class="line">  <span class="string">&quot;paths&quot;</span>: &#123; <span class="comment">// 路径映射，相对于baseUrl</span></span><br><span class="line">    <span class="comment">// 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置</span></span><br><span class="line">    <span class="string">&quot;jquery&quot;</span>: [<span class="string">&quot;node_modules/jquery/dist/jquery.min.js&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;rootDirs&quot;</span>: [<span class="string">&quot;src&quot;</span>,<span class="string">&quot;out&quot;</span>], <span class="comment">// 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错</span></span><br><span class="line">  <span class="string">&quot;listEmittedFiles&quot;</span>: <span class="literal">true</span>, <span class="comment">// 打印输出文件</span></span><br><span class="line">  <span class="string">&quot;listFiles&quot;</span>: <span class="literal">true</span><span class="comment">// 打印编译的文件(包括引用的声明文件)</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 指定一个匹配列表（属于自动指定该路径下的所有ts相关文件）</span></span><br><span class="line"><span class="string">&quot;include&quot;</span>: [</span><br><span class="line">   <span class="string">&quot;src/**/*&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="comment">// 指定一个排除列表（include的反向操作）</span></span><br><span class="line"> <span class="string">&quot;exclude&quot;</span>: [</span><br><span class="line">   <span class="string">&quot;demo.ts&quot;</span></span><br><span class="line">],</span><br><span class="line"><span class="comment">// 指定哪些文件使用该配置（属于手动一个个指定文件）</span></span><br><span class="line"> <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">   <span class="string">&quot;demo.ts&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="装饰器">装饰器</h4>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">tsconfig.json中开启配置</span><br><span class="line"><span class="attr">&quot;experimentalDecorators&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;emitDecoratorMetadata&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> </span><br></pre></td></tr></table></figure>
<h5 id="类装饰器">类装饰器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 装饰器:装饰器是一种特殊类型的声明，它能够被附加到类声明，方法，属性或参数上，可以修改类的行为。</span></span><br><span class="line"><span class="comment">// 通俗的讲装饰器就是一个方法，可以注入到类、方法、属性、参数上来扩展类、属性、方法、参数的功能。</span></span><br><span class="line"><span class="comment">// 常见的装饰器有:类装饰器、属性装饰器、方法装饰器、参数装饰器</span></span><br><span class="line"><span class="comment">// 装饰器的写法:普通装饰器（无法传参)、装饰器工厂（可传参)</span></span><br><span class="line"><span class="comment">// 装饰器是过去几年中js最大的成就之一，已是Es7的标准特性之一</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类装饰器: 类装饰器在类声明之前被声明（紧靠着类声明)。类装饰器应用于类构造函数，可以用来监视，修改或替换类定义。传入一个参数</span></span><br><span class="line"><span class="comment">// 1、类装饰器: ClassDecorator</span></span><br><span class="line"><span class="comment">// const Base:ClassDecorator = (constructor) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   constructor.prototype.num = 10</span></span><br><span class="line"><span class="comment">//   constructor.prototype.fn = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&#x27;hello&#x27;);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // @Base</span></span><br><span class="line"><span class="comment">// class Http &#123;</span></span><br><span class="line"><span class="comment">//   // ...</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// // polyfill 兼容</span></span><br><span class="line"><span class="comment">// // Base(Http)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let http = new Http() as any</span></span><br><span class="line"><span class="comment">// console.log(http.num);</span></span><br><span class="line"><span class="comment">// http.fn()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 传参写法 =&gt; 类装饰器工厂</span></span><br><span class="line"><span class="comment">// const Base = (num: number) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   const fn:ClassDecorator = (constructor) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     constructor.prototype.num = num</span></span><br><span class="line"><span class="comment">//     constructor.prototype.fn = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       console.log(&#x27;hello&#x27;);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   return fn</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// class Http &#123;</span></span><br><span class="line"><span class="comment">//   // ...</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let http = new Http() as any</span></span><br><span class="line"><span class="comment">// console.log(http.num);</span></span><br><span class="line"><span class="comment">// http.fn()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重载 构造函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logClass</span>(<span class="params">target: any</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> target &#123;</span><br><span class="line">    <span class="attr">apiUrl</span>: any = <span class="string">&quot;修改后的数据&quot;</span>;</span><br><span class="line">    <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">apiUrl</span> = <span class="variable language_">this</span>.<span class="property">apiUrl</span> + <span class="string">&quot;---===--&quot;</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">apiUrl</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@logClass</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpClient</span> &#123;</span><br><span class="line">  public <span class="attr">apiUrl</span>: string | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">apiUrl</span> = <span class="string">&quot;我是构造函数里面的apiUrl&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">apiUrl</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpClient = <span class="keyword">new</span> <span class="title class_">HttpClient</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(httpClient.<span class="property">apiUrl</span>)</span><br><span class="line">httpClient.<span class="title function_">getData</span>();</span><br></pre></td></tr></table></figure>
<h5 id="方法装饰器">方法装饰器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">namespace A &#123;</span><br><span class="line">  <span class="comment">// 方法装饰器: 它会被应用到方法的属性描述符上，可以用来监视，修改或者替换方法定义。</span></span><br><span class="line">  <span class="comment">// 方法装饰会在运行时传入下列3个参数:</span></span><br><span class="line">  <span class="comment">// 1、对于静态成员来说是类的构造函数，对于实例成员是类的原型对象。</span></span><br><span class="line">  <span class="comment">// 2、成员的名字。</span></span><br><span class="line">  <span class="comment">// 3、成员的属性描述符。</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">noEnumerable</span>(<span class="params">constructor: any, propertykey: string, descriptor: PropertyDescriptor</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(constructor, propertykey)</span><br><span class="line">    <span class="comment">// 设置为不可枚举</span></span><br><span class="line">    descriptor.<span class="property">enumerable</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getSum</span>(<span class="params">constructor: any, propertykey: string, descriptor: PropertyDescriptor</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取到旧的方法</span></span><br><span class="line">    <span class="keyword">let</span> oldMethod = descriptor.<span class="property">value</span></span><br><span class="line">    <span class="comment">// AOP面向切面编程</span></span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...args: any[]</span>) &#123;</span><br><span class="line">      <span class="comment">// 将传入的参数全部转成数值类型</span></span><br><span class="line">      args = args.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">parseFloat</span>(item))</span><br><span class="line">      <span class="keyword">return</span> oldMethod.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: string = <span class="string">&quot;hello&quot;</span>; <span class="comment">// 实例属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="attr">age</span>: number = <span class="number">10</span>; <span class="comment">// 静态属性</span></span><br><span class="line">    @noEnumerable</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123; <span class="comment">// 实例方法</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    @getSum</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">...args: any[]</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc: number, item: number</span>) =&gt;</span> acc + item, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="title function_">sum</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)) <span class="comment">// 0123 =&gt; 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>应用场景</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 方法装饰器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">GetData</span> = (<span class="params">url: string</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">fn</span>: <span class="title class_">MethodDecorator</span> = <span class="function">(<span class="params">constructor, propertykey, descriptor:PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(constructor, propertykey, descriptor);</span></span><br><span class="line">    axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">      descriptor.<span class="title function_">value</span>(res.<span class="property">data</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Http</span> &#123;</span><br><span class="line">  @<span class="title class_">GetData</span>(<span class="string">&#x27;https://www.fastmock.site/mock/02ea45a6ef9ec3ea725f12488ee49ec8/shop/cart&#x27;</span>)</span><br><span class="line">  <span class="title function_">getData</span>(<span class="params">data: any</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="参数装饰器">参数装饰器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">GetData</span> = (<span class="params">url: string</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">fn</span>: <span class="title class_">MethodDecorator</span> = <span class="function">(<span class="params">constructor, propertykey, descriptor:PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Reflect 获取存储的数据</span></span><br><span class="line">    <span class="keyword">let</span> key = <span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;key&#x27;</span>, constructor)</span><br><span class="line">    axios.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">      descriptor.<span class="title function_">value</span>(key ? res.<span class="property">data</span>[key] : res.<span class="property">data</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数装饰器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Res</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">fn</span>:<span class="title class_">ParameterDecorator</span> = <span class="keyword">function</span>(<span class="params">constructor, key, index</span>)&#123;</span><br><span class="line">    <span class="comment">// console.log(constructor, key, index);</span></span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;res&#x27;</span>, constructor)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Http</span> &#123;</span><br><span class="line">  @<span class="title class_">GetData</span>(<span class="string">&#x27;https://www.fastmock.site/mock/02ea45a6ef9ec3ea725f12488ee49ec8/shop/cart&#x27;</span>)</span><br><span class="line">  <span class="title function_">getData</span>(<span class="params">@Res() data: any</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="属性装饰器">属性装饰器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 属性装饰器: 装饰属性 装饰方法 </span></span><br><span class="line"><span class="comment">// 属性装饰器表达式会在运行时当作函数被调用，传入下列2个参数:</span></span><br><span class="line"><span class="comment">// 1、如果装饰的是实例成员的话第一个参数是类的原型对象, </span></span><br><span class="line"><span class="comment">//    如果装饰的是静态成员的话第一个参数是类的构造函数</span></span><br><span class="line"><span class="comment">// 2、成员的名字。</span></span><br><span class="line">namespace A &#123;</span><br><span class="line">  <span class="comment">// 此处的target =&gt; 构造函数的原型对象</span></span><br><span class="line">  <span class="comment">// 此处的propertykey =&gt; name键</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">upperCase</span>(<span class="params">target: any, propertykey: string</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取老的value值</span></span><br><span class="line">    <span class="keyword">let</span> oldVal = target[propertykey]</span><br><span class="line">    <span class="comment">// 设置getter、setter</span></span><br><span class="line">    <span class="comment">// getter返回旧值</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getter</span> = (<span class="params"></span>) =&gt; oldVal</span><br><span class="line">    <span class="comment">// setter将旧值覆盖为大写后的新值</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setter</span> = (<span class="params">newVal: string</span>) =&gt; oldVal = newVal.<span class="title function_">toUpperCase</span>()</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">delete</span> target[propertykey]) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, propertykey, &#123;</span><br><span class="line">        <span class="attr">get</span>: getter,</span><br><span class="line">        <span class="attr">set</span>: setter,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 修饰静态属性 第一个参数为构造器</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">staticProperty</span>(<span class="params">constructor: <span class="built_in">Function</span>, propertykey: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(constructor, propertykey)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    @upperCase</span><br><span class="line">    <span class="attr">name</span>: string = <span class="string">&quot;hello&quot;</span>; <span class="comment">// 实例属性</span></span><br><span class="line">    @staticProperty</span><br><span class="line">    <span class="keyword">static</span> <span class="attr">age</span>: number = <span class="number">10</span>; <span class="comment">// 静态属性</span></span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123; <span class="comment">// 实例方法</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">sum</span>(<span class="params">...args: any[]</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc: number, item: number</span>) =&gt;</span> acc + item, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>) <span class="comment">// HELLO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="发布订阅模式">发布订阅模式</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; &#125;</span><br><span class="line"><span class="comment">// 事件规范</span></span><br><span class="line">interface <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="attr">on</span>: <span class="function">(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">emit</span>: <span class="function">(<span class="params">eventName: string, ...args: <span class="built_in">Array</span>&lt;any&gt;</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">off</span>: <span class="function">(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">once</span>: <span class="function">(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">List</span> &#123;</span><br><span class="line">  <span class="comment">// 存储订阅消息的数组 一个订阅消息是一个函数</span></span><br><span class="line">  [<span class="attr">key</span>: string]: <span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dispatch</span> implements <span class="title class_">MyEvent</span> &#123;</span><br><span class="line">  <span class="comment">// 存储订阅消息</span></span><br><span class="line">  <span class="attr">list</span>: <span class="title class_">List</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">on</span>(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 判断list上是否有changeChecked 如果没有就已它作为键 值是一个数组</span></span><br><span class="line">    <span class="comment">// 如果有就直接往changeChecked的值(数组)中追加一个回调</span></span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">list</span>[eventName] || [];</span><br><span class="line">    arr.<span class="title function_">push</span>(fn) <span class="comment">// [fn]</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span>[eventName] = arr <span class="comment">// list: &#123;changeChecked: [fn, fn]&#125;</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">eventName: string, ...args: <span class="built_in">Array</span>&lt;any&gt;</span>) &#123;</span><br><span class="line">    <span class="comment">// 查找list中触发的事件名是否有值</span></span><br><span class="line">    <span class="keyword">let</span> eventArr = <span class="variable language_">this</span>.<span class="property">list</span>[eventName]</span><br><span class="line">    <span class="keyword">if</span> (eventArr) &#123;</span><br><span class="line">      eventArr.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;没有订阅该消息&#x27;</span> + eventName);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">off</span>(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> eventArr = <span class="variable language_">this</span>.<span class="property">list</span>[eventName]</span><br><span class="line">    <span class="keyword">if</span>(eventArr) &#123;</span><br><span class="line">      <span class="comment">// 找到和fn相同地址值的回调</span></span><br><span class="line">      eventArr.<span class="title function_">some</span>(<span class="function">(<span class="params">evnet, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(evnet == fn)&#123;</span><br><span class="line">          <span class="comment">// 删除</span></span><br><span class="line">          eventArr.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;没有订阅该消息&#x27;</span> + eventName);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">once</span>(<span class="params">eventName: string, fn: <span class="built_in">Function</span></span>)&#123;</span><br><span class="line">    <span class="comment">// 定义临时的函数</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">cb</span> = (<span class="params">...args: <span class="built_in">Array</span>&lt;any&gt;</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 让once传递的fn执行</span></span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      <span class="comment">// 解绑临时函数</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">off</span>(eventName, cb)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 让临时函数订阅</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">on</span>(eventName, cb)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d = <span class="keyword">new</span> <span class="title class_">Dispatch</span>()</span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="comment">// d.on(&#x27;changeChecked&#x27;, (...args: Array&lt;any&gt;) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;订阅1--&#x27; + args);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// 将函数单独提取出来是为了方便解绑</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params">...args: <span class="built_in">Array</span>&lt;any&gt;</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;订阅2--&#x27;</span> + args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// d.on(&#x27;changeChecked&#x27;, fn)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解绑</span></span><br><span class="line"><span class="comment">// d.off(&quot;changeChecked&quot;, fn)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只能触发一次 第一次触发就已经将changeChecked事件解绑了 后续不管怎么调用都没用</span></span><br><span class="line">d.<span class="title function_">once</span>(<span class="string">&#x27;changeChecked&#x27;</span>, fn)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">d.<span class="title function_">emit</span>(<span class="string">&#x27;changeChecked&#x27;</span>, <span class="number">1</span>, <span class="literal">true</span>, &#123; <span class="attr">checked</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">d.<span class="title function_">emit</span>(<span class="string">&#x27;changeChecked&#x27;</span>, <span class="number">1</span>, <span class="literal">true</span>, &#123; <span class="attr">checked</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">d.<span class="title function_">emit</span>(<span class="string">&#x27;changeChecked&#x27;</span>, <span class="number">1</span>, <span class="literal">true</span>, &#123; <span class="attr">checked</span>: <span class="literal">true</span> &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="观察者模式">观察者模式</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">list</span>: <span class="title class_">Set</span>&lt;<span class="title class_">Function</span>&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 依赖收集</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params">fn: <span class="built_in">Function</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// set集合中是否有该函数 如果没有则添加</span></span><br><span class="line">  <span class="keyword">if</span>(!list.<span class="title function_">has</span>(fn)) list.<span class="title function_">add</span>(fn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者</span></span><br><span class="line"><span class="keyword">const</span> observer = &lt;T <span class="keyword">extends</span> object&gt;<span class="function">(<span class="params">params: T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 返回代理对象</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(params, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newVal, receiver</span>)&#123;</span><br><span class="line">      <span class="comment">// 数据更新</span></span><br><span class="line">      <span class="keyword">const</span> res = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, newVal, receiver)</span><br><span class="line">      <span class="comment">// 通知</span></span><br><span class="line">      list.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line"><span class="title function_">run</span>(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 更新视图</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据发生变化了&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="title function_">observer</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;)</span><br><span class="line">p.<span class="property">age</span> = <span class="number">20</span></span><br><span class="line">p.<span class="property">name</span> = <span class="string">&#x27;ls&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="类型守卫">类型守卫</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、类型收窄 | 类型收缩</span></span><br><span class="line"><span class="comment">// const isString = (value: any) =&gt; typeof value === &#x27;string&#x27;</span></span><br><span class="line"><span class="comment">// typeof有缺陷 引用数据类型检测不了 数组 对象 null</span></span><br><span class="line"><span class="comment">// const isArr = (value: any) =&gt; value instanceof Array</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、类型守卫 | 自定义守卫 | 类型谓词</span></span><br><span class="line"><span class="comment">// 语法规则: 参数 is 类型</span></span><br><span class="line"><span class="comment">// 如果这个函数的返回值是true 那么这个参数就是你想要的类型</span></span><br><span class="line"><span class="comment">// 实现一个函数 该函数接收一个参数(任意类型)</span></span><br><span class="line"><span class="comment">// a. 如果参数是字符串类型 去除左右空格</span></span><br><span class="line"><span class="comment">// b. 如果是Objcet 遍历对象的所有属性 如果它的属性值是number 取整</span></span><br><span class="line"><span class="comment">// c. 如果是函数类型 直接调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 问题1: ts没有提示对应的方法</span></span><br><span class="line"><span class="comment">// 使用类型守卫</span></span><br><span class="line"><span class="comment">// 问题2: this指向问题 </span></span><br><span class="line"><span class="comment">// nodejs环境 this指向undefined</span></span><br><span class="line"><span class="comment">// 浏览器环境  this指向window</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isString = (<span class="attr">param</span>: any): param is string =&gt; <span class="keyword">typeof</span> param === <span class="string">&#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isNum = (<span class="attr">param</span>: any): param is number =&gt; <span class="keyword">typeof</span> param === <span class="string">&#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isObj = (<span class="attr">param</span>: any): param is object =&gt; (&#123;&#125;).<span class="property">toString</span>.<span class="title function_">call</span>(param) === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isFn = (<span class="attr">param</span>: any): param is <span class="title class_">Function</span> =&gt; <span class="keyword">typeof</span> param === <span class="string">&#x27;function&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">param:&#123; [key: string]: any &#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_">isObj</span>(param)) &#123;</span><br><span class="line">    <span class="keyword">let</span> val</span><br><span class="line">    <span class="comment">// 取出所有的键 不建议使用for...in 它会遍历原型上的属性</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(param).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      val = param[key]</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_">isNum</span>(val))&#123;</span><br><span class="line">        <span class="comment">// 取整</span></span><br><span class="line">        param[key] = val.<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_">isString</span>(val))&#123;</span><br><span class="line">        param[key] = val.<span class="title function_">trim</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_">isFn</span>(val))&#123;</span><br><span class="line">        param[key]()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> param</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> param = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;  zs  &#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18.666</span>,</span><br><span class="line">  <span class="title function_">run</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn</span>(param));</span><br></pre></td></tr></table></figure>
<h4 id="协变-逆变">协变&amp;逆变</h4>
<p>所谓的类型兼容性，就是用于确定一个类型是否能赋值给其他的类型。typescript中的类型兼容性是基于<strong>结构类型</strong>的（也就是形状），如果A要兼容B 那么A至少具有B相同的属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 协变也可以叫鸭子类型 什么是鸭子类型?</span></span><br><span class="line"><span class="comment">// 一只鸟 走路像鸭子 游泳什么的都像鸭子 那么这只鸟就可以称之为鸭子类型</span></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父类型</span></span><br><span class="line">interface A &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">age</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类型</span></span><br><span class="line">interface B &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">age</span>: number,</span><br><span class="line">  <span class="attr">sex</span>: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: A = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;zs&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: B = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ls&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">sex</span>: <span class="string">&quot;man&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协变</span></span><br><span class="line">a = b</span><br><span class="line"><span class="comment">// 变量逆变不行 父类无法覆盖子类</span></span><br><span class="line"><span class="comment">// b = a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 逆变</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fna</span> = (<span class="params">param: A</span>) =&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnb</span> = (<span class="params">param: B</span>) =&gt; &#123;&#125;</span><br><span class="line">fnb = fna</span><br><span class="line"><span class="comment">// 严格模式下报错，因为可能并不能a保证存在sex 2.0之前允许 2.0之后需要手动开启</span></span><br><span class="line"><span class="comment">// strictFunctionTypes: false</span></span><br><span class="line"><span class="comment">// 双向协变</span></span><br><span class="line">fna = fnb</span><br></pre></td></tr></table></figure>
<h4 id="keyof">keyof</h4>
<p><code>keyof</code> 是 TypeScript 中的一种类型操作符，用于获取一个类型的所有键（属性名）作为联合类型。它的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">type KeysOfType = keyof ObjectType;</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>keyof</code> 是 TypeScript 的关键字，用于指定要获取键的类型操作。</li>
<li><code>ObjectType</code> 是你想要获取键的对象类型。</li>
</ul>
<p>这将返回一个联合类型，包含了 <code>ObjectType</code> 中所有属性的键。例如，如果你有以下对象类型：</p>
<p>type Person = { name: string; age: number; address: string; };</p>
<p>你可以使用 <code>keyof</code> 来获取 <code>Person</code> 类型的所有键：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">type KeysOfPerson = keyof Person; // KeysOfPerson 类型将是 &quot;name&quot; | &quot;age&quot; | &quot;address&quot;</span><br></pre></td></tr></table></figure>
<p>这是一个非常有用的功能，特别是在编写泛型代码或需要进行类型推断时，可以使用 <code>keyof</code> 来操作对象类型的键。</p>
<h4 id="泛型工具">泛型工具</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; &#125;</span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name: string,</span></span><br><span class="line"><span class="comment">//   sex: string,</span></span><br><span class="line"><span class="comment">//   age: number,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Partial 所有的属性都会变成可选的</span></span><br><span class="line"><span class="comment">// type partialUser =  Partial&lt;User&gt;</span></span><br><span class="line"><span class="comment">// let p: partialUser = &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义Partial</span></span><br><span class="line"><span class="comment">// type customPartial&lt;T&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   [P in keyof T]? : T[P]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// type partialUser = customPartial&lt;User&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name?: string,</span></span><br><span class="line"><span class="comment">//   sex?: string,</span></span><br><span class="line"><span class="comment">//   age?: number,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// Required 所有属性都会变成必传的</span></span><br><span class="line"><span class="comment">// type requiredUser = Required&lt;User&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义Required</span></span><br><span class="line"><span class="comment">// type customRequired&lt;T&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   [P in keyof T]-? : T[P]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// type requiredUser =  customRequired&lt;User&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name?: string,</span></span><br><span class="line"><span class="comment">//   sex: string,</span></span><br><span class="line"><span class="comment">//   age?: number,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// Pick 提取部分属性</span></span><br><span class="line"><span class="comment">// type pickUser = Pick&lt;User, &quot;sex&quot; | &quot;age&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义Pick</span></span><br><span class="line"><span class="comment">// K是T的子类型</span></span><br><span class="line"><span class="comment">// type customPick&lt;T, K extends keyof T&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   readonly [P in K] : T[P]</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// type pickUser = customPick&lt;User, &quot;sex&quot; | &quot;age&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name?: string,</span></span><br><span class="line"><span class="comment">//   sex: string,</span></span><br><span class="line"><span class="comment">//   age?: number,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exclude 排除某部分属性</span></span><br><span class="line"><span class="comment">// type excludeUser =  Exclude&lt;&quot;a&quot;|&quot;b&quot;|&quot;c&quot;, &quot;a&quot;|&quot;c&quot;&gt;</span></span><br><span class="line"><span class="comment">// type excludeUser =  Exclude&lt;keyof User, &quot;age&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义Exclude</span></span><br><span class="line"><span class="comment">// type customExclude&lt;T, K&gt; = T extends K ? never : T</span></span><br><span class="line"><span class="comment">// never在联合类型中会被排除</span></span><br><span class="line"><span class="comment">// type test = &#x27;a&#x27; | &#x27;b&#x27; | never</span></span><br><span class="line"><span class="comment">// type excludeUser = customExclude&lt;keyof User, &quot;age&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name?: string,</span></span><br><span class="line"><span class="comment">//   sex: string,</span></span><br><span class="line"><span class="comment">//   age?: number,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// Omit 排除部分属性 返回新的类型</span></span><br><span class="line"><span class="comment">// type omitUser = Omit&lt;User, &#x27;name&#x27; | &#x27;age&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type customOmit&lt;T, K extends keyof T&gt; = Pick&lt;T, Exclude&lt;keyof T, K&gt;&gt;</span></span><br><span class="line"><span class="comment">// type omitUser = customOmit&lt;User, &quot;name&quot; | &quot;age&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ThisType 指定函数中的上下文指向</span></span><br><span class="line"><span class="comment">// const dog:&#123;run: any&#125; &amp; ThisType&lt;&#123;age: 18&#125;&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   run()&#123;</span></span><br><span class="line"><span class="comment">//     console.log(this.age);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// dog.run() // ok 正常调用</span></span><br><span class="line"><span class="comment">// dog.age // error，在外面的话，就跟ThisType没有关系了,这里就是没有定义age了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Record 可以用来构造一个具有给定类型T的一组属性K的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type key = &quot;c&quot; | &quot;x&quot; | &quot;k&quot;</span></span><br><span class="line"><span class="comment">// type value = &quot;sing&quot; | &quot;dance&quot; | &quot;rapper&quot;</span></span><br><span class="line"><span class="comment">// 限制val的取值范围</span></span><br><span class="line"><span class="comment">// let fn = (val: value) =&gt; &#123;&#125;</span></span><br><span class="line"><span class="comment">// fn(&quot;oo&quot;)</span></span><br><span class="line"><span class="comment">// let obj: Record&lt;key, Record&lt;key, value&gt;&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   c: &#123;</span></span><br><span class="line"><span class="comment">//     c: &quot;sing&quot;,</span></span><br><span class="line"><span class="comment">//     x: &quot;dance&quot;,</span></span><br><span class="line"><span class="comment">//     k: &quot;rapper&quot;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   x: &#123;</span></span><br><span class="line"><span class="comment">//     c: &quot;sing&quot;,</span></span><br><span class="line"><span class="comment">//     x: &quot;dance&quot;,</span></span><br><span class="line"><span class="comment">//     k: &quot;rapper&quot;</span></span><br><span class="line"><span class="comment">//   &#125;,</span></span><br><span class="line"><span class="comment">//   k:&#123;</span></span><br><span class="line"><span class="comment">//     c: &quot;sing&quot;,</span></span><br><span class="line"><span class="comment">//     x: &quot;dance&quot;,</span></span><br><span class="line"><span class="comment">//     k: &quot;rapper&quot;</span></span><br><span class="line"><span class="comment">//   &#125;, </span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// type anyObj = keyof any // string number symbol</span></span><br><span class="line"><span class="comment">// type customRecord&lt;K extends anyObj, T&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   [p in K]: T</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// returnType 获取函数返回类型</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment">// type returnType = ReturnType&lt;typeof fn&gt;</span></span><br><span class="line"></span><br><span class="line">type customReturnType&lt;F <span class="keyword">extends</span> <span class="title class_">Function</span>&gt; = F <span class="keyword">extends</span> (...<span class="attr">args</span>: any[]) =&gt; infer <span class="title class_">Res</span> ? <span class="title class_">Res</span> : never</span><br><span class="line">type returnType = customReturnType&lt;<span class="keyword">typeof</span> fn&gt;</span><br></pre></td></tr></table></figure>
<h4 id="infer">infer</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// infer: 推导泛型参数</span></span><br><span class="line"><span class="comment">// 注意事项: 只能出现在extends语句中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取promise的返回参数</span></span><br><span class="line"><span class="comment">// interface User &#123;</span></span><br><span class="line"><span class="comment">//   name: string;</span></span><br><span class="line"><span class="comment">//   age: number</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// type promiseType = Promise&lt;Promise&lt;Promise&lt;User&gt;&gt;&gt;</span></span><br><span class="line"><span class="comment">// type getType&lt;T&gt; = T extends Promise&lt;infer U&gt; ? getType&lt;U&gt; : T</span></span><br><span class="line"><span class="comment">// type T = getType&lt;promiseType&gt;</span></span><br><span class="line"></span><br><span class="line">type arr = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="comment">// 提取第一个</span></span><br><span class="line"><span class="comment">// type First&lt;T extends any[]&gt; = T extends [infer one, ...any[]] ? one : null</span></span><br><span class="line"><span class="comment">// type a = First&lt;arr&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取最后一个</span></span><br><span class="line"><span class="comment">// type Last&lt;T extends any[]&gt; = T extends [...any[], infer last] ? last : null</span></span><br><span class="line"><span class="comment">// type a = Last&lt;arr&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取前两个</span></span><br><span class="line"><span class="comment">// type First&lt;T extends any[]&gt; = T extends [...infer Rest, unknown] ? Rest : null</span></span><br><span class="line"><span class="comment">// type a = First&lt;arr&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取后两个</span></span><br><span class="line"><span class="comment">// type Last&lt;T extends any[]&gt; = T extends [unknown, ...infer Rest] ? Rest : null</span></span><br><span class="line"><span class="comment">// type a = Last&lt;arr&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [&#x27;c&#x27;,&#x27;b&#x27;, &#x27;a&#x27;]</span></span><br><span class="line"><span class="comment">// type Reverse&lt;T extends any[]&gt; = T extends [infer One, ...infer Rest] ? [...Reverse&lt;Rest&gt;, One] : T</span></span><br><span class="line"><span class="comment">// type a = Reverse&lt;arr&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编写插件">编写插件</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack遵循commonjs规范</span></span><br><span class="line"><span class="comment">// webpack配置文件</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">DefinePlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.ts&quot;</span>,</span><br><span class="line">  <span class="comment">// 出口</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// __dirname: 当前js文件所在目录的绝对路径 =&gt; D:\Education\2301A\ts\demo </span></span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 扩展名</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>],</span><br><span class="line">    <span class="comment">// 别名</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 匹配已.ts结尾的文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        <span class="comment">// 使用哪种loader处理</span></span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 插件</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 根据指定目录下的文件创建打包后的首页</span></span><br><span class="line">      <span class="comment">// 自动将打包后的bundle.js引入到此</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;ts编写插件&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// express</span></span><br><span class="line">  <span class="comment">// http-middleware-proxy</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StorageCls</span>, key, <span class="title class_">Expire</span>, <span class="title class_">Data</span>, <span class="title class_">Result</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dictionaries</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./enum&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Storage</span> implements <span class="title class_">StorageCls</span> &#123;</span><br><span class="line">  <span class="comment">// expire: 不传默认永久 传了就设置时间</span></span><br><span class="line">  set&lt;T&gt;(<span class="attr">key</span>: key, <span class="attr">value</span>: T, <span class="attr">expire</span>: <span class="title class_">Expire</span> = <span class="title class_">Dictionaries</span>.<span class="property">permanent</span>): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 让用户按照我们的格式来存储</span></span><br><span class="line">    <span class="keyword">const</span> data : <span class="title class_">Data</span> = &#123;</span><br><span class="line">      value, <span class="comment">// 用户的value</span></span><br><span class="line">      <span class="comment">// 枚举中定义_expire_键</span></span><br><span class="line">      [<span class="title class_">Dictionaries</span>.<span class="property">expire</span>]: expire <span class="comment">// 过期时间</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">  &#125;</span><br><span class="line">  get&lt;T&gt;(<span class="attr">key</span>: key): <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">data</span>: <span class="title class_">Data</span>&lt;T&gt; = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(value);</span><br><span class="line">      <span class="comment">// 获取当前时间</span></span><br><span class="line">      <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">      <span class="comment">// 时间戳的情况 判断有没有过期</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> data[<span class="title class_">Dictionaries</span>.<span class="property">expire</span>] == <span class="string">&#x27;number&#x27;</span> &amp;&amp; data[<span class="title class_">Dictionaries</span>.<span class="property">expire</span>] &lt; now) &#123;</span><br><span class="line">        <span class="comment">// 删除过期的键</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">`您的<span class="subst">$&#123;key&#125;</span>已过期`</span>,</span><br><span class="line">          <span class="attr">value</span>: <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果没有过期</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">value</span>: data.<span class="property">value</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 比如: getItme(&#x27;不存在的key&#x27;) =&gt; null</span></span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;值无效&quot;</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">removeItem</span>(<span class="attr">key</span>: key): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Storage</span>()</span><br><span class="line">s.<span class="title function_">set</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="number">5000</span>)</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> a = s.<span class="title function_">get</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">src/type/index.<span class="property">ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dictionaries</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../enum&#x27;</span></span><br><span class="line"><span class="comment">// 约束键的类型</span></span><br><span class="line"><span class="keyword">export</span> type key = string</span><br><span class="line"><span class="comment">// 约束时间类型</span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Expire</span> = <span class="title class_">Dictionaries</span>.<span class="property">permanent</span> | number <span class="comment">// 时间戳</span></span><br><span class="line"><span class="comment">// 约束data</span></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">Data</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: T,</span><br><span class="line">  [<span class="title class_">Dictionaries</span>.<span class="property">expire</span>]: <span class="title class_">Expire</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义返回的类型</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Result</span> &lt;T&gt;&#123;</span><br><span class="line">  <span class="attr">msg</span>: string,</span><br><span class="line">  <span class="comment">// 让用户自己返回类型 可能结果为null</span></span><br><span class="line">  <span class="attr">value</span>: T | <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 约束类</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">StorageCls</span> &#123;</span><br><span class="line">  <span class="attr">get</span>: &lt;T&gt;<span class="function">(<span class="params">key:key</span>) =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  <span class="attr">set</span>: &lt;T&gt;<span class="function">(<span class="params">key: key, val: T, expire:Expire</span>) =&gt;</span> <span class="keyword">void</span>,</span><br><span class="line">  <span class="attr">removeItem</span>:<span class="function">(<span class="params">key: key</span>) =&gt;</span> <span class="keyword">void</span></span><br><span class="line">  <span class="attr">clear</span>:<span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/enum/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//字典Dictionaries expire过期时间key permanent永久不过期</span></span><br><span class="line"><span class="keyword">export</span> enum <span class="title class_">Dictionaries</span> &#123;</span><br><span class="line">  permanent = <span class="string">&quot;permanent&quot;</span>,</span><br><span class="line">  expire = <span class="string">&quot;_expire_&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ts</category>
      </categories>
      <tags>
        <tag>ts</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs 学习</title>
    <url>/blog/2023/08/09/nodejs/</url>
    <content><![CDATA[<p><strong>正式学习node之前，我们先铺垫一些基础概念 ~</strong></p>
<h3 id="浏览器工作原理">浏览器工作原理</h3>
<h4 id="浏览器的组成">浏览器的组成</h4>
<ul>
<li>人机交互部分（UI界面）</li>
<li>网络请求部分（Socket）</li>
<li>JavaScript引擎部分（解析执行JavaScript）</li>
<li>渲染引擎部分（渲染HTML、CSS等）</li>
<li>数据存储部分（cookie、HTML5中的本地存储LocalStorage、SessionStorage）</li>
</ul>
<span id="more"></span>
<h4 id="主流渲染引擎">主流渲染引擎</h4>
<p><strong>介绍</strong></p>
<ol>
<li>渲染引擎 又叫 排版引擎 或 浏览器内核。</li>
</ol>
<ul>
<li>OA (员工管理系统 : 员工信息、考勤、请假 …)</li>
</ul>
<ol start="2">
<li>主流的 渲染引擎 有
<ul>
<li><strong>Chrome浏览器</strong>: Blink引擎（WebKit的一个分支）。</li>
<li><strong>Safari浏览器</strong>: WebKit引擎，windows版本2008年3月18日推出正式版，但苹果已于2012年7月25日停止开发Windows版的Safari。</li>
<li><strong>FireFox浏览器</strong>: Gecko引擎。</li>
<li><strong>Opera浏览器</strong>: Blink引擎(早期版使用Presto引擎）。</li>
<li><strong>Internet Explorer浏览器</strong>: Trident引擎。</li>
<li><strong>Microsoft Edge浏览器</strong>: EdgeHTML引擎（Trident的一个分支）。</li>
</ul>
</li>
</ol>
<h4 id="工作原理">工作原理</h4>
<ol>
<li>解析HTML构建Dom树（Document Object Model，文档对象模型），DOM 是W3C组织推荐的处理可扩展置标语言的标准编程接口。</li>
<li>解析CSS构建CSS规则树</li>
<li>构建渲染树，渲染树并不等同于Dom树，因为像<code>head、body、meta、html标签 或 display: none</code>这样的元素就没有必要放到渲染树中了，但是它们在Dom树中。</li>
<li>对渲染树进行布局，定位坐标和大小、确定是否换行、确定position、overflow、z-index等等，这个过程叫<code>&quot;layout&quot; 或 &quot;reflow&quot;</code>。</li>
<li>绘制渲染树，调用操作系统底层API进行绘图操作。</li>
</ol>
<h4 id="渲染引擎工作原理示意图">渲染引擎工作原理示意图</h4>
<p><img data-src="flow.png" alt="渲染引擎工作原理"></p>
<h5 id="WebKit工作原理（Chrome、Safari、Opera）"><strong>WebKit工作原理（Chrome、Safari、Opera）</strong></h5>
<p><img data-src="webkitflow.png" alt="Blink渲染引擎工作原理"></p>
<h5 id="Gecko工作原理（FireFox）"><strong>Gecko工作原理（FireFox）</strong></h5>
<p><img data-src="gecko.jpg" alt="Gecko渲染引擎工作原理"></p>
<h4 id="浏览器的-reflow-或-layout-过程">浏览器的 reflow 或 layout 过程</h4>
<p><a href="https://www.youtube.com/watch?v=ZTnIxIA5KGw">https://www.youtube.com/watch?v=ZTnIxIA5KGw</a></p>
<h4 id="打开-Chrome-的-Rendering-功能">打开 Chrome 的 Rendering 功能</h4>
<p>第一步：</p>
<p><img data-src="chrome_rendering1.png" alt="第一步"></p>
<p>第二步：</p>
<p><img data-src="chrome_rendering2.png" alt="第二步"></p>
<h4 id="浏览器访问网站过程">浏览器访问网站过程</h4>
<blockquote>
<ol>
<li>在浏览器地址栏中输入网址。</li>
</ol>
</blockquote>
<p><img data-src="taobao_url.png" alt="淘宝网址"></p>
<blockquote>
<ol start="2">
<li>浏览器通过用户在地址栏中输入的URL构建HTTP请求报文。</li>
</ol>
</blockquote>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.taobao.com  134.123.132.23</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, sdch, br</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>l=Ag0NWp9E8X4hgaGEtIBhOmKxnSOH6kG8; isg=AkZGLTL-Yr9tHDZbgd5bsn4Rlzwg5IphaK-1BzBvMmlEM-ZNmDfacSyDfdgF; thw=cn</span><br></pre></td></tr></table></figure>
<blockquote>
<ol start="3">
<li>浏览器发起DNS（寻址）解析请求，将域名转换为IP地址。</li>
</ol>
</blockquote>
<p><img data-src="taobao_ip.png" alt="淘宝网址"></p>
<blockquote>
<ol start="4">
<li>浏览器将请求报文发送给服务器。</li>
</ol>
</blockquote>
<blockquote>
<ol start="5">
<li>服务器接收请求报文（request），并解析。</li>
</ol>
</blockquote>
<blockquote>
<ol start="6">
<li>服务器处理用户请求，并将处理结果封装成HTTP响应报文（response）。</li>
</ol>
</blockquote>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 13 Apr 2017 02:24:25 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Transfer-Encoding</span><span class="punctuation">: </span>chunked</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Accept-Encoding</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Ali-Detector-Type, X-CIP-PT</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0, s-maxage=300</span><br><span class="line"><span class="attribute">Via</span><span class="punctuation">: </span>cache8.l2cm10-1[172,200-0,C], cache13.l2cm10-1[122,0], cache3.cn206[0,200-0,H], cache6.cn206[0,0]</span><br><span class="line"><span class="attribute">Age</span><span class="punctuation">: </span>293</span><br><span class="line"><span class="attribute">X-Cache</span><span class="punctuation">: </span>HIT TCP_MEM_HIT dirn:-2:-2</span><br><span class="line"><span class="attribute">X-Swift-SaveTime</span><span class="punctuation">: </span>Thu, 13 Apr 2017 02:19:32 GMT</span><br><span class="line"><span class="attribute">X-Swift-CacheTime</span><span class="punctuation">: </span>300</span><br><span class="line"><span class="attribute">Timing-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">EagleId</span><span class="punctuation">: </span>9903e7e514920502659594264e</span><br><span class="line"><span class="attribute">Strict-Transport-Security</span><span class="punctuation">: </span>max-age=31536000</span><br><span class="line"><span class="attribute">Content-Encoding</span><span class="punctuation">: </span>gzip</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge,chrome=1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;renderer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;webkit&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>淘宝网 - 淘！我喜欢<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;spm-id&quot;</span> <span class="attr">content</span>=<span class="string">&quot;a21bo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;淘宝网 - 亚洲较大的网上交易平台，提供各类服饰、美容、家居、数码、话费/点卡充值… 数亿优质商品，同时提供担保交易(先收货后付款)等安全交易保障服务，并由商家提供退货承诺、破损补寄等消费者保障服务，让你安心享受网上购物乐趣！&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;aplus-xplug&quot;</span> <span class="attr">content</span>=<span class="string">&quot;NONE&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">content</span>=<span class="string">&quot;淘宝,掏宝,网上购物,C2C,在线交易,交易市场,网上交易,交易市场,网上买,网上卖,购物网站,团购,网上贸易,安全购物,电子商务,放心买,供应,买卖信息,网店,一口价,拍卖,网上开店,网络购物,打折,免费开店,网购,频道,店铺&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	......</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<ol start="7">
<li>服务器将HTTP响应报文发送给浏览器。</li>
</ol>
</blockquote>
<blockquote>
<ol start="8">
<li>浏览器接收服务器响应的HTTP响应报文，并解析。</li>
</ol>
</blockquote>
<blockquote>
<ol start="9">
<li>浏览器解析 HTML 页面并展示，在解析HTML页面时遇到新的资源需要再次发起请求。</li>
</ol>
</blockquote>
<blockquote>
<ol start="10">
<li>
<h5 id="最终浏览器展示出了页面">最终浏览器展示出了页面</h5>
</li>
</ol>
</blockquote>
<h4 id="HTTP请求报文和响应报文格式">HTTP请求报文和响应报文格式</h4>
<p><img data-src="HTTPMsgStructure2.png" alt="http请求报文和响应报文"></p>
<h4 id="DNS-解析过程">DNS 解析过程</h4>
<p><img data-src="DNS.gif" alt="DNS解析过程"></p>
<p><strong>windows 下 hosts 文件位置</strong></p>
<p>C:\Windows\System32\drivers\etc\hosts</p>
<h4 id="EventLoop">EventLoop</h4>
<p>详情参见 ppt</p>
<h3 id="web开发本质">web开发本质</h3>
<h4 id="牢记以下三点">牢记以下三点</h4>
<ol>
<li>请求，客户端发起请求。</li>
<li>处理，服务器处理请求。</li>
<li>响应，服务器将处理结果发送给客户端</li>
</ol>
<p><strong>对比一个单机版计算器和Web版计算器</strong></p>
<h4 id="客户端处理响应">客户端处理响应</h4>
<ul>
<li>服务器响应完毕后，客户端继续处理：
<ul>
<li>浏览器：解析服务器返回的数据</li>
<li>iOS、Android 客户端，解析服务器返回的数据，并且通过iOS或Android的UI技术实现界面的展示功能</li>
</ul>
</li>
</ul>
<h4 id="关于-C-S（Client-Server）和-B-S（Browser-Server）">关于 C/S（Client/Server）和 B/S（Browser/Server）</h4>
<p>C/S: 客户端服务器</p>
<p>B/S: 浏览器服务器</p>
<p><img data-src="client-server.png" alt="Client / Server"></p>
<h3 id="node-js-介绍">node.js 介绍</h3>
<h4 id="node-js-是什么？">node.js 是什么？</h4>
<ol>
<li>node.js 是一个开发平台，就像Java开发平台、.Net开发平台、PHP开发平台、Apple开发平台一样。
<ul>
<li>何为开发平台？有对应的编程语言、有语言运行时、有能实现特定功能的API（SDK：Software Development Kit）</li>
</ul>
</li>
<li>nodejs平台使用的编程语言是 JavaScript 语言。
<ul>
<li>不支持 window、document、bom 对象。</li>
</ul>
</li>
<li>node.js 平台是基于 Chrome V8 JavaScript 引擎构建。</li>
<li>基于 node.js 可以开发控制台程序（命令行程序、CLI程序）、桌面应用程序（GUI）（借助 node-webkit、electron 等框架实现）、Web 应用程序（网站）。</li>
</ol>
<p>PHP开发技术栈: LAMP - Linux Apache MySQL PHP</p>
<p>node.js 全栈开发技术栈: MEAN - MongoDB Express Angular Node.js</p>
<h4 id="node-js-有哪些特点？">node.js 有哪些特点？</h4>
<ol>
<li>事件驱动(当事件被触发时，执行传递过去的回调函数)</li>
<li>非阻塞 I/O 模型（当执行I/O操作时，不会阻塞线程）
<ul>
<li>Input / Output</li>
</ul>
</li>
<li>单线程</li>
<li>拥有世界最大的开源库生态系统 —— npm。</li>
</ol>
<h4 id="node-js-网站">node.js 网站</h4>
<ol>
<li><a href="https://nodejs.org/">node.js官方网站</a></li>
<li><a href="http://nodejs.cn/">node.js中文网</a></li>
<li><a href="https://cnodejs.org/">node.js 中文社区</a></li>
</ol>
<h4 id="为什么要学习Node-js">为什么要学习Node.js?</h4>
<ol>
<li>通过学习Node.js开发深入理解<strong>服务器开发</strong>、<strong>Web请求和响应过程</strong>、 <strong>了解服务器端如何与客户端配合</strong></li>
<li>学习服务器端渲染：art-template、ejs、underscore</li>
<li>学习服务器端为客户端编写接口</li>
<li>现在前端工程师面试，对 Node.js 开发有要求</li>
<li>补充提问：
<ul>
<li>在Node.js平台开发时，能使用Dom API吗？比如：<code>document.getElementById('id'); window.location 等</code>?</li>
</ul>
</li>
<li>复习 浏览器端 JavaScript 组成：ECMAscript、Dom、Bom</li>
</ol>
<h4 id="学习目标">学习目标</h4>
<ol>
<li>
<p>了解服务器开发过程</p>
</li>
<li>
<p>会使用 node.js 开发基本的 http 服务程序（Web应用程序）</p>
</li>
</ol>
<h4 id="Node-js可以用来做什么？">Node.js可以用来做什么？</h4>
<ul>
<li>具有复杂逻辑的动态网站</li>
<li>WebSocket服务器</li>
<li>命令行工具</li>
<li>带有图形界面的本地应用程序</li>
<li>…</li>
</ul>
<h4 id="终端基本使用">终端基本使用</h4>
<h4 id="打开应用">打开应用</h4>
<ul>
<li>notepad 打开记事本</li>
<li>mspaint 打开画图</li>
<li>calc 打开计算机</li>
<li>write 写字板</li>
<li>sysdm.cpl 打开环境变量设置窗口</li>
</ul>
<h4 id="常用命令">常用命令</h4>
<ul>
<li>md 创建目录</li>
<li>rmdir(rd) 删除目录，目录内没有文档</li>
<li>echo on a.txt 创建空文件</li>
<li>del 删除文件</li>
<li>rm 文件名 删除文件</li>
</ul>
<h4 id="Node-js开发环境准备">Node.js开发环境准备</h4>
<ol>
<li>
<p>普通安装方式<a href="https://nodejs.org/zh-cn/">官方网站</a></p>
</li>
<li>
<p>多版本安装方式</p>
<ul>
<li>卸载已有的Node.js</li>
<li>下载<a href="https://github.com/coreybutler/nvm-windows">nvm</a></li>
<li>在C盘创建目录dev</li>
<li>在dev目中中创建两个子目录nvm和nodejs</li>
<li>并且把nvm包解压进去nvm目录中</li>
<li>在install.cmd文件上面右键选择【以管理员身份运行】</li>
<li>打开的cmd窗口直接回车会生成一个settings.txt文件，修改文件中配置信息</li>
<li>配置nvm和Node.js环境变量
<ul>
<li>NVM_HOME:C:\dev\nvm</li>
<li>NVM_SYMLINK:C:\dev\nodejs</li>
</ul>
</li>
<li>把配置好的两个环境变量加到Path中</li>
</ul>
</li>
</ol>
<h4 id="nvm常用的命令">nvm常用的命令</h4>
<ul>
<li>nvm list 查看当前安装的Node.js所有版本</li>
<li>nvm install 版本号 安装指定版本的Node.js</li>
<li>nvm uninstall 版本号 卸载指定版本的Node.js</li>
<li>nvm use 版本号 选择指定版本的Node.js</li>
</ul>
<h4 id="Node-js之HelloWorld">Node.js之HelloWorld</h4>
<ul>
<li>命令行方式REPL</li>
<li>运行文件方式</li>
<li>全局对象概览</li>
</ul>
<h4 id="Node-js-开发-Web-应用程序-和-PHP、Java、ASP-Net等传统模式开发Web应用程序区别">Node.js 开发 Web 应用程序 和 PHP、Java、ASP.Net等传统模式开发Web应用程序区别</h4>
<ol>
<li><strong>传统模式</strong>
<ul>
<li>有 Web 容器</li>
</ul>
</li>
</ol>
<p><img data-src="Web.png" alt="有Web容器开发模型"></p>
<ol start="2">
<li><strong>Node.js开发Web应用程序</strong>
<ul>
<li>没有 Web 容器</li>
</ul>
</li>
</ol>
<p><img data-src="nodeWeb.png" alt="Node.js无Web容器开发模型"></p>
<ol start="3">
<li>补充提问：</li>
</ol>
<ul>
<li>什么是动态网页？什么是静态网页？</li>
</ul>
<h3 id="在-node-js-上编写程序">在 node.js 上编写程序</h3>
<h4 id="REPL介绍">REPL介绍</h4>
<ol>
<li>
<p>REPL 全称: Read-Eval-Print-Loop（交互式解释器）</p>
<ul>
<li>R 读取 - 读取用户输入，解析输入了Javascript 数据结构并存储在内存中。</li>
<li>E 执行 - 执行输入的数据结构</li>
<li>P 打印 - 输出结果</li>
<li>L 循环 - 循环操作以上步骤直到用户两次按下 ctrl-c 按钮退出。</li>
</ul>
</li>
<li>
<p>在REPL中编写程序 （类似于浏览器开发人员工具中的控制台功能）</p>
<ul>
<li>直接在控制台输入 <code>node</code> 命令进入 REPL 环境</li>
</ul>
</li>
<li>
<p>按两次 Control + C 退出REPL界面 或者 输入 <code>.exit</code> 退出 REPL 界面</p>
<ul>
<li>按住 control 键不要放开, 然后按两下 c 键</li>
</ul>
</li>
</ol>
<h4 id="创建-JavaScript-文件编写程序">创建 JavaScript 文件编写程序</h4>
<p><strong>JavaScript 文件名命名规则</strong></p>
<ul>
<li>不要用中文</li>
<li>不要包含空格</li>
<li>不要出现node关键字，比如：node.js</li>
<li>建议以 ‘-’ 分割单词</li>
</ul>
<p><strong>案例</strong></p>
<h4 id="案例1：编写一个简单的函数-实现数字相加">案例1：编写一个简单的函数, 实现数字相加</h4>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> m = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = <span class="title function_">add</span>(m, n);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;计算结果是：&#x27;</span> + result);</span><br></pre></td></tr></table></figure>
<h4 id="案例2：文件读写案例">案例2：文件读写案例</h4>
<ul>
<li>
<p>使用到的模块<code>var fs = require('fs');</code></p>
</li>
<li>
<p>1、写文件：<code>fs.writeFile(file, data[, options], callback);</code></p>
<ul>
<li>参数1：要写入的文件路径，<strong>必填</strong>。</li>
<li>参数2：要写入的数据，<strong>必填</strong>。</li>
<li>参数3：写入文件时的选项，比如：文件编码，选填。</li>
<li>参数4：文件写入完毕后的回调函数，<strong>必填</strong>。</li>
<li>写文件注意：
<ul>
<li>该操作采用异步执行</li>
<li>如果文件已经存在则替换掉</li>
<li>默认写入的文件编码为utf8</li>
<li>回调函数有1个参数：err，表示在写入文件的操作过程中是否出错了。
<ul>
<li>如果出错了<code>err != null</code>，否则 <code>err === null</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>2、读文件：<code>fs.readFile(file[, options], callback)</code></p>
<ul>
<li>参数1：要读取的文件路径，<strong>必填</strong>。</li>
<li>参数2：读取文件时的选项，比如：文件编码。选填。</li>
<li>参数3：文件读取完毕后的回调函数，<strong>必填</strong>。</li>
<li>读文件注意：
<ul>
<li>该操作采用异步执行</li>
<li>回调函数有两个参数，分别是err和data</li>
<li>如果读取文件时没有指定编码，那么返回的将是原生的二进制数据；如果指定了编码，那么会根据指定的编码返回对应的字符串数据。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>注意：</p>
<ul>
<li>文件操作中的<code>./</code>表示当前路径，相对的是执行node命令的路径，而不是当前被执行的<code>*.js</code>文件的实际路径。</li>
<li><code>__dirname</code>才永远表示当前被执行的<code>*.js</code>文件的实际路径</li>
<li><code>/</code>表示根目录, 读取文件或写入文件的时候写<code>/</code>目录，在Windows下相当于当前磁盘根目录（比如：c:\ 或 d:\ 或 e:\  等，在Mac下相当于硬盘根目录 <code>/</code>）</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// --------------------------------- 写文件 -----------------------------</span></span><br><span class="line"><span class="comment">// 加载文件操作模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建要写入的文件的字符串</span></span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">&#x27;你好，世界！你好 Node.js.&#x27;</span>;</span><br><span class="line"><span class="comment">// 执行文件写入操作</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&#x27;./data.txt&#x27;</span>, msg, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;---&#x27;</span> + err + <span class="string">&#x27;----&#x27;</span>);</span><br><span class="line">  <span class="comment">// /判断是否写入文件出错了</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件写入出错了，详细错误信息：&#x27;</span> + err);</span><br><span class="line">    <span class="comment">// 把错误继续向上抛出</span></span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件写入成功！&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------- 读文件 -----------------------------</span></span><br><span class="line"><span class="comment">// 加载文件操作模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行文件读取操作</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./data.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">  <span class="comment">// 输出err  和 data</span></span><br><span class="line">  <span class="comment">// console.log(&#x27;error: &#x27; + err);</span></span><br><span class="line">  <span class="comment">// console.log(&#x27;data: &#x27; + data);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件读取出错啦！详细信息: &#x27;</span> + err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件读取成功，以下是文件内容：&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="案例3：创建目录案例">案例3：创建目录案例</h4>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个文件夹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载文件操作模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个目录</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./test-mkdir&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;创建目录出错了，详细信息如下：&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;目录创建成功！&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载文件操作模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 创建 &#x27;01-教学资料&#x27; 目录</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./01-教学资料&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.1 创建 &#x27;01-笔记大纲&#x27; 目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./01-教学资料/01-笔记大纲&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.2 创建 &#x27;02-作业任务&#x27; 目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./01-教学资料/02-作业任务&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.3 创建 &#x27;03-素材资料&#x27; 目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./01-教学资料/03-素材资料&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1.4 创建 &#x27;04-随堂笔记&#x27; 目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./01-教学资料/04-随堂笔记&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建 &#x27;02-源代码&#x27; 目录</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./02-源代码&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.1 创建 &#x27;预习代码&#x27;目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./02-源代码/预习代码&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.2 创建 &#x27;课堂代码&#x27;目录</span></span><br><span class="line">  fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./02-源代码/课堂代码&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建 &#x27;03-视频&#x27; 目录</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./03-视频&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 创建 &#x27;04-其他资料&#x27; 目录</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./04-其他资料&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ol>
<li>异步操作无法通过 try-catch 来捕获异常，要通过判断 error 来判断是否出错。</li>
<li>同步操作可以通过 try-catch 来捕获异常。</li>
<li>不要使用 <code>fs.exists(path, callback)</code> 来判断文件是否存在，直接判断 error 即可</li>
<li>文件操作时的路径问题
<ul>
<li>在读写文件的时候 ‘./’ 表示的是当前执行node命令的那个路径，不是被执行的js文件的路径</li>
<li>__dirname, 表示的永远是&quot;当前被执行的js的目录&quot;</li>
<li>__filename, 表示的是&quot;被执行的js的文件名（含路径)&quot;</li>
</ul>
</li>
<li>error-first 介绍( 错误优先 )</li>
</ol>
<h4 id="案例4：通过-node-js-编写-http-服务程序-极简版本">案例4：通过 node.js 编写 http 服务程序 - 极简版本</h4>
<p>步骤：</p>
<ol>
<li>加载http模块</li>
<li>创建http服务</li>
<li>为http服务对象添加 request 事件处理程序</li>
<li>开启http服务监听，准备接收客户端请求</li>
</ol>
<p>注意：</p>
<ol>
<li>
<p>浏览器显示可能是乱码，所以可以通过 <code>res.setHeader('Content-Type', 'text/plain; charset=utf-8');</code>设置浏览器显示时所使用的编码。</p>
</li>
<li>
<p>Chrome 浏览器默认无法手动设置编码，需要安装&quot;Set Character Encoding&quot;扩展。</p>
</li>
<li>
<p>演示一下设置<code>Content-Type=text/html</code> 和 <code>Content-Type=text/plain</code>的区别。</p>
</li>
</ol>
<p>参考代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 加载http模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建http服务</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 开始监听&#x27;request&#x27;事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// body...</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;有人请求了~~&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 启动服务，开始监听</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务已经启动，请访问： http://localhost:9000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="案例5：通过-node-js-编写-http-服务程序-根据不同请求作出不同响应">案例5：通过 node.js 编写 http 服务程序 - 根据不同请求作出不同响应</h4>
<p><strong>说明：</strong></p>
<ul>
<li>根据不同请求，显示index页面、login页面、register页面、list页面、404页面。</li>
<li>请求 / 或 /index</li>
<li>请求 /login</li>
<li>请求 /register</li>
<li>请求 /list</li>
<li>请求除了以上路径之外的路径</li>
</ul>
<p><strong>参考代码</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 加载http模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建http server</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// body...</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/&#x27;</span> || req.<span class="property">url</span> === <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 表示请求网站首页</span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;这是 index.html&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 表示请求登录页面</span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;这是 login.html&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/register&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 表示请求注册页面</span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;这是 register.html&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/list&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 表示请求列表页面</span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;这是 list.html&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 表示请求的页面不存在</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">404</span>, <span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Sorry, page not found.&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口的网络请求</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http://localhost:9000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="案例6：通过-node-js-编写-http-服务程序-通过读取静态-HTML-文件来响应用户请求">案例6：通过 node.js 编写 http 服务程序 - 通过读取静态 HTML 文件来响应用户请求</h4>
<p>步骤：</p>
<ol>
<li>创建index.html、login.html、register.html、list.html、404.html文件。</li>
<li>演示通过读取最简单的 HTML 文件来响应用户。</li>
<li>演示通过读取&quot;具有引入外部CSS样式表&quot;的HTML文件来响应用户。</li>
<li>演示通过读取&quot;具有img标签&quot;的HTML文件来响应用户。</li>
</ol>
<p>注意：</p>
<ul>
<li>
<p>1、注意在发送不同类型的文件时，要设置好对应的<code>Content-Type</code></p>
<ul>
<li><a href="http://tool.oschina.net/commons">Content-Type参考 OSChina</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types">Content-Type参考 MDN</a></li>
</ul>
</li>
<li>
<p>2、HTTP状态码参考</p>
<ul>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">w3org参考</a></li>
<li><a href="https://www.w3schools.com/tags/ref_httpmessages.asp">w3schools参考</a></li>
</ul>
</li>
<li>
<p>3、在html页面中写相对路径’./’ 和 绝对路径 '/'的含义 。</p>
<ul>
<li>网页中的这个路径主要是告诉浏览器向哪个地址发起请求用的</li>
<li>‘./’ 表示本次请求从相对于当前页面的请求路径（即服务器返回当前页面时的请求路径）开始</li>
<li>‘/’ 表示请求从根目录开始</li>
</ul>
</li>
</ul>
<p>补充知识点：</p>
<ol>
<li>path 模块的 join() 方法</li>
</ol>
<p>参考代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 加载 http 模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 加载文件操作模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">// 加载path模块，这个模块主要用来处理各种路径。</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建http server</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 获取用户请求的URL</span></span><br><span class="line">  <span class="keyword">var</span> url = req.<span class="property">url</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 根据用户的不同请求，做出不同响应</span></span><br><span class="line">  <span class="keyword">if</span> (url === <span class="string">&#x27;/&#x27;</span> || url === <span class="string">&#x27;/index&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取index.html文件，把该文件响应给用户</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;index.html&#x27;</span>), <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, <span class="string">&#x27;OK&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html; charset=utf-8&#x27;);</span></span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取login.html文件，把该文件响应给用户</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;login.html&#x27;</span>), <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, <span class="string">&#x27;OK&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html; charset=utf-8&#x27;);</span></span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&#x27;/register&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取register.html文件，把该文件响应给用户</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;register.html&#x27;</span>), <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, <span class="string">&#x27;OK&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html; charset=utf-8&#x27;);</span></span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&#x27;/404&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取register.html文件，把该文件响应给用户</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;404.html&#x27;</span>), <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, <span class="string">&#x27;OK&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// res.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html; charset=utf-8&#x27;);</span></span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 启动服务</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9090</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// body...</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;please visit: http://localhost:9090&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="案例7：模拟-Apache-实现静态资源服务器">案例7：模拟 Apache 实现静态资源服务器</h4>
<p>步骤：</p>
<ul>
<li>单独创建一个目录来实现，比如：创建一个&quot;07-Apache&quot;的目录。</li>
<li>在该目录下新建 <code>public</code> 目录，假设该目录为静态资源目录。</li>
<li>根据用户请求的路径在 public 目录下寻找对应路径下的资源。</li>
<li>如果找到了，那么将该资源返回给用户，如果没找到则返回404错误。</li>
<li>通过 mime 模块设置不同类型资源的Content-Type</li>
<li>实现完毕后把素材中的’An Ocean of Sky’ 和 'Hacker News’分别拷贝到静态资源目录下, 测试是否成功</li>
</ul>
<p>其他：</p>
<ul>
<li>介绍 NPM</li>
<li>介绍 mime 第三方模块
<ul>
<li><code>npm install mime</code></li>
<li>在代码中直接 <code>var mime = require('mime')</code></li>
</ul>
</li>
</ul>
<p>参考代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 加载对应模块</span></span><br><span class="line"><span class="comment">// 1.1 加载http模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">// 1.2 加载path模块，方便路径拼接</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// 1.3 加载文件读取模块</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">// 1.4 加载判断文件MIME类型的模块</span></span><br><span class="line"><span class="keyword">var</span> mime = <span class="built_in">require</span>(<span class="string">&#x27;mime&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 创建http server</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 监听用户request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. 获取用户的请求路径, 并转换为小写</span></span><br><span class="line">  <span class="keyword">var</span> url = req.<span class="property">url</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断如果请求的路径是 &#x27;/&#x27; 那么等价于 &#x27;/index.html&#x27;</span></span><br><span class="line">  url = (url === <span class="string">&#x27;/&#x27;</span>) ? <span class="string">&#x27;/index.html&#x27;</span> : url;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 根据用户请求的url路径, 去public目录下查找对应的静态资源文件。找到后读取该文件，并将结果返回给用户</span></span><br><span class="line">  <span class="comment">// 2.1 根据用户请求的url拼接本地资源文件的路径 </span></span><br><span class="line">  <span class="keyword">var</span> filePath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>, url);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.2 根据请求的文件路径设置Content-Type</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, mime.<span class="title function_">lookup</span>(url));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.2 根据路径去读取对应的文件</span></span><br><span class="line">  <span class="comment">// 【注意】读取文件前无需判断文件是否已经存在，而是在读取文件的回调函数中根据error的错误信息来判断读取文件是否成功以及发生的错误</span></span><br><span class="line">  fs.<span class="title function_">readFile</span>(filePath, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断是否有错误</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&#x27;ENOENT&#x27;</span>) &#123; <span class="comment">// 判断是否是请求的文件是否不存在</span></span><br><span class="line"></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf8&#x27;</span>);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="property">statusMessage</span> = <span class="string">&#x27;Not Found&#x27;</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;&lt;h1&gt;请求的资源不存在！&lt;/h1&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&#x27;EACCES&#x27;</span>) &#123; <span class="comment">// 判断文件是否有访问权限</span></span><br><span class="line"></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html; charset=utf8&#x27;</span>);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">403</span>;</span><br><span class="line">        res.<span class="property">statusMessage</span> = <span class="string">&#x27;Forbidden&#x27;</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;&lt;h1&gt;Permission denied！&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> err;  </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 如果没有错误则将读取到的文件返回给用户</span></span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">200</span>;</span><br><span class="line">      res.<span class="property">statusMessage</span> = <span class="string">&#x27;OK&#x27;</span>;</span><br><span class="line">      res.<span class="title function_">end</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 启动服务</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// body...</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server is running, please visit: http://localhost:9000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Common-System-Errors-常见错误号">Common System Errors - 常见错误号</h4>
<ul>
<li>
<p>EACCES (Permission denied)</p>
<ul>
<li>An attempt was made to access a file in a way forbidden by its file access permissions.</li>
<li>访问被拒绝</li>
</ul>
</li>
<li>
<p>EADDRINUSE (Address already in use)</p>
<ul>
<li>An attempt to bind a server (net, http, or https) to a local address failed due to another server on the local system already occupying that address.</li>
<li>地址正在被使用（比如：端口号被占用）</li>
</ul>
</li>
<li>
<p>EEXIST (File exists)</p>
<ul>
<li>An existing file was the target of an operation that required that the target not exist.</li>
<li>文件已经存在</li>
</ul>
</li>
<li>
<p>EISDIR (Is a directory)</p>
<ul>
<li>An operation expected a file, but the given pathname was a directory.</li>
<li>给定的路径是目录</li>
</ul>
</li>
<li>
<p>ENOENT (No such file or directory)</p>
<ul>
<li>Commonly raised by fs operations to indicate that a component of the specified pathname does not exist – no entity (file or directory) could be found by the given path.</li>
<li>文件 或 目录不存在</li>
</ul>
</li>
<li>
<p>ENOTDIR (Not a directory)</p>
<ul>
<li>A component of the given pathname existed, but was not a directory as expected. Commonly raised by fs.readdir.</li>
<li>给定的路径不是目录</li>
</ul>
</li>
</ul>
<h4 id="同步文件操作-和-异步文件操作">同步文件操作 和 异步文件操作</h4>
<ul>
<li><code>fs.readFile(file[, options], callback)</code></li>
<li><code>fs.readFileSync(file[, options])</code></li>
</ul>
<h4 id="通过设置-http-响应报文头实现弹框下载功能">通过设置 http 响应报文头实现弹框下载功能</h4>
<ol>
<li>设置 <code>Content-Type: application/octet-stream</code> || <code>application/force-download</code></li>
<li>设置 <code>Content-Disposition: attachment; filename=demo.txt</code></li>
</ol>
<p>当浏览器在请求资源时，会通过http返回头中的content-type决定如何显示/处理将要加载的数据，如果这个类型浏览器能够支持阅览，浏览器就会直接展示该资源，比如png、jpeg、video等格式。在某些下载文件的场景中，服务端可能会返回文件流，并在返回头中带上Content-Type:application/octet-stream，告知浏览器这是一个字节流，浏览器处理字节流的默认方式就是下载。<br>
Application/octet-stream是应用程序文件的默认值。意思是未知的应用程序文件，浏览器一般不会自动执行或询问执行。浏览器会像对待，设置了HTTP头Content-Disposition值为attachment的文件一样来对待这类文件，即浏览器会触发下载行为。<br>
说人话就是，浏览器并不认得这是什么类型，也不知道应该如何展示，只知道这是一种二进制文件，因此遇到content-type为application/octet-stream的文件时，浏览器会直接把它下载下来。这个类型一般会配合另一个响应头Content-Disposition,该响应头指示回复的内容该以何种形式展示，是以内联的形式（即网页或者网页的一部分），还是以附件的形式下载并保存到本地。</p>
<h3 id="request对象-和-response对象">request对象 和 response对象</h3>
<h4 id="request-对象">request 对象</h4>
<ul>
<li>request 对象类型 &lt;http.IncomingMessage&gt;, 继承自stream.Readable</li>
<li>request 对象常用成员
<ul>
<li><code>request.headers</code></li>
<li><code>request.rawHeaders</code></li>
<li><code>request.httpVersion</code></li>
<li><code>request.method</code></li>
<li><code>request.url</code></li>
</ul>
</li>
</ul>
<h4 id="response-对象">response 对象</h4>
<ul>
<li>
<p>response 对象类型 &lt;http.ServerResponse&gt;</p>
</li>
<li>
<p>response 对象常用成员</p>
<ul>
<li>
<p><code>response.writeHead(statusCode[, statusMessage][, headers])</code></p>
<ol>
<li>This method must only be called once on a message and it must be called before response.end() is called.</li>
</ol>
<ul>
<li>这个方法在每次请求响应前都必须被调用（只能调用一次）。并且必须在end()方法调用前调用</li>
</ul>
<ol start="2">
<li>If you call response.write() or response.end() before calling this, the implicit/mutable headers will be calculated and call this function for you.</li>
</ol>
<ul>
<li>如果在调用writeHead()方法之前调用了write() 或 end()方法，系统会自动帮你调用writeHead()方法，并且会生成默认的响应头</li>
</ul>
<ol start="3">
<li>When headers have been set with response.setHeader(), they will be merged with any headers passed to response.writeHead(), with the headers passed to response.writeHead() given precedence.</li>
</ol>
<ul>
<li>如果通过 res.setHeader() 也设置了响应头，那么系统会将serHeader()设置的响应头和writeHead()设置的响应头合并。 并且writeHead()的设置优先</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 示例代码：</span></span><br><span class="line">res.<span class="title function_">writeHead</span>(<span class="number">200</span>, <span class="string">&#x27;OK&#x27;</span>, &#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Content-Length&#x27;</span>: <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(msg)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>response.write(chunk[, encoding][, callback])</code></p>
<ul>
<li>参数1：要写入的数据，可以是字符串或二进制数据，<strong>必填</strong>。</li>
<li>参数2：编码，默认是utf8，选填。</li>
<li>参数3：回调函数，选填。</li>
</ul>
</li>
<li>
<p><code>response.end([data][, encoding][, callback])</code></p>
<ul>
<li>结束响应。</li>
<li>This method signals to the server that all of the response headers and body have been sent; that server should consider this message complete. <em><strong>The method, <code>response.end()</code>, MUST be called on each response</strong></em>.</li>
</ul>
<ul>
<li>res.end()这个方法告诉服务器所有要发送的响应头和响应体都发送完毕了。可以人为这次响应结束了。</li>
<li>同时每次响应都必须调用该方法，用来结束响应</li>
</ul>
<ul>
<li>参数1：结束响应前要发送的数据，选填。</li>
<li>参数2：编码，选填。</li>
<li>参数3：回调函数，选填。</li>
</ul>
</li>
<li>
<p><code>response.setHeader(name, value)</code></p>
<ul>
<li>设置响应报文头</li>
</ul>
</li>
<li>
<p><code>response.statusCode</code></p>
<ul>
<li>设置或读取http响应码</li>
</ul>
</li>
<li>
<p><code>response.statusMessage</code></p>
<ul>
<li>设置或读取http响应状态消息</li>
</ul>
</li>
</ul>
<h3 id="npm-Node-Package-Manager-Node-包管理器">npm - Node Package Manager - Node 包管理器</h3>
<h4 id="npm-是什么？">npm 是什么？</h4>
<ul>
<li>npm（全称Node Package Manager，即node包管理器）是Node.js默认的、以JavaScript编写的软件包管理系统。</li>
<li><a href="https://www.npmjs.com/">npm 官方网站</a></li>
<li><a href="https://docs.npmjs.com/">npm 官方文档</a></li>
</ul>
<p><strong>一般当我们说npm的时候可能指3件事</strong></p>
<ol>
<li>NPM 网站：<a href="https://www.npmjs.com/">https://www.npmjs.com/</a></li>
<li>NPM 包管理库，存储了大量的JavaScript代码库</li>
<li>NPM 客户端，我们所使用的npm命令行工具。使用JavaScript开发的基于node.js的命令行工具，本身也是Node的一个包。</li>
</ol>
<p><strong>参考图片</strong></p>
<p><img data-src="npm.png" alt="NPM"></p>
<p><img data-src="npm1.png" alt="NPM"></p>
<h4 id="npm-官方解释：">npm 官方解释：</h4>
<ul>
<li>
<p>npm is the package manager for JavaScript and the world’s largest software registry.</p>
<ul>
<li>npm 是一个JavaScript包管理器，并且是世界上最大的软件登记处</li>
</ul>
</li>
<li>
<p>discover packages of reusable code — and assemble them in powerful new ways.</p>
<ul>
<li>发现可重用代码，并集成代码包到项目中的全新的、强大方式</li>
</ul>
</li>
<li>
<p>npm makes it easy for JavaScript developers to share and reuse code, and it makes it easy to update the code that you’re sharing.</p>
<ul>
<li>npm 让JavaScript开发者共享和重用代码变的更容易，同时也让我们更容易地更新正在被共享的代码</li>
</ul>
</li>
</ul>
<h4 id="npm与-node-js">npm与 node.js</h4>
<ul>
<li>npm是Node.js默认的软件包管理系统。安装完毕node后，会默认安装好npm</li>
<li>npm本身也是基于Node.js开发的包（软件）</li>
</ul>
<h4 id="如何安装-NPM">如何安装 NPM?</h4>
<ul>
<li>npm会随着Node.js自动安装，安装完毕node.js后会自动安装npm</li>
<li>查看当前npm版本：<code>npm -v</code></li>
<li>更新npm：<code>npm install npm@latest -g</code></li>
</ul>
<h4 id="npm-使用">npm 使用</h4>
<ol>
<li>在 <a href="https://www.npmjs.com/">https://www.npmjs.com/</a> 网站找到需要的包</li>
<li>在项目的根目录下，执行<code>npm install 包名称</code>安装</li>
<li>在node.js代码中通过 <code>require('包名');</code> 加载该模块</li>
<li>注意：通过<code>npm install 包名</code>安装的包，会自动下载到当前目录下的<code>node_modules</code>目录下，如果该目录不存在，则创建，如果已存在则直接下载进去。</li>
<li>在代码中通过 <code>require('包名');</code> 加载该模块</li>
</ol>
<p>----- 上面说的这种方式叫做 本地安装。</p>
<h4 id="npm-全局安装介绍">npm 全局安装介绍</h4>
<ol>
<li>什么是 npm 全局安装？
<ul>
<li><code>npm install 包名 -g</code> npm 全局安装指的是把包安装成了一个命令行工具。</li>
<li>全局安装只是为了可以当做命令行使用而已</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过npm全局安装mime</span></span><br><span class="line">npm install mime -g</span><br><span class="line"></span><br><span class="line"><span class="comment">//安装完毕后可以在命令行中直接使用</span></span><br><span class="line">mime a.<span class="property">txt</span> 命令来查看对应的结果</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>npm 全局安装实际做了2件事：
<ol>
<li>
<p>下载包到一个指定的目录<code>C:\Users\username\AppData\Roaming\npm\node_modules</code></p>
</li>
<li>
<p>创建一段命令行执行的代码。<code> C:\Users\username\AppData\Roaming\npm\mime -&gt; C:\Users\steve xiaohu zhao\AppData\Roaming\npm\node_modules\mime\cli.js</code></p>
</li>
</ol>
</li>
</ol>
<h4 id="npm常用命令介绍">npm常用命令介绍</h4>
<ol>
<li>install，安装包。<code>npm install 包名</code></li>
<li>uninstall，卸载包。npm uninstall 包名`</li>
<li>version，查看当前npm版本。<code>npm version</code> 或 <code>npm -v</code></li>
<li>init，创建一个package.json文件。<code>npm init</code></li>
<li>注意：当使用 <code>npm init -y</code>  的时候，如果当前文件夹（目录）的名字比较怪（有大写、有中文等等）就会影响npm init -y 的一步生成操作，此时需要 npm init 根据向导来生成</li>
</ol>
<h4 id="模块（Modules）和包（Packages）的区别">模块（Modules）和包（Packages）的区别</h4>
<ol>
<li>A <strong>module</strong> is any file or directory that can be loaded by Node.js’ <code>require()</code>.</li>
</ol>
<ul>
<li>模块可以是任何一个文件或目录（目录下可以有很多个文件），只要能被node.js通过require()即可。遵循common.js规范</li>
</ul>
<ol start="2">
<li>A <strong>package</strong> is a file or directory that is described by a <code>package.json</code>. This can happen in a bunch of different ways!</li>
</ol>
<ul>
<li>包是一个文件或目录（目录下可以有多个文件）必须有一个package.json文件来描述，就可以是一个包。</li>
</ul>
<h4 id="node-js-错误调试：">node.js 错误调试：</h4>
<ol>
<li>
<p>当开启服务后，在浏览器中输入地址，如果出现浏览问题，首先要先看 服务器控制台是否报错。如果报错，直接根据服务器报错进行排错。</p>
</li>
<li>
<p>打开浏览器开发者工具中的 “网络” 部分，查看请求是否成功发出去了</p>
</li>
</ol>
<ul>
<li>看一下请求报文是不是和我们想的一样</li>
<li>响应状态码</li>
</ul>
<h3 id="package-json-文件">package.json 文件</h3>
<h4 id="package-json-文件的作用？">package.json 文件的作用？</h4>
<ol>
<li>package.json 文件是一个包说明文件（项目描述文件），用来管理组织一个包（一个项目）</li>
<li>package.json 文件是一个 json 格式的文件</li>
<li>位于当前项目的根目录下</li>
</ol>
<p>元数据</p>
<h4 id="package-json-文件中常见的项有哪些？">package.json 文件中常见的项有哪些？</h4>
<ul>
<li>name
<ul>
<li>包的名字</li>
</ul>
</li>
<li>version
<ul>
<li>包的版本</li>
</ul>
</li>
<li>description
<ul>
<li>包描述</li>
</ul>
</li>
<li>author
<ul>
<li>包的作者</li>
</ul>
</li>
<li>main
<ul>
<li>包的入口js文件，从main字段这里指定的那个js文件开始执行</li>
</ul>
</li>
<li>dependencies
<ul>
<li>当前包依赖的其他包</li>
</ul>
</li>
</ul>
<h4 id="如何创建一个-package-json-文件">如何创建一个 package.json 文件</h4>
<ol>
<li>通过 <code>npm init</code> 命令 或者 <code>npm init -y</code> 或 <code>npm init -yes</code>  命令</li>
<li>手动创建一个</li>
</ol>
<p><strong>注意</strong></p>
<ol>
<li>通过 <code>npm init -y</code> 或 <code>npm init -yes</code> 创建 package.json 文件时，执行命令所在的目录接名称中不能包含大写字母</li>
<li>package.json 文件中，项目名称本身不能包含大写字母</li>
<li>npm 更新新版本后，项目所在的文件夹如果包含中文等特殊字符，创建的时候不会提示一步一步的输入，直接报错。</li>
</ol>
<h4 id="官方介绍">官方介绍</h4>
<ol>
<li><a href="https://docs.npmjs.com/files/package.json">package.json</a></li>
<li><a href="https://docs.npmjs.com/getting-started/using-a-package.json">Using a package.json</a></li>
</ol>
<h4 id="发布一个自己的npm包">发布一个自己的npm包</h4>
<p>1、注册</p>
<p>2、终端输入 <code>npm login</code>，再输入账号密码</p>
<p>​	- 注意一定要将镜像源切换为<code>npm官方地址</code></p>
<p>3、将终端切换到包的根目录之后，运行<code>npm publish</code> 命令，即可将包发布到npm上</p>
<p>​	- 注意: 包名不能雷同</p>
<p>4、运行npm unpublish 包名 --force命令，即可从npm 删除已发布的包。</p>
<ul>
<li>npm unpublish命令只能删除72小时以内发布的包</li>
<li>npm unpublish删除的包，在24小时内不允许重复发布</li>
</ul>
<h3 id="Buffer">Buffer</h3>
<p>思考：Buffer 类型产生的原因？主要用来解决什么问题？</p>
<p>看一下什么是 Buffer? 什么是 Stream?</p>
<p>一、类型介绍</p>
<ol>
<li>JavaScript 语言没有读取或操作二进制数据流的机制。</li>
<li>Node.js 中引入了 Buffer 类型使我们可以操作 TCP流 或 文件流。</li>
<li>Buffer 类型的对象类似于整数数组，但 Buffer 的大小是固定的、且在 V8 堆外分配物理内存。 Buffer 的大小在被创建时确定，且无法调整。（ buf.length 是固定的，不允许修改 ）</li>
<li>Buffer 是全局的，所以使用的时候无需 require() 的方式来加载</li>
</ol>
<p>二、如何创建一个 Buffer 对象</p>
<p>常见的 API 介绍</p>
<ol>
<li>创建一个 Buffer 对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. 通过 Buffer.from() 创建一个 Buffer 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.1 通过一个字节数组来创建一个 Buffer 对象</span></span><br><span class="line"><span class="keyword">var</span> array = [<span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x6c</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x20</span>, <span class="number">0xe4</span>, <span class="number">0xb8</span>, <span class="number">0x96</span>, <span class="number">0xe7</span>, <span class="number">0x95</span>, <span class="number">0x8c</span>];</span><br><span class="line"><span class="keyword">var</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(array);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.2 通过字符串来创建一个 Buffer 对象</span></span><br><span class="line"><span class="comment">// Buffer.from(string[, encoding])</span></span><br><span class="line"><span class="keyword">var</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;你好世界！ Hello World!~&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>拼接多个 Buffer 对象为一个对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Buffer.concat(list[, totalLength])</span></span><br><span class="line"><span class="keyword">var</span> bufferList = [];</span><br><span class="line"><span class="keyword">var</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(bufferList);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>获取字符串对应的字节个数</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Buffer.byteLength(string[, encoding])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> len = <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(<span class="string">&#x27;你好世界Hello&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(len);</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>判断一个对象是否是 Buffer 类型对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Buffer.isBuffer(obj)</span></span><br><span class="line"><span class="comment">// obj &lt;Object&gt;</span></span><br><span class="line"><span class="comment">// Returns: &lt;boolean&gt;</span></span><br><span class="line"><span class="comment">// Returns true if obj is a Buffer, false otherwise.</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>获取 Buffer 中的某个字节</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 根据索引获取 Buffer 中的某个字节（byte、octet）</span></span><br><span class="line"><span class="comment">// buf[index]</span></span><br></pre></td></tr></table></figure>
<p>6、获取 Buffer 对象中的字节的个数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// buf.length</span></span><br><span class="line"><span class="comment">// 注意：length 属性不可修改</span></span><br></pre></td></tr></table></figure>
<p>三、Buffer 对象与编码</p>
<p>Node.js 目前支持的编码如下：</p>
<ol>
<li>ascii</li>
<li>utf8</li>
<li>utf16le
<ul>
<li>ucs2 是 utf16le 的别名</li>
</ul>
</li>
<li>base64</li>
<li>latin1
<ul>
<li>binary 是 latin1 的别名</li>
</ul>
</li>
<li>hex
<ul>
<li>用两位 16 进制来表示每个字节</li>
</ul>
</li>
</ol>
<p>示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;你好世界，Hello World！&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>四、思考：为什么会有 Buffer 类型？</p>
<ol>
<li>Buffer 使用来临时存储一些数据（二进制数据）</li>
<li>当我们要把一大块数据从一个地方传输到另外一个地方的时候可以通过 Buffer 对象进行传输</li>
<li>通过 Buffer 每次可以传输小部分数据，直到所有数据都传输完毕。</li>
</ol>
<p>五、补充</p>
<ol>
<li>
<p>Stream</p>
</li>
<li>
<p>Writable Stream</p>
<ul>
<li>允许 node.js 写数据到流中</li>
</ul>
</li>
<li>
<p>Readable Stream</p>
<ul>
<li>允许 node.js 从流中读取数据</li>
</ul>
</li>
</ol>
<h3 id="node-js-模块">node.js 模块</h3>
<p>在 node.js 开发中一个文件就可以认为是一个模块。</p>
<p>require的加载过程是<strong>同步</strong>的，加载完上一个模块才能加载下一个模块，readFileSync</p>
<h4 id="node-js-模块分类">node.js 模块分类</h4>
<h5 id="核心模块（内置模块、原生模块）"><strong>核心模块（内置模块、原生模块）</strong></h5>
<ul>
<li>
<h6 id="fs">fs</h6>
</li>
<li>
<p>http</p>
</li>
<li>
<p>path</p>
</li>
<li>
<p>url</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p>所有内置模块在安装node.js的时候就已经编译成 二进制文件，可以直接加载运行（速度较快）<br>
部分内置模块，在 node.exe 这个进程启动的时候就已经默认加载了，所以可以直接使用。</p>
<h5 id="文件模块">文件模块</h5>
<p><strong>按文件后缀来分</strong></p>
<p>如果加载时，没有指定后缀名，那么就按照如下顺序依次加载相应模块</p>
<ol>
<li>.js</li>
<li>.json</li>
<li>.node（C/C++编写的模块）<br>
main:app.js =&gt; index.js =&gt; index.json =&gt; index.node<!-- require('./a') -->
<!-- require('http') lib node_modules -->
</li>
</ol>
<h5 id="自定义模块（第三方模块）">自定义模块（第三方模块）</h5>
<ul>
<li>mime</li>
<li>cheerio</li>
<li>moment</li>
<li>mongo</li>
<li>…</li>
</ul>
<h4 id="require-加载模块顺序">require 加载模块顺序</h4>
<ol>
<li>
<p>看 require() 加载模块时传入的参数是否以 ‘./’ 或 ‘…/’ 或 ‘/’ 等等这样的路径方式开头（相对路径或绝对路径都可以）</p>
</li>
<li>
<p>是，那么会按照传入的路径直接去查询对应的模块。</p>
</li>
</ol>
<ul>
<li>传入的是否为具体的文件名
<ul>
<li>
<p>require(‘./test.js’) 是具体的文件名</p>
<ul>
<li>直接根据给定的路径去加载模块，找到了加载成功，找不到加载失败</li>
</ul>
</li>
<li>
<p>require(‘./test’); 不是具体的文件名、</p>
<ul>
<li>第一步：根据给定的路径，依次添加文件后缀 .js、.json、.node进行匹配，如果找不到匹配执行第二步</li>
<li>第二步：查找是否有 test 目录（尝试找 test 包）
<ul>
<li>找不到：加载失败</li>
<li>找到了：依次在 test 目录下查找 package.json 文件（找到该文件后尝试找 main 字段中的入口文件）、index.js、index.json、index.node，找不到则加载失败</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li>不是，那么就认为传入的是 “模块名称”（比如：require(‘http’)、require(‘mime’)）</li>
</ol>
<ul>
<li>是核心模块：直接加载核心模块 lib</li>
<li>不是核心模块
<ul>
<li>依次递归查找 node_modules 目录中是否有相应的包
<ul>
<li>从当前目录开始，依次递归查找所有父目录下的 node_modules 目录中是否包含相应的包</li>
<li>如果查找完毕磁盘根目录依然没有则加载失败</li>
<li>打印输入 module.paths 查看</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">paths</span></span><br></pre></td></tr></table></figure>
<h4 id="require-加载模块注意点">require 加载模块注意点</h4>
<ol>
<li>
<p>所有模块第一次加载完毕后都会有 缓存，二次加载直接读取缓存，避免了二次开销</p>
<ul>
<li>因为有                                                                                                                                                                                                                                                                                                                      缓存，所以模块中的代码只在第一次加载的时候执行一次</li>
</ul>
</li>
<li>
<p>每次加载模块的时候都优先从缓存中加载，缓存中没有的情况下才会按照 node.js 加载模块的规则去查找</p>
</li>
<li>
<p>核心模块在 Node.js 源码编译的时候，都已经编译为二进制执行文件，所以加载速度较快（核心模块加载的优先级仅次于 缓存加载）</p>
</li>
<li>
<p>核心模块都保存在 lib 目录下</p>
</li>
<li>
<p>试图加载一个和 核心模块 同名的 自定义模块（第三方模块）是不会成功的</p>
<ul>
<li>自定义模块要么名字不要与核心模块同名</li>
<li>要么使用路径的方式加载 …/http</li>
</ul>
</li>
<li>
<p>核心模块 只能通过 模块名称 来加载（错误示例：require(‘./http’); 这样是无法加载 核心模块 http的 ）</p>
</li>
<li>
<p>require() 加载模块使用 ./ 相对路径时，相对路径是相对当前模块，不受执行 node 命令的路径影响</p>
</li>
<li>
<p>建议加载文件模块的时候始终添加文件后缀名，不要省略。</p>
</li>
</ol>
<h4 id="相关源码">相关源码</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 每一个 node.js 中被加载的模块其实最终都是 Module 的一个实例</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Module</span>(<span class="params">id, parent</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">exports</span> = &#123;&#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">parent</span> = parent;</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; parent.<span class="property">children</span>) &#123;</span><br><span class="line">    parent.<span class="property">children</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filename</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">loaded</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">children</span> = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. module.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Loads a module at the given file path. Returns that module&#x27;s</span></span><br><span class="line"><span class="comment">// `exports` property.</span></span><br><span class="line"><span class="comment">// 加载给定的模块，并返回该模块中 module.exports 中的值</span></span><br><span class="line"><span class="comment">// 之所以在每个模块中都能使用 require() 函数是因为 require 函数定义在了每个模块中</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">require</span> = <span class="keyword">function</span>(<span class="params">path</span>) &#123;</span><br><span class="line">  <span class="title function_">assert</span>(path, <span class="string">&#x27;missing path&#x27;</span>);</span><br><span class="line">  <span class="title function_">assert</span>(<span class="keyword">typeof</span> path === <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;path must be a string&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Module</span>.<span class="title function_">_load</span>(path, <span class="variable language_">this</span>, <span class="comment">/* isMain */</span> <span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. module.js</span></span><br><span class="line"><span class="comment">// Check the cache for the requested file.</span></span><br><span class="line"><span class="comment">// 1. If a module already exists in the cache: return its exports object.</span></span><br><span class="line"><span class="comment">// 2. If the module is native: call `NativeModule.require()` with the</span></span><br><span class="line"><span class="comment">//    filename and return the result.</span></span><br><span class="line"><span class="comment">// 3. Otherwise, create a new module for the file and save it to the cache.</span></span><br><span class="line"><span class="comment">//    Then have it load  the file contents before returning its exports</span></span><br><span class="line"><span class="comment">//    object.</span></span><br><span class="line"><span class="comment">// 该方法做了 5 件事：</span></span><br><span class="line"><span class="comment">// 1. 检查 Module._cache 中是否有缓存的模块实例</span></span><br><span class="line"><span class="comment">// 2. 如果缓存中没有，那么创建一个 Moudle 实例</span></span><br><span class="line"><span class="comment">// 3. 将创建的 Module 实例保存到缓存中，供下次使用。</span></span><br><span class="line"><span class="comment">// 4. 调用 module.load() 读取模块内容，然后调用 module.compile() 编译执行（封装成一个沙箱）该模块</span></span><br><span class="line"><span class="comment">//   - 如果加载解析出错，那么从缓存中删除该模块</span></span><br><span class="line"><span class="comment">// 5. 返回 module.exports </span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property">_load</span> = <span class="keyword">function</span>(<span class="params">request, parent, isMain</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">    <span class="title function_">debug</span>(<span class="string">&#x27;Module._load REQUEST %s parent: %s&#x27;</span>, request, parent.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解析文件名</span></span><br><span class="line">  <span class="keyword">var</span> filename = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(request, parent, isMain);</span><br><span class="line">  <span class="comment">// 根据文件名到Module._cache对象上找有没有值</span></span><br><span class="line">  <span class="keyword">var</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">  <span class="comment">// 如果有则导出</span></span><br><span class="line">  <span class="keyword">if</span> (cachedModule) &#123;</span><br><span class="line">    <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断核心模块中有没有该属性 有则加载</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">NativeModule</span>.<span class="title function_">nonInternalExists</span>(filename)) &#123;</span><br><span class="line">    <span class="title function_">debug</span>(<span class="string">&#x27;load native module %s&#x27;</span>, request);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">NativeModule</span>.<span class="built_in">require</span>(filename);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建一个模块（Module对象）</span></span><br><span class="line">  <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="keyword">new</span> <span class="title class_">Module</span>(filename, parent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isMain) &#123;</span><br><span class="line">    process.<span class="property">mainModule</span> = <span class="variable language_">module</span>;</span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">id</span> = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 缓存</span></span><br><span class="line">  <span class="title class_">Module</span>.<span class="property">_cache</span>[filename] = <span class="variable language_">module</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尝试加载模块</span></span><br><span class="line">  <span class="title function_">tryModuleLoad</span>(<span class="variable language_">module</span>, filename);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// !!!</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. module.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tryModuleLoad</span>(<span class="params"><span class="variable language_">module</span>, filename</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> threw = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 真正加载该模块</span></span><br><span class="line">    <span class="variable language_">module</span>.<span class="title function_">load</span>(filename);</span><br><span class="line">    threw = <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// finally: 不管try报错与否都要执行这里的代码</span></span><br><span class="line">    <span class="keyword">if</span> (threw) &#123;</span><br><span class="line">      <span class="comment">// 从缓存中删除该模块</span></span><br><span class="line">      <span class="keyword">delete</span> <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. module.js</span></span><br><span class="line"><span class="comment">// Given a file name, pass it to the proper extension handler.</span></span><br><span class="line"><span class="comment">// 该模块中对要加载的模块进行编译</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">load</span> = <span class="keyword">function</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">  <span class="title function_">debug</span>(<span class="string">&#x27;load %j for module %j&#x27;</span>, filename, <span class="variable language_">this</span>.<span class="property">id</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">assert</span>(!<span class="variable language_">this</span>.<span class="property">loaded</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">filename</span> = filename;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">paths</span> = <span class="title class_">Module</span>.<span class="title function_">_nodeModulePaths</span>(path.<span class="title function_">dirname</span>(filename));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 没有filename则默认是.js</span></span><br><span class="line">  <span class="keyword">var</span> extension = path.<span class="title function_">extname</span>(filename) || <span class="string">&#x27;.js&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title class_">Module</span>.<span class="property">_extensions</span>[extension]) extension = <span class="string">&#x27;.js&#x27;</span>;</span><br><span class="line">  <span class="title class_">Module</span>.<span class="property">_extensions</span>[extension](<span class="variable language_">this</span>, filename); <span class="comment">// 此行代码对被加载的模块实现了编译</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">loaded</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. module.js （编译）</span></span><br><span class="line"><span class="comment">// Native extension for .js</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property">_extensions</span>[<span class="string">&#x27;.js&#x27;</span>] = <span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, filename</span>) &#123;</span><br><span class="line">  <span class="comment">// 说明 require() 加载模块是同步执行的</span></span><br><span class="line">  <span class="keyword">var</span> content = fs.<span class="title function_">readFileSync</span>(filename, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="variable language_">module</span>.<span class="title function_">_compile</span>(internalModule.<span class="title function_">stripBOM</span>(content), filename);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. module.js</span></span><br><span class="line"><span class="comment">// Run the file contents in the correct scope or sandbox. Expose</span></span><br><span class="line"><span class="comment">// the correct helper variables (require, module, exports) to</span></span><br><span class="line"><span class="comment">// the file.</span></span><br><span class="line"><span class="comment">// Returns exception, if any.</span></span><br><span class="line"><span class="comment">// 编译（用一个沙箱来包装）执行该模块</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_compile</span> = <span class="keyword">function</span>(<span class="params">content, filename</span>) &#123;</span><br><span class="line">  <span class="comment">// Remove shebang</span></span><br><span class="line">  <span class="keyword">var</span> contLen = content.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (contLen &gt;= <span class="number">2</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (content.<span class="title function_">charCodeAt</span>(<span class="number">0</span>) === <span class="number">35</span><span class="comment">/*#*/</span> &amp;&amp;</span><br><span class="line">        content.<span class="title function_">charCodeAt</span>(<span class="number">1</span>) === <span class="number">33</span><span class="comment">/*!*/</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (contLen === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// Exact match</span></span><br><span class="line">        content = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Find end of shebang line and slice it off</span></span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; contLen; ++i) &#123;</span><br><span class="line">          <span class="keyword">var</span> code = content.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">          <span class="keyword">if</span> (code === <span class="number">10</span><span class="comment">/*\n*/</span> || code === <span class="number">13</span><span class="comment">/*\r*/</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i === contLen)</span><br><span class="line">          content = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// Note that this actually includes the newline character(s) in the</span></span><br><span class="line">          <span class="comment">// new output. This duplicates the behavior of the regular expression</span></span><br><span class="line">          <span class="comment">// that was previously used to replace the shebang line</span></span><br><span class="line">          content = content.<span class="title function_">slice</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create wrapper function</span></span><br><span class="line">  <span class="keyword">var</span> wrapper = <span class="title class_">Module</span>.<span class="title function_">wrap</span>(content);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行模块</span></span><br><span class="line">  <span class="keyword">var</span> compiledWrapper = vm.<span class="title function_">runInThisContext</span>(wrapper, &#123;</span><br><span class="line">    <span class="attr">filename</span>: filename,</span><br><span class="line">    <span class="attr">lineOffset</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">displayErrors</span>: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">_debugWaitConnect</span> &amp;&amp; process.<span class="property">_eval</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!resolvedArgv) &#123;</span><br><span class="line">      <span class="comment">// we enter the repl if we&#x27;re not given a filename argument.</span></span><br><span class="line">      <span class="keyword">if</span> (process.<span class="property">argv</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">        resolvedArgv = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(process.<span class="property">argv</span>[<span class="number">1</span>], <span class="literal">null</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolvedArgv = <span class="string">&#x27;repl&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set breakpoint on module start</span></span><br><span class="line">    <span class="keyword">if</span> (filename === resolvedArgv) &#123;</span><br><span class="line">      <span class="keyword">delete</span> process.<span class="property">_debugWaitConnect</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="title class_">Debug</span> = vm.<span class="title function_">runInDebugContext</span>(<span class="string">&#x27;Debug&#x27;</span>);</span><br><span class="line">      <span class="title class_">Debug</span>.<span class="title function_">setBreakPoint</span>(compiledWrapper, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> dirname = path.<span class="title function_">dirname</span>(filename);</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">require</span> = internalModule.<span class="property">makeRequireFunction</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">var</span> args = [<span class="variable language_">this</span>.<span class="property">exports</span>, <span class="built_in">require</span>, <span class="variable language_">this</span>, filename, dirname];</span><br><span class="line">  <span class="keyword">var</span> depth = internalModule.<span class="property">requireDepth</span>;</span><br><span class="line">  <span class="keyword">if</span> (depth === <span class="number">0</span>) stat.<span class="property">cache</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">var</span> result = compiledWrapper.<span class="title function_">apply</span>(<span class="variable language_">this</span>.<span class="property">exports</span>, args);</span><br><span class="line">  <span class="keyword">if</span> (depth === <span class="number">0</span>) stat.<span class="property">cache</span> = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="补充-CommonJS-规范">补充 CommonJS 规范</h4>
<ol>
<li>
<p><a href="http://www.commonjs.org/">CommonJS 规范</a></p>
</li>
<li>
<p><a href="http://www.commonjs.org/specs/modules/1.0/">模块的定义</a></p>
</li>
<li>
<p>总结：CommonJS 是为 JavaScript 语言制定的一种 模块规范、编程 API规范</p>
</li>
<li>
<p>node.js 遵循了 CommonJS规范</p>
</li>
<li>
<p>参考：<a href="https://www.cnblogs.com/littlebirdlbw/p/5670633.html">https://www.cnblogs.com/littlebirdlbw/p/5670633.html</a></p>
<p><a href="https://blog.csdn.net/u014262793/article/details/114554180">https://blog.csdn.net/u014262793/article/details/114554180</a></p>
</li>
</ol>
<h4 id="关于-node-js-中-Module-详细介绍">关于 node.js 中 Module 详细介绍</h4>
<ul>
<li><a href="https://nodejs.org/dist/latest-v6.x/docs/api/modules.html">Module</a></li>
</ul>
<h5 id=""></h5>
<h3 id="乱七八糟1">乱七八糟1</h3>
<h4 id="url">url</h4>
<h5 id="parse">parse</h5>
<p>url.parse(urlString[, parseQueryString[, slashesDenoteHost]])</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> urlString = <span class="string">&#x27;https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110&#x27;</span></span><br><span class="line"><span class="keyword">const</span> parsedStr = url.<span class="title function_">parse</span>(urlString)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(parsedStr)</span><br></pre></td></tr></table></figure>
<h5 id="format">format</h5>
<p>url.format(urlObject)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> urlObject = &#123;</span><br><span class="line">  <span class="attr">protocol</span>: <span class="string">&#x27;https:&#x27;</span>,</span><br><span class="line">  <span class="attr">slashes</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">auth</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;www.baidu.com:443&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="string">&#x27;443&#x27;</span>,</span><br><span class="line">  <span class="attr">hostname</span>: <span class="string">&#x27;www.baidu.com&#x27;</span>,</span><br><span class="line">  <span class="attr">hash</span>: <span class="string">&#x27;#tag=110&#x27;</span>,</span><br><span class="line">  <span class="attr">search</span>: <span class="string">&#x27;?id=8&amp;name=mouse&#x27;</span>,</span><br><span class="line">  <span class="attr">query</span>: &#123; <span class="attr">id</span>: <span class="string">&#x27;8&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;mouse&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">pathname</span>: <span class="string">&#x27;/ad/index.html&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/ad/index.html?id=8&amp;name=mouse&#x27;</span>,</span><br><span class="line">  <span class="attr">href</span>: <span class="string">&#x27;https://www.baidu.com:443/ad/index.html?id=8&amp;name=mouse#tag=110&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> parsedObj = url.<span class="title function_">format</span>(urlObject)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(parsedObj)</span><br></pre></td></tr></table></figure>
<h5 id="resolve">resolve</h5>
<p>url.resolve(from, to)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> a = url.<span class="title function_">resolve</span>(<span class="string">&#x27;/one/two/three&#x27;</span>, <span class="string">&#x27;four&#x27;</span>) </span><br><span class="line"><span class="keyword">var</span> b = url.<span class="title function_">resolve</span>(<span class="string">&#x27;http://example.com/two/three&#x27;</span>, <span class="string">&#x27;/one&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> c = url.<span class="title function_">resolve</span>(<span class="string">&#x27;/one/two/three&#x27;</span>, <span class="string">&#x27;../four&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c) </span><br></pre></td></tr></table></figure>
<h5 id="URLSearchParams">URLSearchParams</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const urlParams = new URLSearchParams(/* url中的search */)</span><br><span class="line">urlParams.get(/* 键 */)</span><br><span class="line">注: 浏览器中也有该方法</span><br></pre></td></tr></table></figure>
<h4 id="querystring">querystring</h4>
<h5 id="parse-2">parse</h5>
<p>querystring.parse(str[, sep[, eq[, options]]])</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> qs = <span class="string">&#x27;x=3&amp;y=4&#x27;</span></span><br><span class="line"><span class="keyword">var</span> parsed = querystring.<span class="title function_">parse</span>(qs)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(parsed)</span><br></pre></td></tr></table></figure>
<h5 id="stringify">stringify</h5>
<p>querystring.stringify(obj[, sep[, eq[, options]]])</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> qo = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">y</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> parsed = querystring.<span class="title function_">stringify</span>(qo)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(parsed)</span><br></pre></td></tr></table></figure>
<h5 id="escape-unescape">escape/unescape</h5>
<p>querystring.escape(str)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;id=3&amp;city=北京&amp;url=https://www.baidu.com&#x27;</span></span><br><span class="line"><span class="keyword">var</span> escaped = querystring.<span class="built_in">escape</span>(str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(escaped)</span><br></pre></td></tr></table></figure>
<p>querystring.unescape(str)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;id%3D3%26city%3D%E5%8C%97%E4%BA%AC%26url%3Dhttps%3A%2F%2Fwww.baidu.com&#x27;</span></span><br><span class="line"><span class="keyword">var</span> unescaped = querystring.<span class="built_in">unescape</span>(str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(unescaped)</span><br></pre></td></tr></table></figure>
<h4 id="http-https">http/https</h4>
<h5 id="get">get</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、接口 2、跨域</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> url = request.<span class="property">url</span>.<span class="title function_">substr</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  response.<span class="title function_">writeHeader</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  https.<span class="title function_">get</span>(<span class="string">`https://www.fastmock.site/mock/d4c75f77a8eef86dc58b3fced5bf604e/laoxu/api/getData`</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">      data += chunk</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      response.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">ret</span>: <span class="literal">true</span>,</span><br><span class="line">        data</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;localhost:8080&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="post：服务器提交（攻击）">post：服务器提交（攻击）</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postData = querystring.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;小锦儿&#x27;</span>,</span><br><span class="line">  <span class="attr">city</span>: <span class="string">&#x27;北京&#x27;</span>,</span><br><span class="line">  <span class="attr">desc</span>: <span class="string">&#x27;国服第一李白天花板&#x27;</span>,</span><br><span class="line">  <span class="attr">message</span>: <span class="string">&#x27;我的心可不冷&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;刺客&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">protocol</span>: <span class="string">&#x27;http:&#x27;</span>,</span><br><span class="line">  <span class="attr">hostname</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/data&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span>: <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(postData)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doPost</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> req = https.<span class="title function_">request</span>(options, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> data += chunk)</span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  req.<span class="title function_">write</span>(postData)</span><br><span class="line">  req.<span class="title function_">end</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   doPost()</span></span><br><span class="line"><span class="comment">// &#125;, 1000)</span></span><br></pre></td></tr></table></figure>
<h4 id="跨域方式">跨域方式</h4>
<h5 id="跨域：jsonp">跨域：jsonp</h5>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- jsonp原理: 动态创建script标签 设置其src 利用了script标签的src属性发起请求不受同源策略的限制的特点发起请求 script标签将追加到页面 </span></span><br><span class="line"><span class="comment">  如果希望能够自定义函数调用的名字 需要给后端传递一个标识 后端会获取到该标识的值作为返回的函数调用的名字 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- jsonp的缺点 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 1、只支持get请求 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 2、不安全 后端可能返回一段攻击脚本 --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- jsonp的封装 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; url, data, dataType, jsonp, jsonpCallback &#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 返回一个promise对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 启用jsonp的判断</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (dataType == <span class="string">&#x27;jsonp&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 设置 = 左边的键</span></span></span><br><span class="line"><span class="language-javascript">          jsonp = jsonp || <span class="string">&#x27;callback&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 设置 = 右边的值 (后端返回的函数调用的名字)</span></span></span><br><span class="line"><span class="language-javascript">          jsonpCallback = jsonpCallback || <span class="string">&#x27;jQuery&#x27;</span> + (<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span> + <span class="string">&#x27;&#x27;</span>).<span class="title function_">substring</span>(<span class="number">2</span>) + <span class="string">&#x27;_&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 声明一个和传递给后端的函数调用名字一样的函数 </span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 为了方便返回的函数调用能够在任意位置调用到该函数</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 我们将其挂载到全局</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">window</span>[jsonpCallback] = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 自己删除自己</span></span></span><br><span class="line"><span class="language-javascript">            script.<span class="title function_">remove</span>()</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 父级删除</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// document.body.removeChild(script)</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">resolve</span>(data)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// function sayHi(data)&#123;console.log(data)&#125;</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// sayHi(&#123;q: &quot;j&quot;, p: false,…&#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 处理data  &#123;wd:&#x27;j&#x27;&#125; =&gt; wd=j&amp;kw=q</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> arr = []</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// [&#x27;wd=j&#x27;, &#x27;kw=q&#x27;]</span></span></span><br><span class="line"><span class="language-javascript">            arr.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;data[key]&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          arr = arr.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>) <span class="comment">// wd=j&amp;kw=q</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 动态创建script标签</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 设置src属性</span></span></span><br><span class="line"><span class="language-javascript">          script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;jsonp&#125;</span>=<span class="subst">$&#123;jsonpCallback&#125;</span>&amp;<span class="subst">$&#123;arr&#125;</span>&amp;_=<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 追加到页面</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 最终的请求的url如下:</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&amp;callback=jQuery452802181544814_1666055167286&amp;wd=j&amp;_=1666055167286</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 请求百度接口</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ajax(&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   url: &#x27;https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   data: &#123; wd: &#x27;j&#x27; &#125;,</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   dataType: &#x27;jsonp&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   jsonp: &#x27;cb&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   jsonpCallback: &#x27;sayHi&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;).then((data)=&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   console.log(data)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 请求自己的后端接口</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/search&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123; <span class="attr">wd</span>: <span class="string">&#x27;j&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dataType</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">jsonp</span>: <span class="string">&#x27;cb&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">jsonpCallback</span>: <span class="string">&#x27;sayHi&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- jQuery的jsonp实现跨域 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;script&gt;</span></span><br><span class="line"><span class="comment">    $.ajax(&#123;</span></span><br><span class="line"><span class="comment">      url: &#x27;https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&#x27;,</span></span><br><span class="line"><span class="comment">      method: &#x27;get&#x27;,</span></span><br><span class="line"><span class="comment">      data: &#123;wd: &#x27;j&#x27;&#125;,</span></span><br><span class="line"><span class="comment">      // 启用jsonp</span></span><br><span class="line"><span class="comment">      dataType: &#x27;jsonp&#x27;,</span></span><br><span class="line"><span class="comment">      // = 左边的键</span></span><br><span class="line"><span class="comment">      jsonp: &#x27;cb&#x27;,</span></span><br><span class="line"><span class="comment">      // = 右边的值(函数调用的名字)</span></span><br><span class="line"><span class="comment">      jsonpCallback: &#x27;sayHi&#x27;,</span></span><br><span class="line"><span class="comment">      // success: (res)=&gt; &#123;</span></span><br><span class="line"><span class="comment">      //   console.log(res);</span></span><br><span class="line"><span class="comment">      // &#125;</span></span><br><span class="line"><span class="comment">    &#125;).then((res)=&gt; &#123;</span></span><br><span class="line"><span class="comment">      console.log(res)</span></span><br><span class="line"><span class="comment">    &#125;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // jQuery默认生成的 = 左右两边的键值对</span></span><br><span class="line"><span class="comment">    // https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&amp;callback=jQuery36102849457457737017_1666053704489&amp;wd=j&amp;_=1666053704490</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 指定jQuery生成的 = 左右两边的键值对</span></span><br><span class="line"><span class="comment">    // https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&amp;cb=sayHi&amp;wd=j&amp;_=1666053818124</span></span><br><span class="line"><span class="comment">  &lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 百度的做法 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;script&gt;</span></span><br><span class="line"><span class="comment">    function sayHi(data) &#123;</span></span><br><span class="line"><span class="comment">      console.log(data);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;script src=&quot;https://www.baidu.com/sugrec?prod=pc&amp;from=pc_web&amp;wd=j&amp;cb=sayHi&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 上面请求得到的结果如下:  --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 传递了一个cb字段 后端会获取到其对应的值作为返回的函数调用名字 所以我们只需要在当前页面上声明一个和cb字段值一样的函数 返回的函数调用就可以调用到该函数 从而通过参数将数据传递进去 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script&gt;</span></span><br><span class="line"><span class="comment">    sayHi(&#123; &quot;q&quot;: &quot;j&quot;, &quot;p&quot;: false, &quot;g&quot;: [&#123; &quot;type&quot;: &quot;sug&quot;, &quot;sa&quot;: &quot;s_1&quot;, &quot;q&quot;: &quot;聚焦二十大&quot; &#125;, &#123; &quot;type&quot;: &quot;sug&quot;, &quot;sa&quot;: &quot;s_2&quot;, &quot;q&quot;: &quot;剑来&quot; &#125;] &#125;) &lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- jQuery110206832760878043005_1665989839042(&#123;&quot;q&quot;:&quot;j&quot;,&quot;p&quot;:false,&quot;g&quot;:[&#123;&quot;type&quot;:&quot;sug&quot;,&quot;sa&quot;:&quot;s_1&quot;,&quot;q&quot;:&quot;聚焦二十大&quot;&#125;) --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="跨域：CORS">跨域：CORS</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// console.log(req.headers.cookie)</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">headers</span>)</span><br><span class="line">  <span class="comment">// 访问源: http://127.0.0.1:5500</span></span><br><span class="line">  <span class="keyword">let</span> origin = req.<span class="property">headers</span>.<span class="property">origin</span></span><br><span class="line">  <span class="comment">// 白名单</span></span><br><span class="line">  <span class="keyword">let</span> whiteList = [<span class="string">&#x27;http://127.0.0.1:5500&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:3500&#x27;</span>]</span><br><span class="line">  <span class="comment">// 能进判断则证明是我白名单中的源</span></span><br><span class="line">  <span class="keyword">if</span>(whiteList.<span class="title function_">includes</span>(origin))&#123;</span><br><span class="line">    <span class="comment">// 允许所有源访问</span></span><br><span class="line">    <span class="comment">// res.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;)</span></span><br><span class="line">    <span class="comment">// 允许指定源访问</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, origin)</span><br><span class="line">    <span class="comment">// 设置允许哪个头(自定义)访问 多个使用 , 隔开</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;myheader&#x27;</span>)</span><br><span class="line">    <span class="comment">// 设置允许哪种方式访问</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT,DELETE&#x27;</span>)</span><br><span class="line">    <span class="comment">// 设置预检的有效期</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="comment">// 允许客户端携带凭证</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// 告诉客户端 设置的header是可以使用的</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span>, <span class="string">&#x27;serverHeader&#x27;</span>)</span><br><span class="line">    <span class="comment">// 服务器给客户端响应自定义的头</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;serverHeader&#x27;</span>, <span class="string">&#x27;333333&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;1111&#x27;</span>)</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3000启动&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置允许访问的源 *表示所有源都能访问</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"><span class="comment">// 设置允许指定的源访问 </span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, origin)</span><br><span class="line"><span class="comment">// 设置允许哪个头访问</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="comment">// 设置允许哪种方式访问</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>)</span><br><span class="line"><span class="comment">// 设置预检的有效期</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 允许客户端携带凭证</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// 告诉客户端 设置的header是可以使用的</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span>, <span class="string">&#x27;mycookie,mycookie2&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;put&#x27;</span>,<span class="string">&#x27;http://127.0.0.1:3000&#x27;</span>, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 携带自定义的头</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// xhr.setRequestHeader(&#x27;myheader&#x27;, &#x27;11111&#x27;)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置cookie</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&#x27;stuId=6666666&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// xhr.cookie = &#x27;6666666&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 允许携带凭证 =&gt; cookie</span></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">withCredentials</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="title function_">getResponseHeader</span>(<span class="string">&#x27;serverHeader&#x27;</span>))</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="跨域：middleware（http-proxy-middware）">跨域：middleware（http-proxy-middware）</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> url = req.<span class="property">url</span></span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^\/api/</span>.<span class="title function_">test</span>(url)) &#123;</span><br><span class="line">    <span class="keyword">let</span> apiProxy = <span class="title function_">createProxyMiddleware</span>(<span class="string">&#x27;/api&#x27;</span>, &#123; </span><br><span class="line">      <span class="comment">// https://api.it120.cc/fyy/shop/goods/list</span></span><br><span class="line">      <span class="attr">target</span>: <span class="string">&#x27;https://api.it120.cc&#x27;</span>,</span><br><span class="line">      <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http-proy-middleware 在Node.js中使用的方法</span></span><br><span class="line">    <span class="title function_">apiProxy</span>(req, res)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (url) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;/index.html&#x27;</span>:</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;/search.html&#x27;</span>:</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;search.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;[404]page not found.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// https://api.it120.cc/fyy/shop/goods/list</span></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>,<span class="string">&#x27;http://localhost:3000/api/fyy/shop/goods/list&#x27;</span>, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="爬虫">爬虫</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">&#x27;https&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> iconv = <span class="built_in">require</span>(<span class="string">&#x27;iconv-lite&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>)</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">protocol</span>: <span class="string">&#x27;https:&#x27;</span>,</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&#x27;meizu.com&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">443</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> req = https.<span class="title function_">request</span>(options, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">      data += chunk</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">filterData</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">filterData</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="comment">// 转码</span></span><br><span class="line">    data = iconv.<span class="title function_">decode</span>(data, <span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> $ = cheerio.<span class="title function_">load</span>(data)</span><br><span class="line">    <span class="keyword">let</span> $movieList = $(<span class="string">&#x27;.movie-item&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> movies = []</span><br><span class="line">    $movieList.<span class="title function_">each</span>(<span class="function">(<span class="params">index, value</span>) =&gt;</span> &#123;</span><br><span class="line">      movies.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: $(value).<span class="title function_">find</span>(<span class="string">&#x27;.movie-title&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;title&#x27;</span>),</span><br><span class="line">        <span class="attr">score</span>: $(value).<span class="title function_">find</span>(<span class="string">&#x27;.movie-score i&#x27;</span>).<span class="title function_">text</span>(),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    response.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(movies))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  req.<span class="title function_">end</span>()</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">9000</span>)</span><br></pre></td></tr></table></figure>
<h3 id="乱七八糟2">乱七八糟2</h3>
<h4 id="Events">Events</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EventEmitter</span> = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyEventEmitter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">EventEmitter</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> event = <span class="keyword">new</span> <span class="title class_">MyEventEmitter</span>()</span><br><span class="line"></span><br><span class="line">event.<span class="title function_">on</span>(<span class="string">&#x27;play&#x27;</span>, <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(movie)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">event.<span class="title function_">emit</span>(<span class="string">&#x27;play&#x27;</span>, <span class="string">&#x27;萨瓦迪卡&#x27;</span>)</span><br><span class="line">event.<span class="title function_">emit</span>(<span class="string">&#x27;play&#x27;</span>, <span class="string">&#x27;撒由那拉&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="File-System">File System</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fsP = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">promises</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建文件夹</span></span><br><span class="line">fs.<span class="title function_">mkdir</span>(<span class="string">&#x27;./logs&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件夹改名</span></span><br><span class="line">fs.<span class="title function_">rename</span>(<span class="string">&#x27;./logs&#x27;</span>, <span class="string">&#x27;./log&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文件夹</span></span><br><span class="line">fs.<span class="title function_">rmdir</span>(<span class="string">&#x27;./log&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写内容到文件里</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(</span><br><span class="line">  <span class="string">&#x27;./logs/log1.txt&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  <span class="comment">// 错误优先的回调函数</span></span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件创建成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给文件追加内容</span></span><br><span class="line">fs.<span class="title function_">appendFile</span>(<span class="string">&#x27;./logs/log1.txt&#x27;</span>, <span class="string">&#x27;\nworld&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./logs/log1.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// fsPromises</span></span><br><span class="line">fs.<span class="property">promises</span>.<span class="title function_">readFile</span>(<span class="string">&quot;./a.txt&quot;</span>) </span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) &#123; </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result); </span><br><span class="line">&#125;) </span><br><span class="line">.<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">error</span>) &#123; </span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(error); </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// async 改造</span></span><br><span class="line"><span class="keyword">const</span> fsP = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">promises</span></span><br><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> fsP.<span class="title function_">readFile</span>(<span class="string">&#x27;./04-demo.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文件</span></span><br><span class="line">fs.<span class="title function_">unlink</span>(<span class="string">&#x27;./logs/log1.txt&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 批量写文件</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  fs.<span class="title function_">writeFile</span>(<span class="string">`./logs/log-<span class="subst">$&#123;i&#125;</span>.txt`</span>, <span class="string">`log-<span class="subst">$&#123;i&#125;</span>`</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done.&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件/目录信息</span></span><br><span class="line">fs.<span class="title function_">readdir</span>(<span class="string">&#x27;./&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">stat</span>(<span class="string">`./<span class="subst">$&#123;value&#125;</span>`</span>, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(value + &#x27;:&#x27; + stats.size)</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(value + <span class="string">&#x27; is &#x27;</span> + (stats.<span class="title function_">isDirectory</span>() ? <span class="string">&#x27;directory&#x27;</span> : <span class="string">&#x27;file&#x27;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归读取</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myReadDir</span>(<span class="params">path</span>)&#123;</span><br><span class="line">  fs.<span class="title function_">readdir</span>(path, <span class="function">(<span class="params">err, data</span>)=&gt;</span> &#123;</span><br><span class="line">    data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ./logs/aaa  ./logs/aaa/aaa.txt</span></span><br><span class="line">      fs.<span class="title function_">stat</span>(<span class="string">`<span class="subst">$&#123;path&#125;</span>/<span class="subst">$&#123;item&#125;</span>`</span>, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果是目录</span></span><br><span class="line">        <span class="keyword">if</span>(stats.<span class="title function_">isDirectory</span>())&#123;</span><br><span class="line">          <span class="comment">// 递归 ./logs/aaa</span></span><br><span class="line">          <span class="title function_">myReadDir</span>(<span class="string">`<span class="subst">$&#123;path&#125;</span>/<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 读取文件</span></span><br><span class="line">          fs.<span class="title function_">readFile</span>(<span class="string">`<span class="subst">$&#123;path&#125;</span>/<span class="subst">$&#123;item&#125;</span>`</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">myReadDir</span>(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读取文件</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./logs/log-1.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件：方法一</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./logs/log-0.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, content</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件：方法二</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./logs/log-0.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件：方法三</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./logs/log-0.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> <span class="title function_">getFile</span>())</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取文件：方法四</span></span><br><span class="line"><span class="keyword">const</span> fsp = fsP.<span class="title function_">readFile</span>(<span class="string">&#x27;./logs/log-1.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fsP)</span><br><span class="line"></span><br><span class="line"><span class="comment">// watch 监测文件变化</span></span><br><span class="line">fs.<span class="title function_">watch</span>(<span class="string">&#x27;./logs/log-0.txt&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件有变化&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Stream">Stream</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">为什么要需要流?</span><br><span class="line">因为在node中读取文件的方式有两种，一个是利用fs模块，一个是利用流来读取。如果读取小文件，我们可以使用fs读取，fs读取文件的时候，是将文件一次性读取到本地内存。而如果读取一个大文件，一次性读取会占用大量内存，效率很低，这个时候需要用流来读取。流是将数据分割成段，一段一段的读取，可以控制速率,效率很高,不会占用太大的内存。gulp的task任务，文件压缩，和http中的请求和响应等功能的实现都是基于流来实现的。因此，系统学习下流还是很有必要的</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">// 可写流</span></span><br><span class="line"><span class="keyword">const</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;./data.txt&#x27;</span>)</span><br><span class="line"><span class="comment">// on: 为对象绑定一个事件</span></span><br><span class="line"><span class="comment">// once: 绑定一个一次性的事件处理函数 该事件会在触发一次后自动失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听可写流的开启</span></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可写流开启了 开始写入数据&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 监听可写流的关闭</span></span><br><span class="line">ws.<span class="title function_">once</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可写流关闭了 无法写入数据&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;今天周一 好happy&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;今天周二 有点happy&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;今天周三 不开森&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;今天周四 很难过&#x27;</span>)</span><br><span class="line">ws.<span class="title function_">write</span>(<span class="string">&#x27;今天周五 崩溃了&#x27;</span>)</span><br><span class="line"><span class="comment">// 关闭可写流</span></span><br><span class="line"><span class="comment">// &#x27;close&#x27; 事件触发后，该流将不会再触发任何事件。</span></span><br><span class="line">ws.<span class="title function_">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可读流</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">const</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;./任文平.mp4&#x27;</span>)</span><br><span class="line">rs.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可读流开启 开始读数据 ...&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">rs.<span class="title function_">once</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">()=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;可读流关闭 停止读数据 ...&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 不要用once监听 因为数据比较大一次性是读不完的</span></span><br><span class="line"><span class="comment">// 因为读取是每次读取一部分 所以监听data事件 rs会自动读取</span></span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chunk)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(chunk.<span class="property">length</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="复制案例">复制案例</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;./任文平.mp4&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;./任我行.mp4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将可读流可写流建立通道</span></span><br><span class="line">rs.<span class="title function_">pipe</span>(ws)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ws.once(&#x27;open&#x27;, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;可写流开启了 可以开始写入数据&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// // 监听可写流的关闭</span></span><br><span class="line"><span class="comment">// ws.once(&#x27;close&#x27;, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;可写流关闭了 无法写入数据&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rs.on(&#x27;open&#x27;, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;可读流开启 ~&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rs.on(&#x27;data&#x27;, (chunk) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;开始读数据 ...&#x27;)</span></span><br><span class="line"><span class="comment">//   ws.write(chunk)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rs.on(&#x27;close&#x27;, ()=&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;可读流关闭 ~&#x27;);</span></span><br><span class="line"><span class="comment">//   // &#x27;end&#x27; 事件将在流中再没有数据可供消费时触发</span></span><br><span class="line"><span class="comment">//   ws.end()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>
<h4 id="Zlib">Zlib</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> gzip = zlib.<span class="title function_">createGzip</span>()</span><br><span class="line"><span class="keyword">const</span> readstream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;./logs/Buffer.png&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> writestream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;./log.png.zip&#x27;</span>)</span><br><span class="line">readstream</span><br><span class="line">  .<span class="title function_">pipe</span>(gzip)</span><br><span class="line">  .<span class="title function_">pipe</span>(writestream)</span><br><span class="line"></span><br><span class="line">参考网址: <span class="attr">https</span>:<span class="comment">//segmentfault.com/q/1010000004256619</span></span><br></pre></td></tr></table></figure>
<h4 id="ReadLine">ReadLine</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">&#x27;readline&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.<span class="title function_">createInterface</span>(&#123;</span><br><span class="line">  <span class="attr">input</span>: process.<span class="property">stdin</span>,</span><br><span class="line">  <span class="attr">output</span>: process.<span class="property">stdout</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">rl.<span class="title function_">question</span>(<span class="string">&#x27;What do you think of Node.js? &#x27;</span>, <span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Log the answer in a database</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Thank you for your valuable feedback: <span class="subst">$&#123;answer&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  rl.<span class="title function_">close</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="Crypto">Crypto</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secret = <span class="string">&#x27;abcdefg&#x27;</span></span><br><span class="line"><span class="keyword">const</span> hash = crypto.<span class="title function_">createHmac</span>(<span class="string">&#x27;sha256&#x27;</span>, secret)</span><br><span class="line">                   .<span class="title function_">update</span>(<span class="string">&#x27;I love you&#x27;</span>)</span><br><span class="line">                   .<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hash)</span><br></pre></td></tr></table></figure>
<h4 id="路由">路由</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>( <span class="keyword">function</span> (<span class="params"> req, res </span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( req.<span class="property">url</span> ) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/home&#x27;</span>:</span><br><span class="line">      res.<span class="title function_">write</span>(<span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">      res.<span class="title function_">end</span>()</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/mine&#x27;</span>:</span><br><span class="line">      res.<span class="title function_">write</span>(<span class="string">&#x27;mine&#x27;</span>)</span><br><span class="line">      res.<span class="title function_">end</span>()</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/login&#x27;</span>: </span><br><span class="line">      fs.<span class="title function_">readFile</span>( <span class="string">&#x27;./static/login.html&#x27;</span>,<span class="keyword">function</span> (<span class="params"> error , data </span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( error ) <span class="keyword">throw</span> error  </span><br><span class="line">        res.<span class="title function_">write</span>( data )</span><br><span class="line">        res.<span class="title function_">end</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/fulian.jpg&#x27;</span>:</span><br><span class="line">      fs.<span class="title function_">readFile</span>( <span class="string">&#x27;./static/fulian.jpg&#x27;</span>, <span class="string">&#x27;binary&#x27;</span>, <span class="keyword">function</span>(<span class="params"> error , data </span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>( error ) <span class="keyword">throw</span> error </span><br><span class="line">        res.<span class="title function_">write</span>( data, <span class="string">&#x27;binary&#x27;</span> )</span><br><span class="line">        res.<span class="title function_">end</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>: </span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"> &#125;).<span class="title function_">listen</span>( <span class="number">8000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&#x27;服务器运行在： http://localhost:8000&#x27;</span> )</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="静态资源服务">静态资源服务</h4>
<h5 id="readStaticFile">readStaticFile</h5>
<p>/modules/readStaticFile.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入依赖的模块</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> mime = <span class="built_in">require</span>(<span class="string">&#x27;mime&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readStaticFile</span>(<span class="params">res, filePathname</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ext = path.<span class="title function_">parse</span>(filePathname).<span class="property">ext</span></span><br><span class="line">  <span class="keyword">var</span> mimeType = mime.<span class="title function_">getType</span>(ext)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断路径是否有后缀, 有的话则说明客户端要请求的是一个文件 </span></span><br><span class="line">  <span class="keyword">if</span> (ext) &#123;</span><br><span class="line">    <span class="comment">// 根据传入的目标文件路径来读取对应文件</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(filePathname, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 错误处理</span></span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span> &#125;)</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&quot;404 - NOT FOUND&quot;</span>)</span><br><span class="line">        res.<span class="title function_">end</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&quot;Content-Type&quot;</span>: mimeType &#125;)</span><br><span class="line">        res.<span class="title function_">write</span>(data)</span><br><span class="line">        res.<span class="title function_">end</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 返回 true 表示, 客户端想要的 是 静态文件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 返回 false 表示, 客户端想要的 不是 静态文件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出函数</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = readStaticFile</span><br></pre></td></tr></table></figure>
<h5 id="server">server</h5>
<p>/server.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入相关模块</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> readStaticFile = <span class="built_in">require</span>(<span class="string">&#x27;./modules/readStaticFile&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搭建 HTTP 服务器</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> urlObj = url.<span class="title function_">parse</span>(req.<span class="property">url</span>);</span><br><span class="line">  <span class="keyword">var</span> urlPathname = urlObj.<span class="property">pathname</span>;</span><br><span class="line">  <span class="keyword">var</span> filePathname = path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;/public&quot;</span>, urlPathname);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取静态文件</span></span><br><span class="line">  <span class="title function_">readStaticFile</span>(res, filePathname);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 3000 端口监听请求</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器运行中.&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 3000 端口:&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="nodejs常用模块"><a href="https://github.com/sindresorhus/awesome-nodejs">nodejs常用模块</a></h4>
<h3 id="nodejs暂告一段落">nodejs暂告一段落</h3>
<p>express相关资料</p>
<p>在这懒得迁移了：<a href="https://www.yuque.com/laoxuyyds/co4f2q">https://www.yuque.com/laoxuyyds/co4f2q</a></p>
]]></content>
      <categories>
        <category>nodejs</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>javascript</title>
    <url>/blog/2023/08/09/javascript/</url>
    <content><![CDATA[<h3 id="基础">基础</h3>
<h4 id="数据类型">数据类型</h4>
<h5 id="基本数据类型">基本数据类型</h5>
<p>js有<strong>五种</strong>基本数据类型： <strong>Undefined、Null、Boolean、Number、String</strong></p>
<p>es6新增了<strong>一种</strong>基本数据类型：<strong>Symbol</strong></p>
<p>es11新增了<strong>一种</strong>基本数据类型：<strong>bigInt</strong></p>
<span id="more"></span>
<h6 id="Number">Number</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">NaN</span>是number的特殊类型</span><br><span class="line"><span class="title class_">NaN</span> =&gt; not a number =&gt; 不是一个数字</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">NaN</span>)</span><br><span class="line"></span><br><span class="line">* <span class="title class_">NaN</span>和任何数都不相等包括它本身</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> == <span class="title class_">NaN</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> == <span class="literal">undefined</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> == <span class="literal">null</span>)</span><br></pre></td></tr></table></figure>
<h6 id="bigInt">bigInt</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">bigInt表示一个任意精度的整数，可以表示超长数据，可以超出<span class="number">2</span>的<span class="number">53</span>次方。</span><br><span class="line"><span class="title class_">Js</span> 中 <span class="title class_">Number</span>类型只能安全的表示-(<span class="number">2</span>^<span class="number">53</span>-<span class="number">1</span>)至 <span class="number">2</span>^<span class="number">53</span>-<span class="number">1</span> 范的值</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>**<span class="number">53</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span>) <span class="comment">// 最大值-1</span></span><br><span class="line"></span><br><span class="line">- 使用 <span class="title class_">BigInt</span> 有两种方式</span><br><span class="line">方式一: 数字后面增加n</span><br><span class="line"><span class="keyword">const</span> bigInt = <span class="number">9007199254740993n</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> bigInt) <span class="comment">// bigint</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1n</span> == <span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1n</span> === <span class="number">1</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">方式二: 使用 <span class="title class_">BigInt</span> 函数</span><br><span class="line"><span class="keyword">const</span> bigIntNum = <span class="title class_">BigInt</span>(<span class="number">9007199254740993</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigIntNum)</span><br></pre></td></tr></table></figure>
<h6 id="undefined">undefined</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">出现<span class="literal">undefined</span>的情况</span><br><span class="line">- 已声明但未被初始化的变量默认赋值<span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> a; <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">- 未被声明的变量使用<span class="keyword">typeof</span>操作符检测数据类型时返回<span class="literal">undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> a)</span><br><span class="line">- 当函数没有明确指定返回值时，默认返回<span class="literal">undefined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>)&#125;; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn</span>())</span><br><span class="line">- 调用函数时，应该提供的参数没有提供，该参数等于<span class="literal">undefined</span>。</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">x</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(x)&#125;; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn</span>())</span><br><span class="line">- 对象没有赋值的属性，该属性的值为<span class="literal">undefined</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;; obj.<span class="property">sex</span></span><br><span class="line"></span><br><span class="line">* <span class="literal">undefined</span>和<span class="literal">null</span>相等 除了这种情况以外 剩下的<span class="literal">null</span>/<span class="literal">undefined</span>和其它任何数据类型都不相等 除了它本身</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> == <span class="literal">null</span>)</span><br><span class="line">比较数据类型 两边类型不一致</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> === <span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure>
<h6 id="null">null</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="literal">null</span>是js的关键字,表示空值</span><br><span class="line"><span class="literal">null</span>是<span class="title class_">Object</span>的一个特殊值,本质上是一个空的对象</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">null</span>); <span class="comment">// =&gt; &#x27;object&#x27;</span></span><br><span class="line"></span><br><span class="line">产生<span class="literal">null</span>的情况</span><br><span class="line"><span class="number">1</span>、访问不存在的dom元素</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>))</span><br><span class="line"><span class="number">2</span>、<span class="title class_">Object</span>的原型链终点</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>)</span><br><span class="line"></span><br><span class="line">- 小知识: 为什么是typoef <span class="literal">null</span>为object？</span><br><span class="line">原理是这样的: 不同的对象在底层都表示为二进制,在 <span class="title class_">JavaScript</span> 中二进制前三位都为 <span class="number">0</span> 的话会被判断为 object 类型, <span class="literal">null</span>的二进制表示是全<span class="number">0</span>,自然前三位也是<span class="number">0</span>,所以执行 <span class="keyword">typeof</span> 时会返回<span class="string">&quot;object&quot;</span>。</span><br><span class="line">所以这是早期<span class="variable constant_">JS</span>实现中的一个错误, 其实从<span class="title class_">ES5</span>制定开始就有动议将<span class="keyword">typeof</span> <span class="literal">null</span>改为返回<span class="string">&quot;null&quot;</span>,只是因为要保持语言的兼容性而维持至今。</span><br><span class="line"></span><br><span class="line">- <span class="literal">null</span>应用场景</span><br><span class="line">当需要释放一个对象的时候可以将该对象赋值为<span class="literal">null</span>，进而来释放对象</span><br><span class="line">堆内存没有被外界引用的时候 就会被释放</span><br><span class="line"><span class="keyword">let</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>&#125;; obj = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p><strong>如何判断变量是否为null？</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="keyword">var</span> exp = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (!exp &amp;&amp; <span class="keyword">typeof</span> exp != <span class="string">&quot;undefined&quot;</span> &amp;&amp; exp != <span class="number">0</span>)&#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;is null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">其中 <span class="keyword">typeof</span> exp != <span class="string">&quot;undefined&quot;</span> 排除了 <span class="literal">undefined</span></span><br><span class="line">exp != <span class="number">0</span> 排除了数字零</span><br><span class="line">!exp 排除了 <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、<span class="keyword">var</span> exp = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (exp === <span class="literal">null</span>)&#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;is null&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>面试题</strong></p>
<p>如何检测一个对象是空对象？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">- <span class="number">1</span>、使用<span class="title class_">JSON</span>.<span class="title function_">stringify</span>()将对象转换为json字符串；</span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj) === <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">- <span class="number">2</span>、使用<span class="keyword">for</span>...<span class="keyword">in</span>循环遍历对象除<span class="title class_">Symbol</span>以外的所有可枚举属性, 当对象有属性存在返回<span class="literal">false</span>， 否则返回<span class="literal">true</span>。</span><br><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isObjectEmpty</span>(<span class="params">obj</span>)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isObjectEmpty</span>(obj))</span><br><span class="line"></span><br><span class="line">- <span class="number">3</span>、<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>() 方法会返回该对象所有可枚举和不可枚举属性的属性名（不含<span class="title class_">Symbol</span>属性）组成的数组。然后再通过判断返回的数组长度是否为零，如果为零的话就是空对象。</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(obj).<span class="property">length</span> === <span class="number">0</span></span><br><span class="line"></span><br><span class="line">- <span class="number">4</span>、<span class="title class_">Object</span>.<span class="title function_">keys</span>() 是 <span class="title class_">ES5</span> 新增的一个对象方法，该方法返回一个数组，包含指定对象自有的可枚举属性（不含继承的和<span class="title class_">Symbol</span>属性）。用此方法只需要判断返回的数组长度是否为零，如果为零的话就是空对象。</span><br></pre></td></tr></table></figure>
<p><strong>null和undefined的区别？</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">相同点</span><br><span class="line"><span class="number">1.</span> 都只有一个值</span><br><span class="line"><span class="number">2.</span> 都没有方法，准确的说都不能调用方法</span><br><span class="line"><span class="number">3.</span> 都表示<span class="string">&quot;无&quot;</span></span><br><span class="line"></span><br><span class="line">不同点</span><br><span class="line"><span class="number">1.</span> <span class="literal">null</span>是一个关键字，<span class="literal">undefined</span>不是关键字。</span><br><span class="line"><span class="keyword">var</span> <span class="literal">null</span> = <span class="number">2</span>; <span class="comment">// 报错  </span></span><br><span class="line"><span class="keyword">var</span> <span class="literal">undefined</span> = <span class="number">2</span>; <span class="comment">// 不报错</span></span><br><span class="line"><span class="number">2.</span> <span class="literal">null</span>本质上是一个空的对象; <span class="literal">undefined</span>是<span class="variable language_">window</span>的一个属性。</span><br><span class="line"><span class="literal">null</span>表示<span class="string">&quot;没有对象&quot;</span>,即此处不应该有值。</span><br><span class="line">	- 作为函数的参数，表示该函数的参数不是对象。</span><br><span class="line">    - 作为对象原型链的终点。</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>) <span class="comment">// null</span></span><br><span class="line"><span class="literal">undefined</span>表示<span class="string">&quot;缺少值&quot;</span>,即此处应该有一个值，但是还没有定义。</span><br><span class="line">	- 变量被声明了，但没有赋值时，就等于<span class="literal">undefined</span>。</span><br><span class="line"> 		<span class="keyword">var</span> a;</span><br><span class="line">		a  <span class="comment">// undefined</span></span><br><span class="line">其余情况查看上面<span class="literal">undefined</span>章节</span><br></pre></td></tr></table></figure>
<h6 id="Boolean">Boolean</h6>
<p>bool 是表示 true 或 false 的基础数据类型。<br>
Boolean 是表示 true 或 false 的对象数据类型，可以把其他类型转换为 Boolean 类型</p>
<p><strong>bool 与 Boolean 区别</strong><br>
bool 是基础类型，Boolean 是对象类型；<br>
bool 使用场景：所有需要做 true 或 false 判断的地方，优先使用 bool 类型；<br>
Boolean 使用场景：无法直接判断 true 或 false 的类型，可转换为 Boolean 类型后，再做 true 或 false 判断。</p>
<h6 id="String">String</h6>
<p>字符串类型，说明：字符串，用一对单引号（’ '）或双引号（“ ”）及引号内的字符构成，引号中间的部分可以任意多个，也可以是没有字符的空字符串。字符串中如果字符包含了双引号，则其外部应该由单引号标示，反之相同（外单内双，外双内单）</p>
<h6 id="Symbol">Symbol</h6>
<p>ES6 引入了一种新的基本数据类型 <code>Symbol</code> ，表示独一无二的值。具体看ES6章节…</p>
<h5 id="引用数据类型">引用数据类型</h5>
<p>引用数据类型（复杂数据类型）指的是 Object类型，所有其他的如 Array、Date、Math、RegExp等数据类型都可以理解为Object类型的子类。</p>
<p><strong>其中Function比较特殊，它既是函数，也是对象。</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 实例化Function</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;return x + y&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fn</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数身上有属性和方法 =&gt; 也能证明它是对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(fn)</span><br></pre></td></tr></table></figure>
<p>关于其它引用数据类型后续再单独展开讲</p>
<p><strong>基本数据类型和引用数据类型的区别？</strong></p>
<p>两种类型的区别是：<strong>存储位置不同</strong>。基本（原始）数据类型直接存储在栈（stack）中的简单数据段，<strong>占据空间小、大小固定</strong>，属于被频繁使用数据，所以放入栈中存储。引用数据类型存储在堆（heap）中的对象，<strong>占据空间大、大小不固定</strong>。如果存储在栈中，将会影响程序运行的性能；引用数据类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。</p>
<h5 id="数据类型转换">数据类型转换</h5>
<p>概念：把一种数据类型的变量转换为另外一种数据类型。</p>
<p>数字类型转换（调用Number()，parseInt()，parseFloat()方法））</p>
<p>字符串类型转换（调用.toString()或String()方法）</p>
<p>布尔类型转换（调用Boolean()方法）</p>
<h6 id="Number-2">Number()</h6>
<p><strong>将参数对象的值转为数值</strong></p>
<p>遇到非数字字符则返回NaN</p>
<p>遇到第二个小数点返回NaN</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="number">1</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="number">1.2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;1.2&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;1.2.3&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;1x&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;x1&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="literal">undefined</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="title class_">NaN</span>))</span><br><span class="line"></span><br><span class="line">* 特殊情况</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="literal">true</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="literal">false</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="literal">null</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line">** 特殊情况: 转换对象时先调用对象的toString方法</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>([]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>([<span class="number">1</span>]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>([<span class="number">1</span>, <span class="number">2</span>]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(&#123;&#125;))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>
<h6 id="isNaN">isNaN()</h6>
<p><strong>判断是否是一个&quot;非数字&quot;</strong></p>
<blockquote>
<p>在判断之前 底层调用Number()方法对数据进行转换</p>
<p>然后再对返回的结果进行 =&gt; 是否是一个 “非数字”</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="number">1</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="number">1.2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;1&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;1.2&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;1.2.3&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;1x&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;x1&#x27;</span>))</span><br><span class="line"></span><br><span class="line">特殊</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="literal">true</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="literal">false</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="literal">undefined</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="title class_">NaN</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="literal">null</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>([]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line">特特殊</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>([<span class="number">1</span>]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>([<span class="number">1</span>, <span class="number">2</span>]))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(&#123;&#125;))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">isNaN</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure>
<h6 id="parseInt">parseInt()</h6>
<blockquote>
<p>解析一个字符串并返回指定基数的十进制整数，它没有Number严格</p>
<p>1、如果第一个字符是数字会开始解析 直到遇到非数字才会停止解析</p>
<p>2、如果第一个数字是非数字字符 直接返回NaN</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">一般都是用来取整</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseInt</span>(<span class="number">1.2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseInt</span>(<span class="string">&#x27;1.2.3&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseInt</span>(<span class="string">&#x27;1x&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseInt</span>(<span class="string">&#x27;x1&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h6 id="parseFloat">parseFloat()</h6>
<blockquote>
<p>可以把任意类型转成浮点数</p>
<p>parseFloat会解析第一个小数点 遇到第二个小数点 或者是非数字停止解析</p>
<p>parseFloat如果第一个是非数字 则返回NaN</p>
<p>如果解析的内容中只有整数 解析成整数</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseFloat</span>(<span class="string">&#x27;1.23&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseFloat</span>(<span class="string">&#x27;1.2.3&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseFloat</span>(<span class="string">&#x27;1&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><strong>小练习</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">parseFloat</span>(<span class="string">&#x27;top:10px&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span>(result == <span class="number">200</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">200</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(result == <span class="title class_">NaN</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;NaN&#x27;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> result == <span class="string">&#x27;number&#x27;</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;other&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">parseFloat</span>(<span class="string">&#x27;1.6px&#x27;</span>) + <span class="built_in">parseInt</span>(<span class="string">&#x27;1.2px&#x27;</span>) + <span class="keyword">typeof</span> <span class="built_in">parseInt</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result) </span><br></pre></td></tr></table></figure>
<h6 id="toString-String">toString() &amp;&amp; String()</h6>
<blockquote>
<p>把指定参数对象转成字符串</p>
<p>注意：null，undefined不能调用toString()</p>
</blockquote>
<p><strong>情况一</strong>：对象.toString() =&gt; Object.prototype.toString() =&gt; 并不是用来转成字符串的 =&gt; 而是用来检测数据类型的 =&gt; [object 所属类信息]</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">注: 在控制台发现&#123;&#125;会被当作一个代码块而不是一个对象</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125; + <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((&#123;&#125;) + <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((&#123;&#125; + <span class="number">0</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> + &#123;&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> + [])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> + [<span class="number">1</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> + [<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p><strong>情况二</strong>：数组.toString() =&gt; 数组也是对象，所以应该调用Object.prototype.toString()</p>
<p>但是因为数组对toString()方法进行了重写自身原型上有toString()方法</p>
<p>所以根据原型链的查找规则，先用自身的 =&gt; Array.prototype.toString() =&gt; 转字符串</p>
<p>如果数组需要使用Object的toString()来检测其数据类型 可以使用call方法</p>
<p>这种检测数据类型的方式 也是开发中用的最多的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Object.prototype.toString.call([]) =&gt; [object Array]</span><br></pre></td></tr></table></figure>
<p><strong>情况三</strong>：除了对象和数组以外，其它数据类型.toString()都是直接加上&quot;&quot;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="number">1</span>).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((<span class="literal">false</span>).<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span>.<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span>.<span class="title function_">toString</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>(<span class="literal">null</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>(<span class="literal">undefined</span>))</span><br></pre></td></tr></table></figure>
<p>注：对象转数字 需要先调用toString() 转成字符串 再去转数字</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">66</span>] == <span class="number">66</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">66</span>] === <span class="number">66</span>)</span><br></pre></td></tr></table></figure>
<p><strong>小练习</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="built_in">isNaN</span>(!!<span class="title class_">Number</span>(<span class="built_in">parseInt</span>(<span class="string">&quot;0.1&quot;</span>)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="keyword">typeof</span> !<span class="built_in">parseInt</span>(<span class="literal">null</span>) + !<span class="built_in">isNaN</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="number">10</span> + <span class="literal">false</span> + <span class="literal">undefined</span> + [] + <span class="string">&#x27;Tencent&#x27;</span> + <span class="literal">null</span> + <span class="literal">true</span> + &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="number">10</span> + <span class="literal">false</span> + <span class="literal">undefined</span> + [] + +<span class="string">&#x27;Tencent&#x27;</span> + <span class="literal">null</span> + <span class="literal">true</span> + &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br></pre></td></tr></table></figure>
<h6 id="Boolean-2">Boolean</h6>
<p>除了undefined、null、0、‘’、NaN转为false以外，其它的都为true</p>
<p>将一个数据转成boolean类型的两种方式:  Boolean(数据) 或者 !!数据</p>
<h5 id="隐式类型转换">隐式类型转换</h5>
<h6 id="转换为String">转换为String</h6>
<p>算法运算符（+）， 任何值和字符串做 + 时，都会先转换为字符串，然后再和字符串做拼串操作；多个值 + 时 ，从左向右运算，注意数值类型；</p>
<p>可以利用这一特点，来将任意数据类型转换为String，只需（任意字符串 + “”）即可转换为String；这是一种隐式类型转换，由浏览器自动完成，实际上也是调用了String()函数；</p>
<h6 id="转换为Number">转换为Number</h6>
<p>算法运算符（- * / %），任何值做 - * /，都会将其转换为Number，再做运算；可以利用这一特点，来将任意数据类型转换为Number，只需（任意字符串 - 0）（任意字符串 * 1）（任意字符串 / 1）即可转换为Number，这是一种隐式类型转换，由浏览器自动完成，实际上也是调用了Number()函数；</p>
<p>一元运算符（+(正号) ），对于非Number类型的值，它会先转换为Number，然后再运算；可以对一个其他数据类型使用+，来将其转换为number，隐式类型转换，它的原理和Number()函数一样；</p>
<h6 id="转换为Boolean">转换为Boolean</h6>
<p>逻辑计算符（!非），! 对一个布尔值做取反运算；如果对非布尔值取反，则会将其转换为布尔值，再取反；可以利用其特点，将其他数据类型取两次反，转换为布尔值；原理和Boolean()一样；</p>
<h6 id="字符串和数字">字符串和数字</h6>
<p>字符串加数字，数字就会转成字符串。</p>
<p>数字减字符串，字符串转成数字。</p>
<p>如果字符串不是纯数字就会转成NaN。字符串减数字也一样。两个字符串相减也先转成数字。</p>
<p>乘，除，大于，小于跟减的转换也是一样。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>+<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>-<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span>-<span class="string">&#x27;kkb&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span>-<span class="string">&#x27;10a&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span>*<span class="string">&#x27;20&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;10&#x27;</span>*<span class="string">&#x27;20&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>/<span class="string">&#x27;1&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>/<span class="string">&#x27;1&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>/<span class="string">&#x27;kkb&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h6 id="隐式转换规则">== 隐式转换规则</h6>
<p>【类型一致】</p>
<p>{} == {}: false =&gt; 比较的是堆内存中的地址值</p>
<p>[] == []: false =&gt; 比较的是堆内存中的地址值</p>
<p>NaN == NaN: false =&gt; NaN和任何数据类型都不相等包括它本身</p>
<p>undefined == undefined: true</p>
<p>null == null: true</p>
<p>【类型不一致】</p>
<p>1、null == undefined: true, 如果换成 === 结果就是false (因为类型不一致)</p>
<p>剩下的null/undefined和其它任何数据类型都不相等 除了它本身</p>
<p>2、字符串 == 对象 要将对象转成字符串</p>
<p>3、剩下的情况：如果 == 两遍类型不一致 都需要转成数字进行比较</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;0&#x27;</span> == <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">0</span> == <span class="literal">false</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;0&#x27;</span> == <span class="literal">false</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> == <span class="literal">false</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> == <span class="literal">false</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] == <span class="literal">false</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(![] == <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>
<p>注：在循环或者条件判断中，条件处理的结果就是布尔类型值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> flag = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span>(flag)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>)&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数据类型检测">数据类型检测</h5>
<h6 id="typeof">typeof</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">作用：<span class="keyword">typeof</span>校验数据类型 返回一个字符串</span><br><span class="line">基本数据类型</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="number">1</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">NaN</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="string">&#x27;1&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">true</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">undefined</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">null</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="number">123n</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Symbol</span>(<span class="number">1</span>)) </span><br><span class="line">引用数据类型</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> []) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> &#123;&#125;) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> /[a-z]/) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="keyword">new</span> <span class="title class_">Date</span>()) </span><br><span class="line">特殊</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> fn) </span><br><span class="line">[总结]</span><br><span class="line"><span class="keyword">typeof</span> 的返回类型为字符串，值有：number、boolean、string、object、<span class="keyword">function</span>、<span class="literal">undefined</span>、symbol、bigint</span><br><span class="line">[局限性]:<span class="keyword">typeof</span> 判断引用数据类型时 除了判断函数会输出<span class="string">&quot;function&quot;</span> 其它都是输出<span class="string">&quot;object&quot;</span> 所以一般只用来判断基本数据类型 判断引用数据类型的结果只作参考</span><br></pre></td></tr></table></figure>
<h6 id="instanceof">instanceof</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">作用: 用于检测构造函数中的原型(prototype)属性是否出现在某个实例对象的原型链上</span><br><span class="line">【局限性】</span><br><span class="line"><span class="number">1</span>、原型的指向可以任意更改 所以这种方式的返回结果不一定准确 实际开发中也可以参考</span><br><span class="line"><span class="number">2</span>、无法检测基本数据类型 因为基本数据连对象都不是 所以不存在__proto__ 也没有原型链 </span><br><span class="line">   - 如果非要检测 就将基本数据类型包装下</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Array</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125; <span class="keyword">instanceof</span> <span class="title class_">Array</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125; <span class="keyword">instanceof</span> <span class="title class_">Object</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Object</span>) </span><br><span class="line"></span><br><span class="line">[局限性<span class="number">1</span>]</span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Object</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Array</span>) </span><br><span class="line"><span class="comment">// 更改原型指向</span></span><br><span class="line">obj.<span class="property">__proto__</span> = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Array</span>)</span><br><span class="line"></span><br><span class="line">[局限性<span class="number">2</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> <span class="keyword">instanceof</span> <span class="title class_">Number</span>)</span><br><span class="line">包装</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>) <span class="keyword">instanceof</span> <span class="title class_">Object</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>) <span class="keyword">instanceof</span> <span class="title class_">Number</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">1</span>) <span class="keyword">instanceof</span> <span class="title class_">String</span>)</span><br><span class="line"></span><br><span class="line">[注意]</span><br><span class="line"><span class="keyword">instanceof</span> 用来判断对象，代码形式为 【obj1 <span class="keyword">instanceof</span> obj2】（obj2 必须为对象，否则会报错！）</span><br><span class="line"><span class="keyword">instanceof</span>只能用来判断两个对象是否属于实例关系， 而不能判断一个对象实例具体属于哪种类型</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">9</span> <span class="keyword">instanceof</span> <span class="title class_">Number</span>);                </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">true</span> <span class="keyword">instanceof</span> <span class="title class_">Boolean</span>);                </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;libo&#x27;</span> <span class="keyword">instanceof</span> <span class="title class_">String</span>);              </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Array</span>);                   </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125; <span class="keyword">instanceof</span> <span class="title class_">Function</span>);      </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;&#125; <span class="keyword">instanceof</span> <span class="title class_">Object</span>);                  </span><br><span class="line"><span class="comment">// 注意以下两组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="literal">null</span>);                   </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> <span class="keyword">instanceof</span> <span class="title class_">Object</span>);                 </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">NaN</span>);                            </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span> <span class="keyword">instanceof</span> <span class="title class_">Number</span>);     </span><br></pre></td></tr></table></figure>
<h6 id="constructor">constructor</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">作用: 用于检测实例对象是否是由某个构造函数实例化出来的</span><br><span class="line">【局限性】</span><br><span class="line"><span class="number">1</span>、构造器的指向可以任意更改 所以这种方式的返回结果不一定准确 实际开发中也可以参考</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>.<span class="property">constructor</span> == <span class="title class_">Object</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>.<span class="property">constructor</span> == <span class="title class_">Array</span>)</span><br><span class="line">修改构造器的指向</span><br><span class="line">obj.<span class="property">__proto__</span>.<span class="property">constructor</span> = <span class="literal">null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">__proto__</span>.<span class="property">constructor</span> == <span class="title class_">Object</span>) </span><br></pre></td></tr></table></figure>
<h6 id="Object-prototype-toString-call">Object.prototype.toString.call()</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 分三种情况:</span></span><br><span class="line"><span class="comment">// 1、检测Object =&gt; 格式: [object 所属类的信息(大写)] =&gt; [object Object]</span></span><br><span class="line"><span class="comment">// 2、检测其它引用类型 .call</span></span><br><span class="line"><span class="comment">// 3、基本数据类型 =&gt; 转字符串</span></span><br><span class="line"><span class="comment">// var obj = &#123;name: &#x27;zs&#x27;&#125;</span></span><br><span class="line"><span class="comment">// console.log(Object.prototype.toString(obj)) // [object Object]</span></span><br><span class="line"><span class="comment">// var arr = [1,2,3]</span></span><br><span class="line"><span class="comment">// console.log(Object.prototype.toString(arr)) // [object Object]</span></span><br><span class="line"><span class="comment">// 其它引用类型记得.call</span></span><br><span class="line"><span class="comment">// console.log(Object.prototype.toString.call(arr)) // [object Array]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 特殊情况 =&gt; 数组调用的不是Object原型上的toString 而是自身重写了toString方法</span></span><br><span class="line"><span class="comment">// 数组toString方法的实现</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// var str = &#x27;&#x27;</span></span><br><span class="line">  <span class="comment">// for (var i = 0; i &lt; this.length - 1; i++) &#123;</span></span><br><span class="line">  <span class="comment">//   str += this[i] + &#x27;,&#x27;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// // 拼接最后一项</span></span><br><span class="line">  <span class="comment">// str += this[this.length - 1]</span></span><br><span class="line">  <span class="comment">// return str</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure>
<h4 id="堆栈内存"><a href="https://zhuanlan.zhihu.com/p/27534451">堆栈内存</a></h4>
<p>栈： 是一种连续储存的数据结构，具有<strong>先进后出</strong>、<strong>后进先出</strong>的性质。<br>
栈内的元素只能通过列表的一端访问，这一端称为栈顶。由于栈具有先进后出的特点，所有任何不在栈顶的元素都无法访问。</p>
<p>堆： 是一种非连续的树形储存的数据结构，具有<strong>队列优先</strong>，<strong>先进先出</strong>的性质。<br>
  每个节点有一个值，整棵树是经过排序的。特点是根结点的值最小（或最大），且根结点的两个子树也是一个堆。常用来实现优先队列，存取随意。</p>
<p><strong>优点：</strong></p>
<p>​	动态分配内存大小，&quot; 按需分配 &quot;</p>
<p><strong>缺点：</strong></p>
<p>​	由于要在运行时才动态分配内存，相比于栈内存，它的存取速度较慢。</p>
<p><img data-src="image-20230711145722189.png" alt=""></p>
<ul>
<li>GO：全局对象（Global Object）</li>
<li>ECStack：执行环境栈（Excution Context Stack）</li>
<li>EC：执行环境（Excution Context）又称：执行上下文
<ul>
<li>VO：Varibale Object 变量对象</li>
<li>AO：Active Object 活动对象</li>
</ul>
</li>
<li>Scope：作用域，创建函数时就确定的</li>
<li>ScopeChain：作用域链</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 基础</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">b = <span class="number">13</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">n</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">b[<span class="string">&#x27;n&#x27;</span>] = <span class="number">13</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">n</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">n</span>: <span class="number">12</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">b = &#123; <span class="attr">n</span>: <span class="number">13</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">n</span>);</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230712172247421.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">2</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">z</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x + y + z)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> B</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">A</span>(<span class="number">2</span>)</span><br><span class="line"><span class="title function_">c</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230713103712327.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 阿里面试题</span></span><br><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line"> <span class="attr">n</span>: <span class="number">10</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> b = a;</span><br><span class="line">a.<span class="property">m</span> = a = &#123;</span><br><span class="line"> <span class="attr">n</span>: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">m</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230713103807409.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 360面试题</span></span><br><span class="line"><span class="keyword">let</span> x = [<span class="number">12</span>, <span class="number">23</span>];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">y</span>) &#123;</span><br><span class="line">  y[<span class="number">0</span>] = <span class="number">100</span>;</span><br><span class="line">  y = [<span class="number">100</span>];</span><br><span class="line">  y[<span class="number">1</span>] = <span class="number">200</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(x);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230713153153974.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 高德面试题</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">10</span></span><br><span class="line">~<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">  x = x || <span class="number">20</span> &amp;&amp; <span class="number">30</span> || <span class="number">40</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x)</span><br><span class="line">&#125;()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 腾讯面试题</span></span><br><span class="line"><span class="keyword">let</span> x = [<span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  y = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">~<span class="keyword">function</span> (<span class="params">x</span>) &#123;</span><br><span class="line">  x.<span class="title function_">push</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">  x = x.<span class="title function_">slice</span>(<span class="number">0</span>);</span><br><span class="line">  x.<span class="title function_">push</span>(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">  x = y;</span><br><span class="line">  x.<span class="title function_">push</span>(<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br><span class="line">&#125;(x)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230713110817598.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;&#125;, </span><br><span class="line">b = <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">c = <span class="number">0</span>;</span><br><span class="line">a[b] = <span class="string">&#x27;JavaScript&#x27;</span>;</span><br><span class="line">a[c] = <span class="string">&#x27;HTML+CSS&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a[b]);</span><br><span class="line">====================</span><br><span class="line"><span class="keyword">let</span> a = &#123;&#125;,</span><br><span class="line">b = &#123; <span class="attr">n</span>: <span class="string">&#x27;1&#x27;</span> &#125;,</span><br><span class="line">c = &#123; <span class="attr">m</span>: <span class="string">&#x27;2&#x27;</span> &#125;</span><br><span class="line">a[b] = <span class="string">&#x27;JavaScript&#x27;</span>;</span><br><span class="line">a[c] = <span class="string">&#x27;HTML+CSS&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a[c]); </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a[b]); </span><br></pre></td></tr></table></figure>
<p><strong>拓展</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 严格模式下形参和实参不会建立映射关系</span></span><br><span class="line"><span class="comment">// 非严格模式下会建立 一旦建立arguments中的元素和形参</span></span><br><span class="line"><span class="comment">// 如果有一方改变 会影响另外一方</span></span><br><span class="line"><span class="comment">// function fn(x, y) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(x, y, arguments)</span></span><br><span class="line"><span class="comment">//   arguments[0] = 666</span></span><br><span class="line"><span class="comment">//   console.log(x, y)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn(100, 200)</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y, <span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="variable language_">arguments</span>[<span class="number">0</span>] = <span class="number">666</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(<span class="number">100</span>, <span class="number">200</span>)</span><br></pre></td></tr></table></figure>
<h4 id="操作符">操作符</h4>
<p>运算符  operator</p>
<p>5 + 6</p>
<p>表达式  组成 操作数和操作符，会有一个结果</p>
<h5 id="算术运算符">算术运算符</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+ - * / %  </span><br></pre></td></tr></table></figure>
<h5 id="一元运算符">一元运算符</h5>
<p>一元运算符：只有一个操作数的运算符</p>
<p>前置++</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num1 = <span class="number">5</span>;</span><br><span class="line">++ num1; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">6</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + ++ num2);</span><br></pre></td></tr></table></figure>
<p>后置++</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> num1 = <span class="number">5</span>;</span><br><span class="line">num1 ++;    </span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">6</span> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num1 + num2 ++);</span><br></pre></td></tr></table></figure>
<p>猜猜看</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; <span class="keyword">var</span> b = ++a + ++a; <span class="variable language_">console</span>.<span class="title function_">log</span>(b);    </span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; <span class="keyword">var</span> b = a++ + ++a; <span class="variable language_">console</span>.<span class="title function_">log</span>(b);    </span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; <span class="keyword">var</span> b = a++ + a++; <span class="variable language_">console</span>.<span class="title function_">log</span>(b);    </span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>; <span class="keyword">var</span> b = ++a + a++; <span class="variable language_">console</span>.<span class="title function_">log</span>(b);  </span><br><span class="line"><span class="keyword">var</span> a = <span class="number">4</span>; <span class="keyword">var</span> b = (a++)+(++a)+(a*<span class="number">10</span>); <span class="variable language_">console</span>.<span class="title function_">log</span>(a,b);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;<span class="keyword">var</span> b= <span class="number">10</span>; <span class="keyword">var</span> c= <span class="number">10</span>;a = b++;c = --a;b = ++a;a = c-- ;<span class="variable language_">console</span>.<span class="title function_">log</span>(a,b,c);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>前置++：先加1，后参与运算<br>
后置++：先参与运算，后加1</p>
</blockquote>
<h5 id="逻辑运算符-布尔运算符">逻辑运算符(布尔运算符)</h5>
<pre><code>&amp;&amp; 与 两个操作数同时为true，结果为true，否则都是false
|| 或 两个操作数有一个为true，结果为true，否则为false
!  非  取反
</code></pre>
<h5 id="关系运算符-比较运算符">关系运算符(比较运算符)</h5>
<pre><code>&lt;  &gt;  &gt;=  &lt;= == != === !==
</code></pre>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">==与===的区别：==只进行值得比较，===类型和值同时相等，则相等</span><br><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;55&#x27;</span> == <span class="number">55</span>;  	<span class="comment">// true</span></span><br><span class="line"><span class="keyword">var</span> result = <span class="string">&#x27;55&#x27;</span> === <span class="number">55</span>; 	<span class="comment">// false 值相等，类型不相等</span></span><br><span class="line"><span class="keyword">var</span> result = <span class="number">55</span> === <span class="number">55</span>; 	<span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="赋值运算符">赋值运算符</h5>
<p>=   +=   -=   *=   /=   %=</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">例如：</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line">num += <span class="number">5</span>;	<span class="comment">//相当于  num = num + 5;</span></span><br></pre></td></tr></table></figure>
<h5 id="运算符的优先级">运算符的优先级</h5>
<pre><code>优先级从高到底
	1. ()  优先级最高
	2. 一元运算符  ++   --   !
	3. 算数运算符  先*  /  %   后 +   -
	4. 关系运算符  &gt;   &gt;=   &lt;   &lt;=
	5. 相等运算符   ==   !=    ===    !==
	6. 逻辑运算符  先&amp;&amp;   后||
	7. 赋值运算符  = 
</code></pre>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 练习1：</span></span><br><span class="line"><span class="number">4</span> &gt;= <span class="number">6</span> || <span class="string">&#x27;人&#x27;</span> != <span class="string">&#x27;阿凡达&#x27;</span> &amp;&amp; !(<span class="number">12</span> * <span class="number">2</span> == <span class="number">144</span>) &amp;&amp; <span class="literal">true</span></span><br><span class="line"><span class="comment">// 练习2：</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="number">5</span> == num / <span class="number">2</span> &amp;&amp; (<span class="number">2</span> + <span class="number">2</span> * num).<span class="title function_">toString</span>() === <span class="string">&#x27;22&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="作用域">作用域</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// js的执行流程分为三个阶段</span></span><br><span class="line"><span class="comment">// 1、语法分析阶段</span></span><br><span class="line"><span class="comment">// =&gt; 基本的语法校验 如果校验到错误抛出 SyntaxError 程序停止执行</span></span><br><span class="line"><span class="comment">// 2、预解析阶段</span></span><br><span class="line"><span class="comment">// =&gt; 进入该阶段就相当于进入了全局执行环境</span></span><br><span class="line"><span class="comment">// =&gt; 每次调用函数就相当于进入了函数执行环境</span></span><br><span class="line"><span class="comment">// 执行环境定义了变量和函数有权访问的其他数据。</span></span><br><span class="line"><span class="comment">// 3、执行阶段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 作用域: 作用域是可操作变量或函数的有效范围</span></span><br><span class="line"><span class="comment">// 全局作用域: 全局作用域的变量任何地方都可以访问 页面关闭变量才会销毁</span></span><br><span class="line"><span class="comment">// 局部(函数)作用域: 当前作用域内才能访问 函数执行完毕会被释放 内部的变量也会随之销毁</span></span><br><span class="line"><span class="comment">// 局部作用域可以访问全局作用域 反之不行</span></span><br><span class="line"><span class="comment">// 全局变量: 在函数外部定义的变量或在函数内部没有使用var声明的变量。</span></span><br><span class="line"><span class="comment">// 局部变量: 在函数内部定义的变量。</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   var a = 3;</span></span><br><span class="line"><span class="comment">//   a = a * 100;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"><span class="comment">// console.log(a); // ReferenceError: a is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   var a = 3;</span></span><br><span class="line"><span class="comment">//   a = a * 100;</span></span><br><span class="line"><span class="comment">//   console.log(a); // 300</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function f2() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a); // ReferenceError: a is not defined</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"><span class="comment">// f2();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   var local = 100;</span></span><br><span class="line"><span class="comment">//   local++;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;local= &quot; + local); // 101</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function f2() &#123;</span></span><br><span class="line"><span class="comment">//   local++;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"><span class="comment">// f2(); // local is not defined</span></span><br><span class="line"><span class="comment">// console.log(&quot;local= &quot; + local);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// var global = 100;</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   global++;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function f2() &#123;</span></span><br><span class="line"><span class="comment">//   global++;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"><span class="comment">// f2();</span></span><br><span class="line"><span class="comment">// console.log(global)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// var blogName = &quot;梦想天空&quot;;</span></span><br><span class="line"><span class="comment">// function doSomething() &#123;</span></span><br><span class="line"><span class="comment">//   var authorName = &quot;山边小溪&quot;;</span></span><br><span class="line"><span class="comment">//   // 隐式全局变量 =&gt; 作用域是全局的</span></span><br><span class="line"><span class="comment">//   blogName = &quot;梦想天空&quot;;</span></span><br><span class="line"><span class="comment">//   console.log(authorName);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// doSomething();</span></span><br><span class="line"><span class="comment">// console.log(blogName);</span></span><br><span class="line"><span class="comment">// console.log(authorName);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// var a = 3;</span></span><br><span class="line"><span class="comment">// b = 5,</span></span><br><span class="line"><span class="comment">// s = 10;</span></span><br><span class="line"><span class="comment">// function f(a, b) &#123;</span></span><br><span class="line"><span class="comment">//   // 声明形参a,b相当于在当前作用域下声明了a,b变量</span></span><br><span class="line"><span class="comment">//   // var a; var b;</span></span><br><span class="line"><span class="comment">//   a = a * 10; // 30</span></span><br><span class="line"><span class="comment">//   b = b * 10; // 50</span></span><br><span class="line"><span class="comment">//   var c = a + b; // 80</span></span><br><span class="line"><span class="comment">//   v = s * c; // 800</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f(a, b);</span></span><br><span class="line"><span class="comment">// console.log(&quot; v = &quot; + v); // 800</span></span><br><span class="line"><span class="comment">// console.log(&quot; a = &quot; + a); // 3</span></span><br><span class="line"><span class="comment">// console.log(&quot; b = &quot; + b); // 5</span></span><br><span class="line"><span class="comment">// console.log(&quot; c = &quot; + c); // c is not defiend</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// &#123;&#125;表示块级作用域 块级作用域中声明的变量无法被外界访问</span></span><br><span class="line"><span class="comment">// es5中并没有块级作用域的概念 但是函数除外</span></span><br><span class="line"><span class="comment">// es6有块级作用域的概念 通过let声明的变量有自己的独立作用域</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   var v = 100;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(&quot;v = &quot; + v);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// if (true) &#123;</span></span><br><span class="line"><span class="comment">//   var v = 100;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(&quot;v = &quot; + v);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// for (let i = 1; i &lt; 10; i++) &#123;&#125;</span></span><br><span class="line"><span class="comment">// console.log(&quot;i=&quot;+ i );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// function f1()&#123;</span></span><br><span class="line"><span class="comment">//   function f2()&#123;</span></span><br><span class="line"><span class="comment">//     console.dir(f2)</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   f2()</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// f1()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===========================</span></span><br><span class="line"><span class="comment">// 作用域链的查找规则: 就近原则 自己有的就用自己的 如果没有就沿着作用域链往父级作用域查找 直到找到全局作用域为止</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var i = 1;</span></span><br><span class="line"><span class="comment">// function fn1() &#123;</span></span><br><span class="line"><span class="comment">//   var i = 5;</span></span><br><span class="line"><span class="comment">//   var j = 20</span></span><br><span class="line"><span class="comment">//   function fn2() &#123;</span></span><br><span class="line"><span class="comment">//     var i = 10;</span></span><br><span class="line"><span class="comment">//     function fn3() &#123;</span></span><br><span class="line"><span class="comment">//       var j = 15;</span></span><br><span class="line"><span class="comment">//       console.log(i)</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     fn3();</span></span><br><span class="line"><span class="comment">//     console.log(i);</span></span><br><span class="line"><span class="comment">//     console.log(j);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   fn2();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn1();</span></span><br><span class="line"><span class="comment">// console.log(i);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==========================</span></span><br><span class="line"><span class="comment">// 作用域的作用</span></span><br><span class="line"><span class="comment">// 限定变量或函数的可用性</span></span><br><span class="line"><span class="comment">// 提高了程序逻辑的局部性</span></span><br><span class="line"><span class="comment">// 减少名字冲突</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function fun() &#123;</span></span><br><span class="line"><span class="comment">//   var a = b = 100;</span></span><br><span class="line"><span class="comment">//   // b = 100 =&gt; 隐式全局变量</span></span><br><span class="line"><span class="comment">//   // var a = 100</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fun(); </span></span><br><span class="line"><span class="comment">// console.log(&quot;b = &quot; + b); // 100</span></span><br><span class="line"><span class="comment">// console.log(&quot;a = &quot; + a); // a is not defined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==========================</span></span><br><span class="line"><span class="comment">// var a = 123;</span></span><br><span class="line"><span class="comment">// function fun(a) &#123;</span></span><br><span class="line"><span class="comment">//   // var a;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   a = 456;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fun(a);</span></span><br><span class="line"><span class="comment">// console.log(a); </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==========================</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">30</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  a = <span class="number">300</span>;</span><br><span class="line"> &#125;</span><br><span class="line">  <span class="title function_">f2</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">f1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>
<h4 id="函数-2">函数</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// function getMax(x, y) &#123;</span></span><br><span class="line"><span class="comment">//   var max = Math.max(x, y)</span></span><br><span class="line"><span class="comment">//   console.log(max)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面这种写法和下面写法等价 上面更便捷</span></span><br><span class="line"><span class="comment">// let fn = new Function(&#x27;x&#x27;, &#x27;y&#x27;, &#x27;console.log(x+y)&#x27;)</span></span><br><span class="line"><span class="comment">// fn(1, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">x, y</span>)&#123;&#125; <span class="comment">// fn</span></span><br><span class="line"><span class="comment">// let fn = function()&#123;&#125; // fn</span></span><br><span class="line"><span class="comment">// new Function() // anonymous</span></span><br><span class="line"><span class="comment">// fn = fn.bind() // bound fn</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(fn)</span><br><span class="line"><span class="comment">// 【arguments】: 实参列表 =&gt; 伪数组</span></span><br><span class="line"><span class="comment">// 【caller】: caller返回一个函数的引用，这个函数调用了当前的函数。</span></span><br><span class="line"><span class="comment">// 如果函数是由顶层调用的，则返回null</span></span><br><span class="line"><span class="comment">// 【callee】: callee返回正在执行的函数本身的引用 它是arguments的一个属性 可以用来递归匿名函数 </span></span><br><span class="line"><span class="comment">// name: 函数名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// caller</span></span><br><span class="line"><span class="comment">// var a = function () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a.caller);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var b = function () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(b.caller)</span></span><br><span class="line"><span class="comment">//   a();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// b();</span></span><br></pre></td></tr></table></figure>
<h4 id="柯里化">柯里化</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="递归">递归</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="闭包">闭包</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="预解析">预解析</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 预解析做了哪些事?</span></span><br><span class="line"><span class="comment">// 1、变量提升 将变量的声明提升到当前作用域的最顶端 赋值不提升</span></span><br><span class="line"><span class="comment">// 2、函数提升 将函数的声明提升到当前作用域的最顶端 调用不提升</span></span><br><span class="line"><span class="comment">// 3、...</span></span><br><span class="line"><span class="comment">// 函数提升优先于变量提升</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==== 变量提升 ==== </span></span><br><span class="line"><span class="comment">// var user = &#x27;zs&#x27;</span></span><br><span class="line"><span class="comment">// console.log(user) // &#x27;zs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(user) // undefined</span></span><br><span class="line"><span class="comment">// var user = &#x27;zs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// var user</span></span><br><span class="line"><span class="comment">// console.log(user) // undefined</span></span><br><span class="line"><span class="comment">// user = &#x27;zs&#x27;</span></span><br><span class="line"><span class="comment">// console.log(user) // &#x27;zs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==== 函数提升 ====</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数提升的顺序和原来的顺序保持一致</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;111&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;222&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;111&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;222&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================</span></span><br><span class="line"><span class="comment">// 函数表达式的写法</span></span><br><span class="line"><span class="comment">// fn(); // fn is not a function</span></span><br><span class="line"><span class="comment">// var fn = function () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// var fn</span></span><br><span class="line"><span class="comment">// fn(); // undefined()</span></span><br><span class="line"><span class="comment">// fn = function () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ======================</span></span><br><span class="line"><span class="comment">// var num = 10;</span></span><br><span class="line"><span class="comment">// console.log(user)</span></span><br><span class="line"><span class="comment">// var user = &#x27;张三&#x27;;</span></span><br><span class="line"><span class="comment">// console.log(num);</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// var num</span></span><br><span class="line"><span class="comment">// num = 10</span></span><br><span class="line"><span class="comment">// var user</span></span><br><span class="line"><span class="comment">// console.log(user)</span></span><br><span class="line"><span class="comment">// user = &#x27;张三&#x27;</span></span><br><span class="line"><span class="comment">// console.log(num)</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;您好!&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ===================</span></span><br><span class="line"><span class="comment">// var fn = function fn() &#123;</span></span><br><span class="line"><span class="comment">//   var user = &#x27;张三&#x27;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;user&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(fn);</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   var user = &#x27;张三&#x27;</span></span><br><span class="line"><span class="comment">//   console.log(user);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// 函数先提升</span></span><br><span class="line"><span class="comment">// var fn</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   var user = &#x27;张三&#x27;</span></span><br><span class="line"><span class="comment">//   console.log(user);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn = function fn() &#123;</span></span><br><span class="line"><span class="comment">//   var user = &#x27;张三&#x27;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;user&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(fn);</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========================</span></span><br><span class="line"><span class="comment">// var a = 100;</span></span><br><span class="line"><span class="comment">// function test() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   a = 10 // 隐式全局会将全局作用域下的同名变量覆盖</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// test();</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// var a</span></span><br><span class="line"><span class="comment">// function test() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a); // 100</span></span><br><span class="line"><span class="comment">//   a = 10 // 隐式全局会将全局作用域下的同名变量覆盖</span></span><br><span class="line"><span class="comment">//   console.log(a); // 10</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// a = 100;</span></span><br><span class="line"><span class="comment">// test();</span></span><br><span class="line"><span class="comment">// console.log(a); // 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var a = 100;</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   var a = 5;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// a();</span></span><br><span class="line"><span class="comment">// var a = 300;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   var a = 50;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   var a = 5;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   var a = 50;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var a</span></span><br><span class="line"><span class="comment">// a = 100;</span></span><br><span class="line"><span class="comment">// // a(); // 100() =&gt; 报错</span></span><br><span class="line"><span class="comment">// a = 300; </span></span><br><span class="line"><span class="comment">// console.log(a); // 300</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(fn)</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;f1函数&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;f2函数&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;f1函数&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function fn() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&quot;f2函数&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(fn)</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"><span class="comment">// fn();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function b() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   var a = 10;</span></span><br><span class="line"><span class="comment">//   function a() &#123; &#125;;</span></span><br><span class="line"><span class="comment">//   a = 100;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// b();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function b() &#123;</span></span><br><span class="line"><span class="comment">//   function a() &#123; &#125;;</span></span><br><span class="line"><span class="comment">//   var a</span></span><br><span class="line"><span class="comment">//   console.log(a); // 函数a</span></span><br><span class="line"><span class="comment">//   a = 10;</span></span><br><span class="line"><span class="comment">//   a = 100;</span></span><br><span class="line"><span class="comment">//   console.log(a); // 100</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// b();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var foo = 1;</span></span><br><span class="line"><span class="comment">// function bar() &#123;</span></span><br><span class="line"><span class="comment">//   if (!foo) &#123;</span></span><br><span class="line"><span class="comment">//     var foo = 10;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   console.log(foo);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// bar();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function bar() &#123;</span></span><br><span class="line"><span class="comment">//   var foo</span></span><br><span class="line"><span class="comment">//   if (!foo) &#123;</span></span><br><span class="line"><span class="comment">//     foo = 10;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">//   console.log(foo); // 10</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var foo</span></span><br><span class="line"><span class="comment">// foo = 1;</span></span><br><span class="line"><span class="comment">// bar();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"><span class="comment">// var a = 3;</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;f1&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;f2&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// a();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 报错 ==</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;f1&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// function a() &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;f2&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var a</span></span><br><span class="line"><span class="comment">// console.log(a); // a函数 =&gt; &#x27;f2&#x27;</span></span><br><span class="line"><span class="comment">// a = 3;</span></span><br><span class="line"><span class="comment">// console.log(a); // 3</span></span><br><span class="line"><span class="comment">// a(); // 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function test(a, b) &#123;</span></span><br><span class="line"><span class="comment">//   console.log(a); </span></span><br><span class="line"><span class="comment">//   console.log(b); </span></span><br><span class="line"><span class="comment">//   var b = 234; </span></span><br><span class="line"><span class="comment">//   console.log(b);</span></span><br><span class="line"><span class="comment">//   a = 123; </span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   function a() &#123; &#125; </span></span><br><span class="line"><span class="comment">//   var a; b = 234; </span></span><br><span class="line"><span class="comment">//   var b = function () &#123; &#125;</span></span><br><span class="line"><span class="comment">//   console.log(a); </span></span><br><span class="line"><span class="comment">//   console.log(b);</span></span><br><span class="line"><span class="comment">// &#125; </span></span><br><span class="line"><span class="comment">// test(1);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function test(a, b) &#123;</span></span><br><span class="line"><span class="comment">//   // var a =&gt; 1</span></span><br><span class="line"><span class="comment">//   // var b</span></span><br><span class="line"><span class="comment">//   function a() &#123; &#125;  </span></span><br><span class="line"><span class="comment">//   console.log(a); // 1</span></span><br><span class="line"><span class="comment">//   console.log(b); // undefined</span></span><br><span class="line"><span class="comment">//   b = 234; </span></span><br><span class="line"><span class="comment">//   console.log(b); // 234</span></span><br><span class="line"><span class="comment">//   a = 123; </span></span><br><span class="line"><span class="comment">//   console.log(a); // 123</span></span><br><span class="line"><span class="comment">//   b = 234; </span></span><br><span class="line"><span class="comment">//   b = function () &#123; &#125;</span></span><br><span class="line"><span class="comment">//   console.log(a); // 123</span></span><br><span class="line"><span class="comment">//   console.log(b); // 函数b</span></span><br><span class="line"><span class="comment">// &#125; </span></span><br><span class="line"><span class="comment">// test(1);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var a = 18;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   var b = 9;</span></span><br><span class="line"><span class="comment">//   console.log(a);</span></span><br><span class="line"><span class="comment">//   console.log(b);</span></span><br><span class="line"><span class="comment">//   var a = &#x27;123&#x27;;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// == 转换 ==</span></span><br><span class="line"><span class="comment">// function f1() &#123;</span></span><br><span class="line"><span class="comment">//   var b</span></span><br><span class="line"><span class="comment">//   b = 9;</span></span><br><span class="line"><span class="comment">//   var a;</span></span><br><span class="line"><span class="comment">//   console.log(a); // undefined</span></span><br><span class="line"><span class="comment">//   console.log(b); // 9</span></span><br><span class="line"><span class="comment">//   a = &#x27;123&#x27;;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var a</span></span><br><span class="line"><span class="comment">// a = 18;</span></span><br><span class="line"><span class="comment">// f1();</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">f1</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = b = c = <span class="number">9</span>;</span><br><span class="line">  <span class="comment">// var a = 9</span></span><br><span class="line">  <span class="comment">// b = 9</span></span><br><span class="line">  <span class="comment">// c = 9</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="String-2"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String">String</a></h4>
<p><strong>练习</strong></p>
<p>1、&quot;abcoefoxyozzopp&quot;查找字符串中所有o出现的位置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;abcoefoxyozzopp&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> array = [];</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> index = s.<span class="title function_">indexOf</span>(<span class="string">&#x27;o&#x27;</span>, index + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (index != -<span class="number">1</span>) &#123;</span><br><span class="line">    array.<span class="title function_">push</span>(index);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (index &gt; -<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array);</span><br></pre></td></tr></table></figure>
<p>2、把字符串中所有的o替换成!</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;abcoefoxyozzopp&#x27;</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  s = s.<span class="title function_">replace</span>(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">while</span> (s.<span class="title function_">indexOf</span>(<span class="string">&#x27;o&#x27;</span>) &gt; -<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">replace</span>(<span class="regexp">/o/ig</span>, <span class="string">&#x27;&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>3、判断一个字符串中出现次数最多的字符，统计这个次数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&#x27;abcoefoxyozzopp&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; s.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> item = s.<span class="title function_">charAt</span>(i);</span><br><span class="line">  <span class="keyword">if</span> (o[item]) &#123;</span><br><span class="line">    o[item] ++;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    o[item] = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> max = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> char ;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> o) &#123;</span><br><span class="line">  <span class="keyword">if</span> (max &lt; o[key]) &#123;</span><br><span class="line">    max = o[key];</span><br><span class="line">    char = key;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(char);</span><br></pre></td></tr></table></figure>
<p>4、声明：var str= “<a href="http://localhost/mylive.php?id=99&amp;key=%E5%8F%8C11%E7%89%B9%E6%83%A0&amp;age=20">http://localhost/mylive.php?id=99&amp;key=双11特惠&amp;age=20</a>”;<br>
要求返回结果是：<br>
1）数组 [“99”,“双11特惠”,“20”]<br>
2）对象 {id: “99”, key: “双11特惠”, age: “20”}</p>
<p>5、写一段程序,实现将字符串反转。<br>
如 var str = ”I love Javascript”; 反转后的字符串为 “Javascript love I”</p>
<p>6、将get-element-by-id 转成 getElementById</p>
<h4 id="Array"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a></h4>
<h4 id="Object"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></h4>
<h4 id="this指向">this指向</h4>
<p><strong>函数的上下文</strong>(this关键字) 由调用函数的方式决定</p>
<p>函数如果不调用 就不能确定函数的上下文</p>
<hr>
<p>规则1: 对象打点调用它的方法函数 则函数上下文是这个打点的对象<br>
语法: 对象.方法()</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure>
<p>函数的this指向不是由定义在哪决定的 而是由谁调用决定的</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">fn</span>: obj1.<span class="property">fn</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj2.<span class="title function_">fn</span>()</span><br><span class="line"></span><br><span class="line">=============</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>, b = <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">foo</span>()</span><br><span class="line"></span><br><span class="line">=============</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="attr">c</span>: fn</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line">obj.<span class="property">c</span>[<span class="number">0</span>].<span class="title function_">c</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>规则2: 圆括号直接调用函数 则函数的上下文是window对象</p>
<p>通过var声明的变量会挂载到window上</p>
<p>开启严格模式 =&gt; this =&gt; undefined</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">20</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>()</span><br><span class="line"></span><br><span class="line">=============</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) </span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// var声明的变量会挂载到window上</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="title function_">fn</span>(), </span><br><span class="line">  <span class="attr">c</span>: fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> res = obj.<span class="title function_">c</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res) </span><br></pre></td></tr></table></figure>
<p>规则3: <strong>数组</strong>(类数组对象)遍历出函数进行调用 <strong>this指向就是该数组</strong>(类数组对象)</p>
<p>数组【下标】</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>[<span class="number">3</span>]())</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>[<span class="number">0</span>])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>规则4: IIFE函数(自执行函数) this指向是window对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">============</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">fun</span>: (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="variable language_">this</span>.<span class="property">a</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(a + <span class="variable language_">this</span>.<span class="property">a</span>) </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">fun</span>()    </span><br></pre></td></tr></table></figure>
<p>规则5: 定时器调用函数 this指向是window</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> timeId = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br><span class="line"><span class="built_in">clearTimeout</span>(timeId)</span><br><span class="line"></span><br><span class="line">==============</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">fun</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">4</span></span><br><span class="line"><span class="built_in">setTimeout</span>(obj.<span class="property">fun</span>, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">==============</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">fun</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">4</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) </span><br><span class="line">  obj.<span class="title function_">fun</span>() </span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<p>规则6: 事件处理函数的this指向是绑定事件的dom元素</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dom元素.事件 = 事件处理函数</span><br><span class="line">实现效果: 三个div, 点击哪个哪个变红, 要求使用同一个事件处理函数实现</span><br></pre></td></tr></table></figure>
<p>规则7: 类(构造函数)里面的this指向通过该类(构造函数)创建的实例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;zs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>)&#123;</span><br><span class="line">  	<span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&#x27;zs&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>规则8：箭头函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 箭头函数中的this指向的是定义时的this，而不是执行时的this</span></span><br><span class="line"><span class="comment">// 箭头函数中不绑定this，箭头函数中的this指向是它所定义的位置，可以简单理解成，定义箭头函数中的作用域的this指向谁，它就指向谁</span></span><br><span class="line"><span class="comment">// 箭头函数的优点在于解决了this执行环境所造成的一些问题。比如：解决了匿名函数this指向的问题（匿名函数的执行环境具有全局性），包括setTimeout和setInterval中使用this所造成的问题</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">      <span class="attr">fn</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">   <span class="keyword">var</span> obj = &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">     <span class="attr">fn</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) </span><br><span class="line">       <span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) </span><br><span class="line">       &#125;</span><br><span class="line">       <span class="title function_">add</span>()</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = obj.<span class="property">fn</span></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure>
<h4 id="源码分析">源码分析</h4>
<h5 id="new">new</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// new关键字做了哪些事</span></span><br><span class="line"><span class="comment">// 1、申请一块空间 =&gt; 创建一个新对象</span></span><br><span class="line"><span class="comment">// 2、让新对象的__proto__指向构造函数的原型对象</span></span><br><span class="line"><span class="comment">// 3、确认this指向</span></span><br><span class="line"><span class="comment">// 4、调用构造函数初始化属性</span></span><br><span class="line"><span class="comment">// 5、返回新对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="comment">// return &#123;name: &#x27;ls&#x27;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hi&#x27;</span>)&#125;</span><br><span class="line"><span class="comment">// let p = new Person(&#x27;zs&#x27;)</span></span><br><span class="line"><span class="comment">// console.log(p)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mockNew</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1、创建新对象</span></span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  <span class="comment">// 2、让新对象的__proto__指向构造函数的原型对象</span></span><br><span class="line">  <span class="comment">// 获取第一个参数作为构造函数</span></span><br><span class="line">  <span class="keyword">let</span> constructor = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="comment">// 继承原型上的成员</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = constructor.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">  <span class="comment">// 3、确认this指向 (构造函数中的this指向实例对象)</span></span><br><span class="line">  <span class="comment">// 4、调用构造函数初始化属性</span></span><br><span class="line">  <span class="keyword">let</span> res = constructor.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="comment">// 5、返回新对象</span></span><br><span class="line">  <span class="keyword">return</span> res <span class="keyword">instanceof</span> <span class="title class_">Object</span> ? res : obj</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="title function_">mockNew</span>(<span class="title class_">Person</span>, <span class="string">&#x27;zs&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>)</span><br><span class="line">p.<span class="title function_">sayHi</span>()</span><br></pre></td></tr></table></figure>
<h5 id="call">call</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// call(this, arg1, arg2 ...)</span></span><br><span class="line"><span class="comment">// 改变this指向 立即执行函数</span></span><br><span class="line"><span class="comment">// 如果第一个参数没传 || 传的是null || 传的是undefined =&gt; this指向都是window</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// context: 需要被修改的this指向</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="comment">// this指向的判断</span></span><br><span class="line">  <span class="comment">// context = String &#123;&#x27;1&#x27;&#125;</span></span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="variable language_">window</span></span><br><span class="line">  <span class="comment">// 更改this指向</span></span><br><span class="line">  <span class="comment">// String &#123;&#x27;1&#x27;&#125;.fn = fn1</span></span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">let</span> arr = []</span><br><span class="line">  <span class="variable language_">arguments</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>).<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    arr.<span class="title function_">push</span>(<span class="string">&#x27;arguments[&#x27;</span> + i + <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="built_in">eval</span>(<span class="string">&#x27;context.fn(&#x27;</span> + arr + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// fn1.call(null, 1, 2)</span></span><br><span class="line"><span class="comment">// fn1.call(&#x27;1&#x27;, 1, 2)</span></span><br><span class="line"><span class="comment">// fn1.call(fn2, 1, 2)</span></span><br><span class="line"><span class="comment">// fn1.call.call(fn2) </span></span><br><span class="line"><span class="comment">// fn1.call.call.call(fn2) // window arguments[]</span></span><br><span class="line"><span class="comment">// fn1.call.call.call(fn2, 1) // Number &#123;1&#125; arguments[]</span></span><br><span class="line"><span class="comment">// fn1.call.call.call(fn2, 1, 2) // Number &#123;1&#125; arguments[2]</span></span><br><span class="line"><span class="comment">// fn1.call.call.call 并没有调用, 只是链式获取对象的call属性, 所以这一串的结果是Function.call 属性。</span></span><br><span class="line"><span class="comment">// 所以那一串就是 Function.call.call(fn2) 可以解理为 fn3(假设).call(fn2)。</span></span><br><span class="line"><span class="comment">// 根据call的原理（可参考上面的call模拟），在fn3执行call，其实际是fn2.fn3()。</span></span><br><span class="line"><span class="comment">// 由于 fn3实际上就是 call 函数，所以, fn2.fn3() 等价于 fn2.call()。</span></span><br><span class="line"><span class="comment">// 所以最终结果, 就是调用 fn2.call() =&gt;　所以结果输出 this =&gt; window</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call的应用场景</span></span><br><span class="line"><span class="comment">// 伪数组</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="number">111</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="number">222</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="number">333</span>,</span><br><span class="line">  <span class="attr">length</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// obj[obj.length] = 444</span></span><br><span class="line"><span class="comment">// obj.length ++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// call借用数组的push方法</span></span><br><span class="line"><span class="comment">// Array.prototype.push.call(obj, 444)</span></span><br><span class="line"><span class="comment">// console.log(obj)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数列表的个数和类型取决于借用的方法的参数</span></span><br><span class="line"><span class="comment">// console.log(Object.prototype.toString.call([]))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// es5继承中 子级借用父级构造函数初始化自身的属性</span></span><br></pre></td></tr></table></figure>
<h5 id="apply">apply</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// apply(this, [arg1, arg2...])</span></span><br><span class="line"><span class="comment">// 改变this指向 立即执行函数</span></span><br><span class="line"><span class="comment">// 如果第一个参数没传 || 传的是null || 传的是undefined =&gt; this指向都是window</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">apply</span> = <span class="keyword">function</span> (<span class="params">context, args</span>) &#123;</span><br><span class="line">  <span class="comment">// this指向的判断</span></span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="variable language_">window</span></span><br><span class="line">  <span class="comment">// 更改this指向</span></span><br><span class="line">  context.<span class="property">fn</span> = <span class="variable language_">this</span></span><br><span class="line">  <span class="comment">// 如果没有传入第二个参数</span></span><br><span class="line">  <span class="keyword">if</span>(!args) &#123;</span><br><span class="line">    <span class="comment">// 直接执行函数</span></span><br><span class="line">    context.<span class="title function_">fn</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="built_in">eval</span>(<span class="string">&#x27;context.fn(&#x27;</span> + args + <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">  <span class="keyword">delete</span> context.<span class="property">fn</span></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line">fn1.<span class="title function_">apply</span>(<span class="number">1</span>, [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// apply的应用场景</span></span><br><span class="line"><span class="comment">// let max = Math.max(1, 345, 212, 23, 234, 34)</span></span><br><span class="line"><span class="comment">// let max = Math.max(...[1, 345, 212, 23, 234, 34])</span></span><br><span class="line"><span class="keyword">let</span> max = <span class="title class_">Math</span>.<span class="property">max</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">345</span>, <span class="number">212</span>, <span class="number">23</span>, <span class="number">234</span>, <span class="number">34</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max)</span><br></pre></td></tr></table></figure>
<h5 id="bind">bind</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bind(this, arg1, arg2)</span></span><br><span class="line"><span class="comment">// 返回值是一个改变this上下文的函数 不会立即执行</span></span><br><span class="line"><span class="comment">// 返回的函数在调用时也可以传参 最终参数会合并</span></span><br><span class="line"><span class="comment">// 如果第一个参数没传 || 传的是null || 传的是undefined =&gt; this指向都是window</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">xx</span> = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">  <span class="comment">// return 111</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  context = context ? <span class="title class_">Object</span>(context) : <span class="variable language_">window</span></span><br><span class="line">  <span class="keyword">let</span> that = <span class="variable language_">this</span> <span class="comment">// fn1</span></span><br><span class="line">  <span class="keyword">let</span> bindArgs = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>).<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">FBound</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> that.<span class="title function_">apply</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">FBound</span> ? <span class="variable language_">this</span> : context, bindArgs.<span class="title function_">concat</span>(...<span class="variable language_">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 这种方式会直接改变FBound的原型</span></span><br><span class="line">  <span class="comment">// FBound.prototype = this.prototype</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="variable language_">this</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">  <span class="title class_">FBound</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Fn</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">FBound</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// let fn = fn1.bind(fn2, 2, 3)</span></span><br><span class="line"><span class="comment">// let res = fn(4, 5)</span></span><br><span class="line"><span class="comment">// console.log(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let fn = fn1.bind(obj, 1, 2)</span></span><br><span class="line"><span class="comment">// // fn()</span></span><br><span class="line"><span class="comment">// // 此时fn1中的this指向的是fn1的实例对象</span></span><br><span class="line"><span class="comment">// let res = new fn()</span></span><br><span class="line"><span class="comment">// console.log(res)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fn1原型上添加的属性丢失问题</span></span><br><span class="line">fn1.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line"><span class="keyword">let</span> fn = fn1.<span class="title function_">bind</span>(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> res = <span class="keyword">new</span> <span class="title function_">fn</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">age</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind的应用</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// obj</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>) <span class="comment">// &#x27;&#x27;</span></span><br><span class="line">    &#125;.<span class="title function_">bind</span>(obj), <span class="number">2000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure>
<h4 id="对象"><strong>对象</strong></h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">用js描述生活中的汽车</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;布加迪&#x27;</span></span><br><span class="line"><span class="keyword">var</span> price = <span class="number">999</span></span><br><span class="line"><span class="keyword">var</span> color = <span class="string">&#x27;black&#x27;</span></span><br><span class="line">如果使用基本数据类型描述对象 它所创建的变量都是独立 不能成为一个整体</span><br><span class="line"></span><br><span class="line">所以考虑用对象来描述</span><br><span class="line">对象是一种复合数据类型 在对象里面可以保存多个不同数据类型属性</span><br><span class="line">在对象中创建的变量都是从属于一个整体</span><br></pre></td></tr></table></figure>
<h5 id="对象的分类">对象的分类</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、内建(内置)对象</span><br><span class="line">   - 由<span class="variable constant_">JS</span>标准中定义的对象</span><br><span class="line">   - 比如: <span class="title class_">Math</span>、<span class="title class_">Date</span>、<span class="title class_">String</span>、<span class="title class_">Function</span>、<span class="title class_">Object</span>、<span class="title class_">Array</span>...</span><br><span class="line"><span class="number">2</span>、宿主对象</span><br><span class="line">   - 由<span class="variable constant_">JS</span>的运行环境提供的 (由浏览器提供的)</span><br><span class="line">   - <span class="variable constant_">DOM</span>、<span class="variable constant_">BOM</span>、<span class="title class_">Console</span></span><br><span class="line"><span class="number">3</span>、自定义对象</span><br><span class="line">   - 开发人员自己创建的对象</span><br></pre></td></tr></table></figure>
<h5 id="创建对象方式1">创建对象方式1</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">不成文的规定</span><br><span class="line">首字母大写的函数是构造函数 =&gt; 用来配合<span class="keyword">new</span>关键字进行实例化对象的 =&gt; <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line">首字母小写的函数是普通函数 =&gt; 用来调用的 =&gt; <span class="title function_">sayHi</span>()</span><br><span class="line"><span class="number">1</span>、通过<span class="keyword">new</span>关键字调用js提供的<span class="title class_">Object</span>函数(构造函数)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Object</span>(<span class="params"></span>)&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="new-关键字做了哪些事">new 关键字做了哪些事</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>、在堆内存中申请一块空间 创建一个新对象&#123;&#125;</span><br><span class="line"><span class="number">2</span>、新对象的__proto__指向构造函数中的原型对象prototype</span><br><span class="line"><span class="number">3</span>、确认<span class="variable language_">this</span>指向 让上下文中<span class="variable language_">this</span>指向这个新对象</span><br><span class="line"><span class="number">4</span>、执行构造函数中的代码 初始化新对象</span><br><span class="line"><span class="number">5</span>、返回新对象 返回的是新对象的地址值 即便没有<span class="keyword">return</span> 构造函数也会默认返回<span class="variable language_">this</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> car = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"><span class="comment">// 添加属性 =&gt; 语法: 对象.属性 = 属性值</span></span><br><span class="line">car.<span class="property">name</span> = <span class="string">&#x27;布加迪&#x27;</span></span><br><span class="line">car.<span class="property">price</span> = <span class="number">999</span></span><br><span class="line">car.<span class="property">color</span> = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"><span class="comment">// 获取属性 =&gt; 语法: 对象.属性</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">name</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">price</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">color</span>)</span><br><span class="line"><span class="comment">// 修改属性 =&gt; 语法: 对象.属性 = 新值</span></span><br><span class="line">car.<span class="property">name</span> = <span class="string">&#x27;劳斯莱斯&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// 删除属性 =&gt; delete 对象.属性名</span></span><br><span class="line"><span class="keyword">delete</span> car.<span class="property">name</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// 添加方法 =&gt; 对象.方法名 = 函数</span></span><br><span class="line">car.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;run ~&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用方法 =&gt; 对象.方法名()</span></span><br><span class="line">car.<span class="title function_">run</span>()</span><br><span class="line"><span class="comment">// 修改方法 =&gt; 对象.方法名 = 新函数</span></span><br><span class="line">car.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new run ~&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">car.<span class="title function_">run</span>()</span><br><span class="line"><span class="comment">// 删除方法</span></span><br><span class="line"><span class="keyword">delete</span> car.<span class="property">run</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(car.<span class="property">run</span>) <span class="comment">// undefined</span></span><br><span class="line">car.<span class="title function_">run</span>() <span class="comment">// TypeError: car.run is not a function</span></span><br></pre></td></tr></table></figure>
<h5 id="工厂函数">工厂函数</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> car1 = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">car1.<span class="property">name</span> = <span class="string">&#x27;布加迪&#x27;</span></span><br><span class="line">car1.<span class="property">price</span> = <span class="number">999</span></span><br><span class="line">car1.<span class="property">color</span> = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car2 = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">car2.<span class="property">name</span> = <span class="string">&#x27;布加迪&#x27;</span></span><br><span class="line">car2.<span class="property">price</span> = <span class="number">999</span></span><br><span class="line">car2.<span class="property">color</span> = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car3 = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">car3.<span class="property">name</span> = <span class="string">&#x27;布加迪&#x27;</span></span><br><span class="line">car3.<span class="property">price</span> = <span class="number">999</span></span><br><span class="line">car3.<span class="property">color</span> = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代码的重复度过高、复用性差 =&gt; 考虑封装 =&gt; 工厂函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createCar</span>(<span class="params">name, price, color</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> car = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">  car.<span class="property">name</span> = name</span><br><span class="line">  car.<span class="property">price</span> = price</span><br><span class="line">  car.<span class="property">color</span> = color</span><br><span class="line">  car.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;run ~&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> car</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 发现问题 所以返回的对象属性值都是一样的</span></span><br><span class="line"><span class="comment">// 所以我们将工厂函数中的固定的属性值提取到函数的形参上</span></span><br><span class="line"><span class="comment">// 让调用者自行传递</span></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="title function_">createCar</span>(<span class="string">&#x27;布加迪&#x27;</span>, <span class="number">999</span>, <span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="title function_">createCar</span>(<span class="string">&#x27;劳斯莱斯&#x27;</span>, <span class="number">888</span>, <span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> c3 = <span class="title function_">createCar</span>(<span class="string">&#x27;宝马&#x27;</span>, <span class="number">777</span>, <span class="string">&#x27;white&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="创建对象方式2">创建对象方式2</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第一种方式 new Object() 缺点: </span></span><br><span class="line"><span class="comment">// 1、代码复用性较差 =&gt; 工厂函数</span></span><br><span class="line"><span class="comment">// 2、无法判断实例化的对象具体属于什么类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> obj) <span class="comment">// object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj <span class="keyword">instanceof</span> <span class="title class_">Object</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">toString</span>(obj)) <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure>
<p><strong>自定义构造函数的方式创建对象</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 3、自定义构造函数的方式创建对象</span></span><br><span class="line"><span class="comment">// 构造函数的声明也要遵循驼峰命名法</span></span><br><span class="line"><span class="comment">// 缺点: 构造函数中定义函数，那么每次创建对象，都会重新创建该函数,这样会导致全局变量增多,造成污染, 浪费内存</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="comment">// 指向当前实例化对象</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age,</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sayHi ~&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;zs&quot;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">name</span>)</span><br><span class="line">p1.<span class="title function_">say</span>()</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;ls&quot;</span>, <span class="number">20</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">age</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1 <span class="keyword">instanceof</span> <span class="title class_">Person</span>) <span class="comment">// true</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1 <span class="keyword">instanceof</span> <span class="title class_">Animal</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="title function_">toString</span>(p1)) <span class="comment">// [object Object]</span></span><br></pre></td></tr></table></figure>
<h5 id="创建对象方式3">创建对象方式3</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">字面量的方式: 创建出来的对象是一次性的 复用性差 如果要创建多个对象，代码冗余度太高</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello ~&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>)</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;ls&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>)</span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure>
<h5 id="遍历对象">遍历对象</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello ~&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 使用对象[属性] 属性要写成字符串而不是变量</span></span><br><span class="line"><span class="comment">// 如果是变量则会到当前作用域中查找有没有该变量而不是对象中 没找到就报错</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj[<span class="string">&#x27;age&#x27;</span>])</span><br><span class="line"><span class="comment">// obj =&gt; 需要遍历的对象</span></span><br><span class="line"><span class="comment">// key =&gt; 键 =&gt; 对象的属性名</span></span><br><span class="line"><span class="comment">// obj[key] =&gt; 值 =&gt; 对象属性对应的值</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="comment">// console.log(key) // name age fn</span></span><br><span class="line">  <span class="comment">// 如果使用.拼接 会到obj对象中去查找key属性 找不到则报undefined</span></span><br><span class="line">  <span class="comment">// console.log(obj.key)</span></span><br><span class="line">  <span class="comment">// 如果涉及到变量的拼接 不要使用.语法 要使用[]</span></span><br><span class="line">  <span class="comment">// []能做到的.不一定能做到 .能做到的[]一定能做到的</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(obj[key])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="构造函数">构造函数</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 1、构造函数就是一个普通的函数 创建方式和普通函数没什么区别</span></span><br><span class="line"><span class="comment"> * 唯一不同的就是构造函数首字母大写 多个单词遵循驼峰命名法</span></span><br><span class="line"><span class="comment"> * 2、构造函数和普通的调用方式的不同</span></span><br><span class="line"><span class="comment"> *    - 构造函数配合new关键是调用 =&gt; 创建对象的</span></span><br><span class="line"><span class="comment"> *    - 普通函数直接调用 =&gt; 执行函数中的代码</span></span><br><span class="line"><span class="comment"> * 3、new 关键字做了哪些事情 ?</span></span><br><span class="line"><span class="comment"> *    - 在堆内存中申请一块空间 创建一个新对象&#123;&#125;</span></span><br><span class="line"><span class="comment"> *    - 新对象的__proto__指向构造函数中的原型对象prototype</span></span><br><span class="line"><span class="comment"> *    - 确认this指向 让上下文中this指向这个新对象</span></span><br><span class="line"><span class="comment"> *    - 执行构造函数中的代码 初始化新对象</span></span><br><span class="line"><span class="comment"> *    - 返回新对象 返回的是新对象的地址值 即便没有return 构造函数也会默认返回this</span></span><br><span class="line"><span class="comment"> * 4、使用同一个构造函数创建的对象 我们称之为同一类对象 也会将构造函数称之为类</span></span><br><span class="line"><span class="comment"> *    - 通过构造函数创建的对象 我们称之为类的实例</span></span><br><span class="line"><span class="comment"> *    - 实例对象是由构造函数创建出来 这个创建的过程我们称之为实例化</span></span><br><span class="line"><span class="comment"> * 5、构造函数中的this指向当前实例化的对象</span></span><br><span class="line"><span class="comment"> * 6、instanceof用来检测一个对象是否某个类的实例</span></span><br><span class="line"><span class="comment"> *    - 对象 instanceof 构造函数名</span></span><br><span class="line"><span class="comment"> *    - 对象.__proto__.constructor == 构造函数名</span></span><br><span class="line"><span class="comment"> *    - 不管用什么构造函数 只要是实例化出来的对象 instanceof检测结果都为true</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(p) <span class="comment">// =&gt; constructor =&gt; ƒ Person()</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">__proto__</span>.<span class="property">constructor</span> == <span class="title class_">Person</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">constructor</span> == <span class="title class_">Person</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><strong>构造函数创建对象存在的问题</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var study = new Function(&#x27;console.log(&quot;good good study, day day up&quot;)&#x27;)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;good good study, day day up&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果将fn函数定义在全局的作用域下 则会污染全局作用域的命名空间</span></span><br><span class="line"><span class="comment">// 如果声明了和它一样名字的变量或者方法 则会将其覆盖</span></span><br><span class="line"><span class="comment">// 存在命名冲突的问题</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在Student中为每个实例化对象添加了一个study方法</span></span><br><span class="line"><span class="comment">// 每次实例化对象都会执行构造函数中的代码 创建一个函数对象</span></span><br><span class="line"><span class="comment">// 每个函数对象地址值都不一样(唯一的)</span></span><br><span class="line"><span class="comment">// 执行100次就创建100个函数对象、但函数中的内容又是一模一样的</span></span><br><span class="line"><span class="comment">// 我们能不能让所有实例共享同一个函数呢? =&gt; 将函数提取到构造函数外面</span></span><br><span class="line"><span class="comment">// 每次执行构造函数的代码都是将外面的fn函数赋值给this.study</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age, sex</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sex</span> = sex</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">study</span> = fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> stu1 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;zs&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;man&#x27;</span>)</span><br><span class="line">stu1.<span class="title function_">study</span>()</span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;ls&#x27;</span>, <span class="number">16</span>, <span class="string">&#x27;woman&#x27;</span>)</span><br><span class="line">stu2.<span class="title function_">study</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu1.<span class="property">study</span> == stu2.<span class="property">study</span>) <span class="comment">// false =&gt; true</span></span><br></pre></td></tr></table></figure>
<h4 id="原型">原型</h4>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原型 prototype</span></span><br><span class="line"><span class="comment">// 作用: </span></span><br><span class="line"><span class="comment">// 1、数据共享 节省了内存空间 避免了全局污染</span></span><br><span class="line"><span class="comment">// 2、模拟了类与类之间的关系</span></span><br><span class="line"><span class="comment">// 3、继承的前提</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型分类</span></span><br><span class="line"><span class="comment">// 1、我们所创建出来的每一个函数 js引擎都会向函数中添加一个属性 prototype</span></span><br><span class="line"><span class="comment">// 它对应的值就是一个对象 也就是我们说的原型对象 这个对象是标准的 给程序员使用的 显示原型</span></span><br><span class="line"><span class="comment">// 2、通过构造函数实例化的对象中也有一个属性 __proto__</span></span><br><span class="line"><span class="comment">// 它也是原型 它是不标准的 是给浏览器使用的 隐式原型 =&gt; 原型链的查找就是通过它</span></span><br><span class="line"><span class="comment">// 隐式原型指向显示原型的 =&gt; 所以所有实例化对象都能够直接访问到显示原型中的属性和方法</span></span><br><span class="line"><span class="comment">// 显示原型对象上有一个constructor属性 它指向的是该原型对象所在的构造函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型其实一个公共的对象 所有同一个类的实例都可以访问到这个原型对象</span></span><br><span class="line"><span class="comment">// 只要是需要共享的属性和方法 我们都统一设置到原型上</span></span><br><span class="line"><span class="comment">// 不需要为每一个实例化对象分别添加属性和方法 也不会影响到全局作用域 就可以使每个对象都具备原型上的属性和方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型对象、实例对象、构造函数三者之间的关系</span></span><br><span class="line"><span class="comment">// 1、实例对象是由构造函数实例化出来的</span></span><br><span class="line"><span class="comment">// 2、构造函数中有一个prototype属性 指向的是prototype原型对象 </span></span><br><span class="line"><span class="comment">// 在原型对象上有一个constructor属性 它指向是构造器 该构造器表示的是原型所在的构造函数</span></span><br><span class="line"><span class="comment">// 3、实例对象中有一个__proto__属性 指向的是实例化该对象的构造函数中的prototype原型对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果看到某个变量中有__proto__属性 那么它一定是一个对象</span></span><br><span class="line"><span class="comment">// 所有实例化对象都直接或者间接的继承了原型上的属性和方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">say</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;听大家说高考数学卷很难 昨晚试了一下 两个小时后才发现试卷拿反了&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型上添加属性</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">score</span> = <span class="number">88</span></span><br><span class="line"><span class="comment">// 原型上添加方法</span></span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHi</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;哥们你这睡眠质量不行 我一般都8小时后才发现&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;zs&#x27;</span>, <span class="number">18</span>)</span><br><span class="line"><span class="comment">// 访问私有的属性</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// 访问私有的方法</span></span><br><span class="line">stu.<span class="title function_">say</span>()</span><br><span class="line"><span class="comment">// 访问原型上的属性</span></span><br><span class="line"><span class="comment">// console.log(stu.__proto__.score)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">score</span>)</span><br><span class="line"><span class="comment">// 访问原型上的方法</span></span><br><span class="line"><span class="comment">// stu.__proto__.sayHi()</span></span><br><span class="line"><span class="comment">// 开发过程中__proto__可以省略不写</span></span><br><span class="line">stu.<span class="title function_">sayHi</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stu2 = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&#x27;ls&#x27;</span>, <span class="number">20</span>)</span><br><span class="line"><span class="comment">// 两个实例访问的是同一个原型 所以使用的是同一个方法</span></span><br><span class="line"><span class="comment">// 比较私有的方法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">say</span> == stu2.<span class="property">say</span>) <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 比较公有的方法</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">sayHi</span> == stu2.<span class="property">sayHi</span>) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 比较原型指向</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu2.<span class="property">__proto__</span> == <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var obj1 = &#123;</span></span><br><span class="line"><span class="comment">//   name : &#x27;zs&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var obj2 = obj1</span></span><br><span class="line"><span class="comment">// console.log(obj2.name)</span></span><br></pre></td></tr></table></figure>
<h5 id="Array原型">Array原型</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var arr1 = [1, 2, 3]</span></span><br><span class="line"><span class="comment">// var arr2 = [4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var arr1 = new Array(1, 2, 3)</span></span><br><span class="line"><span class="comment">// var arr2 = new Array(4, 5, 6)</span></span><br><span class="line"><span class="comment">// 通过查看控制台发现 数组实例上只有元素和length属性</span></span><br><span class="line"><span class="comment">// 为什么能访问到push方法呢 ?</span></span><br><span class="line"><span class="comment">// console.log(arr1)</span></span><br><span class="line"><span class="comment">// 通过__proto__找到Array构造函数原型上的push方法 =&gt; 继承</span></span><br><span class="line"><span class="comment">// console.log(arr1.__proto__.push == arr2.__proto__.push) // true</span></span><br><span class="line"><span class="comment">// 查看push方法是否在Array原型上</span></span><br><span class="line"><span class="comment">// console.log(Array.prototype)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需求: 我们希望数组能提供一个求和的方法</span></span><br><span class="line"><span class="comment">// 相当于在修改数组的源码 添加自定义方法</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getSum</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">  <span class="comment">// 谁调用getSum this就代表谁</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++)&#123;</span><br><span class="line">    sum += <span class="variable language_">this</span>[i]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建实例对象</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// 调用原型上自定义的方法</span></span><br><span class="line"><span class="keyword">var</span> res = arr.<span class="title function_">getSum</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="number">23</span>,<span class="number">432</span>,<span class="number">35</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr2.<span class="title function_">getSum</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="property">getSum</span> == arr2.<span class="property">getSum</span>) <span class="comment">// true </span></span><br></pre></td></tr></table></figure>
<h5 id="原型的简单写法">原型的简单写法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">zhua</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;猫抓老鼠狗吃肉 凹凸曼打小怪兽&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Cat.prototype.leg = 4</span></span><br><span class="line"><span class="comment">// Cat.prototype.color = &#x27;yellow&#x27;</span></span><br><span class="line"><span class="comment">// Cat.prototype.height = 30</span></span><br><span class="line"><span class="comment">// Cat.prototype.run = function()&#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;run run ~&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// Cat.prototype.eat = function()&#123;</span></span><br><span class="line"><span class="comment">//   // Cat.prototype.run()</span></span><br><span class="line"><span class="comment">//   // 此时的this指向调用者c1</span></span><br><span class="line"><span class="comment">//   this.run()</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;吃猫粮 ~&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型的简单写法</span></span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="comment">// 构造器的指向需要手动指定</span></span><br><span class="line">  <span class="attr">constructor</span>: <span class="title class_">Cat</span>,</span><br><span class="line">  <span class="attr">leg</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&#x27;yellow&#x27;</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">30</span>,</span><br><span class="line">  <span class="attr">run</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;run run ~&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">eat</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">run</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;吃猫粮 ~&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&quot;布偶&quot;</span>, <span class="number">2</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">name</span>)</span><br><span class="line">c1.<span class="title function_">zhua</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">leg</span>)</span><br><span class="line">c1.<span class="title function_">eat</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c1.<span class="property">__proto__</span>)</span><br></pre></td></tr></table></figure>
<h5 id="原型的查找规则">原型的查找规则</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">zhua</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;猫抓老鼠狗吃肉 凹凸曼打小怪兽&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sex</span> = <span class="string">&#x27;man&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;大金毛&#x27;</span>, <span class="number">5</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog)</span><br><span class="line"><span class="comment">// 对象.hasOwnProperty(&#x27;属性名&#x27;) =&gt; 检测对象自身是否有该属性</span></span><br><span class="line"><span class="comment">// 只有当对象自身有该属性时 才会返回true</span></span><br><span class="line"><span class="comment">// 即便原型上有该属性 也返回false</span></span><br><span class="line"><span class="comment">// 检测自身</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;age&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;weight&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 检测原型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;sex&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// in 使用in检测对象中是否有某个属性 如果对象自身有 返回true</span></span><br><span class="line"><span class="comment">// 如果对象自身没有 原型有 也返回true</span></span><br><span class="line"><span class="comment">// 检测自身</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name&#x27;</span> <span class="keyword">in</span> dog) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;height&#x27;</span> <span class="keyword">in</span> dog) <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 检测原型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;sex&#x27;</span> <span class="keyword">in</span> dog) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;hasOwnProperty&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hasOwnProperty&#x27;</span> <span class="keyword">in</span> dog) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// dog.aaa is not a function</span></span><br><span class="line"><span class="comment">// dog.aaa()</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="property">aaa</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型的查找规则 =&gt; 就近原则 =&gt; 先找自身 =&gt; 沿着原型链往上找 =&gt; Objcet.prototype</span></span><br><span class="line"><span class="comment">// 当我们的对象在调用属性或方法时 </span></span><br><span class="line"><span class="comment">// 1、在对象自身上查找是否有该属性和方法</span></span><br><span class="line"><span class="comment">// 2、如果自身没有 则沿着原型链去原型上找 如果原型上有 则直接使用</span></span><br><span class="line"><span class="comment">// 3、如果原型没有 则继续往原型的原型上找 直到找到Object的原型对象为止 (null)</span></span><br><span class="line"><span class="comment">// 4、如果Object原型上也没有 属性找不到 则返回undefined 方法找不到就报错</span></span><br></pre></td></tr></table></figure>
<h5 id="原型的终点">原型的终点</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">zhua</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;猫抓老鼠狗吃肉 凹凸曼打小怪兽&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// Dog构造函数中的原型对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>) <span class="comment">// Dog构造函数中的原型对象的原型 =&gt; Object.prorotype</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>) <span class="comment">// Object原型的原型 =&gt; null</span></span><br></pre></td></tr></table></figure>
<h5 id="改变原型指向">改变原型指向</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 改变原型指向注意的问题</span></span><br><span class="line"><span class="comment">// Animal类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name, age, sex</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sex</span> = sex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">weight</span> = <span class="number">18</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sleep</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;睡觉咯 ~&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ErHa类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ErHa</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">zhua</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;猫抓老鼠狗吃肉 凹凸曼打小怪兽&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变原型指向之前添加方法和属性</span></span><br><span class="line"><span class="comment">// ErHa.prototype.color = &#x27;black and white&#x27;</span></span><br><span class="line"><span class="comment">// ErHa.prototype.run = function()&#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;跑起来疯疯癫癫&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变 ErHa 的原型指向</span></span><br><span class="line"><span class="comment">// 让 ErHa 的原型指向 指向了Animal的实例</span></span><br><span class="line"><span class="comment">// ErHa.prototype = new Animal(&quot;小狗&quot;, 5, &#x27;man&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变原型指向之后添加方法和属性</span></span><br><span class="line"><span class="comment">// ErHa.prototype.color = &#x27;black and white&#x27;</span></span><br><span class="line"><span class="comment">// ErHa.prototype.run = function () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;跑起来疯疯癫癫&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">ErHa</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> erha = <span class="keyword">new</span> <span class="title class_">ErHa</span>(<span class="string">&#x27;二哈&#x27;</span>, <span class="number">3</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(erha.<span class="property">name</span>)</span><br><span class="line"><span class="comment">// console.log(erha.color)</span></span><br><span class="line">erha.<span class="title function_">zhua</span>()</span><br><span class="line"><span class="comment">// erha.__proto__.run()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(erha.__proto__) // 是Animal实例对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(erha.<span class="property">weight</span>)</span><br><span class="line"><span class="comment">// erha.sleep()</span></span><br></pre></td></tr></table></figure>
<h4 id="继承">继承</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Ajax">Ajax</h4>
<h5 id="初体验">初体验</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、创建ajax核心对象</span></span><br><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line"><span class="comment">// 2、建立连接</span></span><br><span class="line"><span class="comment">//    - 参数1: 请求方式 常用的有: get(获取) post(提交) delete(删除) put(修改) patch(打补丁的修改)</span></span><br><span class="line"><span class="comment">//    - 参数2: 请求路径 url</span></span><br><span class="line"><span class="comment">//    - 参数3: boolean类型 默认为true </span></span><br><span class="line"><span class="comment">//    同步(false) 或 异步(true)</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;https://api.it120.cc/fyy/shop/goods/list&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">// 3、发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">// 4、监听服务端响应</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="comment">// JSON.parse: 反序列化 将满足JSON格式的字符串转成对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ajax核心对象">ajax核心对象</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;!-- 如果是表单提交的方式 一定要加上name属性 --&gt;</span><br><span class="line">  &lt;!-- 数据提交时会将name属性的值作为键 用户输入的数据作为值 --&gt;</span><br><span class="line">  &lt;!-- 拼接成一个对象 放到请求体中提交给后端 --&gt;</span><br><span class="line">  &lt;!-- &lt;form action=&quot;/add&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">    密码: &lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;button type=&quot;submit&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;  --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    // 1、创建xhr核心对象 =&gt; 兼容写法</span><br><span class="line">    var xhr = null</span><br><span class="line">    // 判断当前浏览器是否支持 XMLHttpRequest</span><br><span class="line">    if (XMLHttpRequest) &#123;</span><br><span class="line">      // IE以外的浏览器使用</span><br><span class="line">      xhr = new XMLHttpRequest()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // IE浏览器使用</span><br><span class="line">      xhr = new ActiveXObject(&#x27;Microsoft.XMLHttp&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="get请求方式">get请求方式</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var xhr = new XMLHttpRequest()</span></span><br><span class="line"><span class="comment">// // localhost: 127.0.0.1 本机回环地址</span></span><br><span class="line"><span class="comment">// xhr.open(&#x27;get&#x27;, &#x27;http://localhost:3000/getUserList&#x27;, true)</span></span><br><span class="line"><span class="comment">// xhr.send(null)</span></span><br><span class="line"><span class="comment">// xhr.onload = function()&#123;</span></span><br><span class="line"><span class="comment">//   if(xhr.readyState == 4 &amp;&amp; xhr.status == 200)&#123;</span></span><br><span class="line"><span class="comment">//     console.log(JSON.parse(xhr.responseText))</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过get方式提交数据 =&gt; 需要拼接在url地址栏?后面</span></span><br><span class="line"><span class="keyword">let</span> userInfo = <span class="string">&#x27;name=张三&amp;age=22&#x27;</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://localhost:3000/addUser?&#x27;</span>+ <span class="built_in">encodeURI</span>(userInfo), <span class="literal">true</span>)</span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>作业</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>添加数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &lt;!-- 提示信息 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">  &lt;!-- 准备一个容器 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;uu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 通过get方式获取数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> xhr;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span>(<span class="title class_">XMLHttpRequest</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;<span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;Microsoft.XMLHttp&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// btn1.onclick = function () &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   xhr.open(&#x27;get&#x27;, &#x27;http://localhost:3000/getUserList&#x27;, true)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   xhr.send(null)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   xhr.onload = function () &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//     if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       // 将json字符串转成对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       let data = JSON.parse(xhr.responseText)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       // 拼接数据和标签</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       let str = &#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       data.forEach(item =&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//         str += `&lt;li&gt;$&#123;item.name&#125;--$&#123;item.age&#125;&lt;/li&gt;`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       &#125;);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       // 将拼接好的标签追加到页面上</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//       uu.innerHTML = str</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//     &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 添加数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn2.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> userInfo = <span class="string">&#x27;name=李四&amp;age=22&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// encodeURI: 把字符串作为 URI 进行编码</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// get方式如果提交的数据中有中文 一定要进行乱码处理</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://localhost:3000/addUser?&#x27;</span> + <span class="built_in">encodeURI</span>(userInfo), <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">alert</span>(xhr.<span class="property">responseText</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// let data = JSON.parse(xhr.responseText)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// if(data.code == 1)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//   info.innerHTML = data.msg</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>服务端</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"><span class="comment">// 处理表单类型的数据 application/x-www-form-urlencoded</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>())</span><br><span class="line"><span class="comment">// 处理json类型的数据 application/json</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户列表</span></span><br><span class="line"><span class="keyword">let</span> userList = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;ls&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/getUserList&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 响应用户一些数据</span></span><br><span class="line">  res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userList))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/addUser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1111</span>)</span><br><span class="line">  <span class="comment">// 获取用户get方式提交的数据</span></span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">query</span>.<span class="property">name</span>)</span><br><span class="line">  <span class="comment">// 判断用户名是否重复</span></span><br><span class="line">  <span class="comment">// 遍历数组取出每一项 判断每一项的name属性值和用户提交的name属性值是否一样</span></span><br><span class="line">  <span class="comment">// let result = userList.find(item =&gt; item.name == req.query.name)</span></span><br><span class="line">  <span class="comment">// if (result) &#123;</span></span><br><span class="line">  <span class="comment">//   res.send(&#123;</span></span><br><span class="line">  <span class="comment">//     code: 1,</span></span><br><span class="line">  <span class="comment">//     msg: &#x27;用户名已存在&#x27;</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">// &#125; else &#123;</span></span><br><span class="line">  <span class="comment">//   // 将数据保存到数组中</span></span><br><span class="line">  <span class="comment">//   userList.push(req.query)</span></span><br><span class="line">  <span class="comment">//   res.send(&#123;</span></span><br><span class="line">  <span class="comment">//     code: 0,</span></span><br><span class="line">  <span class="comment">//     msg: &#x27;添加成功&#x27;</span></span><br><span class="line">  <span class="comment">//   &#125;)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/addUser&#x27;</span>, <span class="function">(<span class="params">req, res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">  <span class="comment">// 响应数据</span></span><br><span class="line">  res.<span class="title function_">send</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;server is running at port 3000 ~&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="post请求方式">post请求方式</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>发送表单数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>发送Json数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// post提交数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn1.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 准备提交的数据 =&gt; 表单数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> userInfo = <span class="string">&quot;name=李四&amp;age=22&quot;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://localhost:3000/addUser&#x27;</span>, <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1、post请求方式提交数据需要设置请求头</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1.1 提交表单类型数据的请求头设置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 2、post提交数据需要通过send(数据)方法</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 3、post提交的数据是通过请求提提交给后端 所以无需url编码处理</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">send</span>(userInfo)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn2.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 准备提交的数据 =&gt; json数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> userInfo = &#123;<span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="attr">age</span>: <span class="number">24</span>&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://localhost:3000/addUser&#x27;</span>, <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1、post请求方式提交数据需要设置请求头</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1.1 提交json类型数据的请求头设置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1.2 Json数据需要通过JSON.stringify处理</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userInfo))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>作业</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line">  用户名: &lt;input type=&quot;text&quot; id=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">  密码: &lt;input type=&quot;text&quot; id=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;button id=&quot;btn1&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    btn1.onclick = function () &#123;</span><br><span class="line">      // 获取用户输入的用户名</span><br><span class="line">      var uname = username.value</span><br><span class="line">      // 获取用户输入的密码</span><br><span class="line">      var pwd = password.value</span><br><span class="line">      if (!uname || !pwd) &#123;</span><br><span class="line">        info.innerHTML = &#x27;输入框不能为空&#x27;</span><br><span class="line">        // 停止后面代码执行</span><br><span class="line">        return</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 能够进到这里证明用户输入了用户名和密码</span><br><span class="line">        // 拿着用户输入的用户名和密码发起请求</span><br><span class="line">        var xhr = new XMLHttpRequest()</span><br><span class="line">        var userInfo = `name=$&#123;uname&#125;&amp;pwd=$&#123;pwd&#125;`</span><br><span class="line">        xhr.open(&#x27;get&#x27;, &#x27;http://localhost:3000/addUser?&#x27; + encodeURI(userInfo), true)</span><br><span class="line">        xhr.send(null)</span><br><span class="line">        xhr.onreadystatechange = function () &#123;</span><br><span class="line">          if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) &#123;</span><br><span class="line">            console.log(xhr.responseText)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="onreadystatechange"><strong>onreadystatechange</strong></h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">readyState</span>) <span class="comment">// 0</span></span><br><span class="line">   <span class="keyword">var</span> userInfo = <span class="string">`name=zs&amp;pwd=123`</span></span><br><span class="line">   xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;http://localhost:3000/addUser?&#x27;</span> + <span class="built_in">encodeURI</span>(userInfo), <span class="literal">true</span>)</span><br><span class="line">   xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">readyState</span>) <span class="comment">// 1</span></span><br><span class="line">   <span class="comment">// 准备回调函数 接收服务端响应</span></span><br><span class="line">   <span class="comment">// 当服务端有数据响应过来的时候 会调用函数</span></span><br><span class="line">   <span class="comment">// 我们只是声明了函数 并没有调用 谁调用的? =&gt; 浏览器</span></span><br><span class="line">   <span class="comment">// 浏览器根据readyState的变化来调用这个函数</span></span><br><span class="line">   <span class="comment">// 函数中的readyState(2 3 4)变了三次 函数一共调用了三次 </span></span><br><span class="line">   xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">readyState</span>) <span class="comment">// 2 =&gt; 3 =&gt; 4</span></span><br><span class="line">     <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//0: 请求未初始化, xhr对象创建完毕(此时还没有调用open)</span></span><br><span class="line">   <span class="comment">//1: 服务器连接已建立(三次握手), 已经发送请求开始监听</span></span><br><span class="line">   <span class="comment">//2: 请求已接收, 已经收到服务器返回的内容 数据还无法使用</span></span><br><span class="line">   <span class="comment">//3: 请求处理中, 解析服务器响应内容 数据还无法使用</span></span><br><span class="line">   <span class="comment">//4: 请求已完成, 且响应就绪, 数据解析完毕 数据可以使用</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// status: http状态码</span></span><br><span class="line">   <span class="comment">// 200 OK 请求成功 一切ok</span></span><br><span class="line">   <span class="comment">// 302 Found 重定向 redirect</span></span><br><span class="line">   <span class="comment">// 304 Not Modified 缓存</span></span><br><span class="line">   <span class="comment">// 403 Forbidden 没有权限</span></span><br><span class="line">   <span class="comment">// 404 Not Found 资源路径不存在</span></span><br><span class="line">   <span class="comment">// 500 Internal Server Error 服务器错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 晚上作业</span></span><br><span class="line">   <span class="comment">// 1、注册页 获取用户输入的数据 提交数据为表单数据类型 后端保存数据 用户名重复则注册失败</span></span><br><span class="line">   <span class="comment">// 2、登录页 获取用户输入的数据 提交数据为json数据类型 后端验证用户名和密码是否正确 都正确则跳转到首页(自己随便写个页面显示欢迎您xxx)</span></span><br><span class="line">   </span><br><span class="line"> &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="onload">onload</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> xhr=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">    <span class="keyword">let</span> params = <span class="string">&#x27;name=zs&amp;age=18&#x27;</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;post&#x27;</span>,<span class="string">&#x27;http://localhost:3000/addUser&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>)</span><br><span class="line">    xhr.<span class="title function_">send</span>(params)</span><br><span class="line">    xhr.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">      <span class="comment">// if(xhr.readyState==4&amp;&amp;xhr.status==200)</span></span><br><span class="line">      <span class="comment">// console.log(xhr.responseText)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// onload   onreadyStateChange</span></span><br><span class="line">    <span class="comment">// 兼容性:   不兼容IE      兼容</span></span><br><span class="line">    <span class="comment">// 判断:     不需要        需要 </span></span><br><span class="line">    <span class="comment">// 调用次数:  调用一次      调用三次</span></span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>练习</strong></p>
<p>登录页</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>登陆页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">  密 码: &lt;input type=&quot;text&quot; name=&quot;password&quot; id=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;button id=&quot;btn&quot;&gt;登录&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    btn.onclick = function () &#123;</span><br><span class="line">      // 获取用户输入的内容</span><br><span class="line">      var uname = username.value</span><br><span class="line">      var pwd = password.value</span><br><span class="line">      if (!uname) &#123;</span><br><span class="line">        info.innerHTML = &#x27;用户名不能为空&#x27;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      if (!pwd) &#123;</span><br><span class="line">        info.innerHTML = &#x27;密码不能为空&#x27;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      let params = `uname=$&#123;uname&#125;&amp;pwd=$&#123;pwd&#125;`</span><br><span class="line">      var xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;post&#x27;, &#x27;http://localhost:3000/login&#x27;, true)</span><br><span class="line">      xhr.setRequestHeader(&#x27;Content-Type&#x27;, &#x27;application/x-www-form-urlencoded&#x27;)</span><br><span class="line">      xhr.send(params)</span><br><span class="line">      xhr.onload = function () &#123;</span><br><span class="line">        var data = JSON.parse(xhr.responseText)</span><br><span class="line">        if(data.code == 1)&#123;</span><br><span class="line">          info.innerHTML = data.msg</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">          alert(&#x27;登录成功 即将跳转到首页&#x27;)</span><br><span class="line">          // location.href = `./02-首页.html#name=$&#123;uname&#125;`</span><br><span class="line">          // file:///D:/Education/2108A/js/day13/code/02.html#name=zs</span><br><span class="line"></span><br><span class="line">          location.href = `./02-首页.html`</span><br><span class="line">          sessionStorage.setItem(&#x27;userInfo&#x27;, uname)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      xhr.onerror = function()&#123;</span><br><span class="line">        console.log(&#x27;网络错误 ~&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>首页</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// var hash = location.hash</span></span><br><span class="line">    <span class="comment">// if (hash) &#123;</span></span><br><span class="line">    <span class="comment">//   hash = hash.substring(1)</span></span><br><span class="line">    <span class="comment">//   var arr = hash.split(&#x27;=&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//   // 字符串的方式</span></span><br><span class="line">    <span class="comment">//   // var h3 = `&lt;h3&gt;欢迎你 $&#123;arr[1]&#125;&lt;/h3&gt;`</span></span><br><span class="line">    <span class="comment">//   // document.body.innerHTML = h3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//   // 节点的方式</span></span><br><span class="line">    <span class="comment">//   // var h3 = document.createElement(`h3`)</span></span><br><span class="line">    <span class="comment">//   // h3.innerHTML = `欢迎你 $&#123;arr[1]&#125;`</span></span><br><span class="line">    <span class="comment">//   // document.body.appendChild(h3)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// var uname = localStorage.getItem(&#x27;userInfo&#x27;)</span></span><br><span class="line">    <span class="keyword">var</span> uname = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;userInfo&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> h3 = <span class="string">`&lt;h3&gt;欢迎你 <span class="subst">$&#123;uname&#125;</span>&lt;/h3&gt;`</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = h3</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>注册页</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>注册页<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;info&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot; id=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">  密 码: &lt;input type=&quot;text&quot; name=&quot;password&quot; id=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">  &lt;button id=&quot;btn&quot;&gt;注册&lt;/button&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    btn.onclick = function () &#123;</span><br><span class="line">      // 获取用户输入的内容</span><br><span class="line">      var uname = username.value</span><br><span class="line">      var pwd = password.value</span><br><span class="line">      if (!uname) &#123;</span><br><span class="line">        info.innerHTML = &#x27;用户名不能为空&#x27;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      if (!pwd) &#123;</span><br><span class="line">        info.innerHTML = &#x27;密码不能为空&#x27;</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      var xhr = new XMLHttpRequest()</span><br><span class="line">      xhr.open(&#x27;post&#x27;, &#x27;http://localhost:3000/register&#x27;, true)</span><br><span class="line">      xhr.setRequestHeader(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)</span><br><span class="line">      xhr.send(JSON.stringify(&#123; uname, pwd &#125;))</span><br><span class="line">      xhr.onload = function () &#123;</span><br><span class="line">        var data = JSON.parse(xhr.responseText)</span><br><span class="line">        if(data.code == 1)&#123;</span><br><span class="line">          info.innerHTML = data.msg</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">          alert(&#x27;注册成功 即将跳转到登陆页&#x27;)</span><br><span class="line">          location.href = &#x27;./02-登陆页.html&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="缓存问题">缓存问题</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">      xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;http://localhost:3000/cache?cache=&#x27;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>(), <span class="literal">true</span>)</span><br><span class="line">      xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line">      xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> data = xhr.<span class="property">responseText</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// 因为每次请求的url都是一样的 所以IE低版本没有重新对服务器发起请求</span></span><br><span class="line"><span class="comment">// 而是从缓存中读取上一次请求的结果 怎么解决 ?</span></span><br><span class="line"><span class="comment">// 保证每次请求的url都是不一致的 在url上添加随机数 当前时间毫秒数</span></span><br></pre></td></tr></table></figure>
<h5 id="ajax封装">ajax封装</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ajax初步封装</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定功能 =&gt; ajax封装</span></span><br><span class="line"><span class="comment">// 确定参数 =&gt; method、url</span></span><br><span class="line"><span class="comment">// 确定返回值 =&gt; 没有</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; method = <span class="string">&#x27;get&#x27;</span>, url, callback &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> xhr</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;Micrsoft.XMLHTTP&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  xhr.<span class="title function_">open</span>(method, url, <span class="literal">true</span>)</span><br><span class="line">  xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="comment">// var data</span></span><br><span class="line">  xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 不要对数据做统一的处理 而是交给调用者来决定具体的业务逻辑</span></span><br><span class="line">    <span class="comment">// console.log(xhr.responseText)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 此处返回返回给了onload指定的匿名函数</span></span><br><span class="line">    <span class="comment">// return xhr.responseText</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是在异步函数中 同步先执行return data 再执行下面的赋值代码</span></span><br><span class="line">    <span class="comment">// data = xhr.responseText</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用回调函数来返回数据</span></span><br><span class="line">    <span class="title function_">callback</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 此处返回 xhr.responseText 结果为 &#x27;&#x27;</span></span><br><span class="line">  <span class="comment">// return xhr.responseText</span></span><br><span class="line">  <span class="comment">// return data</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>get请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>post请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn1.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1、传参顺序有限制 不能随意调换参数的顺序 =&gt; 对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 2、如果不传参 没有默认值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getBookList&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">callback</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn2.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getBookList&#x27;</span>, </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">callback</span>: <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="ajax封装-2">ajax封装</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ajax初步封装</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定功能 =&gt; ajax封装</span></span><br><span class="line"><span class="comment">// 确定参数 =&gt; method、url</span></span><br><span class="line"><span class="comment">// 确定返回值 =&gt; 没有</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@params</span></span></span><br><span class="line"><span class="comment"> *  method: 传参方式</span></span><br><span class="line"><span class="comment"> *  url: 请求路径</span></span><br><span class="line"><span class="comment"> *  dataType: 数据类型</span></span><br><span class="line"><span class="comment"> *  data: 提交的数据</span></span><br><span class="line"><span class="comment"> *  callback: 回调</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> <span class="variable">void</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; method = <span class="string">&#x27;get&#x27;</span>, url, dataType, data, callback &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> xhr</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">XMLHttpRequest</span>) &#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    xhr = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;Micrsoft.XMLHTTP&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果是get请求方式</span></span><br><span class="line">  <span class="keyword">if</span> (data &amp;&amp; method == <span class="string">&#x27;get&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> data == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// name=《聊斋志异》&amp;auth=蒲松龄&amp;desc=跨越生死的爱情故事</span></span><br><span class="line">      url += <span class="string">&#x27;?&#x27;</span> + <span class="built_in">encodeURI</span>(data)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> data == <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 对象: &#123;name: &#x27;《聊斋志异》&#x27;,auth: &#x27;蒲松龄&#x27;,desc: &#x27;跨越生死的爱情故事&#x27;&#125;,</span></span><br><span class="line">      <span class="comment">// 目标: http://localhost:3000/getBookList?name=&#x27;《聊斋志异》&#x27;&amp;auth=&#x27;xx&#x27;&amp;desc=&#x27;xx&#x27;</span></span><br><span class="line">      url = url + <span class="string">&#x27;?&#x27;</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">        <span class="comment">// key =&gt; name、auth、desc</span></span><br><span class="line">        <span class="comment">// data[key] =&gt; &#x27;《聊斋志异》&#x27;、&#x27;蒲松龄&#x27;、&#x27;跨越生死的爱情故事&#x27;</span></span><br><span class="line">        url += key + <span class="string">&#x27;=&#x27;</span> + data[key] + <span class="string">&#x27;&amp;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 将最后的&amp;截取掉 并进行编码处理</span></span><br><span class="line">      url = <span class="built_in">encodeURI</span>(url.<span class="title function_">substring</span>(<span class="number">0</span>, url.<span class="property">length</span> - <span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  xhr.<span class="title function_">open</span>(method, url, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> params = <span class="literal">null</span></span><br><span class="line">  <span class="comment">// 如果是post请求方式</span></span><br><span class="line">  <span class="keyword">if</span> (data &amp;&amp; method == <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> data == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 设置请求头</span></span><br><span class="line">      xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>)</span><br><span class="line">      params = data</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> data == <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">      <span class="comment">// 将数据转成json格式</span></span><br><span class="line">      params = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  xhr.<span class="title function_">send</span>(params)</span><br><span class="line">  </span><br><span class="line">  xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 接收服务端响应的数据</span></span><br><span class="line">    <span class="keyword">let</span> data = xhr.<span class="property">responseText</span></span><br><span class="line">    <span class="comment">// 如果用户传入了json参数</span></span><br><span class="line">    <span class="keyword">if</span> (dataType) &#123;</span><br><span class="line">      <span class="comment">// 将数据转成json格式</span></span><br><span class="line">      data = data.<span class="title function_">includes</span>(<span class="string">&#x27;[&#x27;</span>) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data) : data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用回调函数来返回数据</span></span><br><span class="line">    <span class="title function_">callback</span>(data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn1&quot;</span>&gt;</span>get请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn2&quot;</span>&gt;</span>post请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn1.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 1、传参顺序有限制 不能随意调换参数的顺序 =&gt; 对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 2、如果不传参 没有默认值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getBookList&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// data: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   name: &#x27;《聊斋志异》&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   auth: &#x27;蒲松龄&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   desc: &#x27;跨越生死的爱情故事&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">data</span>: <span class="string">&#x27;name=《聊斋志异》&amp;auth=蒲松龄&amp;desc=跨越生死的爱情故事&#x27;</span> ,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">callback</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    btn2.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/getBookList&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// data: &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   name: &#x27;《山海经》&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   auth: &#x27;未知&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//   desc: &#x27;远古时期神话故事&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">data</span>: <span class="string">&#x27;name=《聊斋志异》&amp;auth=蒲松龄&amp;desc=跨越生死的爱情故事&#x27;</span> ,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">callback</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="图书案例"><strong>图书案例</strong></h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    .dv &#123;</span><br><span class="line">      width: 400px;</span><br><span class="line">      height: 300px;</span><br><span class="line">      background-color: skyblue;</span><br><span class="line">      margin: 100px auto;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ul &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">      padding: 20px 35px;</span><br><span class="line">      text-align: left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    li &#123;</span><br><span class="line">      list-style: none;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;script src=&quot;./01-ajax.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;dv&quot;&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;keywords&quot;&gt; &lt;button id=&quot;search&quot;&gt;搜索&lt;/button&gt;</span><br><span class="line">    &lt;!-- 展示图书信息 --&gt;</span><br><span class="line">    &lt;ul id=&quot;uu&quot;&gt;&lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    search.onclick = function () &#123;</span><br><span class="line">      // 如果用户什么都没有输入</span><br><span class="line">      if (keywords.value == &#x27;&#x27;) &#123;</span><br><span class="line">        // 默认获取所有的数据</span><br><span class="line">        ajax(&#123;</span><br><span class="line">          method: &#x27;get&#x27;,</span><br><span class="line">          url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">          dataType: &#x27;json&#x27;,</span><br><span class="line">          callback: function (data) &#123;</span><br><span class="line">            let lis = &#x27;&#x27;</span><br><span class="line">            data.forEach((item, index) =&gt; &#123;</span><br><span class="line">              lis += `&lt;li&gt;$&#123;index + 1&#125;.$&#123;item.name&#125;- $&#123;item.auth&#125;- $&#123;item.desc&#125;&lt;/li&gt;`</span><br><span class="line">            &#125;)</span><br><span class="line">            uu.innerHTML = lis</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 根据用户输入的内容查询对应的书籍</span><br><span class="line">        ajax(&#123;</span><br><span class="line">          method: &#x27;get&#x27;,</span><br><span class="line">          url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">          dataType: &#x27;json&#x27;,</span><br><span class="line">          data: `keywords=$&#123;keywords.value&#125;`,</span><br><span class="line">          callback: function (data) &#123;</span><br><span class="line">            if (typeof data == &#x27;string&#x27;) &#123;</span><br><span class="line">              uu.innerHTML = data</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              let lis = &#x27;&#x27;</span><br><span class="line">              data.forEach((item, index) =&gt; &#123;</span><br><span class="line">                lis += `&lt;li&gt;$&#123;index + 1&#125;.$&#123;item.name&#125;- $&#123;item.auth&#125;- $&#123;item.desc&#125;&lt;/li&gt;`</span><br><span class="line">              &#125;)</span><br><span class="line">              uu.innerHTML = lis</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="jquery实现">jquery实现</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    .dv &#123;</span><br><span class="line">      width: 400px;</span><br><span class="line">      height: 300px;</span><br><span class="line">      background-color: skyblue;</span><br><span class="line">      margin: 100px auto;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ul &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">      padding: 20px 35px;</span><br><span class="line">      text-align: left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    li &#123;</span><br><span class="line">      list-style: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .mask &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">      background: rgba(0, 0, 0, .5);</span><br><span class="line">      text-align: center;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      line-height: 150px;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://unpkg.com/nprogress@0.2.0/nprogress.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/nprogress@0.2.0/nprogress.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;mask&quot;&gt;玩命加载中 ~ &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;dv&quot;&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;keywords&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;search&quot;&gt;搜索&lt;/button&gt;</span><br><span class="line">    &lt;!-- &lt;button id=&quot;search2&quot;&gt;搜索&lt;/button&gt; --&gt;</span><br><span class="line">    &lt;!-- 展示图书信息 --&gt;</span><br><span class="line">    &lt;ul id=&quot;uu&quot;&gt;&lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    // 全局事件 只要当前页面有ajax请求发起就会执行回调函数中的代码</span><br><span class="line">    $(document).ajaxStart(() =&gt; &#123;</span><br><span class="line">      // $(&#x27;.mask&#x27;).fadeIn()</span><br><span class="line">      NProgress.start()</span><br><span class="line">    &#125;)</span><br><span class="line">    // 全局事件 只要当前页面有ajax请求完成就会执行回调函数中的代码</span><br><span class="line">    $(document).ajaxComplete(() =&gt; &#123;</span><br><span class="line">      // $(&#x27;.mask&#x27;).fadeOut()</span><br><span class="line">      NProgress.done()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    $(&#x27;#search&#x27;).click(() =&gt; &#123;</span><br><span class="line">      let keywords = $(&#x27;#keywords&#x27;).val()</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">        data: &#123; keywords &#125;,</span><br><span class="line">        dataType: &#x27;json&#x27;,</span><br><span class="line">        success: (data) =&gt; &#123;</span><br><span class="line">          let lis = &#x27;&#x27;</span><br><span class="line">          data.forEach((item, index) =&gt; &#123;</span><br><span class="line">            lis += `&lt;li&gt;$&#123;index + 1&#125;.$&#123;item.name&#125;- $&#123;item.auth&#125;- $&#123;item.desc&#125;&lt;/li&gt;`</span><br><span class="line">          &#125;)</span><br><span class="line">          $(&#x27;#uu&#x27;).html(lis)</span><br><span class="line">        &#125;,</span><br><span class="line">        // 在发送请求之前调用</span><br><span class="line">        // beforeSend()&#123;</span><br><span class="line">        //   $(&#x27;.mask&#x27;).fadeIn()</span><br><span class="line">        // &#125;,</span><br><span class="line">        // // complete 当请求完成之后调用这个函数，无论成功或失败</span><br><span class="line">        // complete()&#123;</span><br><span class="line">        //   $(&#x27;.mask&#x27;).fadeOut()</span><br><span class="line">        // &#125;,</span><br><span class="line">        // 在请求出错时调用</span><br><span class="line">        error(xhr) &#123;</span><br><span class="line">          console.log(xhr.responseText)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    $(&#x27;#search2&#x27;).click(() =&gt; &#123;</span><br><span class="line">      let keywords = $(&#x27;#keywords&#x27;).val()</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">        data: &#123; keywords &#125;,</span><br><span class="line">        dataType: &#x27;json&#x27;,</span><br><span class="line">        success: (data) =&gt; &#123;</span><br><span class="line">          let lis = &#x27;&#x27;</span><br><span class="line">          data.forEach((item, index) =&gt; &#123;</span><br><span class="line">            lis += `&lt;li&gt;$&#123;index + 1&#125;.$&#123;item.name&#125;- $&#123;item.auth&#125;- $&#123;item.desc&#125;&lt;/li&gt;`</span><br><span class="line">          &#125;)</span><br><span class="line">          $(&#x27;#uu&#x27;).html(lis)</span><br><span class="line">        &#125;,</span><br><span class="line">        // 在请求出错时调用</span><br><span class="line">        error(xhr) &#123;</span><br><span class="line">          console.log(xhr.responseText)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="jquery方法">jquery方法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    // $.get()</span><br><span class="line">    // $.post()</span><br><span class="line">    // $.getJSON()</span><br><span class="line">    // $.getScript()</span><br><span class="line"></span><br><span class="line">    // 同步的写法 =&gt; 不建议使用</span><br><span class="line">    // let data = $.ajax(&#123;</span><br><span class="line">    //     method: &#x27;get&#x27;,</span><br><span class="line">    //     url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">    //     dataType: &#x27;json&#x27;,</span><br><span class="line">    //     // 同步 =&gt; 默认true =&gt; 异步</span><br><span class="line">    //     async: false,</span><br><span class="line">    //     // 缓存 默认true =&gt; 有缓存</span><br><span class="line">    //     cache: false,</span><br><span class="line">    //   &#125;)</span><br><span class="line">    //   console.log(JSON.parse(data.responseText))</span><br><span class="line">    //   console.log(111)</span><br><span class="line"></span><br><span class="line">      let data = $.ajax(&#123;</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">        // 预期服务器返回的数据类型 默认是纯文本</span><br><span class="line">        dataType: &#x27;text&#x27;,</span><br><span class="line">        // dataType: &#x27;json&#x27;,</span><br><span class="line">        // 同步 =&gt; 默认true =&gt; 异步</span><br><span class="line">        async: false,</span><br><span class="line">        // 缓存 默认true =&gt; 有缓存</span><br><span class="line">        cache: false,</span><br><span class="line">        // 发送信息至服务器时内容编码类型 默认表单数据类型</span><br><span class="line">        // contentType: &#x27;application/x-www-form-urlencoded&#x27;,</span><br><span class="line">        contentType: &#x27;application/json&#x27;,</span><br><span class="line">        // 一个额外的&quot;&#123;键:值&#125;&quot;对映射到请求一起发送 =&gt; 设置自定义请求头</span><br><span class="line">        headers:&#123;</span><br><span class="line">          Authrization: &#x27;Bearer 34859REGFG34523DSDFJHGJUY23&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      console.log(JSON.parse(data.responseText))</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="图书案例-2">图书案例</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    .dv &#123;</span><br><span class="line">      width: 500px;</span><br><span class="line">      height: 300px;</span><br><span class="line">      background-color: skyblue;</span><br><span class="line">      margin: 100px auto;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    input &#123;</span><br><span class="line">      outline: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ul &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">      padding: 20px 35px;</span><br><span class="line">      text-align: left;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    li &#123;</span><br><span class="line">      list-style: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .mask &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 0;</span><br><span class="line">      left: 0;</span><br><span class="line">      right: 0;</span><br><span class="line">      bottom: 0;</span><br><span class="line">      background: rgba(0, 0, 0, .5);</span><br><span class="line">      text-align: center;</span><br><span class="line">      font-weight: bold;</span><br><span class="line">      line-height: 150px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #del,</span><br><span class="line">    #edit &#123;</span><br><span class="line">      margin-left: 10px;</span><br><span class="line">      width: 42px;</span><br><span class="line">      height: 20px;</span><br><span class="line">      font-size: 13px;</span><br><span class="line">      cursor: pointer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .edit &#123;</span><br><span class="line">      display: none;</span><br><span class="line">      background-color: white;</span><br><span class="line">      width: 251px;</span><br><span class="line">      height: 100px;</span><br><span class="line">      padding: 20px;</span><br><span class="line">      text-align: center;</span><br><span class="line">      position: absolute;</span><br><span class="line">      top: 35%;</span><br><span class="line">      left: 50%;</span><br><span class="line">      transform: translate(-50%, -50%);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #confirmEdit &#123;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">  &lt;script src=&quot;https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://unpkg.com/nprogress@0.2.0/nprogress.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/nprogress@0.2.0/nprogress.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;mask&quot;&gt;玩命加载中 ~ &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;edit&quot;&gt;</span><br><span class="line">    书名: &lt;input type=&quot;text&quot; id=&quot;name&quot;&gt;&lt;br&gt;</span><br><span class="line">    作者: &lt;input type=&quot;text&quot; id=&quot;author&quot;&gt;&lt;br&gt;</span><br><span class="line">    描述: &lt;input type=&quot;text&quot; id=&quot;desc&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;button id=&quot;confirmEdit&quot;&gt;确认修改&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div class=&quot;dv&quot;&gt;</span><br><span class="line">    &lt;!-- 添加框 --&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;bookName&quot; placeholder=&quot;请输入书名&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;authorName&quot; placeholder=&quot;请输入作者名字&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;textarea&quot; id=&quot;bookDesc&quot; placeholder=&quot;请输入相关描述&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;addBook&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">    &lt;!-- 搜索框 --&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;keywords&quot; placeholder=&quot;请输入搜索的关键字&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;search&quot;&gt;搜索&lt;/button&gt;</span><br><span class="line">    &lt;!-- 展示图书信息 --&gt;</span><br><span class="line">    &lt;ul id=&quot;uu&quot;&gt;&lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    // 全局事件 只要当前页面有ajax请求发起就会执行回调函数中的代码</span><br><span class="line">    $(document).ajaxStart(() =&gt; &#123;</span><br><span class="line">      // $(&#x27;.mask&#x27;).fadeIn()</span><br><span class="line">      NProgress.start()</span><br><span class="line">    &#125;)</span><br><span class="line">    // 全局事件 只要当前页面有ajax请求完成就会执行回调函数中的代码</span><br><span class="line">    $(document).ajaxComplete(() =&gt; &#123;</span><br><span class="line">      // $(&#x27;.mask&#x27;).fadeOut()</span><br><span class="line">      NProgress.done()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 搜索</span><br><span class="line">    $(&#x27;#search&#x27;).click(() =&gt; &#123;</span><br><span class="line">      let keywords = $(&#x27;#keywords&#x27;).val()</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        method: &#x27;get&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/getBookList&#x27;,</span><br><span class="line">        data: &#123; keywords &#125;,</span><br><span class="line">        dataType: &#x27;json&#x27;,</span><br><span class="line">        success: (data) =&gt; &#123;</span><br><span class="line">          let lis = &#x27;&#x27;</span><br><span class="line">          data.forEach((item, index) =&gt; &#123;</span><br><span class="line">            lis += `&lt;li myid=$&#123;item.id&#125;&gt;$&#123;index + 1&#125;.$&#123;item.name&#125;- $&#123;item.auth&#125;- $&#123;item.desc&#125;&lt;button id=&#x27;del&#x27;&gt;删除&lt;/button&gt;&lt;button id=&#x27;edit&#x27;&gt;编辑&lt;/button&gt;&lt;/li&gt;`</span><br><span class="line">          &#125;)</span><br><span class="line">          $(&#x27;#uu&#x27;).html(lis)</span><br><span class="line">        &#125;,</span><br><span class="line">        // 在请求出错时调用</span><br><span class="line">        error(xhr) &#123;</span><br><span class="line">          console.log(xhr.responseText)</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 添加</span><br><span class="line">    $(&#x27;#addBook&#x27;).click(() =&gt; &#123;</span><br><span class="line">      // 获取用户输入的书名</span><br><span class="line">      let name = $(&#x27;#bookName&#x27;).val()</span><br><span class="line">      let auth = $(&#x27;#authorName&#x27;).val()</span><br><span class="line">      let desc = $(&#x27;#bookDesc&#x27;).val()</span><br><span class="line">      // 发起请求提交书名</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/addBook&#x27;,</span><br><span class="line">        data: &#123; name: `《$&#123;name&#125;》`, auth, desc &#125;,</span><br><span class="line">        dataType: &#x27;json&#x27;,</span><br><span class="line">        success: (data) =&gt; &#123;</span><br><span class="line">          console.log(data)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 删除</span><br><span class="line">    $(&#x27;#uu&#x27;).click((e) =&gt; &#123;</span><br><span class="line">      // console.log(e.target.parentNode.getAttribute(&#x27;myid&#x27;))</span><br><span class="line">      if (e.target.getAttribute(&#x27;id&#x27;) == &#x27;del&#x27;) &#123;</span><br><span class="line">        let myid = $(e.target).parent().attr(&#x27;myid&#x27;)</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">          method: &#x27;post&#x27;,</span><br><span class="line">          url: &#x27;http://localhost:3000/delBookById?id=&#x27; + myid,</span><br><span class="line">          success: (data) =&gt; &#123;</span><br><span class="line">            if (data.code == 0) &#123;</span><br><span class="line">              // 触发搜索按钮</span><br><span class="line">              $(&#x27;#search&#x27;).click()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 编辑</span><br><span class="line">    let myid</span><br><span class="line">    $(&#x27;#uu&#x27;).click((e) =&gt; &#123;</span><br><span class="line">      if (e.target.getAttribute(&#x27;id&#x27;) == &#x27;edit&#x27;) &#123;</span><br><span class="line">        // 获取当前元素的id</span><br><span class="line">        myid = $(e.target).parent().attr(&#x27;myid&#x27;)</span><br><span class="line">        // 显示编辑框</span><br><span class="line">        $(&#x27;.edit&#x27;).css(&#x27;display&#x27;, &#x27;block&#x27;)</span><br><span class="line">        // 发起请求 =&gt; 渲染编辑框</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">          url: &#x27;http://localhost:3000/getBookById?id=&#x27; + myid,</span><br><span class="line">          success: (data) =&gt; &#123;</span><br><span class="line">            if (data.code == 0) &#123;</span><br><span class="line">              $(&#x27;#name&#x27;).val(data.data.name)</span><br><span class="line">              $(&#x27;#author&#x27;).val(data.data.auth)</span><br><span class="line">              $(&#x27;#desc&#x27;).val(data.data.desc)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 确认修改</span><br><span class="line">    $(&#x27;#confirmEdit&#x27;).click(() =&gt; &#123;</span><br><span class="line">      // 获取用户输入的数据</span><br><span class="line">      let name = $(&#x27;#name&#x27;).val()</span><br><span class="line">      let author = $(&#x27;#author&#x27;).val()</span><br><span class="line">      let desc = $(&#x27;#desc&#x27;).val()</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        method: &#x27;post&#x27;,</span><br><span class="line">        url: &#x27;http://localhost:3000/editBookById&#x27;,</span><br><span class="line">        data: &#123; id: myid, name, author, desc &#125;,</span><br><span class="line">        success: (data) =&gt; &#123;</span><br><span class="line">          if (data.code == 0) &#123;</span><br><span class="line">            // 隐藏编辑框</span><br><span class="line">            $(&#x27;.edit&#x27;).css(&#x27;display&#x27;, &#x27;none&#x27;)</span><br><span class="line">            alert(&#x27;修改成功&#x27;)</span><br><span class="line">            // 触发搜索按钮</span><br><span class="line">            $(&#x27;#search&#x27;).click()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="跨域">跨域</h4>
<h5 id="跨域初体验">跨域初体验</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>发起请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 同源策略</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 协议 域名 端口号一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 以上其中一个不一致就跨域了</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// http://laoxu.fun:3000/admin</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://laoxu.fun/admin  协议不一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// http://123.456.78/admin  域名不一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// http://laoxu.fun:8080/admin  端口不一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 1、访问百度提供的地图api (第三方接口)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 2、同一个项目不同的模块会部署到不同的服务器上</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $(<span class="string">&#x27;#btn&#x27;</span>).<span class="title function_">click</span>(<span class="function">()=&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000/cors&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">success</span>: <span class="function">(<span class="params">data</span>)=&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="静态script跨域">静态script跨域</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;!-- 利用script标签的src属性发起请求不受同源策略限制特点 --&gt;</span><br><span class="line">  &lt;!-- 有以下缺点 </span><br><span class="line">        <span class="number">1</span>、数据无法使用 =&gt; 后端返回一段js代码 =&gt; 变量/函数声明</span><br><span class="line">        <span class="number">2</span>、无法携带参数 =&gt; 后端无法获取到拼接在?后面的数据</span><br><span class="line">        <span class="number">3</span>、script发起请求响应数据是同步的 第一个script没有请求结束 第二个script的内容无法加载</span><br><span class="line">  --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> num = <span class="number">10</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:3000/cors?number=&quot;</span>+ <span class="attr">num</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 所谓跨域 不是请求未发起 而是请求发起成功 服务器接收成功、</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 并且服务器将数据响应给了浏览器 浏览器对数据做了拦截</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="动态script跨域">动态script跨域</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// jsonp本质</span></span><br><span class="line">    <span class="comment">// 前端发起请求 发起请求之前声明一个函数 </span></span><br><span class="line">    <span class="comment">// 后端返回一个函数调用 这个函数调用的函数名和前端声明的函数名一致</span></span><br><span class="line">    <span class="comment">// 所以返回的函数调用就能调用到该函数 并且通过参数把数据传进去</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">data</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// fn(111)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态创建script标签 设置src属性 将script标签追加到页面上</span></span><br><span class="line">    <span class="comment">// 这种方式是异步的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、创建script标签</span></span><br><span class="line">    <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> params = <span class="string">&#x27;zs&#x27;</span></span><br><span class="line">    <span class="comment">// 2、设置src属性</span></span><br><span class="line">    <span class="comment">// script.src = &#x27;http://localhost:3000/cors?name=&#x27;+ params</span></span><br><span class="line">    script.<span class="property">src</span> = <span class="string">&#x27;http://localhost:3000/cors&#x27;</span></span><br><span class="line">    <span class="comment">// 3、将script追加到页面上</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="函数名自定义">函数名自定义</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">data</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// foo([&#123;name: &quot;zs&quot;&#125;])</span></span><br><span class="line"><span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&#x27;http://localhost:3000/cors?cb=foo&#x27;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br></pre></td></tr></table></figure>
<h5 id="jsonp">jsonp</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// jsonp(面试)、cors(后端)、proxy(前端)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 同源策略: 协议、域名、端口一致就认为是同源 </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 只要有一个不一致就是跨域</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://www.baidu.com:80</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// http://localhost:5500</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 所谓的跨域 不是请求没有发送成功 而是请求发送成功了 后端也接收到了</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 并且后端也响应了 数据返回给前端被浏览器拦截了</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://www.baidu.com/sugrec?prod=pc&amp;wd=a&amp;cb=jQuery1102007891681812805862_1668749789485&amp;_=1668749789486</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://www.baidu.com/sugrec?prod=pc&amp;wd=a&amp;cb=sayHi&amp;_=1668749789486</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 返回一段函数调用 sayHi(&#123;q: &quot;a&quot;, p: false,…&#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 原生ajax发起请求 =&gt; 发现跨域问题</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;https://www.baidu.com/sugrec?prod=pc&amp;wd=a&amp;cb=sayHi&amp;_=1668749789486&#x27;</span>, <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> &gt;= <span class="number">200</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>))</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> --&gt;</span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 如何解决跨域问题 ? =&gt; jsonp</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// jsonp原理 ?</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 动态创建script标签 利用script标签的src属性发起请求不受同源策略限制的特点 后端会返回一段函数调用 前端要声明一个和该函数调用名字一样的函数 通过形参接收函数调用传过来的实参</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  &lt;!-- 以下是通过手动声明函数和script标签实现跨域 --&gt;</span><br><span class="line">  &lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">sayHi</span>(<span class="params">data</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.baidu.com/sugrec?prod=pc&amp;wd=a&amp;cb=sayHi&amp;_=1668749789486&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 上面这个script标签发起请求得到的结果如下 是一段函数调用 --&gt;</span><br><span class="line">  &lt;!-- <span class="title function_">sayHi</span>(&#123;<span class="attr">q</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">p</span>: <span class="literal">false</span>,…&#125;) --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- 以下是通过jquery的jsonp去处理跨域 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://www.baidu.com/sugrec&amp;callback=jQuery361022337695995273776_1668753176561&amp;prod=pc&amp;wd=a&amp;_=1668753176562</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// https://www.baidu.com/sugrec?cb=sayHi&amp;prod=pc&amp;wd=a&amp;_=1668753483319</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// $.ajax(&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 请求路径</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   url: &#x27;https://www.baidu.com/sugrec&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 请求参数 =&gt; 最终会以键值对的形式拼接在url上</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   data: &#123; prod: &#x27;pc&#x27;, wd: &#x27;a&#x27; &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 启用jsonp</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   dataType: &#x27;jsonp&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 定义回调函数标识 =&gt;  = 左边的键</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   jsonp: &#x27;cb&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 定义回调函数名字 =&gt;  = 右边的值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   jsonpCallback: &#x27;sayHi&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // 成功的回调</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // success: (data)=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   //   console.log(data)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   // &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;).then((data)=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   console.log(data)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  &lt;!-- 以下是模拟jQuery封装jsonp --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; url, data, dataType, jsonp = <span class="string">&#x27;callback&#x27;</span>, jsonpCallback &#125;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 不管是否启用jsonp 都要返回一个promise实例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 处理data数据 </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 现有的data数据: &#123; prod: &#x27;pc&#x27;, wd: &#x27;a&#x27; &#125;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 目标的data数据: prod=pc&amp;wd=a</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">let</span> arr = []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// [&#x27;prod=pc&#x27;, &#x27;wd=a&#x27;]</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          arr.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;data[key]&#125;</span>`</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// prod=pc&amp;wd=a</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        arr = arr.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 如果启用jsonp</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (dataType &amp;&amp; dataType == <span class="string">&#x27;jsonp&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 处理函数调用的名字 =&gt; jsonpCallback</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          jsonpCallback = jsonpCallback || <span class="string">&#x27;jQuery&#x27;</span> + (<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span> + <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;_&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 动态创建script标签</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 声明一个和函数调用名字一样的函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 为了返回的函数调用能在任何位置调用到该函数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 我们选择将其挂载到window身上</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">window</span>[jsonpCallback] = <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">resolve</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 父级删除</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// document.body.removeChild(script)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 自己删除</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            script.<span class="title function_">remove</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// sayHi([&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zs&quot;&#125;,&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;ls&quot;&#125;])</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 设置src属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// https://www.baidu.com/sugrec?callback=jQuery361022337695995273776_1668753176561&amp;prod=pc&amp;wd=a&amp;_=1668753176562</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;jsonp&#125;</span>=<span class="subst">$&#123;jsonpCallback&#125;</span>&amp;<span class="subst">$&#123;arr&#125;</span>&amp;_<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 将script标签追加到页面上</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// sayHi(&#x27;11111&#x27;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 请求百度的接口</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ajax(&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   url: &#x27;https://www.baidu.com/sugrec&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   data: &#123; prod: &#x27;pc&#x27;, wd: &#x27;a&#x27; &#125;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   dataType: &#x27;jsonp&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   jsonp: &#x27;cb&#x27;,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   jsonpCallback: &#x27;sayHi&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;).then((data)=&gt; &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//   console.log(data)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 请求自己的接口</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">url</span>: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">data</span>: &#123; <span class="attr">prod</span>: <span class="string">&#x27;pc&#x27;</span>, <span class="attr">wd</span>: <span class="string">&#x27;a&#x27;</span> &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">dataType</span>: <span class="string">&#x27;jsonp&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">jsonp</span>: <span class="string">&#x27;cb&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">jsonpCallback</span>: <span class="string">&#x27;sayHi&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// jsonp的缺点</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 1、只能发起get请求 </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 2、不安全 =&gt; 后端可能会返回一段攻击脚本</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h5 id="cors">cors</h5>
<p><strong>index.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立连接 http://127.0.0.1:5500/</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;put&#x27;</span>, <span class="string">&quot;http://localhost:3000&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置自定义头提交给后端</span></span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;myheader&#x27;</span>, <span class="string">&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交cookie给后端 =&gt; 1、有cookie 自动提交 2、不跨域</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&#x27;mycookie=111&#x27;</span></span><br><span class="line"><span class="comment">// 允许强制携带凭证</span></span><br><span class="line">xhr.<span class="property">withCredentials</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听回调</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> &gt;= <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="comment">// console.log(xhr.responseText)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取响应头</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="title function_">getResponseHeader</span>(<span class="string">&#x27;serverHeader&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>index.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line"><span class="keyword">let</span> whiteList = [<span class="string">&#x27;http://127.0.0.1:5500&#x27;</span>, <span class="string">&#x27;27.134.345.12:3000&#x27;</span>]</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取请求源 =&gt; 谁请求我的?</span></span><br><span class="line">  <span class="comment">// console.log(req.headers.origin)</span></span><br><span class="line">  <span class="comment">// let origin = req.headers.origin</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// if (whiteList.includes(origin)) &#123;</span></span><br><span class="line">  <span class="comment">//   res.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, origin)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置允许访问的源</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:5500&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置允许所有源访问</span></span><br><span class="line">  <span class="comment">// res.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, &#x27;*&#x27;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置允许访问的请求方式 =&gt; 大写</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;PUT,DELETE&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置允许哪个自定义头访问</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="string">&#x27;myheader&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取前端提交的请求头</span></span><br><span class="line">  <span class="comment">// console.log(req.headers)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置自定义头返回给前端</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;serverHeader&#x27;</span>, <span class="string">&#x27;999&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 告诉客户端 设置的header是可以使用的 安全的</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span>, <span class="string">&#x27;serverHeader&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 允许客户端携带凭证</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取前端提交的cookie</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">headers</span>.<span class="property">cookie</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置预检的有效期 =&gt; 单位 s</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Max-Age&#x27;</span>, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;over ~&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动 ~&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="proxy">proxy</h5>
<p><strong>index.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立连接 </span></span><br><span class="line"><span class="comment">// 不能直接请求 https://api.it120.cc/fyy/shop/goods/list =&gt; 跨域</span></span><br><span class="line"><span class="comment">// 要请求本地服务器 http://localhost:3000/fyy/shop/goods/list</span></span><br><span class="line"><span class="comment">// 让代理服务器去帮我们发起请求</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, <span class="string">&quot;http://localhost:3000/api/fyy/shop/goods/list&quot;</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听回调</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> &gt;= <span class="number">200</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>index.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>)</span><br><span class="line">  <span class="comment">// cors跨域</span></span><br><span class="line">  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> apiProxy = <span class="title function_">createProxyMiddleware</span>(<span class="string">&#x27;/api&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// 前端请求地址: http://localhost:3000/api/fyy/shop/goods/list</span></span><br><span class="line">    <span class="comment">// 目标地址: https://api.it120.cc/fyy/shop/goods/list</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 代理目标</span></span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;https://api.it120.cc&#x27;</span>,</span><br><span class="line">    <span class="comment">// =&gt; https://api.it120.cc/api/fyy/shop/goods/list</span></span><br><span class="line">    <span class="comment">// 路径重写 =&gt; 所有以/api开头的 把它替换成&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// https://api.it120.cc/fyy/shop/goods/list</span></span><br><span class="line">    <span class="comment">// 改变源</span></span><br><span class="line">    <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 代理服务器帮我们处理 比如: 响应</span></span><br><span class="line">  <span class="title function_">apiProxy</span>(req, res)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// vue =&gt; webpack =&gt; express =&gt; createProxyMiddleware</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务启动 ~&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="postMessage">postMessage</h5>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:4000/b.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;myframe&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">let</span> myframe = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#myframe&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 给b页面发送消息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        myframe.<span class="property">contentWindow</span>.<span class="title function_">postMessage</span>(<span class="string">&#x27;你真帅&#x27;</span>, <span class="string">&#x27;http://localhost:4000&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 接受b页面返回的消息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>b.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">data</span>);</span><br><span class="line">        <span class="comment">// 给a页面回复消息</span></span><br><span class="line">        e.<span class="property">source</span>.<span class="title function_">postMessage</span>(<span class="string">&#x27;必须滴&#x27;</span>, e.<span class="property">origin</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>a.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><strong>b.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">4000</span>)</span><br></pre></td></tr></table></figure>
<h5 id="name">name</h5>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:4000/c.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;frame&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ab同域 c不同域</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// a页面引用了c页面</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// c页面把值放到了window.name上 a=&gt;c 跨域</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 马上把c页面的地址值修改为b页面的地址值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 此时有一个奇怪的现象 c存储的window.name还在</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> first = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> frame = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#frame&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (first) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// src改变会重新加载iframe </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            frame.<span class="property">src</span> = <span class="string">&#x27;http://localhost:3000/b.html&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            first = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">console</span>.<span class="title function_">log</span>(frame.<span class="property">contentWindow</span>.<span class="property">name</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>b.html</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>c.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">   <span class="variable language_">window</span>.<span class="property">name</span> = <span class="string">&#x27;萨瓦迪卡&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="hash">hash</h5>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://localhost:4000/c.html#iloveyou&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> <span class="attr">id</span>=<span class="string">&quot;frame&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;load()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// ab同域 ac不同域</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// a引入c 给c传一个hash </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// c拿到参数 c把hash传递给b  b将结果再给到a的hash</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// hash改变但是事件未触发</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// window.onhashchange = function () &#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//     console.log(111);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// &#125; </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// undefined</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>b.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// console.log(location.hash);</span></span><br><span class="line">    <span class="comment">// a=&gt;c c=&gt;b</span></span><br><span class="line">    <span class="comment">// window.parent.parent.location.hash = location.hash</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>c.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(location.<span class="property">hash</span>);</span><br><span class="line">    <span class="keyword">var</span> frame = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>)</span><br><span class="line">    frame.<span class="property">src</span> = <span class="string">&#x27;http://localhost:3000/a.html#metoo&#x27;</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(frame)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="domain">domain</h5>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">aaaaa</span><br><span class="line">&lt;iframe src=<span class="string">&quot;http://c.laoxu.fun:3000/c.html&quot;</span> frameborder=<span class="string">&quot;0&quot;</span> id=<span class="string">&quot;frame&quot;</span> onload=<span class="string">&quot;load()&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laoxu.fun&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// domain 限制</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 一级域名 www.baidu.com 二级域名 music.baidu.com</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="comment">// 修改host文件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">load</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> frame = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#frame&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(frame.<span class="property">contentWindow</span>.<span class="property">number</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>b.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">domain</span> = <span class="string">&#x27;laoxu.fun&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> number = <span class="number">10</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="websocket">websocket</h5>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// websocket =&gt; 不兼容 =&gt; socket.io =&gt; 双工</span></span><br><span class="line"><span class="comment">// WebSocket 是 HTML5 提供的一种在单个 TCP 连接上进行全双工通讯的协议</span></span><br><span class="line"><span class="comment">// 原生api</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:3000&#x27;</span>)</span><br><span class="line"><span class="comment">// onopen是客户端与服务端建立连接后触发</span></span><br><span class="line">socket.<span class="property">onopen</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    socket.<span class="title function_">send</span>(<span class="string">&#x27;iloveyou&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// onmessage是当服务端给客户端发来消息的时候触发，接收数据</span></span><br><span class="line">socket.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">res</span>)&#123;</span><br><span class="line">    <span class="comment">// 打印的res是MessageEvent对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>); <span class="comment">// 真正的消息数据是 res.data</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>a.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.listen(3000)</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Server</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>).<span class="property">Server</span></span><br><span class="line"><span class="keyword">let</span> wss = <span class="keyword">new</span> <span class="title class_">Server</span>(&#123;<span class="attr">port</span>: <span class="number">3000</span>&#125;)</span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="keyword">function</span>(<span class="params">ws</span>)&#123;</span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>,<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>());</span><br><span class="line">        ws.<span class="title function_">send</span>(<span class="string">&#x27;metoo&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="nginx">nginx</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">启动nginx 访问 localhost</span><br><span class="line">新建json目录 声明json文件存放数据</span><br><span class="line">location ~.*\.<span class="property">json</span> &#123;</span><br><span class="line">    root  json;</span><br><span class="line">    # ~ 忽略大小写 .*任意字符出现多次 \.单纯的.</span><br><span class="line">    # add_header <span class="string">&quot;Access-Control-Allow-Origin&quot;</span> <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    # 携带凭证和 *通配符不能同时存在</span><br><span class="line">    add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;http://localhost:3000&#x27;</span>;</span><br><span class="line">    add_header <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>a.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&#x27;laoxu&#x27;</span></span><br><span class="line">    xhr.<span class="property">cookie</span> = <span class="string">&#x27;laoxu&#x27;</span></span><br><span class="line">    xhr.<span class="property">withCredentials</span> = <span class="literal">true</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://localhost:88/a.json&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// 设置请求头</span></span><br><span class="line">    <span class="comment">// xhr.setRequestHeader(&#x27;name&#x27;, &#x27;laoxu&#x27;)</span></span><br><span class="line">    <span class="comment">// 请求头 请求正文 请求体</span></span><br><span class="line">    xhr.<span class="title function_">send</span>()</span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="comment">// 304: 表示走缓存了</span></span><br><span class="line">            <span class="keyword">if</span> (xhr.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; xhr.<span class="property">status</span> &lt;= <span class="number">300</span> || xhr.<span class="property">status</span> == <span class="number">304</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="XSS攻击">XSS攻击</h4>
<p><strong>登录页</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登陆页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/node_modules/bootstrap/dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6 col-md-offset-3&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel panel-info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>登录页面<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;login(event)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/node_modules/jquery/dist/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> username = $(<span class="string">&#x27;#username&#x27;</span>).<span class="title function_">val</span>()</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">let</span> password = $(<span class="string">&#x27;#password&#x27;</span>).<span class="title function_">val</span>()</span></span><br><span class="line"><span class="language-javascript">$.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, &#123;username, password&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 根据后端返回的状态码做处理 code: 0 || code: 1</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(res.<span class="property">code</span> === <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        location.<span class="property">href</span> = <span class="string">&#x27;/index.html&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(res.<span class="property">error</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>评论页</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>评论页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/node_modules/bootstrap/dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-12&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-md-6 col-md-offset-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel panel-info&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>评论区<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-footer&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;addComment(event)&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;content&quot;</span>&gt;</span>输入内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>发表评论<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/node_modules/jquery/dist/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 获取评论列表</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 发起请求</span></span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> comments = res.<span class="property">comments</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> html = <span class="string">``</span></span></span><br><span class="line"><span class="language-javascript">        comments.<span class="title function_">forEach</span>(<span class="function"><span class="params">comment</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            html += <span class="string">`&lt;li&gt;<span class="subst">$&#123;comment.username&#125;</span>: <span class="subst">$&#123;encodedHTML(comment.content)&#125;</span>&lt;/li&gt;`</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;.list-group&#x27;</span>).<span class="title function_">html</span>(html)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="title function_">getList</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 发表评论</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">addComment</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> comment = $(<span class="string">&#x27;#content&#x27;</span>).<span class="title function_">val</span>()</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">post</span>(<span class="string">&#x27;/api/addComments&#x27;</span>, &#123; <span class="attr">comment</span>: <span class="title function_">encodedHTML</span>(comment) &#125;, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getList</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(res.<span class="property">error</span>)</span></span><br><span class="line"><span class="language-javascript">            location.<span class="property">href</span> = <span class="string">&#x27;/login.html&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 通过正则替换所有的符号</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">encodedHTML</span>(<span class="params">str</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&#x27;&amp;apos&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>dombashed</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    图片地址: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span>&gt;</span>插入图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/node_modules/jquery/dist/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // 不基于后端 dom-based 改变dom结构 属性</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // 我们客户端的js可以对页面dom节点进行动态的操作，比如插入、修改页面的内容。</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // 比如说客户端从URL中提取数据并且在本地执行、如果用户在客户端输入的数据包含了恶意的js脚本的话，</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // 但是这些脚本又没有做任何过滤处理的话，那么我们的应用程序就有可能受到DOM-based XSS的攻击</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">onerror</span>=<span class="string">&#x27;alert(1)&#x27;</span> &gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">        // <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;&#x27;</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="number">1</span>)&lt;\/script&gt;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        $(<span class="string">&#x27;#insert&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">            $(<span class="string">&#x27;.box&#x27;</span>).<span class="title function_">html</span>(<span class="string">`&lt;img src=<span class="subst">$&#123;<span class="built_in">encodeURI</span>($(<span class="string">&#x27;.img&#x27;</span>).val())&#125;</span>&gt;`</span>) </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">        &#125;)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="language-handlebars">    </span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParse = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; urlencoded &#125; = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析url上的参数</span></span><br><span class="line"><span class="comment">// username=&#x27;zs&#x27;&amp;password=&#x27;111&#x27; =&gt; &#123;username:zs, password: 111&#125; =&gt; req.body</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParse</span>(<span class="title function_">urlencoded</span>(&#123; <span class="attr">extends</span>: <span class="literal">true</span> &#125;)))</span><br><span class="line"><span class="comment">// 数组模拟用户数据</span></span><br><span class="line"><span class="keyword">let</span> userList = [&#123; <span class="attr">username</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;111&#x27;</span> &#125;, &#123; <span class="attr">username</span>: <span class="string">&#x27;zs&#x27;</span>, <span class="attr">password</span>: <span class="string">&#x27;111&#x27;</span> &#125;]</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SESSION_ID</span> = <span class="string">&#x27;connect.sid&#x27;</span></span><br><span class="line"><span class="keyword">let</span> session = &#123;&#125;</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; username, password &#125; = req.<span class="property">body</span></span><br><span class="line">    <span class="keyword">let</span> user = userList.<span class="title function_">find</span>(<span class="function"><span class="params">user</span> =&gt;</span> (user.<span class="property">username</span> == username &amp;&amp; user.<span class="property">password</span> == password))</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        <span class="comment">// 返回给用户一个唯一的凭证 cookie</span></span><br><span class="line">        <span class="comment">// connect.sid = 666</span></span><br><span class="line">        <span class="keyword">let</span> cardId = <span class="title class_">Math</span>.<span class="title function_">random</span>() + <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        <span class="comment">// 将cookie返回给客户端</span></span><br><span class="line">        <span class="comment">// 一般情况下会让cookie在前端不可以获取 并不是解决xss的方案 只是降低受损的范围</span></span><br><span class="line">        res.<span class="title function_">cookie</span>(<span class="variable constant_">SESSION_ID</span>, cardId, &#123;<span class="attr">httpOnly</span>: <span class="literal">false</span>&#125;)</span><br><span class="line">        <span class="comment">// 维护cookie和user之间的关系</span></span><br><span class="line">        session[cardId] = user <span class="comment">// =&gt; &#123;666: &#123;username:admin, password:111&#125;&#125;</span></span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;用户或密码错误&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// xss-反射型(一次性的，非持久攻击) 诱导型</span></span><br><span class="line"><span class="comment">// 概念: 反射性XSS的原理是：反射性xss一般指攻击者通过特定的方式来诱惑受害者去访问一个包含恶意代码的URL。</span></span><br><span class="line"><span class="comment">// 当受害者点击恶意链接url的时候，恶意代码会直接在受害者的主机上的浏览器执行。</span></span><br><span class="line"><span class="comment">// http://localhost:3000/welcome?msg=%E4%BD%A0%E5%A5%BD</span></span><br><span class="line"><span class="comment">// http://localhost:3000/welcome?msg=&lt;script&gt;alert(1)&lt;/script&gt; chrome发现异常 屏蔽xss</span></span><br><span class="line"><span class="comment">// http://localhost:3000/welcome?msg=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/welcome&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="built_in">encodeURIComponent</span>(req.<span class="property">query</span>.<span class="property">msg</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取评论列表</span></span><br><span class="line"><span class="keyword">let</span> comments = [&#123;<span class="attr">username</span>: <span class="string">&#x27;鸿星尔克&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;同志们理性消费&#x27;</span>&#125;, </span><br><span class="line">&#123;<span class="attr">username</span>: <span class="string">&#x27;观众&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;别说话直接上链接&#x27;</span>&#125;]</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/list&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;<span class="attr">code</span>:<span class="number">0</span>, comments&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// xss 存储型攻击</span></span><br><span class="line"><span class="comment">// 存储型XSS的原理是: 主要是将恶意代码上传或存储到服务器中，</span></span><br><span class="line"><span class="comment">// 下次只要受害者浏览包含此恶意代码的页面就会执行恶意代码</span></span><br><span class="line"><span class="comment">// 解决方案</span></span><br><span class="line"><span class="comment">// 1. 服务器做过滤</span></span><br><span class="line"><span class="comment">// 2. 前端发送请求之前做过滤</span></span><br><span class="line"><span class="comment">// 3. 前端输出到页面上之前做过滤</span></span><br><span class="line"><span class="comment">// 添加评论</span></span><br><span class="line"><span class="comment">// 解析cookie</span></span><br><span class="line"><span class="keyword">const</span> cookieParse = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParse</span>())</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/addComments&#x27;</span>,<span class="keyword">function</span>(<span class="params">req, res</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;comment&#125; = req.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 1627865250050.2632: &#123;username: admin, password: 111&#125;</span></span><br><span class="line">    <span class="keyword">let</span> user = session[req.<span class="property">cookies</span>[<span class="string">&#x27;connect.sid&#x27;</span>]] || <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span>(user)&#123;</span><br><span class="line">        comments.<span class="title function_">push</span>(&#123;<span class="attr">username</span>: user.<span class="property">username</span>, <span class="attr">content</span>: comment&#125;)</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;<span class="attr">code</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;<span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;用户未登录&#x27;</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;端口3000已启动&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="CSRF跨站请求伪造">CSRF跨站请求伪造</h4>
<p><strong>fish.html</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>世纪佳缘相亲网，单身光棍的天堂 (注意你的钱包哦)<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;/bad.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>bad.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;form name=<span class="string">&quot;myform&quot;</span> action=<span class="string">&quot;http://localhost:3000/api/pay&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;target&quot; value=&quot;zlq&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;money&quot; value=&quot;1000&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  // 提交表单</span><br><span class="line">  document.myform.submit()</span><br><span class="line">script&gt;</span><br></pre></td></tr></table></figure>
<p><strong>pay.html</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">&lt;title&gt;转账页面&lt;/title&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;/node_modules/bootstrap/dist/css/bootstrap.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">&lt;div class=&quot;row&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;col-md-12&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-md-6 col-md-offset-3&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;panel panel-info&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;panel-heading&quot;&gt;</span><br><span class="line">                    &lt;h3&gt;转账区&lt;/h3&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;panel-body&quot;&gt;</span><br><span class="line">                    &lt;h3&gt;用户: &lt;span class=&quot;u&quot;&gt;&lt;/span&gt;&lt;/h3&gt;</span><br><span class="line">                    &lt;h3&gt;金额: &lt;span class=&quot;m&quot;&gt;&lt;/span&gt;&lt;/h3&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;panel-footer&quot;&gt;</span><br><span class="line">                    &lt;form onsubmit=&quot;pay(event)&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;target&quot;&gt;收款人&lt;/label&gt;</span><br><span class="line">                            &lt;input type=&quot;text&quot; id=&quot;target&quot; class=&quot;form-control&quot;&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;money&quot;&gt;转账金额&lt;/label&gt;</span><br><span class="line">                            &lt;input type=&quot;text&quot; id=&quot;money&quot; class=&quot;form-control&quot;&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;label for=&quot;code&quot; class=&quot;svg&quot;&gt;验证码&lt;/label&gt;</span><br><span class="line">                            &lt;input type=&quot;text&quot; id=&quot;code&quot; class=&quot;form-control&quot;&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                            &lt;button class=&quot;btn btn-danger&quot; type=&quot;submit&quot;&gt;转账&lt;/button&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;/node_modules/jquery/dist/jquery.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function getUserInfo() &#123;</span><br><span class="line">    $.get(&#x27;/api/getUserInfo&#x27;, (res) =&gt; &#123;</span><br><span class="line">        console.log(res);</span><br><span class="line">        if (res.code === 0) &#123;</span><br><span class="line">            $(&#x27;.u&#x27;).html(res.user.username)</span><br><span class="line">            $(&#x27;.m&#x27;).html(res.user.money)</span><br><span class="line">            $(&#x27;.svg&#x27;).html(res.user.pic)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            alert(res.error)</span><br><span class="line">            location.href(&#x27;/login.html&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getUserInfo()</span><br><span class="line"></span><br><span class="line">function pay(e) &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    let target = $(&#x27;#target&#x27;).val()</span><br><span class="line">    let money = $(&#x27;#money&#x27;).val()</span><br><span class="line">    let code = $(&#x27;#code&#x27;).val()</span><br><span class="line">    // connect.sid=1627886290863.131</span><br><span class="line">    let token = document.cookie.split(&#x27;=&#x27;)[1] + &#x27;_mycookie&#x27;</span><br><span class="line">    $.post(&#x27;/api/pay&#x27;, &#123; target, money, code, token &#125;, (res) =&gt; &#123;</span><br><span class="line">        if (res.code == 0) &#123;</span><br><span class="line">            getUserInfo()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            alert(res.error)</span><br><span class="line">            // location.href = &#x27;/login.html&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">// 解决方案</span><br><span class="line">// 1. 验证码 暴力破解 高并发量</span><br><span class="line">// 2. Referer: http://localhost:3001/</span><br><span class="line">// 3. token</span><br><span class="line"></span><br><span class="line">// xss + csrf  xsrf</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>ad.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">post</span>(<span class="string">&#x27;/api/addComments&#x27;</span>, &#123; <span class="attr">comment</span>: <span class="string">&#x27;小日子过的不错的日本选手&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParse = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; urlencoded &#125; = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> svgCaptcha = <span class="built_in">require</span>(<span class="string">&#x27;svg-captcha&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析url上的参数</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParse</span>(<span class="title function_">urlencoded</span>(&#123; <span class="attr">extends</span>: <span class="literal">true</span> &#125;)))</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/getUserInfo&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 查询用户是否登录过了</span></span><br><span class="line">    <span class="keyword">let</span> user = session[req.<span class="property">cookies</span>[<span class="variable constant_">SESSION_ID</span>]] || <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; data, text &#125; = svgCaptcha.<span class="title function_">create</span>()</span><br><span class="line">        user.<span class="property">text</span> = text</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">user</span>: &#123; <span class="attr">username</span>: user.<span class="property">username</span>, <span class="attr">money</span>: user.<span class="property">money</span>, <span class="attr">pic</span>: data &#125; &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;用户未登录&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 转账接口</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/pay&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; target, money, code, token &#125; = req.<span class="property">body</span></span><br><span class="line">    <span class="keyword">let</span> referer = req.<span class="property">headers</span>[<span class="string">&#x27;referer&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> (token === req.<span class="property">cookies</span>[<span class="variable constant_">SESSION_ID</span>] + <span class="string">&#x27;_mycookie&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (referer.<span class="title function_">includes</span>(<span class="string">&#x27;http://localhost:3000&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (code === session[req.<span class="property">cookies</span>[<span class="variable constant_">SESSION_ID</span>]].<span class="property">text</span>) &#123;</span><br><span class="line">                money = <span class="title class_">Number</span>(money)</span><br><span class="line">                <span class="comment">// 查询用户是否登录过了</span></span><br><span class="line">                <span class="keyword">let</span> user = session[req.<span class="property">cookies</span>[<span class="variable constant_">SESSION_ID</span>]] || <span class="literal">null</span></span><br><span class="line">                <span class="keyword">if</span> (user) &#123;</span><br><span class="line">                    userList.<span class="title function_">forEach</span>(<span class="function"><span class="params">u</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 转账人</span></span><br><span class="line">                        <span class="keyword">if</span> (u.<span class="property">username</span> === user.<span class="property">username</span>) &#123;</span><br><span class="line">                            u.<span class="property">money</span> -= money</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 收款人</span></span><br><span class="line">                        <span class="keyword">if</span> (u.<span class="property">username</span> === target) &#123;</span><br><span class="line">                            u.<span class="property">money</span> += money</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span> &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;用户未登录&#x27;</span> &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;验证码错误&#x27;</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;被攻击了&#x27;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">error</span>: <span class="string">&#x27;token不正确&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;端口3000已启动&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>server1.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParse = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; urlencoded &#125; = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>)))</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(__dirname))</span><br><span class="line"><span class="comment">// 解析url上的参数</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">bodyParse</span>(<span class="title function_">urlencoded</span>(&#123; <span class="attr">extends</span>: <span class="literal">true</span> &#125;)))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3001</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;端口3001已启动&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>Git 学习</title>
    <url>/blog/2023/08/09/git/</url>
    <content><![CDATA[<h3 id="Git-历史">Git 历史</h3>
<p>历史使人明智，当我们谈论到某一个伟大的工具的时候，当然是少不了去了解它的历史；只有我们清楚地明白到它是为了解决什么样的问题而产生的，我们才能够更好地去学习了解使用它；</p>
<p>1、git是由谁发明的？<br>
答: git是由Linus发明的，基于C语言的；</p>
<p>2、在当时是为了解决什么样的历史问题？<br>
答: 谈及这个问题就不得不提起另一个伟大的工具linux，在2002年以前呀，这个工具的维护研发是由世界各地的程序员共同参与的，他们写出来的代码全部都交给Linus去合并的 如下图：</p>
<span id="more"></span>
<p><img data-src="https://img-blog.csdnimg.cn/e8db962c4618459798df426c8394c14a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IuO5769,size_20,color_FFFFFF,t_70,g_se,x_16" alt=""></p>
<p>时间节点来到了2002年，这时候经过了十多年的发展参与的人是越来越多了，而一个人合并难以避免的就是效率低这也直接引起了维护者们的不满；</p>
<p>其实在当时已经存在一些版本控制的工具的了，像cvs，svn等，但是这些工具都是要收费的，而且使用的还是集中式版本管理方式。这就受到了Linus的唾弃；</p>
<p>后来Linus选择了BitKeeper分布式版本控制工具作为他们的版本管理工具，这个系统的研发公司也是出于人道博爱的精神给他们免费使用了；</p>
<p>大家都知道linux系统是很牛逼的，所以能参与维护的都不是一般的攻城狮呀，有一天团队里面的一个人就想着破解BitKeeper的协议呀，当时也是被它的研发公司发现了，他们就骂骂咧咧地收回了给他们的使用权；之后就是Linus被迫自己花了半个月时间用C写了git这个伟大的分布式版本控制工具了；</p>
<p><img data-src="image-20220703002156421.png" alt="Linux版本控制历史"></p>
<p><strong>所以Git的产生就是为了解决团队开发效率问题以及开发版本的管理的</strong></p>
<p>3、第二个问题提到的分布式和集中式有什么区别？</p>
<blockquote>
<p>目前市场上有两种版本控制：集中式和分布式</p>
</blockquote>
<p>集中式：拥有一台中央处理服务器，版本库是集中放在中央服务器的，而干活的时候，用的都是自己的电脑，所以首先要从中央服务器哪里得到最新的版本，改完再推回去；所以集中式版本控制系统是必须联网才能工作。</p>
<p>这种做法带来了许多好处，每个人都可以在一定程度上看到项目中的其他人正在做些什 么。而管理员也可以轻松掌控每个开发者的权限，并且管理一个集中化的版本控制系统，要远比在各个客户端上维护本地数据库来得轻松容易。</p>
<p>事分两面，有好有坏。这么做显而易见的缺点是中央服务器的单点故障。如果服务器宕机一小时，那么在这一小时内，谁都无法提交更新，也就无法协同工作</p>
<p>并不是说服务器故障了就没有办法写代码了，只是在服务器故障的情况下，编写的 代码是没有办法得到保障的。试想 svn 中央服务器挂机一天。你还拼命写了一天代码，其中 12 点之前的代码都是高质量可靠的，而且有很多闪光点。而 12 点之后的代码由于你想尝试一个比较大胆的想法，将代码改的面目全非了。这样下来你 12 点之前做的工作也都白费了，有记录的版本只能是 svn 服务器挂掉时保存的版本！</p>
<p>要是中央服务器的磁盘发生故障，碰巧没做备份，或者备份不够及时，就会有丢失数据的风险。最坏的情况是彻底丢失整个项目的所有历史更改记录，而被客户端偶然提取出来的保存在本地的某些快照数据，就成了恢复数据的希望。但这样的话依然是个问题，你不能保证所有的数据都已经有人事先完整提取出来过。 只要整个项目的历史记录被保存在单一位置，就有丢失所有历史更新记录的风险。</p>
<p><img data-src="image-20220703071046386.png" alt="集中式"></p>
<p>分布式：去中心化，没有中央处理服务器，每个人的电脑都是完整的一个版本库，每个电脑都是独立连接的；因为版本都是在自己的电脑上，工作的时候就不需要联网了。</p>
<p>客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来。这么一来，任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复。因为每一次的提取操作，实际上都是一次对代码仓库的完整备份</p>
<p><img data-src="image-20220703071133407.png" alt="分布式"></p>
<p>更进一步，许多这类系统都可以指定和若干不同的远端代码仓库进行交互。籍此，你就可以在同一个项目中分别和不同工作小组的人相互协作。 分布式的版本控制系统在管理项目时 存放的不是项目版本与版本之间 的差异.它存的是索引 （所需磁盘空间很少，所以每个客户端都可以放下整个项目的历史记录）</p>
<p>分布式的版本控制系统出现之后，解决了集中式版本控制系统的缺陷：</p>
<ol>
<li>断网的情况下也可以进行开发 （因为版本控制是在本地进行的）</li>
<li>使用 github 进行团队协作，哪怕 github 挂了，每个客户端保存的也都是整个完整的项目(包含历史记录，更加安全）</li>
</ol>
<hr>
<h3 id="Git-简介">Git 简介</h3>
<p>Git是目前世界上最先进的分布式版本控制系统，是一款免费、开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。</p>
<p>Git是一个开源的分布式版本控制系统，可以有效、高速的处理从很小到非常大的项目版本管理。</p>
<p>Git 是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。</p>
<hr>
<h3 id="Git-特点">Git 特点</h3>
<ul>
<li>
<p>Git易于学习，占地面积小，性能极快。</p>
</li>
<li>
<p>它具有廉价的本地库，方便的暂存区域和多个工作，流分支等特性。</p>
</li>
<li>
<p>适合分布式开发，强调个体；</p>
</li>
<li>
<p>任意两个开发者之间可以很容易的解决冲突；</p>
</li>
<li>
<p>离线工作。</p>
</li>
</ul>
<p>缺点：</p>
<ul>
<li>代码保密性差，一旦开发者把整个库克隆下来就可以完全公开所有代码和版本信息；</li>
<li>权限控制不友好；如果需要对开发者限制各种权限的建议使用SVN。</li>
</ul>
<hr>
<h3 id="何为版本控制">何为版本控制</h3>
<p>版本控制（Revision control）是一种在开发的过程中用于管理我们对文件、目录或工程等内容的修改历史，方便查看更改历史记录，备份以便恢复以前的版本的软件工程技术。</p>
<ul>
<li>实现跨区域多人协同开发</li>
<li>追踪和记载一个或者多个文件的历史记录</li>
<li>组织和保护你的源代码和文档</li>
<li>统计工作量</li>
<li>并行开发、提高开发效率</li>
<li>跟踪记录整个软件的开发过程</li>
<li>减轻开发人员的负担，节省时间，同时降低人为错误</li>
</ul>
<p><strong>简单说就是用于管理多人协同开发项目的技术。</strong></p>
<p>没有进行版本控制或者版本控制本身缺乏正确的流程管理，在软件开发过程中将会引入很多问题，如软件代码的一致性、软件内容的冗余、软件过程的事物性、软件开发过程中的并发性、软件源代码的安全性，以及软件的整合等问题。</p>
<p><img data-src="image-20220703072408227.png" alt="版本控制"></p>
<h3 id="常用术语">常用术语</h3>
<p><strong>1、仓库（Repository）</strong><br>
受版本控制的所有文件修订历史的共享数据库</p>
<p><strong>2、工作空间（Workspace)</strong><br>
本地硬盘或Unix 用户帐户上编辑的文件副本</p>
<p><strong>3、工作树/区（Working tree）</strong><br>
工作区中包含了仓库的工作文件。您可以修改的内容和提交更改作为新的提交到仓库。</p>
<p><strong>4、暂存区（Staging area）</strong><br>
暂存区是工作区用来提交更改（commit）前可以暂存工作区的变化。</p>
<p><img data-src="image-20220703073150458.png" alt="暂存区"></p>
<p><strong>5、索引（Index）</strong><br>
索引是暂存区的另一种术语。</p>
<p><strong>6、签入（Checkin）</strong><br>
将新版本复制回仓库</p>
<p><strong>7、签出（Checkout）</strong><br>
从仓库中将文件的最新修订版本复制到工作空间</p>
<p><strong>8、提交（Commit）</strong><br>
对各自文件的工作副本做了更改，并将这些更改提交到仓库</p>
<p><strong>9、冲突（Conflict）</strong><br>
多人对同一文件的工作副本进行更改，并将这些更改提交到仓库</p>
<p><strong>10、合并（Merge）</strong><br>
将某分支上的更改联接到此主干或同为主干的另一个分支</p>
<p><strong>11、分支（Branch）</strong><br>
从主线上分离开的副本，默认分支叫master</p>
<p><strong>12、锁（Lock）</strong><br>
获得修改文件的专有权限。</p>
<p><strong>13、头（HEAD）</strong><br>
头是一个象征性的参考，最常用以指向当前选择的分支。</p>
<p><strong>14、修订（Revision）</strong><br>
表示代码的一个版本状态。Git通过用SHA1 hash算法表示的ID来标识不同的版本。</p>
<p><strong>15、标记（Tags）</strong><br>
标记指的是某个分支某个特定时间点的状态。通过标记，可以很方便的切换到标记时的状态。</p>
<h3 id="Git-安装">Git 安装</h3>
<p><strong>官网：</strong> <a href="https://git-scm.com/">https://git-scm.com/</a></p>
<p><strong>源码：</strong> <a href="https://github.com/git/git/">https://github.com/git/git/</a></p>
<h4 id="搭建-Git工作环境">搭建 Git工作环境</h4>
<p>打开 <a href="https://git-scm.com/">Git官网</a>，下载git对应操作系统的版本。</p>
<p><img data-src="image-20220703074610862.png" alt=""></p>
<p>选择版本：</p>
<p><img data-src="image-20220703074649845.png" alt=""></p>
<h4 id="安装">安装</h4>
<p><img data-src="image-20220703150422703.png" alt=""></p>
<p>选择 Git安装位置，要求是非中文并且没有空格的目录，然后下一步。</p>
<p><img data-src="image-20220703150500689.png" alt=""></p>
<p>Git选项配置，推荐默认设置，然后下一步。</p>
<p><img data-src="image-20220703150535493.png" alt=""></p>
<p>Git安装目录名，不用修改，直接点击下一步。</p>
<p><img data-src="image-20220703150608352.png" alt=""></p>
<p>Git的默认编辑器，建议使用默认的 Vim编辑器，然后点击下一步。</p>
<p><img data-src="image-20220703150642021.png" alt=""></p>
<p>默认分支名设置，选择让 Git决定，分支名默认为 master，下一步。</p>
<p><img data-src="image-20220703150719157.png" alt=""></p>
<p>修改 Git的环境变量，选第一个，不修改环境变量，只在 Git Bash里使用 Git。</p>
<p><img data-src="image-20220703150756480.png" alt=""></p>
<p>选择后台客户端连接协议，选默认值 OpenSSL，然后下一步。</p>
<p><img data-src="image-20220703150823380.png" alt=""></p>
<p>配置 Git文件的行末换行符，Windows使用 CRLF，Linux使用 LF，选择第一个自动 转换，然后继续下一步。</p>
<p><img data-src="image-20220703150851446.png" alt=""></p>
<p>选择 Git终端类型，选择默认的 Git Bash终端，然后继续下一步。</p>
<p><img data-src="image-20220703150918345.png" alt=""></p>
<p>选择 Git pull合并的模式，选择默认，然后下一步。</p>
<p><img data-src="image-20220703150939063.png" alt=""></p>
<p>选择 Git的凭据管理器，选择默认的跨平台的凭据管理器，然后下一步。</p>
<p><img data-src="image-20220703150959388.png" alt=""></p>
<p>其他配置，选择默认设置，然后下一步。</p>
<p><img data-src="image-20220703151025146.png" alt=""></p>
<p>实验室功能，技术还不成熟，有已知的 bug，不要勾选，然后点击右下角的 Install 按钮，开始安装 Git。</p>
<p><img data-src="image-20220703151050377.png" alt=""></p>
<p>点击 Finsh按钮，Git安装成功！</p>
<p><img data-src="image-20220703151119145.png" alt=""></p>
<h4 id="启动-Git">启动 Git</h4>
<p>安装完毕右键桌面即可看到Git图标，或者点击开始菜单栏</p>
<p><img data-src="image-20220703080317674.png" alt=""></p>
<p><strong>Git Bash：</strong> Unix与Linux风格的命令行，使用最多，推荐最多</p>
<p><img data-src="image-20220703080552529.png" alt=""></p>
<p>与DOS风格的命令有些区别，不习惯可以选择Git CMD</p>
<p><strong>Git CMD：</strong> Windows风格的命令行</p>
<p><img data-src="image-20220703080745181.png" alt=""></p>
<p>**Git GUI：**图形界面的Git，不建议初学者使用，尽量先熟悉常用命令</p>
<p><img data-src="image-20220703135140532.png" alt=""></p>
<p>点击Create New Repository可以直接创建一个新的仓库。</p>
<h4 id="Bash-基本命令">Bash 基本命令</h4>
<p>1、cd : 改变目录。<br>
2、cd . . 回退到上一个目录，直接cd进入默认目录<br>
3、pwd : 显示当前所在的目录路径。<br>
4、ls(ll): 都是列出当前目录中的所有文件，只不过ll(两个ll)列出的内容更为详细。<br>
5、touch : 新建一个文件 如 touch index.js 就会在当前目录下新建一个index.js文件。<br>
6、rm: 删除一个文件, rm index.js 就会把index.js文件删除。<br>
7、mkdir: 新建一个目录,就是新建一个文件夹。<br>
8、rm -r : 删除一个文件夹, rm -r src 删除src目录， 好像不能用通配符。<br>
9、mv 移动文件, mv index.html src index.html 是我们要移动的文件, src 是目标文件夹,当然, 这样写,必须保证文件和目标文件夹在同一目录下。<br>
10、reset 重新初始化终端/清屏。<br>
11、clear 清屏。<br>
12、history 查看命令历史。<br>
13、help 帮助。<br>
14、exit 退出。<br>
15、#表示注释</p>
<h4 id="Git-常见命令">Git 常见命令</h4>
<p><img data-src="https://img-blog.csdnimg.cn/9d64a05c0bed45debba481cd227c6613.png#pic_center" alt=""></p>
<p>为了方便查找，做了如下细化和分类</p>
<p>专用名词：</p>
<ul>
<li><code>master</code>: 默认开发分支</li>
<li><code>origin</code>: 默认远程版本库</li>
<li><code>Index / Stage</code>：暂存区</li>
<li><code>Workspace</code>：工作区</li>
<li><code>Repository</code>：仓库区（或本地仓库）</li>
<li><code>Remote</code>：远程仓库</li>
</ul>
<h5 id="新建代码库">新建代码库</h5>
<p><code>git init</code>: 在当前目录新建一个代码仓库<br>
<code>git init [project-name]</code>: 新建一个目录，把它初始化为git代码仓库<br>
<code>git clone [url]</code>: 下载一个项目和它整个代码的历史，即从远程把仓库复制一份到本地，克隆后会创建一个新的本地仓库</p>
<h5 id="配置类命令">配置类命令</h5>
<p><code>git config --list</code>:查看git配置<br>
<code>git config -e [--global]</code>:编辑git配置文件<br>
<code>git config [--global] user.name &quot;用户名&quot;</code>:设置[全局]配置用户名<br>
<code>git config [--global] user.password &quot;密码&quot;</code>:设置[全局]配置密码<br>
<code>git config [--global] user.email&quot;邮箱&quot;</code>:重新全局配置邮箱<br>
<code>ssh-keygen</code>:生成ssh 公钥</p>
<h5 id="修改类命令">修改类命令</h5>
<p><code>git status</code>:查看当前工作区的状态<br>
<code>git diff -- fileName</code>:命令可以查看工作区和版本库里面最新版本的区别<br>
<code>git add [file1] [file2]</code>: 添加文件到暂存区<br>
<code>git add dir</code>: 添加文件目录到暂存区<br>
<code>git add .</code>: 添加当前目录所有文件到暂存区<br>
<code>git add -p</code>: 添加每个变化前都会要求确认，对于同一文件多处变化，可以实现分次提交</p>
<p><code>git rm [file1] [file2]</code>: 删除工作区文件，并把删除放入暂存区<br>
<code>git rm --cached [file]</code>: 停止追踪指定文件，但该文件会保留在工作区<br>
<code>git mv [file-origname] [file-rename]</code>: 改名文件，并把改名放入暂存区</p>
<h5 id="提交类命令">提交类命令</h5>
<p><code>git commit -m [message]</code>:提交暂存区到本地仓库区<br>
<code>git commit [file1] [file2] ... -m [message]</code>:提交暂存区的指定文件本地仓库区<br>
<code>git commit -a</code>:提交工作区自上次commit之后的变化直接到本地仓库区<br>
<code>git commit -v</code>:提交时显示所有的diff信息<br>
<code>git commit --amend -m [message]</code>:使用一次新的commit，替代上一次提交，如果代码没有变化，就改写上一次commit的提交信息<br>
<code>git commit --amend [file1] [file2]</code>:重做上一次commit，并包括指定文件的新变化<br>
<code>git commit --amend --only -m 'xxxxxxx'</code> : 如果提交信息(commit message)写错了且这次提交(commit)还没有推(push), 可以通过此方法来修改提交信息(commit message)<br>
<code>git commit --amend --author &quot;New Authorname &lt;authoremail@mydomain.com&gt;&quot;</code> : 提交(commit)里的用户名和邮箱不对</p>
<h5 id="分支类命令">分支类命令</h5>
<p><code>git branch</code>:查看所有分支，当前分支前面会有一个<code>*</code>表示<br>
<code>git branch -r</code>:列出所有远程分支<br>
<code>git branch -a</code>:列出所有本地分支和远程分支<br>
<code>git branch [branch-name]</code>:新建一个分支，但依然停留在当前分支<br>
<code>git branch --track [branch] [remote-branch]</code>:新建一个分支，与远程指定分支建立追踪关系<br>
<code>git branch -d [branch]</code>:删除分支<br>
<code>git push origin --delete [branch]</code>:删除远程分支<br>
<code>git branch -dr [remote/branch]</code>:删除远程分支<br>
<code>git checkout -b [branch]</code>:创建并切换到新的分支<br>
<code>git checkout [branch]</code>:切换到指定分支，并更新工作区<br>
<code>git checkout -</code>:切换到上一个分支<br>
<code>git branch --set-upstream [branch] [remote-branch]</code>:建立追踪关系，在现有分支与指定远程分支之间<br>
<code>git merge [branch]</code>:用来合并指定分支到当前分支，假如要合并dev到master，使用此命令时需要先使用<code>checkout命令</code>切换到<code>master分支</code>，然后将 <code>dev分支</code>的修改合并到<code>master分支</code><br>
<code>git rebase [branch]</code>:衍合指定分支到当前分支<br>
<code>git cherry-pick [commit]</code>:合并部分commit，不像merge是合并全部commit，选择一个commit合并到当前分支</p>
<h5 id="标签类">标签类</h5>
<p><code>git tag</code>:列出所有本地标签<br>
<code>git tag &lt;tagname&gt;</code>:基于最新提交创建标签<br>
<code>git tag -d &lt;tagname&gt;</code>:删除指定标签<br>
<code>git push origin :refs/tags/[tagName]</code>:删除远程标签<br>
<code>git show [tag]</code>:查看标签信息<br>
<code>git push [remote] [tag]</code>:提交指定tag<br>
<code>git push [remote] --tags</code>:提交所有tag<br>
<code>git checkout -b [branch] [tag]</code>:新建一个分支指向某个tag</p>
<h5 id="查看信息">查看信息</h5>
<p><code>git status</code>:显示有变更的文件<br>
<code>git log</code>:查看历史的每次提交信息，但是如果回退版本了，那么对应的历史信息就没了，那就使用<code>git reflog</code><br>
<code>git reflog</code>:看到以前的每次执行动作<br>
<code>git log --stat</code>:显示commit历史，以及每次commit发生变更的文件<br>
<code>git log -S [keyword]</code>:根据关键字搜索提交历史<br>
<code>git log [tag] HEAD --pretty=format:%s</code>:显示某个commit之后所有变动，每个commit占据一行<br>
<code>git log [tag] HEAD --grep feature</code>:显示某个commit之后所有变动，其<code>提交说明</code>必须符合搜索条件<br>
<code>git log --follow [file]</code>:显示某个文件版本历史，包括文件改名<br>
<code>git whatchanged [file]</code>:显示某个文件版本历史，包括文件改名<br>
<code>git log -p [file]</code>:显示指定文件相关的每一次的diff<br>
<code>git log -5 --pretty --online</code>:显示过去5次提交<br>
<code>git shortlog -sn</code>:显示所有提交过的用户，按提交次数序排序<br>
<code>git blame [file]</code>:显示指定文件是什么人在什么时候修改过<br>
<code>git diff</code>:显示暂存区和工作区差异<br>
<code>git diff --cache [file]</code>:显示暂存区和上一个文件的差异<br>
<code>git diff HEAD</code>:显示工作区和当前分支最新commit之间差异<br>
<code>git diff [first-branch] ... [second-branch]</code>:显示两次提交之间差异<br>
<code>git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;</code>:显示今天写了多少行代码<br>
<code>git show [commit]</code>:显示某次提交元数据和内容变化<br>
<code>git show --name-only [commit]</code>:显示某次提交发生变化的文件<br>
<code>git show [commit]:[fileName]</code>:显示某次时某个文件的内容</p>
<h5 id="远程操作">远程操作</h5>
<p><code>git fetch [remote]</code>:下载远程仓库所有变动<br>
<code>git pull [remote] [branch]</code>:获取远程仓库变化，并与本地代码合并<br>
<code>git remote -v</code>:显示所有远程仓库<br>
<code>git remote show [remote]</code>:显示某个远程仓库信息<br>
<code>git remote add [shortname] [url]</code>:增加一个新的远程仓库并命名<br>
<code>git push [remote] [branch]</code>:上传本地指定分支到远程仓库<br>
<code>git push [remote] --force</code>:强行推当前分支到远程仓库，即使有冲突<br>
<code>git push [remote] --all</code>:推送所有分支到远程仓库<br>
<code>git push &lt;remote&gt; :&lt;branch/tag-name&gt;</code>:删除远程分支或标签<br>
<code>git push --tags</code>:上传所有标签</p>
<h5 id="撤销操作">撤销操作</h5>
<p><code>git reset --hard HEAD</code>:撤销工作目录中所有未提交文件的修改内容<br>
<code>git reset --hard HEAD^</code> : 把当前的版本回退到上一个版本，如果退到上上个版本只需把<code>HEAD^</code>改成 <code>HEAD^^</code> 以此类推<br>
<code>git reset --hard HEAD~100</code> : 回退到前100个版本<br>
<code>git checkout HEAD &lt;file&gt;</code>:撤销指定的未提交文件的修改内容<br>
<code>git revert &lt;commit&gt;</code>:撤销指定提交<br>
<code>git log --before=&quot;1 days&quot;</code>:退回到之前一天的版本<br>
<code>git checkout [file]</code>:恢复暂存区指定文件到工作区<br>
<code>git checkout [commit] [file]</code>:恢复某个commit指定文件到暂存区和工作区<br>
<code>git checkout .</code>:恢复暂存区所有文件到工作区<br>
<code>git reset [file]</code>:重置暂存区指定文件，与上一次commit保持一致，但工作区不变<br>
<code>git reset --hard</code>:重置暂存区与工作区，与上一次commit保持一致<br>
<code>git reset [commit]</code>:重置当前分支指针为指定commit，同时重置暂存区，但工作区不变<br>
<code>git reset --hard [commit]</code>:重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致<br>
<code>git reset --keep [commit]</code>:重置当前分支的HEAD为指定commit，但是保持暂存区和工作区不变<br>
<code>git revert [commit]</code>:新建一个commit，用来撤销指定commit，后者所有变化都被前者抵消，并且应用到当前分支<br>
<code>git stash:</code>将未提交的变化移除，稍后移入，保存工作区<br>
<code>git stash pop :</code>将未提交的变化移入，保存工作区</p>
<h5 id="其他命令">其他命令</h5>
<p><code>git archive</code>:生成一个可供发布的压缩包</p>
<hr>
<h3 id="Git-配置">Git 配置</h3>
<p>使用 <code>git config -l </code> 可以查看现在的git环境详细配置</p>
<p><img data-src="image-20220703140022093.png" alt=""></p>
<p>查看不同级别的配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 查看系统config</span><br><span class="line">git config --system --list</span><br><span class="line">　　</span><br><span class="line"># 查看当前用户(global)配置</span><br><span class="line">git config --global --list</span><br><span class="line"> </span><br><span class="line"># 查看当前仓库配置信息</span><br><span class="line">git config --local --list</span><br></pre></td></tr></table></figure>
<h4 id="Git配置文件分类">Git配置文件分类</h4>
<p><strong>git配置文件有三个</strong></p>
<p>1、system 系统级：</p>
<p>路径位于 (C:\Program Files\Git\etc\gitconfig)：包含了适用于系统所有用户和所有项目的值。</p>
<p><img data-src="image-20220703140730719.png" alt=""></p>
<p>2、global 全局：</p>
<p>路径位于(Win：C:\Users\Administrator\.gitconfig)：只适用于当前登录用户的配置。</p>
<p><img data-src="image-20220703141023119.png" alt=""></p>
<p><img data-src="image-20220703141134730.png" alt=""></p>
<p>3、local当前项目：</p>
<p>路径位于(git项目目录中的.git/config)：适用于特定git项目的配置。</p>
<p><img data-src="image-20220703141805923.png" alt=""></p>
<p><code>注意：对于同一配置项，三个配置文件的优先级是1&lt;2&lt;3。</code></p>
<p><code>这里可以直接编辑配置文件，通过命令设置后也会响应到这里</code></p>
<h4 id="设置用户签名">设置用户签名</h4>
<p>当你安装Git后首先要做的事情是设置你的用户名称和e-mail地址。这是非常重要的，签名的作用是用来区分不同操作者的身份，每次Git提交都会使用该信息，它被永远的嵌入到了你的提交中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;laoxu&quot;  #名称</span><br><span class="line">git config --global user.email laoxu@git.com  #邮箱</span><br></pre></td></tr></table></figure>
<p>只需要做一次这个设置，而且必须要做，否则无法提交到代码托管中心上，如果你传递了–global 选项，因为Git将总是会使用该信息来处理你在系统中所做的一切操作。它将被设置到上述的 <strong>global 全局</strong> 中。</p>
<p>如果你希望在一个特定的项目中使用不同的名称或e-mail地址，你可以在该项目中运行该命令而不要–global选项。 总之–global为全局配置，不加为某个项目的特定配置。</p>
<h4 id="Git-连接Gitee-GitHub">Git 连接Gitee / GitHub</h4>
<h5 id="通过SSH公钥连接"><strong>通过SSH公钥连接</strong></h5>
<p>（推荐资深用户或经常推送大型文件用户使用）</p>
<p>Gitee 提供了基于SSH协议的Git服务，在使用SSH协议访问仓库之前，需要先配置好账户/仓库的SSH公钥。</p>
<p>SSH全称(Secure SHell)是一种网络协议，顾名思义就是非常安全的shell，主要用于计算机间加密传输。<br>
使用加密通道读写仓库，无单次上传限制，需先设置 账户 SSH 公钥，完成配对验证。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;xxx@xxx.com&quot;</span><br></pre></td></tr></table></figure>
<p>注意：这里的 <a href="mailto:xxx@xxx.com">xxx@xxx.com</a> 只是生成的 sshkey 的名称，并不约束或要求具体命名为某个邮箱。<br>
现网的大部分教程均讲解的使用邮箱生成，其一开始的初衷仅仅是为了便于辨识所以使用了邮箱。</p>
<p>按照提示完成三次回车，即可生成 ssh key。通过查看 C:\Users\用户名\.ssh\id_rsa.pub 文件内容，前者是私钥， 后者是公钥。秘钥不能泄露出去，而公钥要设置在gitee相应位置。<br>
<img data-src="image-20220703154013880.png" alt=""></p>
<p><img data-src="image-20220703154038441.png" alt=""></p>
<p><strong>gitee免密登录</strong></p>
<p>复制生成后的 ssh key，通过个人主页 「设置」-&gt;「SSH公钥」 ，添加生成的 public key 添加到仓库中。</p>
<p><img data-src="image-20220703154330253.png" alt=""></p>
<p>或者单独为仓库设置 ssh key，通过 仓库主页 「管理」-&gt;「部署公钥管理」-&gt; 「公钥管理」</p>
<p><img data-src="image-20220703154745792.png" alt=""></p>
<p><strong>配置本地仓库连接远程仓库</strong></p>
<p><code>git remote add test git@gitee.com:xx/xx.git:</code>会关联<code>git@gitee.com:xx/xx.git</code>所对应的远程仓库。<code>test</code>是设置的关联名字，可以随便起， 以后通过它向远程仓库提交程序</p>
<h5 id="通过https连接">通过https连接</h5>
<p>（推荐轻量级用户使用）</p>
<p>通过<code>https</code>连接就需要<code>https</code>的连接地址，使用加密的网页访问通道读写仓库，使用用户名及密码进行鉴权比如：<code>https://gitee.com/laoxu/git-test.git</code><br>
此时就不需要<code>ssh</code>生成公钥，也不用在gitee上配置<code>ssh公钥</code></p>
<p><code>git remote add test https://gitee.com/jingzh7751/git-test.git:</code>用来和远端仓库进行关联，在拉取或者推送时只用输入账号或者密码就可以了</p>
<h4 id="更多配置选项">更多配置选项</h4>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global color.ui true   #打开所有的默认终端着色</span><br><span class="line">git config --global alias.ci commit   #别名 ci 是commit的别名</span><br><span class="line">[alias]  </span><br><span class="line">co = checkout  </span><br><span class="line">ci = commit  </span><br><span class="line">st = status  </span><br><span class="line">pl = pull  </span><br><span class="line">ps = push  </span><br><span class="line">dt = difftool  </span><br><span class="line">l = log --stat  </span><br><span class="line">cp = cherry-pick  </span><br><span class="line">ca = commit -a  </span><br><span class="line">b = branch </span><br><span class="line"></span><br><span class="line">user.name  #用户名</span><br><span class="line">user.email  #邮箱</span><br><span class="line">core.editor  #文本编辑器  </span><br><span class="line">merge.tool  #差异分析工具  </span><br><span class="line">core.paper &quot;less -N&quot;  #配置显示方式  </span><br><span class="line">color.diff true  #diff颜色配置  </span><br><span class="line">alias.co checkout  #设置别名</span><br><span class="line">git config user.name  #获得用户名</span><br><span class="line">git config core.filemode false  #忽略修改权限的文件  </span><br></pre></td></tr></table></figure>
<p>所有config命令参数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">语法: git config [&lt;options&gt;]        </span><br><span class="line">        </span><br><span class="line">文件位置        </span><br><span class="line">    --global                  #use global config file 使用全局配置文件</span><br><span class="line">    --system                  #use system config file 使用系统配置文件</span><br><span class="line">    --local                   #use repository config file    使用存储库配置文件</span><br><span class="line">    -f, --file &lt;file&gt;         #use given config file    使用给定的配置文件</span><br><span class="line">    --blob &lt;blob-id&gt;          #read config from given blob object    从给定的对象中读取配置</span><br><span class="line">        </span><br><span class="line">动作        </span><br><span class="line">    --get                     #get value: name [value-regex]    获得值：[值]名[正则表达式]</span><br><span class="line">    --get-all                 #get all values: key [value-regex]    获得所有值：[值]名[正则表达式]</span><br><span class="line">    --get-regexp          #get values for regexp: name-regex [value-regex]    得到的值根据正则</span><br><span class="line">    --get-urlmatch            #get value specific for the URL: section[.var] URL    为URL获取特定的值</span><br><span class="line">    --replace-all             #replace all matching variables: name value [value_regex]    替换所有匹配的变量：名称值[ value_regex ]</span><br><span class="line">    --add                     #add a new variable: name value    添加一个新变量：name值</span><br><span class="line">    --unset                   #remove a variable: name [value-regex]    删除一个变量名[值]：正则表达式</span><br><span class="line">    --unset-all               #remove all matches: name [value-regex]    删除所有匹配的正则表达式：名称[值]</span><br><span class="line">    --rename-section          #rename section: old-name new-name    重命名部分：旧名称 新名称</span><br><span class="line">    --remove-section          #remove a section: name    删除部分：名称</span><br><span class="line">    -l, --list                #list all    列出所有</span><br><span class="line">    -e, --edit            #open an editor    打开一个编辑器</span><br><span class="line">    --get-color               #find the color configured: slot [default]    找到配置的颜色：插槽[默认]</span><br><span class="line">    --get-colorbool           #find the color setting: slot [stdout-is-tty]    发现颜色设置：槽[ stdout是TTY ]</span><br><span class="line">        </span><br><span class="line">类型        </span><br><span class="line">    --bool                    #value is &quot;true&quot; or &quot;false&quot;    值是“真”或“假”。</span><br><span class="line">    --int                     #value is decimal number    值是十进制数。</span><br><span class="line">    --bool-or-int             #value is --bool or --int    值--布尔或int</span><br><span class="line">    --path                    #value is a path (file or directory name)    值是路径（文件或目录名）</span><br><span class="line">        </span><br><span class="line">其它        </span><br><span class="line">    -z, --null                #terminate values with NUL byte    终止值与null字节</span><br><span class="line">    --name-only               #show variable names only    只显示变量名</span><br><span class="line">    --includes                #respect include directives on lookup    尊重包括查找指令</span><br><span class="line">    --show-origin             #show origin of config (file, standard input, blob, command line)    显示配置（文件、标准输入、数据块、命令行）的来源</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Git理论基础">Git理论基础</h3>
<h4 id="工作区域">工作区域</h4>
<p>Git本地有三个工作区域：工作目录（Working Directory）、暂存区(Stage/Index)、资源库(Repository或Git Directory)。如果在加上远程的git仓库(Remote Directory)就可以分为四个工作区域。文件在这四个区域之间的转换关系如下：</p>
<p><img data-src="image-20220703151549530.png" alt=""></p>
<ul>
<li>Workspace：工作区，就是你平时存放项目代码的地方</li>
<li>Index / Stage：暂存区，用于临时存放你的改动，事实上它只是一个文件，保存即将提交到文件列表信息</li>
<li>Repository：仓库区（或本地仓库），就是安全存放数据的位置，这里面有你提交到所有版本的数据。其中HEAD指向最新放入仓库的版本</li>
<li>Remote：远程仓库，托管代码的服务器，可以简单的认为是你项目组中的一台电脑用于远程数据交换</li>
</ul>
<p>本地的三个区域确切的说应该是git仓库中HEAD指向的版本</p>
<p><img data-src="image-20220703151843221.png" alt=""></p>
<ul>
<li>Directory：使用Git管理的一个目录，也就是一个仓库，包含我们的工作空间和Git的管理空间。</li>
<li>WorkSpace：需要通过Git进行版本控制的目录和文件，这些目录和文件组成了工作空间。</li>
<li>.git：存放Git管理信息的目录，初始化仓库的时候自动创建。</li>
<li>Index/Stage：暂存区，或者叫待提交更新区，在提交进入repo之前，我们可以把所有的更新放在暂存区。</li>
<li>Local Repo：本地仓库，一个存放在本地的版本库；HEAD会只是当前的开发分支（branch）。</li>
<li>Stash：隐藏，是一个工作状态保存栈，用于保存/恢复WorkSpace中的临时状态。</li>
</ul>
<h4 id="工作流程">工作流程</h4>
<p>git的工作流程一般是这样的：</p>
<p>１、在工作目录中添加、修改文件；</p>
<p>２、将需要进行版本管理的文件放入暂存区域；</p>
<p>３、将暂存区域的文件提交到git仓库。</p>
<p>因此，git管理的文件有三种状态：已修改（modified）,已暂存（staged）,已提交(committed)</p>
<p><img data-src="image-20220703152004485.png" alt=""></p>
<h4 id="图解教程">图解教程</h4>
<p>个人认为Git的原理相比别的版本控制器还是复杂一些的，有一份图解教程比较直观：</p>
<p><a href="http://www.cnblogs.com/yaozhongxiao/p/3811130.html">图解教程中文版</a></p>
<p><img data-src="image-20220703152205753.png" alt="image-20220703152205753"></p>
<h3 id="Git-操作">Git 操作</h3>
<h4 id="创建工作目录与常用指令"><strong>创建工作目录与常用指令</strong></h4>
<p>工作目录（WorkSpace)一般就是你希望Git帮助你管理的文件夹，可以是你项目的目录，也可以是一个空目录，建议不要有中文。</p>
<p>日常使用只要记住下图6个命令：</p>
<p><img data-src="image-20220703152319073.png" alt=""></p>
<h4 id="获得GIT仓库"><strong>获得GIT仓库</strong></h4>
<p>创建本地仓库的方法有两种：一种是创建全新的仓库，另一种是克隆远程仓库。</p>
<p><strong>创建全新仓库</strong></p>
<p>需要用GIT管理的项目的根目录执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 在当前目录新建一个Git代码库</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>
<p>执行完毕后会得到一个.git隐藏文件夹，如果没显示可以设置</p>
<p><img data-src="image-20220703152553509.png" alt=""></p>
<p>文件夹内容如下：</p>
<p><img data-src="image-20220703152629993.png" alt=""></p>
<p>执行后可以看到，仅仅在项目目录多出了一个.git目录，关于版本等的所有信息都在这个目录里面。</p>
<p>当然如果使用如下命令，可以把创建目录与仓库一起完成：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 新建一个目录，将其初始化为Git代码库</span><br><span class="line">git init [project-name]</span><br></pre></td></tr></table></figure>
<p><strong>克隆远程仓库</strong></p>
<p>另一种方式是克隆远程目录，由于是将远程服务器上的仓库完全镜像一份至本地，而不是取某一个特定版本，所以用clone而不是checkout，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 克隆一个项目和它的整个代码历史(版本信息)</span><br><span class="line">git clone [url]</span><br></pre></td></tr></table></figure>
<p>比如我们要从克隆的远程仓库托管在github上，如下方式获取地址：</p>
<p><img data-src="image-20220703152914328.png" alt=""></p>
<h4 id="GIT文件操作">GIT文件操作</h4>
<p>版本控制就是对文件的版本控制，要对文件进行修改、提交等操作，首先要知道文件当前在什么状态，不然可能会提交了现在还不想提交的文件，或者要提交的文件没提交上。GIT不关心文件两个版本之间的具体差别，而是关心文件的整体是否有改变，若文件被改变，在添加提交时就生成文件新版本的快照，而判断文件整体是否改变的方法就是用SHA-1算法计算文件的校验和。</p>
<p><strong>文件4种状态</strong></p>
<ul>
<li><strong>Untracked</strong>: 未跟踪, 此文件在文件夹中, 但并没有加入到git库, 不参与版本控制. 通过<code>git add</code> 状态变为<code>Staged</code>.</li>
<li><strong>Unmodify</strong>: 文件已经入库, 未修改, 即版本库中的文件快照内容与文件夹中完全一致. 这种类型的文件有两种去处, 如果它被修改, 而变为<code>Modified</code>. 如果使用<code>git rm</code>移出版本库, 则成为<code>Untracked</code>文件</li>
<li><strong>Modified</strong>: 文件已修改, 仅仅是修改, 并没有进行其他的操作. 这个文件也有两个去处, 通过<code>git add</code>可进入暂存<code>staged</code>状态, 使用<code>git checkout</code> 则丢弃修改过, 返回到<code>unmodify</code>状态, 这个<code>git checkout</code>即从库中取出文件, 覆盖当前修改</li>
<li><strong>Staged</strong>: 暂存状态. 执行<code>git commit</code>则将修改同步到库中, 这时库中的文件和本地文件又变为一致, 文件为<code>Unmodify</code>状态. 执行<code>git reset HEAD filename</code>取消暂存, 文件状态为<code>Modified</code></li>
</ul>
<p><img data-src="image-20220703153520002.png" alt=""></p>
<h4 id="查看文件状态">查看文件状态</h4>
<p>上面说文件有4种状态，通过如下命令可以查看到文件的状态：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看指定文件状态</span><br><span class="line">git status [filename]</span><br><span class="line"></span><br><span class="line">#查看所有文件状态</span><br><span class="line">git status</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220703153641659.png" alt=""></p>
<p>结果：</p>
<p>foo.htm文件的状态为untracked（未跟踪），提示通过git add可以暂存</p>
<p>GIT在这一点做得很好，在输出每个文件状态的同时还说明了怎么操作，像上图就有怎么暂存、怎么跟踪文件、怎么取消暂存的说明。</p>
<h4 id="添加文件与目录">添加文件与目录</h4>
<p><img data-src="image-20220703184850438.png" alt=""></p>
<p>工作区（Working Directory）就是你在电脑里能看到的目录。</p>
<p>版本库（Repository）工作区有一个隐藏目录<code>.git</code>，这个不算工作区，而是Git的版本库。</p>
<p>Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支<code>master</code>，以及指向<code>master</code>的一个指针叫<code>HEAD</code>。</p>
<p>将untracked状态的文件添加到暂存区，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 添加指定文件到暂存区</span><br><span class="line">git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"># 添加指定目录到暂存区，包括子目录</span><br><span class="line">git add [dir]</span><br><span class="line"></span><br><span class="line"># 添加当前目录的所有文件到暂存区</span><br><span class="line">git add .</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220703185056947.png" alt=""></p>
<h4 id="移除文件与目录（撤销add）">移除文件与目录（撤销add）</h4>
<p><img data-src="image-20220703185129815.png" alt=""></p>
<p>当执行如下命令时，会直接从暂存区删除文件，工作区则不做出改变</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#直接从暂存区删除文件，工作区则不做出改变</span><br><span class="line">git rm --cached &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220703185213868.png" alt=""></p>
<p>通过重写目录树移除add文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#如果已经用add 命令把文件加入stage了，就先需要从stage中撤销</span><br><span class="line">git reset HEAD &lt;file&gt;...</span><br></pre></td></tr></table></figure>
<p>当执行 “git reset HEAD” 命令时，暂存区的目录树会被重写，被 master 分支指向的目录树所替换，但是工作区不受影响。</p>
<p>示例：把f1.txt文件从暂存区撤回工作区</p>
<p><img data-src="image-20220703185336189.png" alt=""></p>
<p>移除所有未跟踪文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#移除所有未跟踪文件</span><br><span class="line">#一般会加上参数-df，-d表示包含目录，-f表示强制清除。</span><br><span class="line">git clean [options] </span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p><img data-src="image-20220703185427133.png" alt=""></p>
<p>移除前：</p>
<p><img data-src="image-20220703185455192.png" alt=""></p>
<p>执行移除：</p>
<p><img data-src="image-20220703185527566.png" alt=""></p>
<p>移除后：</p>
<p><img data-src="image-20220703185549697.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#只从stage中删除，保留物理文件</span><br><span class="line">git rm --cached readme.txt </span><br><span class="line"></span><br><span class="line">#不但从stage中删除，同时删除物理文件</span><br><span class="line">git rm readme.txt </span><br><span class="line"></span><br><span class="line">#把a.txt改名为b.txt</span><br><span class="line">git mv a.txt b.txt</span><br></pre></td></tr></table></figure>
<p>当执行提交操作（git commit）时，暂存区的目录树写到版本库（对象库）中，master 分支会做相应的更新。即 master 指向的目录树就是提交时暂存区的目录树。</p>
<p>当执行 “git reset HEAD” 命令时，暂存区的目录树会被重写，被 master 分支指向的目录树所替换，但是工作区不受影响。</p>
<p>当执行 “git rm –cached <file>” 命令时，会直接从暂存区删除文件，工作区则不做出改变。</p>
<p>当执行 “git checkout .” 或者 “git checkout — <file>” 命令时，会用暂存区全部或指定的文件替换工作区的文件。这个操作很危险，会清除工作区中未添加到暂存区的改动。</p>
<p>当执行 “git checkout HEAD .” 或者 “git checkout HEAD <file>” 命令时，会用 HEAD 指向的 master 分支中的全部或者部分文件替换暂存区和以及工作区中的文件。这个命令也是极具危险性的，因为不但会清除工作区中未提交的改动，也会清除暂存区中未提交的改 动。</p>
<h4 id="查看文件修改后的差异">查看文件修改后的差异</h4>
<p>git diff用于显示WorkSpace中的文件和暂存区文件的差异</p>
<p>用&quot;git status&quot;只能查看对哪些文件做了改动，如果要看改动了什么，可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看文件修改后的差异</span><br><span class="line">git diff [files]</span><br></pre></td></tr></table></figure>
<p>命令：</p>
<p><img data-src="image-20220703185824812.png" alt=""></p>
<p>—a表示修改之前的文件，+++b表示修改后的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#比较暂存区的文件与之前已经提交过的文件</span><br><span class="line">git diff --cached</span><br></pre></td></tr></table></figure>
<p>也可以把WorkSpace中的状态和repo中的状态进行diff，命令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#比较repo与工作空间中的文件差异</span><br><span class="line">git diff HEAD~n</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220703185857831.png" alt=""></p>
<h4 id="签出"><strong>签出</strong></h4>
<p>如果仓库中已经存在文件f4.txt，在工作区中对f4修改了，如果想撤销可以使用checkout，签出覆盖</p>
<p>检出命令git checkout是git最常用的命令之一，同时也是一个很危险的命令，因为这条命令会重写工作区</p>
<p>语法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#用法一</span><br><span class="line">git checkout [-q] [&lt;commit&gt;] [--] &lt;paths&gt;...</span><br><span class="line">#用法二</span><br><span class="line">git checkout [&lt;branch&gt;]</span><br><span class="line">#用法三</span><br><span class="line">git checkout [-m] [[-b]--orphan] &lt;new_branch&gt;] [&lt;start_point&gt;]</span><br></pre></td></tr></table></figure>
<p><commit>是可选项，如果省略则相当于从暂存区（index）进行检出</p>
<p><img data-src="image-20220703190432114.png" alt=""></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git checkout branch</span><br><span class="line">#检出branch分支。要完成图中的三个步骤，更新HEAD以指向branch分支，以及用branch  指向的树更新暂存区和工作区。</span><br><span class="line"></span><br><span class="line">$ git checkout</span><br><span class="line">#汇总显示工作区、暂存区与HEAD的差异。</span><br><span class="line"></span><br><span class="line">$ git checkout HEAD</span><br><span class="line">#同上</span><br><span class="line"></span><br><span class="line">$ git checkout -- filename</span><br><span class="line">#用暂存区中filename文件来覆盖工作区中的filename文件。相当于取消自上次执行git add filename以来（如果执行过）的本地修改。</span><br><span class="line"></span><br><span class="line">$ git checkout branch -- filename</span><br><span class="line">#维持HEAD的指向不变。用branch所指向的提交中filename替换暂存区和工作区中相   应的文件。注意会将暂存区和工作区中的filename文件直接覆盖。</span><br><span class="line"></span><br><span class="line">$ git checkout -- . 或写作 git checkout .</span><br><span class="line">#注意git checkout 命令后的参数为一个点（“.”）。这条命令最危险！会取消所有本地的  #修改（相对于暂存区）。相当于用暂存区的所有文件直接覆盖本地文件，不给用户任何确认的机会！</span><br><span class="line"></span><br><span class="line">$ git checkout commit_id -- file_name</span><br><span class="line">#如果不加commit_id，那么git checkout -- file_name 表示恢复文件到本地版本库中最新的状态。</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p><img data-src="image-20220703190456297.png" alt=""></p>
<h4 id="忽略文件">忽略文件</h4>
<p>有些时候我们不想把某些文件纳入版本控制中，比如数据库文件，临时文件，设计文件等</p>
<p>在主目录下建立&quot;.gitignore&quot;文件，此文件有如下规则：</p>
<ol>
<li>忽略文件中的空行或以井号（#）开始的行将会被忽略。</li>
<li>可以使用Linux通配符。例如：星号（*）代表任意多个字符，问号（？）代表一个字符，方括号（[abc]）代表可选字符范围，大括号（{string1,string2,…}）代表可选的字符串等。</li>
<li>如果名称的最前面有一个感叹号（!），表示例外规则，将不被忽略。</li>
<li>如果名称的最前面是一个路径分隔符（/），表示要忽略的文件在此目录下，而子目录中的文件不忽略。</li>
<li>如果名称的最后面是一个路径分隔符（/），表示要忽略的是此目录下该名称的子目录，而非文件（默认文件或目录都忽略）。</li>
</ol>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#为注释</span><br><span class="line">*.txt #忽略所有 .txt结尾的文件</span><br><span class="line">!lib.txt #但lib.txt除外</span><br><span class="line">/temp #仅忽略项目根目录下的TODO文件,不包括其它目录temp</span><br><span class="line">build/ #忽略build/目录下的所有文件</span><br><span class="line">doc/*.txt #会忽略 doc/notes.txt 但不包括 doc/server/arch.txt</span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/kevingrace/p/5690241.html">更多规则请点这里</a></p>
<p>示例：</p>
<p>创建一个.gitignore文件忽视所有的日志文件</p>
<p><img data-src="image-20220703190519456.png" alt=""></p>
<p>查看状态：</p>
<p><img data-src="image-20220703190538918.png" alt=""></p>
<p>从上图中可以看出2个日志文件并没有添加到暂存区，直接被忽视了。</p>
<p>针对各种语言与项目的Git忽视文件： <a href="https://github.com/kaedei/gitignore">https://github.com/kaedei/gitignore</a>  <a href="https://github.com/github/gitignore">https://github.com/github/gitignore</a></p>
<p>通用的vue忽视文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">node_modules</span><br><span class="line">/dist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># local env files</span><br><span class="line">.env.local</span><br><span class="line">.env.*.local</span><br><span class="line"></span><br><span class="line"># Log files</span><br><span class="line">npm-debug.log*</span><br><span class="line">yarn-debug.log*</span><br><span class="line">yarn-error.log*</span><br><span class="line">pnpm-debug.log*</span><br><span class="line"></span><br><span class="line"># Editor directories and files</span><br><span class="line">.idea</span><br><span class="line">.vscode</span><br><span class="line">*.suo</span><br><span class="line">*.ntvs*</span><br><span class="line">*.njsproj</span><br><span class="line">*.sln</span><br><span class="line">*.sw?</span><br></pre></td></tr></table></figure>
<p>通用的Visual Studio开发项目忽视文件：</p>
<h4 id="提交">提交</h4>
<p>通过add只是将文件或目录添加到了index暂存区，使用commit可以实现将暂存区的文件提交到本地仓库。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 提交暂存区到仓库区</span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"># 提交暂存区的指定文件到仓库区</span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"># 提交工作区自上次commit之后的变化，直接到仓库区，跳过了add,对新文件无效</span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"># 提交时显示所有diff信息</span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"># 使用一次新的commit，替代上一次提交</span><br><span class="line"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"># 重做上一次commit，并包括指定文件的新变化</span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p>提交前的状态</p>
<p><img data-src="image-20220703190607847.png" alt=""></p>
<p>提交：</p>
<p><img data-src="image-20220704224814203.png" alt=""></p>
<p>提交后的状态：</p>
<p><img data-src="image-20220703190629423.png" alt=""></p>
<p>从上图中可以看出暂存区中没有了bar.htm</p>
<p><strong>修订提交</strong></p>
<p>如果我们提交过后发现有个文件改错了，或者只是想修改提交说明，这时可以对相应文件做出修改，将修改过的文件通过&quot;git add&quot;添加到暂存区，然后执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#修订提交</span><br><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>
<p><strong>撤销提交（commit）</strong></p>
<p>原理就是放弃工作区和index的改动，同时HEAD指针指向前一个commit对象</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#撤销上一次的提交</span><br><span class="line">git reset --hard HEAD~1</span><br></pre></td></tr></table></figure>
<p>要通过git log查看提交日志，也可直接指定提交编号或序号</p>
<p>示例：</p>
<p><img data-src="image-20220703190657493.png" alt=""></p>
<p>撤销提交<br>
git revert <commit-id><br>
这条命令会把指定的提交的所有修改回滚，并同时生成一个新的提交。</p>
<h4 id="日志与历史">日志与历史</h4>
<p>查看提交日志可以使用git log指令，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看提交日志</span><br><span class="line">git log [&lt;options&gt;] [&lt;revision range&gt;] [[\--] &lt;path&gt;…]</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p><img data-src="image-20220703190714276.png" alt=""></p>
<p>&quot;git log --graph&quot;以图形化的方式显示提交历史的关系，这就可以方便地查看提交历史的分支信息，当然是控制台用字符画出来的图形。</p>
<p>&quot;git log -1&quot;则表示显示1行。</p>
<p>使用history可以查看您在bash下输入过的指令：</p>
<p><img data-src="image-20220703190730967.png" alt=""></p>
<p>几乎所有输入过的都被记录下来的，不愧是做版本控制的。</p>
<h4 id="查看所有分支日志"><strong>查看所有分支日志</strong></h4>
<p>&quot;git reflog&quot;中会记录这个仓库中所有的分支的所有更新记录，包括已经撤销的更新。</p>
<p><img data-src="image-20220703190749551.png" alt=""></p>
<h4 id="查看文件列表">查看文件列表</h4>
<p>使用git ls-files指令可以查看指定状态的文件列表，格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看指定状态的文件</span><br><span class="line">git ls-files [-z] [-t] [-v] (--[cached|deleted|others|ignored|stage|unmerged|killed|modified])* (-[c|d|o|i|s|u|k|m])*</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p><img data-src="image-20220703190807027.png" alt=""></p>
<h4 id="撤销更新">撤销更新</h4>
<p><strong>1）、撤销暂存区更新</strong></p>
<p>使用&quot;git add&quot;把更新提交到了暂存区。这时&quot;git status&quot;的输出中提示我们可以通过&quot;git reset HEAD <file>…&quot;把暂存区的更新移出到WorkSpace中</p>
<p>示例：f6已经提交，工作区修改，暂存区修改，撤销</p>
<p><img data-src="image-20220703190823317.png" alt=""></p>
<p><strong>2)、撤销本地仓库更新</strong></p>
<p>使用git log查看提交日志</p>
<p><img data-src="image-20220703190841466.png" alt=""></p>
<p>撤销提交有两种方式：<strong>使用HEAD指针</strong>和<strong>使用commit id</strong></p>
<p>在Git中，有一个HEAD指针指向当前分支中最新的提交。当前版本，我们使用&quot;HEAD^“，那么再钱一个版本可以使用&quot;HEAD^^”，如果想回退到更早的提交，可以使用&quot;HEAD~n&quot;。（也就是，HEAD^=HEAD~1，HEAD^^=HEAD~2）</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset --hard HEAD^</span><br><span class="line">git reset --hard HEAD~1</span><br><span class="line">git reset --hard 59cf9334cf957535cb328f22a1579b84db0911e5</span><br></pre></td></tr></table></figure>
<p>示例：回退到添加f6</p>
<p>回退前：</p>
<p><img data-src="image-20220703190855391.png" alt=""></p>
<p>回退后：</p>
<p><img data-src="image-20220703190909266.png" alt=""></p>
<p>现在又想恢复被撤销的提交可用&quot;git reflog&quot;查看仓库中所有的分支的所有更新记录，包括已经撤销的更新，撤销方法与前面一样。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset --hard HEAD@&#123;7&#125;</span><br><span class="line">git reset --hard e0e79d7</span><br></pre></td></tr></table></figure>
<p>–hard：撤销并删除相应的更新</p>
<p>–soft：撤销相应的更新，把这些更新的内容放到Stage中</p>
<h4 id="删除文件">删除文件</h4>
<p><strong>1）、删除未跟踪文件</strong></p>
<p>如果文件还是未跟踪状态，直接删除文件就可了，bash中使用rm可以删除文件，示例如下：</p>
<p><img data-src="image-20220703190927188.png" alt=""></p>
<p><strong>2）、删除已提交文件</strong></p>
<p><img data-src="image-20220703190953450.png" alt=""></p>
<p>-f 强制删除，物理删除了，同时删除工作区和暂存区中的文件</p>
<p><strong>撤销删除：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#to discard changes in working directory</span><br><span class="line">git checkout -- &lt;file&gt;...</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220703191011745.png" alt=""></p>
<p><strong>3）、删除暂存区的文件，不删除工作区的文件</strong></p>
<p><img data-src="image-20220703191030385.png" alt=""></p>
<p>使用git reset HEAD <file>…同样可以实现上面的功能</p>
<h4 id="文件操作小结">文件操作小结</h4>
<p><img data-src="image-20220703191105865.png" alt=""></p>
<p>Git很强大，很灵活，这是毋庸置疑的。但也正因为它的强大造成了它的复杂，因此会有很多奇奇怪怪的问题出现，多用就好了。</p>
<h4 id="Git-分支">Git 分支</h4>
<p>分支在GIT中相对较难</p>
<p>分支就是科幻电影里面的平行宇宙，当你正在电脑前努力学习Git的时候，另一个你正在另一个平行宇宙里努力学习SVN。</p>
<p>如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，在某个时间点，两个平行宇宙合并了，结果，你既学会了Git又学会了SVN！</p>
<p>分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p>
<p>现在有了分支，就不用怕了。你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。</p>
<p>Git分支的速度非常快。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。HEAD严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支。</p>
<p><img data-src="image-20220704230737520.png" alt=""></p>
<p><img data-src="image-20220704230832835.png" alt=""></p>
<p><img data-src="image-20220704231014098.png" alt=""></p>
<h5 id="git分支中常用指令：">git分支中常用指令：</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 列出所有本地分支</span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"># 列出所有远程分支</span><br><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line"># 列出所有本地分支和远程分支</span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"># 新建一个分支，但依然停留在当前分支</span><br><span class="line">git branch [branch-name]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，并切换到该分支</span><br><span class="line">git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，指向指定commit</span><br><span class="line">git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，与指定的远程分支建立追踪关系</span><br><span class="line">git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># 切换到指定分支，并更新工作区</span><br><span class="line">git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"># 切换到上一个分支</span><br><span class="line">git checkout -</span><br><span class="line"></span><br><span class="line"># 建立追踪关系，在现有分支与指定的远程分支之间</span><br><span class="line">git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># 合并指定分支到当前分支</span><br><span class="line">git merge [branch]</span><br><span class="line"></span><br><span class="line"># 选择一个commit，合并进当前分支</span><br><span class="line">git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"># 删除分支</span><br><span class="line">git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"># 删除远程分支</span><br><span class="line">git push origin --delete [branch-name]</span><br><span class="line">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>
<h5 id="新建分支与切换分支">新建分支与切换分支</h5>
<p>默认分支是这样的，master是主分支</p>
<p>1）、新建一个分支，但依然停留在当前分支，使用：<code>git branch [branch-name]</code></p>
<p><img data-src="image-20220704231148806.png" alt=""></p>
<p><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001375840038939c291467cc7c747b1810aab2fb8863508000">关于分支廖雪峰解释的比较清楚，我们引用一下</a>。</p>
<p>当我们创建新的分支，例如<code>dev</code>时，Git新建了一个指针叫<code>dev</code>，指向<code>master</code>相同的提交，再把<code>HEAD</code>指向<code>dev</code>，就表示当前分支在<code>dev</code>上：</p>
<p>你看，Git创建一个分支很快，因为除了增加一个<code>dev</code>指针，改改<code>HEAD</code>的指向，工作区的文件都没有任何变化！</p>
<p>不过，从现在开始，对工作区的修改和提交就是针对<code>dev</code>分支了，比如新提交一次后，<code>dev</code>指针往前移动一步，而<code>master</code>指针不变：</p>
<p>假如我们在<code>dev</code>上的工作完成了，就可以把<code>dev</code>合并到<code>master</code>上。Git怎么合并呢？最简单的方法，就是直接把<code>master</code>指向<code>dev</code>的当前提交，就完成了合并：</p>
<p>所以Git合并分支也很快！就改改指针，工作区内容也不变！</p>
<p>合并完分支后，甚至可以删除<code>dev</code>分支。删除<code>dev</code>分支就是把<code>dev</code>指针给删掉，删掉后，我们就剩下了一条<code>master</code>分支：</p>
<p>2）、切换分支，git branch <name>，如果name为-则为上一个分支</p>
<p><img data-src="image-20220704231405494.png" alt=""></p>
<p>切换为上一个分支</p>
<p><img data-src="image-20220704231428091.png" alt=""></p>
<p>3）、新建一个分支，并切换到该分支，git checkout -b [branch]</p>
<p><img data-src="image-20220704231456564.png" alt=""></p>
<p>4）、新建一个分支，指向指定commit使用命令：git branch [branch] [commit]</p>
<p><img data-src="image-20220704231600490.png" alt=""></p>
<p>上面创建了dev3分支且指向了master中首次提交的位置，切换到dev3查看日志如下：</p>
<p><img data-src="image-20220704231622634.png" alt=""></p>
<p>master上本来有两个提交记录的，此时的dev3指向的是第1次提交的位置</p>
<p>5）、新建一个分支，与指定的远程分支建立追踪关系使用命令：git branch --track [branch] [remote-branch]</p>
<p><img data-src="image-20220704231710945.png" alt=""></p>
<h5 id="查看分支">查看分支</h5>
<p>1）、列出所有本地分支使用 git branch</p>
<p><img data-src="image-20220704231749716.png" alt=""></p>
<p>2）、列表所有远程分支使用 git branch -r</p>
<p><img data-src="image-20220704231813801.png" alt=""></p>
<p>3)、列出所有本地分支和远程分支使用 git branch -a</p>
<p><img data-src="image-20220704231835966.png" alt=""></p>
<h5 id="分支合并">分支合并</h5>
<p>合并指定分支到当前分支使用指令$ git merge [branch]</p>
<p>这里的合并分支就是对分支的指针操作，我们先创建一个分支再合并到主分支：</p>
<p><img data-src="image-20220704231909763.png" alt=""></p>
<p>这里的file11.txt主分支与dev6的内容现在是不同的，因为在dev6中已被修改过，我们可以使用指令查看：</p>
<p><img data-src="image-20220704231930467.png" alt=""></p>
<p>现在我们将dev6合并到主分支中去，从下图中可以看出dev6中有一次提交，而master并没有</p>
<p><img data-src="image-20220704231951329.png" alt=""></p>
<p>合并后在master上查看file11.txt文件内容与dev6上的内容就一样了，合并后dev6中多出的提交在master也拥有了。</p>
<h5 id="解决冲突">解决冲突</h5>
<p>如果同一个文件在合并分支时都被修改了则会引起冲突，如下所示：</p>
<p>提交前两个分支的状态</p>
<p><img data-src="image-20220704232033395.png" alt=""></p>
<p>在dev6分支中同样修改file11.txt</p>
<p><img data-src="image-20220704232057910.png" alt=""></p>
<p>dev6与master分支中file11.txt文件都被修改且提交了，现在合并分支</p>
<p><img data-src="image-20220704232121148.png" alt=""></p>
<p>提示冲突，现在我们看看file11.txt在master分支中的状态</p>
<p><img data-src="image-20220704232140808.png" alt=""></p>
<p>Git用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同分支的内容，其中&lt;&lt;&lt;HEAD是指主分支修改的内容，&gt;&gt;&gt;&gt;&gt;dev6 是指dev6上修改的内容</p>
<p>解决的办法是我们可以修改冲突文件后重新提交，请注意当前的状态产master | MERGING：</p>
<p><img data-src="image-20220704232204241.png" alt=""></p>
<p>重新提交后冲突解决：</p>
<p><img data-src="image-20220704232233157.png" alt=""></p>
<p>手动解决完冲突后就可以把此文件添 加到索引(index)中去，用git commit命令来提交，就像平时修改了一个文件 一样。</p>
<p>用<em>git log --graph</em>命令可以看到分支合并图。</p>
<p><img data-src="image-20220704232253368.png" alt=""></p>
<p><strong>分支策略</strong></p>
<p>master主分支应该非常稳定，用来发布新版本，一般情况下不允许在上面工作，工作一般情况下在新建的dev分支上工作，工作完后，比如上要发布，或者说dev分支代码稳定后可以合并到主分支master上来。</p>
<h5 id="删除分支">删除分支</h5>
<p>删除本地分支可以使用命令：$ git branch -d [branch-name]，-D（大写）强制删除</p>
<p><img data-src="image-20220704232334499.png" alt=""></p>
<p>删除远程分支可以使用如下指令：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git push origin --delete [branch-name]</span><br><span class="line"> </span><br><span class="line">git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>
<p>-d表示删除分支。分支必须完全合并在其上游分支，或者在HEAD上没有设置上游</p>
<p>-r表示远程的意思remotes，如果-dr则表示删除远程分支</p>
<p><img data-src="image-20220704232407229.png" alt=""></p>
<h4 id="远程仓库操作">远程仓库操作</h4>
<p>申请到了Git远程仓库的帐号并创建了一个空的远程仓库现在我们就可以结合本地的仓库与远程仓库一起协同工作了，模拟多人协同开发，这里我们全部使用命令完成。</p>
<h5 id="常用操作指令">常用操作指令</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 下载远程仓库的所有变动</span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"># 显示所有远程仓库</span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"># 显示某个远程仓库的信息</span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"># 增加一个新的远程仓库，并命名</span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"># 取回远程仓库的变化，并与本地分支合并</span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"># 上传本地指定分支到远程仓库</span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"># 强行推送当前分支到远程仓库，即使有冲突</span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"># 推送所有分支到远程仓库</span><br><span class="line">$ git push [remote] --all</span><br><span class="line"></span><br><span class="line">#简单查看远程---所有仓库</span><br><span class="line">git remote  （只能查看远程仓库的名字）</span><br><span class="line">#查看单个仓库</span><br><span class="line">git  remote show [remote-branch-name]</span><br><span class="line"></span><br><span class="line">#新建远程仓库</span><br><span class="line">git remote add [branchname]  [url]</span><br><span class="line"></span><br><span class="line">#修改远程仓库</span><br><span class="line">git remote rename [oldname] [newname]</span><br><span class="line"></span><br><span class="line">#删除远程仓库</span><br><span class="line">git remote rm [remote-name]</span><br><span class="line"></span><br><span class="line">#获取远程仓库数据</span><br><span class="line">git fetch [remote-name] (获取仓库所有更新，但不自动合并当前分支)</span><br><span class="line">git pull (获取仓库所有更新，并自动合并到当前分支)</span><br><span class="line"></span><br><span class="line">#上传数据，如git push origin master</span><br><span class="line">git push [remote-name] [branch]</span><br></pre></td></tr></table></figure>
<h5 id="git-clone-克隆">git clone 克隆</h5>
<p>远程操作的第一步，通常是从远程主机克隆一个版本库，这时就要用到<code>git clone</code>命令。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone &lt;版本库的网址&gt;</span><br></pre></td></tr></table></figure>
<p>比如，克隆一个上课示例的版本库。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone https://github.com/zhangguo5/AngularJS04_BookStore.git</span><br></pre></td></tr></table></figure>
<p>该命令会在本地主机生成一个目录，与远程主机的版本库同名。如果要指定不同的目录名，可以将目录名作为<code>git clone</code>命令的第二个参数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone &lt;版本库的网址&gt; &lt;本地目录名&gt;</span><br></pre></td></tr></table></figure>
<p><code>git clone</code>支持多种协议，除了HTTP(s)以外，还支持SSH、Git、本地文件协议等，下面是一些例子。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone http[s]://example.com/path/to/repo.git/</span><br><span class="line">$ git clone ssh://example.com/path/to/repo.git/</span><br><span class="line">$ git clone git://example.com/path/to/repo.git/</span><br><span class="line">$ git clone /opt/git/project.git </span><br><span class="line">$ git clone file:///opt/git/project.git</span><br><span class="line">$ git clone ftp[s]://example.com/path/to/repo.git/</span><br><span class="line">$ git clone rsync://example.com/path/to/repo.git/</span><br></pre></td></tr></table></figure>
<p>SSH协议还有另一种写法。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone [user@]example.com:path/to/repo.git/</span><br></pre></td></tr></table></figure>
<p>通常来说，Git协议下载速度最快，SSH协议用于需要用户认证的场合。各种协议优劣的详细讨论请参考 <a href="http://git-scm.com/book/en/Git-on-the-Server-The-Protocols">官方文档</a>。</p>
<p>示例：</p>
<p><img data-src="image-20220705232746680.png" alt=""></p>
<p>结果：</p>
<p><img data-src="image-20220705232812568.png" alt=""></p>
<h5 id="git-remote">git remote</h5>
<p>为了便于管理，Git要求每个远程主机都必须指定一个主机名。<code>git remote</code>命令就用于管理主机名。</p>
<p>不带选项的时候，<code>git remote</code>命令列出所有远程主机。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705232840239.png" alt=""></p>
<p>使用<code>-v</code>选项，可以参看远程主机的网址。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote -v</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705232904884.png" alt=""></p>
<p>上面命令表示，当前只有一台远程主机，叫做origin，以及它的网址。</p>
<p>克隆版本库的时候，所使用的远程主机自动被Git命名为<code>origin</code>。如果想用其他的主机名，需要用<code>git clone</code>命令的<code>-o</code>选项指定。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git clone -o WeUI https://github.com/Tencent/weui.git</span><br><span class="line">$ git remote</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705232932388.png" alt=""></p>
<p>上面命令表示，克隆的时候，指定远程主机叫做WeUI。</p>
<p><code>git remote show</code>命令加上主机名，可以查看该主机的详细信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote show &lt;主机名&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705232952128.png" alt=""></p>
<p><code>git remote add</code>命令用于添加远程主机。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote add &lt;主机名&gt; &lt;网址&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233013150.png" alt=""></p>
<p><code>git remote rm</code>命令用于删除远程主机。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote rm &lt;主机名&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233033353.png" alt=""></p>
<p><code>git remote rename</code>命令用于远程主机的改名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git remote rename &lt;原主机名&gt; &lt;新主机名&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233057193.png" alt=""></p>
<h5 id="git-fetch">git fetch</h5>
<p>一旦远程主机的版本库有了更新（Git术语叫做commit），需要将这些更新取回本地，这时就要用到<code>git fetch</code>命令。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git fetch &lt;远程主机名&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233125837.png" alt=""></p>
<p>上面命令将某个远程主机的更新，全部取回本地。</p>
<p><code>git fetch</code>命令通常用来查看其他人的进程，因为它取回的代码对你本地的开发代码没有影响。</p>
<p>默认情况下，<code>git fetch</code>取回所有分支（branch）的更新。如果只想取回特定分支的更新，可以指定分支名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git fetch &lt;远程主机名&gt; &lt;分支名&gt;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233145121.png" alt=""></p>
<p>比如，取回<code>origin</code>主机的<code>master</code>分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git fetch origin master</span><br></pre></td></tr></table></figure>
<p>所取回的更新，在本地主机上要用&quot;远程主机名/分支名&quot;的形式读取。比如<code>origin</code>主机的<code>master</code>，就要用<code>origin/master</code>读取。</p>
<p><code>git branch</code>命令的<code>-r</code>选项，可以用来查看远程分支，<code>-a</code>选项查看所有分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git branch -r</span><br><span class="line">origin/master</span><br><span class="line"></span><br><span class="line">$ git branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/master</span><br></pre></td></tr></table></figure>
<p>上面命令表示，本地主机的当前分支是<code>master</code>，远程分支是<code>origin/master</code>。</p>
<p>取回远程主机的更新以后，可以在它的基础上，使用<code>git checkout</code>命令创建一个新的分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git checkout -b newBrach origin/master</span><br></pre></td></tr></table></figure>
<p>上面命令表示，在<code>origin/master</code>的基础上，创建一个新分支。</p>
<p>此外，也可以使用<code>git merge</code>命令或者<code>git rebase</code>命令，在本地分支上合并远程分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line"># 或者</span><br><span class="line">$ git rebase origin/master</span><br></pre></td></tr></table></figure>
<p>上面命令表示在当前分支上，合并<code>origin/master</code>。</p>
<h5 id="git-pull">git pull</h5>
<p><code>git pull</code>命令的作用是，取回远程主机某个分支的更新，再与本地的指定分支合并。它的完整格式稍稍有点复杂。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</span><br></pre></td></tr></table></figure>
<p>比如，取回<code>origin</code>主机的<code>next</code>分支，与本地的<code>master</code>分支合并，需要写成下面这样。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull origin next:master</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233239482.png" alt=""></p>
<p>如果远程分支是与当前分支合并，则冒号后面的部分可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull origin next</span><br></pre></td></tr></table></figure>
<p>上面命令表示，取回<code>origin/next</code>分支，再与当前分支合并。实质上，这等同于先做<code>git fetch</code>，再做<code>git merge</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">$ git merge origin/next</span><br></pre></td></tr></table></figure>
<p>在某些场合，Git会自动在本地分支与远程分支之间，建立一种追踪关系（tracking）。比如，在<code>git clone</code>的时候，所有本地分支默认与远程主机的同名分支，建立追踪关系，也就是说，本地的<code>master</code>分支自动&quot;追踪&quot;<code>origin/master</code>分支。</p>
<p>Git也允许手动建立追踪关系。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git branch --set-upstream master origin/next</span><br></pre></td></tr></table></figure>
<p>上面命令指定<code>master</code>分支追踪<code>origin/next</code>分支。</p>
<p>如果当前分支与远程分支存在追踪关系，<code>git pull</code>就可以省略远程分支名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull origin</span><br></pre></td></tr></table></figure>
<p>上面命令表示，本地的当前分支自动与对应的<code>origin</code>主机&quot;追踪分支&quot;（remote-tracking branch）进行合并。</p>
<p>如果当前分支只有一个追踪分支，连远程主机名都可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull</span><br></pre></td></tr></table></figure>
<p>上面命令表示，当前分支自动与唯一一个追踪分支进行合并。</p>
<p>如果合并需要采用rebase模式，可以使用<code>--rebase</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull --rebase &lt;远程主机名&gt; &lt;远程分支名&gt;:&lt;本地分支名&gt;</span><br></pre></td></tr></table></figure>
<p>如果远程主机删除了某个分支，默认情况下，<code>git pull</code> 不会在拉取远程分支的时候，删除对应的本地分支。这是为了防止，由于其他人操作了远程主机，导致<code>git pull</code>不知不觉删除了本地分支。</p>
<p>但是，你可以改变这个行为，加上参数 <code>-p</code> 就会在本地删除远程已经删除的分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git pull -p</span><br><span class="line"># 等同于下面的命令</span><br><span class="line">$ git fetch --prune origin </span><br><span class="line">$ git fetch -p</span><br></pre></td></tr></table></figure>
<h5 id="git-push">git push</h5>
<p><code>git push</code>命令用于将本地分支的更新，推送到远程主机。它的格式与<code>git pull</code>命令相仿。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push &lt;远程主机名&gt; &lt;本地分支名&gt;:&lt;远程分支名&gt;</span><br></pre></td></tr></table></figure>
<p>注意，分支推送顺序的写法是&lt;来源地&gt;:&lt;目的地&gt;，所以<code>git pull</code>是&lt;远程分支&gt;:&lt;本地分支&gt;，而<code>git push</code>是&lt;本地分支&gt;:&lt;远程分支&gt;。</p>
<p>如果省略远程分支名，则表示将本地分支推送与之存在&quot;追踪关系&quot;的远程分支（通常两者同名），如果该远程分支不存在，则会被新建。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233311762.png" alt=""></p>
<p>上面命令表示，将本地的<code>master</code>分支推送到<code>origin</code>主机的<code>master</code>分支。如果后者不存在，则会被新建。</p>
<p>如果省略本地分支名，则表示删除指定的远程分支，因为这等同于推送一个空的本地分支到远程分支。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push origin :master</span><br><span class="line"># 等同于</span><br><span class="line">$ git push origin --delete master</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20220705233330460.png" alt=""></p>
<p>上面命令表示删除<code>origin</code>主机的<code>master</code>分支。</p>
<p>如果当前分支与远程分支之间存在追踪关系，则本地分支和远程分支都可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push origin</span><br></pre></td></tr></table></figure>
<p>上面命令表示，将当前分支推送到<code>origin</code>主机的对应分支。</p>
<p><img data-src="image-20220705233351022.png" alt=""></p>
<p>如果是新建分支第一次push，会提示：<br>
　　fatal: The current branch dev1 has no upstream branch.<br>
　　To push the current branch and set the remote as upstream, use<br>
　　git push --set-upstream origin dev1<br>
　　输入这行命令，然后输入用户名和密码，就push成功了。</p>
<p>以后的push就只需要输入git push origin</p>
<p>原因是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#因为在git的全局配置中，有一个push.default属性，其决定了git push操作的默认行为。在Git 2.0之前，这个属性的默认被设为&#x27;matching&#x27;，2.0之后则被更改为了&#x27;simple&#x27;。</span><br><span class="line"></span><br><span class="line">#我们可以通过git version确定当前的git版本（如果小于2.0，更新是个更好的选择），通过git config --global push.default &#x27;option&#x27;改变push.default的默认行为（或者也可直接编辑~/.gitconfig文件）。</span><br><span class="line"></span><br><span class="line">push.default 有以下几个可选值：</span><br><span class="line">nothing, current, upstream, simple, matching</span><br><span class="line"></span><br><span class="line">其用途分别为：</span><br><span class="line">nothing - push操作无效，除非显式指定远程分支，例如git push origin develop（我觉得。。。可以给那些不愿学git的同事配上此项）。</span><br><span class="line">current - push当前分支到远程同名分支，如果远程同名分支不存在则自动创建同名分支。</span><br><span class="line">upstream - push当前分支到它的upstream分支上（这一项其实用于经常从本地分支push/pull到同一远程仓库的情景，这种模式叫做central workflow）。</span><br><span class="line">simple - simple和upstream是相似的，只有一点不同，simple必须保证本地分支和它的远程</span><br><span class="line">upstream分支同名，否则会拒绝push操作。</span><br><span class="line">matching - push所有本地和远程两端都存在的同名分支。</span><br><span class="line"></span><br><span class="line">因此如果我们使用了git2.0之前的版本，push.default = matching，git push后则会推送当前分支代码到远程分支，而2.0之后，push.default = simple，如果没有指定当前分支的upstream分支，就会收到上文的fatal提示。</span><br></pre></td></tr></table></figure>
<p>如果当前分支只有一个追踪分支，那么主机名都可以省略。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push</span><br></pre></td></tr></table></figure>
<p>如果当前分支与多个主机存在追踪关系，则可以使用<code>-u</code>选项指定一个默认主机，这样后面就可以不加任何参数使用<code>git push</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push -u origin master</span><br></pre></td></tr></table></figure>
<p>上面命令将本地的<code>master</code>分支推送到<code>origin</code>主机，同时指定<code>origin</code>为默认主机，后面就可以不加任何参数使用<code>git push</code>了。</p>
<p>不带任何参数的<code>git push</code>，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用<code>git config</code>命令。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git config --global push.default matching</span><br><span class="line"># 或者</span><br><span class="line">$ git config --global push.default simple</span><br></pre></td></tr></table></figure>
<p>还有一种情况，就是不管是否存在对应的远程分支，将本地的所有分支都推送到远程主机，这时需要使用<code>--all</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push --all origin</span><br></pre></td></tr></table></figure>
<p>上面命令表示，将所有本地分支都推送到<code>origin</code>主机。</p>
<p>如果远程主机的版本比本地版本更新，推送时Git会报错，要求先在本地做<code>git pull</code>合并差异，然后再推送到远程主机。这时，如果你一定要推送，可以使用<code>--force</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push --force origin </span><br></pre></td></tr></table></figure>
<p>上面命令使用<code>--force</code>选项，结果导致远程主机上更新的版本被覆盖。除非你很确定要这样做，否则应该尽量避免使用<code>--force</code>选项。</p>
<p>最后，<code>git push</code>不会推送标签（tag），除非使用<code>--tags</code>选项。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ git push origin --tags</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>es6~es11 学习</title>
    <url>/blog/2023/08/09/es6/</url>
    <content><![CDATA[<h3 id="ECMAScript-和-JavaScript-的关系">ECMAScript 和 JavaScript 的关系</h3>
<p>1996 年 11 月，JavaScript 的创造者 Netscape 公司，决定将 JavaScript 提交给标准化组织 ECMA，希望这种语言能够成为国际标准。次年，ECMA 发布 262 号标准文件（ECMA-262）的第一版，规定了浏览器脚本语言的标准，并将这种语言称为 ECMAScript，这个版本就是 1.0 版。</p>
<p>该标准从一开始就是针对 JavaScript 语言制定的，但是之所以不叫 JavaScript，有两个原因。一是商标，Java 是 Sun 公司的商标，根据授权协议，只有 Netscape 公司可以合法地使用 JavaScript 这个名字，且 JavaScript 本身也已经被 Netscape 公司注册为商标。二是想体现这门语言的制定者是 ECMA，不是 Netscape，这样有利于保证这门语言的开放性和中立性。</p>
<p>因此，ECMAScript 和 JavaScript 的关系是，前者是后者的规格，后者是前者的一种实现（另外的 ECMAScript 方言还有 JScript 和 ActionScript）。日常场合，这两个词是可以互换的。</p>
<span id="more"></span>
<h3 id="ES6-与-ECMAScript-2015-的关系">ES6 与 ECMAScript 2015 的关系</h3>
<p>ECMAScript 2015（简称 ES2015）这个词，也是经常可以看到的。它与 ES6 是什么关系呢？</p>
<p>2011 年，ECMAScript 5.1 版发布后，就开始制定 6.0 版了。因此，ES6 这个词的原意，就是指 JavaScript 语言的下一个版本。</p>
<p>但是，因为这个版本引入的语法功能太多，而且制定过程当中，还有很多组织和个人不断提交新功能。事情很快就变得清楚了，不可能在一个版本里面包括所有将要引入的功能。常规的做法是先发布 6.0 版，过一段时间再发 6.1 版，然后是 6.2 版、6.3 版等等。</p>
<p>但是，标准的制定者不想这样做。他们想让标准的升级成为常规流程：任何人在任何时候，都可以向标准委员会提交新语法的提案，然后标准委员会每个月开一次会，评估这些提案是否可以接受，需要哪些改进。如果经过多次会议以后，一个提案足够成熟了，就可以正式进入标准了。这就是说，标准的版本升级成为了一个不断滚动的流程，每个月都会有变动。</p>
<p>标准委员会最终决定，标准在每年的 6 月份正式发布一次，作为当年的正式版本。接下来的时间，就在这个版本的基础上做改动，直到下一年的 6 月份，草案就自然变成了新一年的版本。这样一来，就不需要以前的版本号了，只要用年份标记就可以了。</p>
<p>ES6 的第一个版本，就这样在 2015 年 6 月发布了，正式名称就是《ECMAScript 2015 标准》（简称 ES2015）。2016 年 6 月，小幅修订的《ECMAScript 2016 标准》（简称 ES2016）如期发布，这个版本可以看作是 ES6.1 版，因为两者的差异非常小（只新增了数组实例的<code>includes</code>方法和指数运算符），基本上是同一个标准。根据计划，2017 年 6 月发布 ES2017 标准。</p>
<p>因此，ES6 既是一个历史名词，也是一个泛指，含义是 5.1 版以后的 JavaScript 的下一代标准，涵盖了 ES2015、ES2016、ES2017 等等，而 ES2015 则是正式名称，特指该年发布的正式版本的语言标准。本书中提到 ES6 的地方，一般是指 ES2015 标准，但有时也是泛指“下一代 JavaScript 语言”。</p>
<p><img data-src="https://img0.baidu.com/it/u=196054532,118543837&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=788&amp;h=443" alt=""></p>
<blockquote>
<p>值得一提的是：</p>
<ul>
<li>ES2015较前面的版本有较大的更新，但总体上还是向后兼容的</li>
<li>当时，微软开发的类似的脚本语言基本完成，所以两者基本处于并行发展的，所以，如今出现了微软系列的浏览器兼容性较差的局面，因为起初并不是依据ECMAScript标准进行开发的</li>
</ul>
</blockquote>
<h3 id="环境安装">环境安装</h3>
<p>为了大家可以把更多的精力放在ES新语法的学习上，而不是纠结于环境配置，已经为大家准备好了开发环境，利用脚手架只需要一步就可以完成安装，但是需要依赖 Node 环境，请大家首先安装 Node。具体环境构建请参照文章底部 ~</p>
<h4 id="Node-安装">Node 安装</h4>
<blockquote>
<p>安装包下载地址：<a href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a></p>
<p>下载长期支持版本（LTS）</p>
</blockquote>
<p>安装完成，在终端输入：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<p>出现版本信息表示安装成功</p>
<h4 id="NRM">NRM</h4>
<p>NRM(Npm Registry Manager )是npm的镜像源管理工具，有时候国外资源太慢，可以使用就可以快速地在 npm 源间切换。</p>
<blockquote>
<p>NRM 不是必装工具，如果网络环境比较好可以不安装。</p>
</blockquote>
<h5 id="安装-2">安装</h5>
<p>在命令行执行命令，全局安装nrm</p>
<p>Windows电脑安装命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g nrm</span><br></pre></td></tr></table></figure>
<p>Mac电脑安装命令：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo npm install -g nrm</span><br></pre></td></tr></table></figure>
<h5 id="使用">使用</h5>
<p>执行命令查看可选的源：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nrm <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<p><img data-src="image-20230410144630143.png" alt=""></p>
<p>其中，带*的是当前使用的源，上面的输出表明当前源是官方源。</p>
<h5 id="切换源">切换源</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure>
<h5 id="测速源">测速源</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nrm test npm</span><br></pre></td></tr></table></figure>
<h5 id="增加源">增加源</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nrm add laoxu http://192.168.1.100:6666</span><br></pre></td></tr></table></figure>
<h5 id="删除源">删除源</h5>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nrm del laoxu</span><br></pre></td></tr></table></figure>
<h5 id="环境初始化">环境初始化</h5>
<p>需要借助webpack搭建脚手架，文章底部再更新 ~</p>
<h4 id="几个小case">几个小case</h4>
<p>我们通过几个案例，来对比ES6+语法新特性的魅力所在。</p>
<h5 id="案例1：可选链">案例1：可选链</h5>
<p>读取一个被连接对象的深层次的属性的值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">street</span>: <span class="string">&#x27;xx街道&#x27;</span>,</span><br><span class="line">        <span class="title function_">getNum</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;80号&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES5语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> street = user &amp;&amp; user.<span class="property">address</span> &amp;&amp; user.<span class="property">address</span>.<span class="property">street</span></span><br><span class="line"><span class="keyword">const</span> num = user &amp;&amp; user.<span class="property">address</span> &amp;&amp; user.<span class="property">address</span>.<span class="property">getNum</span> &amp;&amp; user.<span class="property">address</span>.<span class="title function_">getNum</span>()</span><br></pre></td></tr></table></figure>
<p>ES6+语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> street = user?.<span class="property">address</span>?.<span class="property">street</span></span><br><span class="line"><span class="keyword">const</span> num = user?.<span class="property">address</span>?.<span class="property">getNum</span>?.()</span><br></pre></td></tr></table></figure>
<h5 id="案例2：消除魔术字符串">案例2：消除魔术字符串</h5>
<p>魔术字符串指的是在代码之中多次出现、与代码形成强耦合的某一个具体的字符串或者数值。风格良好的代码，应该尽量消除魔术字符串，改由含义清晰的变量代替。</p>
<p>ES5语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">shape</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> area = <span class="number">0</span></span><br><span class="line">    <span class="keyword">switch</span> (shape) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;Triangle&#x27;</span>:</span><br><span class="line">            area = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;Circle&#x27;</span>:</span><br><span class="line">            area = <span class="number">2</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> area</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getArea</span>(<span class="string">&#x27;Triangle&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ES6+语法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> shapeType = &#123;</span><br><span class="line">    <span class="attr">triangle</span>: <span class="title class_">Symbol</span>(),</span><br><span class="line">    <span class="attr">circle</span>: <span class="title class_">Symbol</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">shape</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> area = <span class="number">0</span></span><br><span class="line">    <span class="keyword">switch</span> (shape) &#123;</span><br><span class="line">        <span class="keyword">case</span> shapeType.<span class="property">triangle</span>:</span><br><span class="line">            area = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> shapeType.<span class="property">circle</span>:</span><br><span class="line">            area = <span class="number">2</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> area</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getArea</span>(shapeType.<span class="property">triangle</span>)</span><br></pre></td></tr></table></figure>
<h5 id="案例3：将类数组转化为数组">案例3：将类数组转化为数组</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arrayLike = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.item&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ES5语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(arrayLike)</span><br></pre></td></tr></table></figure>
<p>ES6+语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(arrayLike)</span><br></pre></td></tr></table></figure>
<h5 id="案例4：优雅的异步操作与解构赋值">案例4：优雅的异步操作与解构赋值</h5>
<p>ES5语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getData</span> (url) &#123;</span><br><span class="line">    <span class="title function_">ajax</span>(url, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> data = res.<span class="property">data</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">list</span> = data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES6+语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getData</span> (url) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(url)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ES6词法汇总">ES6词法汇总</h3>
<p><img data-src="ES6.png" alt=""></p>
<h3 id="ES7-ES11汇总">ES7-ES11汇总</h3>
<p><img data-src="es7-es11.png" alt=""></p>
<h3 id="ES6（ES2015）">ES6（ES2015）</h3>
<h4 id="新的声明方式">新的声明方式</h4>
<h5 id="作用域-2">作用域</h5>
<h6 id="什么是作用域？">什么是作用域？</h6>
<p>几乎所有编程语言就是在变量中存储值，并且能读取和修改此值。事实上，在变量中存储值和取出值的能力，给程序赋予了状态。 如果没有这样的概念，一个程序虽然可以执行一些任务，但是它们将会受到极大的限制而且不会非常有趣。 但是这些变量该存储在哪，又给如何读取？为了完成这个目标，需要制定一些规则，这个规则就是：作用域。</p>
<p>常见的作用域主要分为几个类型：全局作用域、函数作用域、块状作用域、动态作用域。</p>
<table>
<thead>
<tr>
<th style="text-align:center">对象</th>
<th style="text-align:center">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">global/window</td>
<td style="text-align:center">全局作用域</td>
</tr>
<tr>
<td style="text-align:center">function</td>
<td style="text-align:center">函数作用域（局部作用域）</td>
</tr>
<tr>
<td style="text-align:center">{}</td>
<td style="text-align:center">块状作用域</td>
</tr>
<tr>
<td style="text-align:center">this</td>
<td style="text-align:center">动态作用域</td>
</tr>
</tbody>
</table>
<blockquote>
<p>如果一个 变量 或者其他表达式不在 “当前的作用域”，那么JavaScript机制会继续沿着作用域链上查找直到全局作用域（global或浏览器中的window）如果找不到将不可被使用。 作用域也可以根据代码层次分层，以便子作用域可以访问父作用域，通常是指沿着链式的作用域链查找，而不能从父作用域引用子作用域中的变量和引用</p>
</blockquote>
<h6 id="全局作用域">全局作用域</h6>
<p>变量在函数或者代码块 <code>&#123;&#125;</code> 外定义，即为全局作用域。不过，在函数或者代码块 <code>&#123;&#125;</code> 内未定义的变量也是拥有全局作用域的（不推荐）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> course = <span class="string">&quot;es&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处可调用 course 变量</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 函数内可调用 course 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码中变量 <code>course</code> 就是在函数外定义的，它是拥有全局作用域的。这个变量可以在任意地方被读取或者修改，当然如果变量在函数内没有声明（没有使用 var 关键字），该变量依然为全局变量。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 此处可调用 course 变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    course = <span class="string">&quot;es&quot;</span></span><br><span class="line">    <span class="comment">// 此处可调用 course 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上实例中 course 在函数内，但是拥有全局作用域，它将作为 global 或者 window 的属性存在。</p>
<blockquote>
<p>注意：在函数内部或代码块中没有定义的变量实际上是作为 window/global 的属性存在，而不是全局变量。换句话说没有使用 var 定义的变量虽然拥有全局作用域，但是它是可以被 delete 的，而全局变量不可以。<br>
参考：<a href="https://www.runoob.com/js/js-scope.html">https://www.runoob.com/js/js-scope.html</a></p>
</blockquote>
<h6 id="函数作用域">函数作用域</h6>
<p>在函数内部定义的变量，就是局部作用域。函数作用域内，对外是封闭的，从外层的作用域无法直接访问函数内部的作用域！</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> testValue = <span class="string">&#x27;inner&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(testValue) <span class="comment">// 报错：ReferenceError: testValue is not defined</span></span><br></pre></td></tr></table></figure>
<p>如果想读取函数内的变量，必须借助 return 或者闭包。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> testValue = <span class="string">&#x27;inner&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> testValue + value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bar</span>(<span class="string">&#x27;fun&#x27;</span>)) <span class="comment">// &quot;innerfun&quot;</span></span><br></pre></td></tr></table></figure>
<p>这是借助 return 的方式，下面是闭包的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> testValue = <span class="string">&#x27;inner&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rusult = testValue + value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">innser</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> rusult</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">innser</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bar</span>(<span class="string">&#x27;fun&#x27;</span>)) <span class="comment">// &quot;innerfun&quot;</span></span><br></pre></td></tr></table></figure>
<p>通俗的讲，return 是函数对外交流的出口，而 return 可以返回的是函数，根据作用域的规则，函数内部的子函数是可以获取函数作用域内的变量的。</p>
<p>说到这其实大家会想到嵌套函数的作用域问题，如果 inner 函数再嵌套函数呢？这就涉及到另一个概念：作用域链。</p>
<p><img data-src="image-20230410153942044.png" alt=""></p>
<p>仔细观察上图，其实不难理解作用域链是什么，因为你可以按照原型链那样去理解。任何一个作用域链都是一个堆栈，首先先把全局作用域压入栈底，再按照函数的嵌套关系一次压入堆栈。在执行的时候就按照这个作用域链寻找变量。</p>
<h6 id="块状作用域">块状作用域</h6>
<p>在其他编程语言中，块状作用域是很熟悉的概念，但是在JavaScript中不被支持，就像上述知识一样，除了全局作用域就是函数作用域，一直没有自己的块状作用域。在 ES6 中已经改变了这个现象，块状作用域得到普及。关于什么是块，只要认识 <code>&#123;&#125;</code> 就可以了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个代码中， <code>if 后 &#123;&#125;</code> 就是“块”，这个里面的变量就是拥有这个块状作用域，按照规则， <code>&#123;&#125;</code> 之外是无法访问这个变量的。</p>
<h6 id="动态作用域">动态作用域</h6>
<p>在 JavaScript 中很多同学对 this 的指向时而清楚时而模糊，其实结合作用域会对 this 有一个清晰的理解。不妨先来看下这段代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">a</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test.<span class="title function_">bind</span>(&#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span></span><br><span class="line">&#125;)() <span class="comment">// 2</span></span><br><span class="line"><span class="title function_">test</span>() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>在这里 bind 已经把作用域的范围进行了修改指向了 <code>&#123; a: 2 &#125;</code>，而 this 指向的是当前作用域对象，是不是可以清楚的理解了呢？</p>
<p>接下来我们再思考另一个问题：作用域是在代码编写的时候就已经决定了呢，还是在代码执行的过程中才决定的？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> course = <span class="string">&quot; es&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处可调用 course 变量</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myFunction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 函数内可调用 course 变量</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在看看这段代码，写代码的时候就知道 course 就是全局作用域，函数内部的用 var 定义的变量就是函数作用域。这个也就是专业术语：词法作用域。 通俗的讲变量的作用域是在定义时决定而不是执行时决定，也就是说词法作用域取决于源码，通过静态分析就能确定，因此词法作用域也叫做静态作用域。 相反，只能在执行阶段才能决定变量的作用域，那就是动态作用域。</p>
<h6 id="推荐阅读">推荐阅读</h6>
<ul>
<li><a href="https://www.kancloud.cn/kancloud/you-dont-know-js-scope-closures/516610">什么是作用域</a></li>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/3">JavaScript深入之词法作用域和动态作用域</a></li>
<li><a href="https://github.com/creeperyang/blog/issues/16">深入理解JS中声明提升、作用域（链）和 this 关键字</a></li>
</ul>
<h5 id="Let">Let</h5>
<p>ES6 新增了let命令，用来声明变量。</p>
<h6 id="1-let-声明的全局变量不是全局对象window的属性">1. let 声明的全局变量不是全局对象window的属性</h6>
<p>这就意味着，你不可以通过 window. 变量名 的方式访问这些变量，而 var 声明的全局变量是 window 的属性，是可以通过 window. 变量名 的方式访问的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>) <span class="comment">// 5</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">a</span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<h6 id="2-用let定义变量不允许重复声明">2. 用let定义变量不允许重复声明</h6>
<p>这个很容易理解，使用 var 可以重复定义，使用 let 却不可以。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<p>如果是 let ，则会报错</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">5</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">6</span></span><br><span class="line"><span class="comment">// VM131:1 Uncaught SyntaxError: Identifier &#x27;a&#x27; has already been declared</span></span><br><span class="line"><span class="comment">//   at &lt;anonymous&gt;:1:1</span></span><br></pre></td></tr></table></figure>
<h6 id="3-let声明的变量不存在变量提升">3. let声明的变量不存在变量提升</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>() <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<p>上述代码中， <code>a</code> 的调用在声明之前，所以它的值是 undefined，而不是 Uncaught ReferenceError。实际上因为 var 会导致变量提升，上述代码和下面的代码等同：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">    a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>() <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<p>而对于 let 而言，变量的调用是不能先于声明的，看如下代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: Cannot access &#x27;a&#x27; before initialization</span></span><br></pre></td></tr></table></figure>
<p>在这个代码中， <code>a</code> 的调用是在声明之前，因为 let 没有发生变量提升，所有读取 a 的时候，并没有找到，而在调用之后才找到 let 对 <code>a</code> 的定义，所以按照 tc39 的定义会报错。</p>
<h6 id="4-let声明的变量具有暂时性死区">4. let声明的变量具有暂时性死区</h6>
<p>只要块级作用域内存在 <code>let</code> 命令，它所声明的变量就绑定在了这个区域，不再受外部的影响。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    a = <span class="number">6</span></span><br><span class="line">    <span class="keyword">let</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: Cannot access &#x27;a&#x27; before initialization</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，存在全局变量 <code>a</code> ，但是块级作用域内 <code>let</code> 又声明了一个局部变量 <code>a</code> ，导致后者绑定这个块级作用域，所以在let声明变量前，对 <code>a</code> 赋值会报错。</p>
<p>ES6 明确规定，如果区块中存在 <code>let</code> 和 <code>const</code> 命令，这个区块对这些命令声明的变量，从一开始就形成了封闭作用域。凡是在声明之前就使用这些变量，就会报错。</p>
<p>总之，在代码块内，使用 <code>let</code> 命令声明变量之前，该变量都是不可用的。这在语法上，称为“暂时性死区”</p>
<p>有时“暂时性死区”比较隐蔽，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">b = a, a = <span class="number">2</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: Cannot access &#x27;a&#x27; before initialization</span></span><br></pre></td></tr></table></figure>
<h6 id="5-let-声明的变量拥有块级作用域">5. let 声明的变量拥有块级作用域</h6>
<p>let实际上为 JavaScript 新增了块级作用域</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p><code>a</code> 变量是在代码块 <code>&#123;&#125;</code> 中使用 let 定义的，它的作用域是这个代码块内部，外部无法访问。</p>
<p>我们再看一个项目中很常见的 <code>for</code> 循环:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;循环内:&#x27;</span> + i) <span class="comment">// 0、1、2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;循环外:&#x27;</span> + i) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>如果改为 <code>let</code> 会怎么样呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;循环内:&#x27;</span> + i) <span class="comment">// 0、1、2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;循环外:&#x27;</span> + i) <span class="comment">// ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure>
<p>继续看下面两个例子的对比，这时 <code>a</code> 的值又是多少呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"><span class="comment">// Uncaught ReferenceError: a is not defined</span></span><br></pre></td></tr></table></figure>
<h6 id="思考">思考</h6>
<p>请问 <code>i</code> 的值是多少？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3、3、3</span></span><br></pre></td></tr></table></figure>
<p>答案是3次3。<br>
但我希望的值是0、1、2，也就是每次保存住循环时候 <code>i</code> 的值，应该如何做呢？</p>
<p>方案1：闭包</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    (<span class="keyword">function</span>(<span class="params">j</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(j)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方案2：使用let</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大家可以把上面这段代码粘贴到 <code>babel</code> 中：<a href="https://www.babeljs.cn/repl">https://www.babeljs.cn/repl</a> , 看下经过 <code>babel</code> 转化为的 <code>ES5</code> 代码是什么样子的。</p>
<p>大家会发现其实 <code>babel</code> 把这段代码转化成了闭包的形式:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _loop = <span class="keyword">function</span> <span class="title function_">_loop</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="title function_">_loop</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相信通过这个思考题，大家对于 <code>let</code> 关键字的使用会有进一步的理解。</p>
<blockquote>
<p>总结</p>
<p>使用let声明的变量：</p>
<ul>
<li>不属于顶层对象window</li>
<li>不允许重复声明</li>
<li>不存在变量提升</li>
<li>暂时性死区</li>
<li>块级作用域</li>
</ul>
</blockquote>
<h6 id="推荐阅读-2">推荐阅读</h6>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management">内存管理</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/let">let</a></li>
</ul>
<h5 id="Const">Const</h5>
<p>不能被改变的叫做常量，请大家思考在 <code>ES5</code> 中如何定义一个常量呢？</p>
<p><code>ES5</code> 中可以使用 <code>Object.defineProperty()</code> 来实现定义常量：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">window</span>, <span class="string">&#x27;PI&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">3.14</span>,</span><br><span class="line">    <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">PI</span>)</span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">PI</span>)</span><br></pre></td></tr></table></figure>
<p><code>const</code> 除了具有 <code>let</code> 的块级作用域和不会变量提升外，还有就是它定义的是常量，在用 <code>const</code> 定义变量后，我们就不能修改它了，对变量的修改会抛出异常。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.1415</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">PI</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">PI</span>)</span><br><span class="line"><span class="comment">// Uncaught TypeError: Assignment to constant variable.</span></span><br></pre></td></tr></table></figure>
<p>这个代码块中因为对 <code>PI</code> 尝试修改，导致浏览器报错，这就说明 const 定义的变量是不能被修改的，它是只读的。聪明的同学一定会发现只读属性是不是一定要进行初始化呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PI</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">PI</span> = <span class="number">3.1415</span></span><br><span class="line"><span class="comment">// Uncaught SyntaxError: Missing initializer in const declaration</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>const 声明的变量必须进行初始化，不然会抛出异常 Uncaught SyntaxError: Missing initializer in const declaration。</p>
</blockquote>
<h6 id="重点来喽">重点来喽</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span></span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="property">school</span> = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"><span class="comment">// &#123;name: &quot;xiecheng&quot;, age: 34, school: &quot;xxx&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<p>大家会发现 <code>const</code> 定义的 <code>obj</code> 竟然被改变了… 这到底是为什么呢？有点懵啊…</p>
<p>这时我们就需要了解JS中的变量是如何存储的，见下图：</p>
<p><img data-src="image-20230410154611569.png" alt=""></p>
<p>基本数据类型存储在 <code>栈内存</code> 中，引用数据类型存储在 <code>堆内存</code> 中然后在栈内存中保存 <code>引用地址</code> 。</p>
<blockquote>
<p>const 实际上保证的是变量的值不得改动，而不是变量指向的那个内存地址所保存的数据不得改动。</p>
</blockquote>
<p>如何让对象或者数组这种引用数据类型也不被改变呢？</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Object.freeze(obj)</span><br><span class="line">注意: Object.freeze() 只是浅层冻结，只会对最近一层的对象进行冻结，并不会对深层对象冻结。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>总结</p>
<p>使用const声明的常量：</p>
<ul>
<li>不属于顶层对象window</li>
<li>不允许重复声明</li>
<li>不存在变量提升</li>
<li>暂时性死区</li>
<li>块级作用域</li>
</ul>
</blockquote>
<h6 id="推荐阅读-3">推荐阅读</h6>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/const">const</a></li>
</ul>
<h4 id="解构赋值-Desctructuring">解构赋值 Desctructuring</h4>
<p>在 ES6 中新增了变量赋值的方式：解构赋值。允许按照一定模式，从数组和对象中提取值，对变量进行赋值。如果对这个概念不了解，我们可以快速展示一个小示例一睹风采：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> a = arr[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> b = arr[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">let</span> c = arr[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>想从数组中找出有意义的项要单独赋值给变量，在 ES6 中就可以这样写了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>解构赋值重点是在赋值，赋值的元素是要拷贝出来赋值给变量，赋值的元素本身是不会被改变的。</p>
<p>是不是非常的简洁，在解构赋值里用的最多的就是 Object 和 Array ，我们可以分别来看下两者的解构赋值是如何操作的。</p>
</blockquote>
<h5 id="数组解构赋值">数组解构赋值</h5>
<p>上述的小示例已经在描述数组的解构赋值了，可是那只是开始。</p>
<ul>
<li>
<p><strong>赋值元素可以是任意可遍历的对象</strong></p>
<p>赋值的元素不仅是数组，它可以是任意可遍历的对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, b, c] = <span class="string">&quot;abc&quot;</span> <span class="comment">// [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span></span><br><span class="line"><span class="keyword">let</span> [one, two, three] = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>左边的变量</strong></p>
<p>被赋值的变量还可以是对象的属性，不局限于单纯的变量。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;&#125;</span><br><span class="line">[user.<span class="property">firstName</span>, user.<span class="property">secondName</span>] = <span class="string">&#x27;Kobe Bryant&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">firstName</span>, user.<span class="property">secondName</span>) <span class="comment">// Kobe Bryant</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>循环体</strong></p>
<p>解构赋值在循环体中的应用，可以配合 entries 使用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// loop over keys-and-values</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(user)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>:<span class="subst">$&#123;value&#125;</span>`</span>) <span class="comment">// name:John, then age:30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，对于 map 对象依然适用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">user.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">user.<span class="title function_">set</span>(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;30&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> user.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>:<span class="subst">$&#123;value&#125;</span>`</span>) <span class="comment">// name:John, then age:30</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>可以跳过赋值元素</strong></p>
<p>如果想忽略数组的某个元素对变量进行赋值，可以使用逗号来处理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// second element is not needed</span></span><br><span class="line"><span class="keyword">let</span> [name,, title] = [<span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;Jim&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>, <span class="string">&#x27;Moon&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( title ) <span class="comment">// Sun</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>rest 参数</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [name1, name2, ...rest] = [<span class="string">&quot;Julius&quot;</span>, <span class="string">&quot;Caesar&quot;</span>, <span class="string">&quot;Consul&quot;</span>, <span class="string">&quot;of the Roman Republic&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name1) <span class="comment">// Julius</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name2) <span class="comment">// Caesar</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Note that type of `rest` is Array.</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest[<span class="number">0</span>]) <span class="comment">// Consul</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest[<span class="number">1</span>]) <span class="comment">// of the Roman Republic</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest.<span class="property">length</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意</p>
<p>我们可以使用 rest 来接受赋值数组的剩余元素，不过要确保这个 rest 参数是放在被赋值变量的最后一个位置上。</p>
<ul>
<li>
<p><strong>默认值</strong></p>
<p>如果数组的内容少于变量的个数，并不会报错，没有分配到内容的变量会是 undefined。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> [firstName, surname] = []</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(firstName) <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(surname) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>当然你也可以给变量赋予默认值，防止 undefined 的情况出现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// default values</span></span><br><span class="line"><span class="keyword">let</span> [name = <span class="string">&quot;Guest&quot;</span>, surname = <span class="string">&quot;Anonymous&quot;</span>] = [<span class="string">&quot;Julius&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name)    <span class="comment">// Julius (from array)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(surname) <span class="comment">// Anonymous (default used)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="对象解构赋值">对象解构赋值</h5>
<ul>
<li>
<p><strong>基本用法</strong></p>
<p>解构赋值除了可以应用在 Array，也可以应用在 Object。基本的语法如下：</p>
<blockquote>
<p>let {var1, var2} = {var1:…, var2…}</p>
</blockquote>
<p>大致的意思是我们有一个 Object 想把里面的属性分别拿出来而无需通过调用属性的方式赋值给指定的变量。具体的做法是在赋值的左侧声明一个和 Object 结构等同的模板，然后把相关属性的 value 指定为新的变量即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Menu&quot;</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">200</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;title, width, height&#125; = options</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(title)  <span class="comment">// Menu</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(width)  <span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(height) <span class="comment">// 200</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>TIP</p>
<p>在这个结构赋值的过程中，左侧的“模板”结构要与右侧的 Object 一致，但是属性的顺序无需一致。</p>
<p>上述的赋值左侧是采用了对象简写的方式，类似于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="attr">title</span>: title, <span class="attr">width</span>: width, <span class="attr">height</span>: height&#125; = options</span><br></pre></td></tr></table></figure>
<p>如果不想这么写或者想使用其他的变量名，可以自定义的，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123;<span class="attr">width</span>: w, <span class="attr">height</span>: h, title&#125; = options</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>默认值</strong></p>
<p>当然，这个赋值的过程中也是可以指定默认值的，这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Menu&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;width = <span class="number">100</span>, height = <span class="number">200</span>, title&#125; = options</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(title)  <span class="comment">// Menu</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(width)  <span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(height) <span class="comment">// 200</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>rest 运算符</strong></p>
<p>如果我们想象操作数组一样，只关心指定的属性，其他可以暂存到一个变量下，这就要用到 rest 运算符了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;Menu&quot;</span>,</span><br><span class="line">  <span class="attr">height</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">width</span>: <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;title, ...rest&#125; = options</span><br><span class="line"></span><br><span class="line"><span class="comment">// now title=&quot;Menu&quot;, rest=&#123;height: 200, width: 100&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest.<span class="property">height</span>)  <span class="comment">// 200</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(rest.<span class="property">width</span>)   <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>嵌套对象</strong></p>
<p>如果一个 Array 或者 Object 比较复杂，它嵌套了 Array 或者 Object，那只要被赋值的结构和右侧赋值的元素一致就好了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  <span class="attr">size</span>: &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">200</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">items</span>: [<span class="string">&quot;Cake&quot;</span>, <span class="string">&quot;Donut&quot;</span>],</span><br><span class="line">  <span class="attr">extra</span>: <span class="literal">true</span>    <span class="comment">// something extra that we will not destruct</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// destructuring assignment on multiple lines for clarity</span></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  <span class="attr">size</span>: &#123; <span class="comment">// put size here</span></span><br><span class="line">    width,</span><br><span class="line">    height</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">items</span>: [item1, item2], <span class="comment">// assign items here</span></span><br><span class="line">  title = <span class="string">&#x27;Menu&#x27;</span> <span class="comment">// not present in the object (default value is used)</span></span><br><span class="line">&#125; = options</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(title)  <span class="comment">// Menu</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(width)  <span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(height) <span class="comment">// 200</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item1)  <span class="comment">// Cake</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(item2)  <span class="comment">// Donut</span></span><br></pre></td></tr></table></figure>
<p>这个原理其实很简单，如果不理解可以看下图：</p>
<p><img data-src="http://es.xiecheng.live/assets/img/destructuring-complex@2x.9f75fc55.png" alt="img"></p>
</li>
</ul>
<h5 id="字符串解构赋值">字符串解构赋值</h5>
<p>可以当做是数组的解构:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [a, b, c, d, e] = str</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, b, c, d, e)</span><br></pre></td></tr></table></figure>
<h5 id="思考-2">思考</h5>
<ol>
<li>有时候我们写一个函数需要传入很多参数，而且很多参数是可选的，是否可以利用解构赋值来简化操作呢？</li>
<li>如何在业务开发中对接口数据进行解构赋值呢？</li>
</ol>
<h5 id="推荐阅读-4">推荐阅读</h5>
<ul>
<li><a href="https://www.sitepoint.com/es6-destructuring-assignment/">Destructuring Assignment</a></li>
<li><a href="https://ponyfoo.com/articles/es6-destructuring-in-depth">ES6 JavaScript Destructuring in Depth</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">解构赋值</a></li>
</ul>
<h4 id="Array-2">Array</h4>
<p>在 ES6 中新增了很多实用的原生 API，方便开发者对 Array 的操控性更强，如 for…of、from、of、fill、find、findIndex等。</p>
<h5 id="ES5-中数组遍历方式">ES5 中数组遍历方式</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h5 id="for循环">for循环</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arr[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后来语法有所升级，到 ES5 遍历数组的 API 多了起来，其中有 forEach、every、filter等，同样的功能可以用 forEach 、 map 、 every 等方法来实现。</p>
<h5 id="forEach-没有返回值，只是针对每个元素调用func">forEach() 没有返回值，只是针对每个元素调用func</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">arr.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">elem, index, array</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i] == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(elem, index)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这个语法看起来要简洁很多，不需要通过索引去访问数组项，然而它的缺点也是很明显，不支持 break、continue 等。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i === <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这段代码的&quot;本意&quot;是从第一个元素开始遍历，遇到数组项 2 之后就结束遍历，不然打印出所遍历过的数值项。可是，事实让你大跌眼镜，因为它的输出是 1, 3, 4, 5。</p>
<blockquote>
<p>注意</p>
<p>forEach 的代码块中不能使用 break、continue，它会抛出异常。</p>
</blockquote>
<h5 id="map-返回新的数组，每个元素为调用func的结果">map() 返回新的数组，每个元素为调用func的结果</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    value += <span class="number">1</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr, result)</span><br></pre></td></tr></table></figure>
<h5 id="filter-返回符合func条件的元素数组">filter() 返回符合func条件的元素数组</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> value == <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr, result)</span><br></pre></td></tr></table></figure>
<h5 id="some-返回boolean，判断是否有元素符合func条件">some() 返回boolean，判断是否有元素符合func条件</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">some</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> value == <span class="number">4</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr, result)</span><br></pre></td></tr></table></figure>
<h5 id="every-返回boolean，判断每个元素都符合func条件">every() 返回boolean，判断每个元素都符合func条件</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> result = arr.<span class="title function_">every</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> value == <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr, result)</span><br></pre></td></tr></table></figure>
<p>同样完成刚才的目标，使用 every 遍历就可以做到 break 那样的效果，简单的说 return false 等同于 break，return true 等同于 continue。如果不写，默认是 return false。</p>
<blockquote>
<p>注意</p>
<p>every 的代码块中不能使用 break、continue，它会抛出异常。</p>
</blockquote>
<h5 id="reduce-接收一个函数作为累加器">reduce() 接收一个函数作为累加器</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">prev, cur, index, array</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> prev + cur</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum)</span><br><span class="line"><span class="keyword">let</span> max = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">prev, cur</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(prev, cur)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max)</span><br><span class="line"><span class="keyword">let</span> res = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">prev, cur</span>) &#123;</span><br><span class="line">    prev.<span class="title function_">indexOf</span>(cur) == -<span class="number">1</span> &amp;&amp; prev.<span class="title function_">push</span>(cur)</span><br><span class="line">    <span class="keyword">return</span> prev</span><br><span class="line">&#125;, [])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>
<p>有的同学会说，还有 for…in 可以遍历数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> array) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(array[index]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说的没错，for…in 确实可以遍历数组，而且还支持 continue、break等功能，但是它真的没有瑕疵吗？如果 array 有自定义属性，你发现也会被遍历出来(显然不合理)。这是因为 for…in 是为遍历对象创造的（{a:1, b:2}），不是为数组设计的。</p>
<blockquote>
<p>注意</p>
<p>for…in不能用于遍历数组。<br>
for…in代码块中不能有 return，不然会抛出异常。</p>
</blockquote>
<h5 id="ES6-中数组遍历方式-for…of">ES6 中数组遍历方式 for…of</h5>
<p>接下来就要步入正题，说说我们今天的主角：for…of。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> val <span class="keyword">of</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1,2,3</span></span><br></pre></td></tr></table></figure>
<p>上述代码中轻松实现了数组的遍历，乍一看没有绝对它有非常强大之处。我们不得不强调下，for…of 的来历和作用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (variable <span class="keyword">of</span> iterable) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看下这个伪代码，of 后面是 iterable 既不是 for 循环规定的 array，也不是 for…in 规定的 Object，而是 iterable。如果查查 iterable 的含义就很直观的感受到 for…of 遍历的是一切可遍历的元素（数组、对象、集合）等，不要小瞧这个功能，因为在 ES6 中允许开发者自定义遍历，换句话说任何数据结构都可以自定义一个遍历，这个遍历是不能被 for、for…in 理解和实现的。很抽象吧？Iterator 是如何实现的这是ES6的新增语法，后面课程中 <code>Iterator</code> 一节会讲。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [index, item] <span class="keyword">of</span> arr.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(index, item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>for…of是支持 break、continue、return的，所以在功能上非常贴近原生的 for。</p>
</blockquote>
<h5 id="Array-from">Array.from()</h5>
<p>数组是开发中经常用到的数据结构，它非常好用。在 JavaScript 的世界里有些对象被理解为数组，然而缺不能使用数组的原生 API，比如函数中的 arguments、DOM中的 NodeList等。当然，还有一些可遍历的对象，看上去都像数组却不能直接使用数组的 API，因为它们是伪数组（Array-Like）。要想对这些对象使用数组的 API 就要想办法把它们转化为数组，传统的做法是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> args = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line"><span class="keyword">let</span> imgs = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;img&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>基本原理是使用 call 将数组的 api 应用在新的对象上，换句话说是利用改变函数的上下文来间接使用数组的 api。在 ES6 中提供了新的 api 来解决这个问题，就是 Array.from，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> args = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>);</span><br><span class="line"><span class="keyword">let</span> imgs = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;img&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>伪数组具备两个特征，1. 按索引方式储存数据 2. 具有length属性；如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrLike = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="attr">length</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="惊喜">惊喜</h5>
<p>难道 Array.from 只能用来将伪数组转换成数组吗，还有其他用法吗？这要来看下 Array.from 的几个参数：</p>
<p><strong>语法：</strong><code>Array.from(arrayLike[, mapFn[, thisArg]])</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">arrayLike</td>
<td style="text-align:center">想要转换成数组的伪数组对象或可迭代对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">mapFn</td>
<td style="text-align:center">如果指定了该参数，新数组中的每个元素会执行该回调函数</td>
<td style="text-align:center">N</td>
</tr>
<tr>
<td style="text-align:center">thisArg</td>
<td style="text-align:center">可选参数，执行回调函数 mapFn 时 this 对象</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p>看了这几个参数至少能看到 Array.from 还具备 map 的功能，比如我们想初始化一个长度为 5 的数组，每个数组元素默认为 1，之前的做法是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Array</span>(<span class="number">6</span>).<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> <span class="number">1</span>)</span><br><span class="line"><span class="comment">// [1,1,1,1,1]</span></span><br></pre></td></tr></table></figure>
<p>这样写虽然也能实现，但是用起来比较繁琐，使用 Array.from 就会简洁很多。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(&#123;</span><br><span class="line">    <span class="attr">length</span>: <span class="number">5</span></span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这个代码看起来既简洁还容易理解，有咩有？</p>
<h5 id="Array-of">Array.of()</h5>
<p>Array.of() 方法创建一个具有可变数量参数的新数组实例，而不考虑参数的数量或类型。</p>
<p>Array.of() 和 Array 构造函数之间的区别在于处理整数参数：Array.of(7) 创建一个具有单个元素 7 的数组，而 Array(7) 创建一个长度为7的空数组（注意：这是指一个有7个空位(empty)的数组，而不是由7个undefined组成的数组）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(<span class="number">7</span>); <span class="comment">// [7]</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Array</span>(<span class="number">7</span>); <span class="comment">// [ , , , , , , ]</span></span><br><span class="line"><span class="title class_">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>
<p><strong>语法：</strong><code>Array.of(element0[, element1[, ...[, elementN]]])</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">elementN</td>
<td style="text-align:center">任意个参数，将按顺序成为返回数组中的元素</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<h5 id="Array-prototype-fill">Array.prototype.fill()</h5>
<p>fill() 方法用一个固定值填充一个数组中从起始索引到终止索引内的全部元素。不包括终止索引。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">array.<span class="title function_">fill</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// [1,0,3,4]</span></span><br></pre></td></tr></table></figure>
<p>这个操作是将 array 数组的第二个元素（索引为1）到第三个元素（索引为2）内的数填充为 0，不包括第三个元素，所以结果是 [1, 0, 3, 4]</p>
<h5 id="技巧">技巧</h5>
<p>我们前面有提到用 Array.from 初始化为一个长度固定，元素为指定值的数组。如果用 fill 是否可以达到同样的效果呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>(<span class="number">5</span>).<span class="title function_">fill</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// [1,1,1,1,1]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>fill 不具备遍历的功能，它是通过指定要操作的索引范围来进行，通过这道题目可以看出不指定索引会对所有元素进行操作</p>
</blockquote>
<p><strong>语法：</strong><code>arr.fill(value[, start[, end]])</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">value</td>
<td style="text-align:center">用来填充数组元素的值</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">start</td>
<td style="text-align:center">起始索引，默认值为0</td>
<td style="text-align:center">N</td>
</tr>
<tr>
<td style="text-align:center">end</td>
<td style="text-align:center">终止索引，默认值为 this.length</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<h5 id="Array-prototype-find">Array.prototype.find()</h5>
<p>find() 方法返回数组中满足提供的测试函数的第一个元素的值，否则返回 undefined。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">5</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">130</span>, <span class="number">44</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> found = array.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> element &gt; <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(found);</span><br><span class="line"><span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<p><strong>语法：</strong><code>arr.find(callback[, thisArg])</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">callback</td>
<td style="text-align:center">在数组每一项上执行的函数，接收 3 个参数，element、index、array</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">thisArg</td>
<td style="text-align:center">执行回调时用作 this 的对象</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<h5 id="Array-prototype-findIndex">Array.prototype.findIndex()</h5>
<p>findIndex()方法返回数组中满足提供的测试函数的第一个元素的索引。否则返回-1。其实这个和 find() 是成对的，不同的是它返回的是索引而不是值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">5</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">130</span>, <span class="number">44</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> found = array.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> element &gt; <span class="number">10</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(found);</span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p><strong>语法：</strong><code>arr.findIndex(callback[, thisArg])</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">callback</td>
<td style="text-align:center">在数组每一项上执行的函数，接收 3 个参数，element、index、array</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">thisArg</td>
<td style="text-align:center">执行回调时用作 this 的对象</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<h5 id="Array-prototype-copyWithin">Array.prototype.copyWithin()</h5>
<p>在当前数组内部，将指定位置的成员复制到其他位置（会覆盖原有成员），然后返回当前数组。也就是说，使用这个方法，会修改当前数组。</p>
<p><strong>语法：</strong><code>arr.copyWithin(target, start = 0, end = this.length)</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">从该位置开始替换数据。如果为负值，表示倒数</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">start</td>
<td style="text-align:center">从该位置开始读取数据，默认为 0。如果为负值，表示从末尾开始计算</td>
<td style="text-align:center">N</td>
</tr>
<tr>
<td style="text-align:center">end</td>
<td style="text-align:center">到该位置前停止读取数据，默认等于数组长度。如果为负值，表示从末尾开始计算</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">copyWithin</span>(<span class="number">1</span>, <span class="number">3</span>))</span><br><span class="line"><span class="comment">// [1, 4, 5, 4, 5]</span></span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-5">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a></li>
</ul>
<h4 id="Function">Function</h4>
<h5 id="默认参数">默认参数</h5>
<p>对于函数而言，经常会用到参数，关于参数的默认值通常都是写在函数体中，如在 ES5 的时候大家都会这么写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    y = y || <span class="string">&#x27;world&#x27;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;hello&#x27;</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>当一个函数有很多参数涉及初始化的时候，这样写代码极其丑陋，所以在 ES6 中改变了对这种知识的写法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x, y = <span class="string">&#x27;world&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;hello&#x27;</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP：</p>
<p>函数参数是从左到右解析，如果没有默认值会被解析成 undefined</p>
<p>如果我们想让具体某个参数使用默认值，我们可以使用 undefined 进行赋值，如下段代码所示：</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">x, y = <span class="number">7</span>, z = <span class="number">42</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f</span>(<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">43</span>)) <span class="comment">// 51</span></span><br></pre></td></tr></table></figure>
<p>在ES6中我们不仅可以给参数默认赋值具体的数值，同时参数赋值支持参数的逻辑运算进行赋值，如下段代码所示：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">x, y = <span class="number">7</span>, z = x + y</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> z * <span class="number">0.5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f</span>(<span class="number">1</span>, <span class="number">7</span>)) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>再看一个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url, &#123;</span></span><br><span class="line"><span class="params">    body = <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">    method = <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="params">    headers = &#123;&#125;</span></span><br><span class="line"><span class="params">&#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(method)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;http://www.xxx.com&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="拓展">拓展</h5>
<p>在函数体内，有时候需要判断函数有几个参数，一共有2个办法。在 ES5 中可以在函数体内使用 arguments 来判断。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b = <span class="number">1</span>, c</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) <span class="comment">//2</span></span><br></pre></td></tr></table></figure>
<p>然而在 ES6 中不能再使用 arguments 来判断了，但可以借助 Function.length 来判断。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b = <span class="number">1</span>, c</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>细心的同学发现 Function.length 结果和 arguments 的结果不同！没错，Function.length 是统计第一个默认参数前面的变量数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a = <span class="number">2</span>, b = <span class="number">1</span>, c</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h5 id="Rest-参数">Rest 参数</h5>
<p>在写函数的时候，部分情况我们不是很确定参数有多少个，比如求和运算，之前都是这么做的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span></span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">forEach</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        num += item * <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>其实在上面说过，这个代码在 ES5 中可以这么写，在 ES6 就不能这么写了，因为 arguments 的问题。现在需要这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span></span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        num += item * <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) <span class="comment">// 6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
<p>当然，Rest Parameter 也可以和其他参数一起来用，比如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">base, ...nums</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> num = base</span><br><span class="line">    nums.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        num += item * <span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">30</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) <span class="comment">// 36</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">30</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)) <span class="comment">// 40</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>arguments 不是数组，所以不能直接使用数组的原生 API 如 forEach，而 Rest Parameter 是数组，可以直接使用数组的原生 API。</p>
</blockquote>
<h5 id="扩展运算符">扩展运算符</h5>
<p>Spread Operator 和 Rest Parameter 是形似但相反意义的操作符，简单的来说 Rest Parameter 是把不定的参数“收敛”到数组，而 Spread Operator 是把固定的数组内容“打散”到对应的参数。示例如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x = <span class="number">1</span>, y = <span class="number">2</span>, z = <span class="number">3</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(...[<span class="number">4</span>])) <span class="comment">// 9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(...[<span class="number">4</span>, <span class="number">5</span>])) <span class="comment">// 12</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(...[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>大家可以好好体会下前面两个示例，Rest Parameter 用来解决函数参数不确定的场景，Spread Operator 用来解决已知参数集合应用到固定参数的函数上，如果没有这个语法，可能需要这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">x = <span class="number">1</span>, y = <span class="number">2</span>, z = <span class="number">3</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">4</span>])) <span class="comment">// 9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">4</span>, <span class="number">5</span>])) <span class="comment">// 12</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])) <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>
<p>这种代码是否似曾相识？所以有了 Spread Operator 你的操作将更加简单！</p>
<h5 id="length属性">length属性</h5>
<p>函数指定了默认值以后，函数的length属性，将返回没有指定默认值的参数个数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">x = <span class="number">1</span>, y = <span class="number">2</span>, z = <span class="number">3</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(x, y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">length</span>)</span><br><span class="line"><span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h5 id="name属性">name属性</h5>
<p>函数的name属性，返回该函数的函数名。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">foo.<span class="property">name</span> <span class="comment">// &quot;foo&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="箭头函数">箭头函数</h5>
<p>箭头函数可以说是 ES6 很大的福利了，不管你是函数式爱好者还是面向对象开发者，函数是必须要用到的东西。之前声明函数需要使用 function，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say hello&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hello = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say hello&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在可以这样做了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">hello</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say hello&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果带参数该怎么做呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">hello</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say hello&#x27;</span>, name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">hello</span> = name =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say hello&#x27;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>如果只有一个参数，可以省略括号，如果大于一个参数一定要记得带括号</p>
<p>函数的声明和参数写的很清楚了，那么对于返回值有什么要注意的地方呢？</p>
</blockquote>
<ul>
<li>
<p><strong>如果返回值是表达式</strong></p>
<p>如果返回值是表达式可以省略 return 和 {}</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">pow</span> = x =&gt; x * x</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>如果返回值是字面量对象</strong></p>
<p>如果返回值是字面量对象，一定要用小括号包起来</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">person</span> = (<span class="params">name</span>) =&gt; (&#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">addr</span>: <span class="string">&#x27;Beijing City&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><strong>其他</strong></p>
<p>其他情况就要中规中矩的写好啦！</p>
</li>
</ul>
<h5 id="拓展-2">拓展</h5>
<p>看上去箭头函数真的很漂亮，可是它有什么神秘之处吗？this，对，就是它。普通函数和箭头函数对 this 的处理方式是截然不同的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">    <span class="attr">say</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">say</span>()) <span class="comment">// es</span></span><br></pre></td></tr></table></figure>
<p>这是用普通函数的写法，say 在被调用之后，this 指向的是调用 say 方法的对象，显示是 foo 对象，所以 this === foo <a href="http://this.name">this.name</a> 也就是 <a href="http://foo.name">foo.name</a>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">    <span class="attr">say</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>, <span class="variable language_">this</span>) <span class="comment">// &#x27;&#x27;, window对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">say</span>())</span><br></pre></td></tr></table></figure>
<p>因为箭头函数中对 this 的处理是定义时，this 的指向也就是 foo 外层的所指向的 window，而 window 有 name 属性，所以结果是 ‘’。</p>
<p>总结</p>
<p>1、箭头函数中的this指向的是定义时的this，而不是执行时的this，箭头函数中不绑定this，箭头函数中的this指向是它所定义的位置，可以简单理解成，定义箭头函数中的作用域的this指向谁，它就指向谁。</p>
<p>2、箭头函数不可以当作构造函数</p>
<p>3、箭头函数不可以使用arguments对象</p>
<h5 id="练习">练习</h5>
<ol>
<li>如何用箭头函数来实现一个数组排序的问题</li>
<li>箭头函数对 this 的处理还有什么妙用</li>
</ol>
<h5 id="推荐阅读-6">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions">箭头函数</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Default_parameters">默认参数</a></li>
<li><a href="https://alligator.io/js/rest-parameters-es6/">rest-parameters</a></li>
<li><a href="https://dev.to/sagar/three-dots---in-javascript-26ci">Three dots ( … ) in JavaScript</a></li>
</ul>
<h4 id="Object-2">Object</h4>
<h5 id="属性简洁表示法">属性简洁表示法</h5>
<p>在 ES6 之前 Object 的属性必须是 key-value 形式，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;xiecheng&#x27;</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">34</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: name,</span><br><span class="line">    <span class="attr">age</span>: age,</span><br><span class="line">    <span class="attr">study</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;正在学习&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 ES6 之后是可以用简写的形式来表达：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;xiecheng&#x27;</span></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">34</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name,</span><br><span class="line">    age,</span><br><span class="line">    <span class="title function_">study</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&#x27;正在学习&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="属性名表达式">属性名表达式</h5>
<p>在 ES6 可以直接用变量或者表达式来定义Object的 key。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;school&#x27;</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">    [s]: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Object-is"><a href="http://Object.is">Object.is</a>()</h5>
<p>判断两个对象是否相等。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123; <span class="comment">// new Object()</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123; <span class="comment">// new Object()</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1 == obj2) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">is</span>(obj1, obj2)) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = obj1</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">is</span>(obj1, obj2)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="Object-assign">Object.assign()</h5>
<p>Object.assign() 方法用于将所有可枚举属性的值从一个或多个源对象复制到目标对象，它将返回目标对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> source = &#123;</span><br><span class="line">    <span class="attr">b</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> returnedTarget = <span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br><span class="line"><span class="comment">// expected output: Object &#123; a: 1, b: 4, c: 5 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(returnedTarget)</span><br><span class="line"><span class="comment">// expected output: Object &#123; a: 1, b: 4, c: 5 &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>基本语法</strong></p>
<blockquote>
<p>Object.assign(target, …sources)</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">sources</td>
<td style="text-align:center">源对象</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<blockquote>
<p>TIP</p>
<p>从语法上可以看出源对象的个数是不限制的（零个或多个），如果是零个直接返回目的对象，如果是多个相同属性的会被后边的源对象的属相覆盖。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// &#123;a: 1&#125;</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>如果目的对象不是对象，则会自动转换为对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> t = <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// Number &#123;2&#125;</span></span><br><span class="line"><span class="keyword">let</span> s = <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="number">2</span>, &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// Number &#123;2, a: 2&#125;</span></span><br></pre></td></tr></table></figure>
<p>如果对象属性具有多层嵌套，这时使用Object.assign()合并对象会怎么样呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;</span><br><span class="line">    <span class="attr">a</span>: &#123;</span><br><span class="line">        <span class="attr">b</span>: &#123;</span><br><span class="line">            <span class="attr">c</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">e</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">f</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">g</span>: <span class="number">6</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> source = &#123;</span><br><span class="line">    <span class="attr">a</span>: &#123;</span><br><span class="line">        <span class="attr">b</span>: &#123;</span><br><span class="line">            <span class="attr">c</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">e</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">f</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(target)</span><br></pre></td></tr></table></figure>
<p>我们惊奇的发现， <code>g</code> 属性消失了…</p>
<blockquote>
<p>注意</p>
<p>Object.assign()对于引用数据类型属于浅拷贝。</p>
<p>对象的浅拷贝：浅拷贝是对象共用的一个内存地址，对象的变化相互印象。 对象的深拷贝：简单理解深拷贝是将对象放到新的内存中，两个对象的改变不会相互影响。</p>
</blockquote>
<h5 id="思考-3">思考</h5>
<ol>
<li>如果目标对象传入的是 undefined 和 null 将会怎样呢？</li>
<li>如果源对象的参数是 undefined 和 null 又会怎样呢？</li>
<li>如果目标对象是个嵌套的对象，子对象的属性会被覆盖吗？</li>
</ol>
<h5 id="对象的遍历方式">对象的遍历方式</h5>
<p>如何能够遍历出对象中每个key和value的值呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span>,</span><br><span class="line">    <span class="attr">school</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Array中演示过，for…in不能够用于遍历Array，for…in的作用是用于遍历对象的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, obj[key])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Object.keys()用于返回对象所有key组成的数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Object.getOwnPropertyNames()用于返回对象所有key组成的数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Reflect.ownKeys()用于返回对象所有key组成的数组。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(obj).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-7">推荐阅读</h5>
<ol>
<li><a href="https://www.sitepoint.com/es6-enhanced-object-literals/">es6-enhanced-object-literals</a></li>
<li><a href="https://codetower.github.io/es6-features/">es6-features</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign()</a></li>
</ol>
<h4 id="Class">Class</h4>
<blockquote>
<p>Javascript是一种基于对象（object-based）的语言，你遇到的所有东西几乎都是对象。但是，它又不是一种真正的面向对象编程（OOP）语言，因为它的语法中没有class（类）。</p>
</blockquote>
<p>这是摘自阮一峰老师的博客，这句话放在 ES5 可以说不为过，然而到了 ES6 这么说就已经不严谨了。因为 ES6 中已经有了专属的 class 语法了。</p>
<p>有的同学喜欢函数式的编程方式，有的同学喜欢面向对象的编程思维，我们今天不论长短，重点讲述怎么使用 ES6 的 class 语法完成面向对象的开发。</p>
<p>对于面向对象编程而言，更关注类的声明、属性、方法、静态方法、继承、多态、私有属性。</p>
<h5 id="声明类">声明类</h5>
<p>首先我们要先来说明在 JavaScript 世界里如何声明一个 “类”。在 ES6 之前大家都是这么做的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Animal</span> = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">walk</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> monkey = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;monkey&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>在上述代码中，我们定义了一个叫 Animal 的类，类中声明了一个属性 type、一个方法 walk；然后通过 new Animal 这个类生成实例，完成了类的定义和实例化。当然你也可以这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Animal</span> = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">walk</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> monkey = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;monkey&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>在 ES6 中把类的声明专业化了，不在用 function 的方式了，请看：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">walk</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> dog = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> monkey = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;monkey&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>很明显，从定义上就很专业了，有构造函数、方法，但是 ES6 增加了新的数据类型 class 吗？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Animal</span>) <span class="comment">//function</span></span><br></pre></td></tr></table></figure>
<p>可以发现 class 的类型还是 function，和 ES5 貌似并没有什么区别，那么 class 中定义的方法在哪呢？我们知道只要是函数，就一定会有 prototype 对象。那么类的方法和 prototype 对象有什么关系呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="comment">// &#123;constructor: ƒ, walk: ƒ&#125;</span></span><br><span class="line"><span class="comment">//   constructor: class Animal</span></span><br><span class="line"><span class="comment">//   walk: ƒ walk()</span></span><br><span class="line"><span class="comment">//   __proto__:</span></span><br><span class="line"><span class="comment">//   constructor: ƒ Object()</span></span><br><span class="line"><span class="comment">//   hasOwnProperty: ƒ hasOwnProperty()</span></span><br><span class="line"><span class="comment">//   isPrototypeOf: ƒ isPrototypeOf()</span></span><br><span class="line"><span class="comment">//   propertyIsEnumerable: ƒ propertyIsEnumerable()</span></span><br><span class="line"><span class="comment">//   toLocaleString: ƒ toLocaleString()</span></span><br><span class="line"><span class="comment">//   toString: ƒ toString()</span></span><br><span class="line"><span class="comment">//   valueOf: ƒ valueOf()</span></span><br><span class="line"><span class="comment">//   __defineGetter__: ƒ __defineGetter__()</span></span><br><span class="line"><span class="comment">//   __defineSetter__: ƒ __defineSetter__()</span></span><br><span class="line"><span class="comment">//   __lookupGetter__: ƒ __lookupGetter__()</span></span><br><span class="line"><span class="comment">//   __lookupSetter__: ƒ __lookupSetter__()</span></span><br><span class="line"><span class="comment">//   get __proto__: ƒ __proto__()</span></span><br><span class="line"><span class="comment">//   set __proto__: ƒ __proto__()</span></span><br></pre></td></tr></table></figure>
<p>可以看出在 Animal.prototype 对象上有两个方法，一个是构造函数（constructor）、一个是自定义的方法（walk）。这是不是和 ES5 的第二种写法一模一样？我们再来看下属性，在 ES5 中有个 API 用来判断对象的自有属性（hasOwnProperty）。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;type&#x27;</span>)) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>这个表现也和 ES5 中直接使用 function 定义类的方式相同，所以得出一个结论：class 的方式是 function 方式的语法糖。</p>
<h5 id="Setters-Getters">Setters &amp; Getters</h5>
<p>对于类中的属性，可以直接在 constructor 中通过 this 直接定义，还可以直接在类的顶层来定义：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type, age</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_age</span> = age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">age</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_age</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">age</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_age</span> = val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码演示了，通过 get/set 来给类定一个属性，不过貌似没有说服力。因为 age 和 <code>_age</code> 都是类的属性，而且是相同的含义这样做感觉没有实际用途。但是如果一个属性是个只读的呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">addr</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;北京动物园&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>毋庸赘述，大家都能看出来含义。再来看下如下的应用场景：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomHTMLElement</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">element</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">element</span> = element</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">html</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">innerHTML</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">html</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">innerHTML</span> = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用 set/get 实现了对 element.innerHTML 的简单封装。</p>
<p>可是，有时候我们真的需要设置一个私有属性(闭包)，然后通过一定的规则来限制对它的修改，利用 set/get就可以轻松实现。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> #age = <span class="number">1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">age</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> #age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">age</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (val &gt; <span class="number">0</span> &amp;&amp; val &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            #age = val</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="静态方法">静态方法</h5>
<p>静态方法是面向对象最常用的功能，在 ES5 中利用 function 实现的类是这样实现一个静态方法的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">Animal</span> = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">walk</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am eating`</span> )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 ES6 中使用 static 的标记是不是静态方法，代码如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">walk</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am eating`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有没有很清爽，代码可读性一下子就上来了。</p>
<h5 id="继承-2">继承</h5>
<p>面向对象只所以可以应对复杂的项目实现，很大程度上要归功于继承。如果对继承概念不熟悉的同学，可以自行查询。在 ES5 中怎么实现继承呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义父类</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Animal</span> = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义方法</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">walk</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义静态方法</span></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am eating`</span> )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义子类</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Dog</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 初始化父类</span></span><br><span class="line">    <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I can run&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 继承</span></span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure>
<p>从代码上看，是不是很繁琐？而且阅读性也较差。再看看 ES6 是怎么解决这些问题的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">walk</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am walking`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">eat</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`I am eating`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> () &#123;</span><br><span class="line">    <span class="variable language_">super</span>(<span class="string">&#x27;dog&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  run () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I can run&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然 ES6 在类的定义上仅是 ES5 定义类的语法糖，但是从开发者的角度而言，开发更有效率了，代码可阅读性大大提升。</p>
<h5 id="练习-2">练习</h5>
<ol>
<li>请实现一个堆栈类，具备 push、pop 功能。</li>
<li>请回忆下自己在业务中有哪些场景可以用类来实现。</li>
</ol>
<h5 id="推荐阅读-8">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes">类</a></li>
<li><a href="https://googlechrome.github.io/samples/classes-es6/">Classes (ES6) Sample</a></li>
<li><a href="https://www.kancloud.cn/kancloud/you-dont-know-js-this-object-prototypes/516675">ES6 class</a></li>
<li><a href="https://exploringjs.com/es6/ch_classes.html#sec_private-data-for-classes">Classes</a></li>
</ul>
<h4 id="Symbol-2">Symbol</h4>
<p>ES6 引入了一种新的原始数据类型 <code>Symbol</code> ，表示独一无二的值。它是 JavaScript 语言的第七种数据类型，前六种是：undefined、null、布尔值（Boolean）、字符串（String）、数值（Number）、对象（Object）。</p>
<p>Symbol 值通过Symbol函数生成。这就是说，对象的属性名现在可以有两种类型，一种是原来就有的字符串，另一种就是新增的 Symbol 类型。凡是属性名属于 Symbol 类型，就都是独一无二的，可以保证不会与其他属性名产生冲突。</p>
<h5 id="声明方式">声明方式</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">typeof</span> s</span><br><span class="line"><span class="comment">// &quot;symbol&quot;</span></span><br></pre></td></tr></table></figure>
<p>变量s就是一个独一无二的值。typeof的结果说明s是 Symbol 数据类型。</p>
<p>既然是独一无二的，那么两个Symbol()就一定是不相等的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>Symbol函数前不能使用new命令，否则会报错。这是因为生成的 Symbol 是一个原始类型的值，不是对象。也就是说，由于 Symbol 值不是对象，所以不能添加属性。基本上，它是一种类似于字符串的数据类型。</p>
<p>Symbol函数可以接受一个字符串作为参数，表示对 Symbol 实例的描述，主要是为了在控制台显示，或者转为字符串时，比较容易区分。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s2)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h5 id="Symbol-for">Symbol.for()</h5>
<p><code>Symbol.for()</code> 接受一个字符串作为参数，然后搜索有没有以该参数作为名称的 Symbol 值。如果有，就返回这个 Symbol 值，否则就新建一个以该字符串为名称的 Symbol 值，并将其注册到全局。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s1 === s2) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>Symbol.for()与Symbol()这两种写法，都会生成新的 Symbol。它们的区别是，前者会被登记在全局环境中供搜索，后者不会。Symbol.for()不会每次调用就返回一个新的 Symbol 类型的值，而是会先检查给定的key是否已经存在，如果不存在才会新建一个值。</p>
</blockquote>
<h5 id="Symbol-keyFor">Symbol.keyFor()</h5>
<p>Symbol.keyFor()方法返回一个已登记的 Symbol 类型值的key。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s1)) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s2)) <span class="comment">// foo</span></span><br></pre></td></tr></table></figure>
<h5 id="作为属性名">作为属性名</h5>
<p>由于每一个 Symbol 值都是不相等的，这意味着 Symbol 值可以作为标识符，用于对象的属性名，就能保证不会出现同名的属性。这对于一个对象由多个模块构成的情况非常有用，能防止某一个键被不小心改写或覆盖。</p>
<p>比如在一个班级中，可能会有同学名字相同的情况，这时候使用对象来描述学生信息的时候，如果直接使用学生姓名作为key会有有问题。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> grade = &#123;</span><br><span class="line">    张三: &#123;</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&#x27;111&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    李四: &#123;</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&#x27;yyy&#x27;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&#x27;222&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    李四: &#123;</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&#x27;zzz&#x27;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&#x27;333&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(grade)</span><br><span class="line"><span class="comment">// 只会保留最后一个李四</span></span><br></pre></td></tr></table></figure>
<p>如果使用Symbol，同名的学生信息就不会被覆盖：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> stu1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;李四&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> stu2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;李四&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> grade = &#123;</span><br><span class="line">    [stu1]: &#123;</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&#x27;yyy&#x27;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&#x27;222&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    [stu2]: &#123;</span><br><span class="line">        <span class="attr">address</span>: <span class="string">&#x27;zzz&#x27;</span>,</span><br><span class="line">        <span class="attr">tel</span>: <span class="string">&#x27;333&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(grade)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(grade[stu1])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(grade[stu2])</span><br></pre></td></tr></table></figure>
<h5 id="属性遍历">属性遍历</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sym = <span class="title class_">Symbol</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">        <span class="variable language_">this</span>[sym] = <span class="string">&#x27;xxx.com&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span> + <span class="variable language_">this</span>[sym]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;xiecheng&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="title function_">getName</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(user)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(user)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(user)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="消除魔术字符串">消除魔术字符串</h5>
<p>魔术字符串指的是，在代码之中多次出现、与代码形成强耦合的某一个具体的字符串或者数值。风格良好的代码，应该尽量消除魔术字符串，改由含义清晰的变量代替。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">shape</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> area = <span class="number">0</span></span><br><span class="line">    <span class="keyword">switch</span> (shape) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;Triangle&#x27;</span>:</span><br><span class="line">            area = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;Circle&#x27;</span>:</span><br><span class="line">            area = <span class="number">2</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> area</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getArea</span>(<span class="string">&#x27;Triangle&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>上面代码中，字符串Triangle和Circle就是魔术字符串。它多次出现，与代码形成“强耦合”，不利于将来的修改和维护。</p>
<p>使用Symbol就可以很好的解决这个问题：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> shapeType = &#123;</span><br><span class="line">    <span class="attr">triangle</span>: <span class="title class_">Symbol</span>(),</span><br><span class="line">    <span class="attr">circle</span>: <span class="title class_">Symbol</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getArea</span>(<span class="params">shape</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> area = <span class="number">0</span></span><br><span class="line">    <span class="keyword">switch</span> (shape) &#123;</span><br><span class="line">        <span class="keyword">case</span> shapeType.<span class="property">triangle</span>:</span><br><span class="line">            area = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> shapeType.<span class="property">circle</span>:</span><br><span class="line">            area = <span class="number">2</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> area</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getArea</span>(shapeType.<span class="property">triangle</span>))</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-9">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Symbol">Symbol</a></li>
</ul>
<h4 id="Set">Set</h4>
<p>在 JavaScript 里通常使用 Array 或 Object 来存储数据。但是在频繁操作数据的过程中查找或者统计并需要手动来实现，并不能简单的直接使用。 比如如何保证 Array 是去重的，如何统计 Object 的数据总数等，必须自己去手动实现类似的需求，不是很方便。 在 ES6 中为了解决上述痛点，新增了数据结构 Set 和 Map，它们分别对应传统数据结构的“集合”和“字典”。首先，我们先来学习下 Set 数据结构。</p>
<p>ES6 提供了新的数据结构 Set。它类似于数组，但是成员的值都是唯一的，没有重复的值。</p>
<h5 id="生成-Set-实例">生成 Set 实例</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br></pre></td></tr></table></figure>
<p>可以定义一个空的 Set 实例，也可以在实例化的同时传入默认的数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>初始化的参数必须是可遍历的，可以是数组或者自定义遍历的数据结构。</p>
<h5 id="添加数据">添加数据</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">s.<span class="title function_">add</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">s.<span class="title function_">add</span>(<span class="string">&#x27;goodbye&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">s.<span class="title function_">add</span>(<span class="string">&#x27;hello&#x27;</span>).<span class="title function_">add</span>(<span class="string">&#x27;goodbye&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>Set 数据结构不允许数据重复，所以添加重复的数据是无效的</p>
<h5 id="删除数据">删除数据</h5>
<p>删除数据分两种，一种是删除指定的数据，一种是删除全部数据。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除指定数据</span></span><br><span class="line">s.<span class="title function_">delete</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 删除全部数据</span></span><br><span class="line">s.<span class="title function_">clear</span>()</span><br></pre></td></tr></table></figure>
<h5 id="统计数据">统计数据</h5>
<p>Set 可以快速进行统计数据，如数据是否存在、数据的总数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 判断是否包含数据项，返回 true 或 false</span></span><br><span class="line">s.<span class="title function_">has</span>(<span class="string">&#x27;hello&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 计算数据项总数</span></span><br><span class="line">s.<span class="property">size</span> <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h5 id="数组去重">数组去重</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>(arr)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s)</span><br></pre></td></tr></table></figure>
<h5 id="合并去重">合并去重</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="keyword">let</span> s = <span class="keyword">new</span> <span class="title class_">Set</span>([...arr1, ...arr2])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...s])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(s))</span><br></pre></td></tr></table></figure>
<h5 id="交集">交集</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s1 = <span class="keyword">new</span> <span class="title class_">Set</span>(arr1)</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="keyword">new</span> <span class="title class_">Set</span>(arr2)</span><br><span class="line"><span class="keyword">let</span> result = <span class="keyword">new</span> <span class="title class_">Set</span>(arr1.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> s2.<span class="title function_">has</span>(item)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Array</span>.<span class="title function_">from</span>(result))</span><br></pre></td></tr></table></figure>
<h5 id="差集">差集</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr3 = <span class="keyword">new</span> <span class="title class_">Set</span>(arr1.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> !s2.<span class="title function_">has</span>(item)))</span><br><span class="line"><span class="keyword">let</span> arr4 = <span class="keyword">new</span> <span class="title class_">Set</span>(arr2.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> !s1.<span class="title function_">has</span>(item)))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr3)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr4)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...arr3, ...arr4])</span><br></pre></td></tr></table></figure>
<h5 id="遍历方式">遍历方式</h5>
<ul>
<li>keys()：返回键名的遍历器</li>
<li>values()：返回键值的遍历器</li>
<li>entries()：返回键值对的遍历器</li>
<li>forEach()：使用回调函数遍历每个成员</li>
<li>for…of：可以直接遍历每个成员</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">keys</span>()) <span class="comment">// SetIterator &#123;&quot;hello&quot;, &quot;goodbye&quot;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">values</span>()) <span class="comment">// SetIterator &#123;&quot;hello&quot;, &quot;goodbye&quot;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="title function_">entries</span>()) <span class="comment">// SetIterator &#123;&quot;hello&quot; =&gt; &quot;hello&quot;, &quot;goodbye&quot; =&gt; &quot;goodbye&quot;&#125;</span></span><br><span class="line">s.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item) <span class="comment">// hello // goodbye</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> s) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> s.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> s.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> s.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item[<span class="number">0</span>], item[<span class="number">1</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>不理解 SetIterator 没关系，后面会讲遍历器，耐心一点！</p>
</blockquote>
<h5 id="WeakSet">WeakSet</h5>
<p>WeakSet 结构与 Set 类似，也是不重复的值的集合。但是，它与 Set 有两个区别。</p>
<p>WeakSet 的成员只能是对象，而不能是其他类型的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WeakSet</span>()</span><br><span class="line">ws.<span class="title function_">add</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used in weak set</span></span><br><span class="line">ws.<span class="title function_">add</span>(<span class="title class_">Symbol</span>())</span><br><span class="line"><span class="comment">// TypeError: invalid value used in weak set</span></span><br><span class="line"><span class="keyword">let</span> ws = <span class="keyword">new</span> <span class="title class_">WeakSet</span>()</span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">ws.<span class="title function_">add</span>(obj1)</span><br><span class="line">ws.<span class="title function_">add</span>(obj2)</span><br><span class="line">ws.<span class="title function_">delete</span>(obj1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ws)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ws.<span class="title function_">has</span>(obj2))</span><br></pre></td></tr></table></figure>
<p>WeakSet 没有size属性，没有办法遍历它的成员。</p>
<p>WeakSet 中的对象都是弱引用，即垃圾回收机制不考虑 WeakSet 对该对象的引用，也就是说，如果其他对象都不再引用该对象，那么垃圾回收机制会自动回收该对象所占用的内存，不考虑该对象还存在于 WeakSet 之中。</p>
<h5 id="推荐阅读-10">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a></li>
</ul>
<h4 id="Map">Map</h4>
<p>ES6 提供了 Map 数据结构。它类似于对象，也是键值对的集合，但是“键”的范围不限于字符串，各种类型的值（包括对象）都可以当作键。也就是说，Object 结构提供了“字符串—值”的对应，Map 结构提供了“值—值”的对应，是一种更完善的 Hash 结构实现。如果你需要“键值对”的数据结构，Map 比 Object 更合适。</p>
<h5 id="实例化">实例化</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([iterable])</span><br></pre></td></tr></table></figure>
<p>Iterable 可以是一个数组或者其他 iterable 对象，其元素为键值对(两个元素的数组，例如: [[ 1, ‘one’ ], [ 2, ‘two’ ]])。 每个键值对都会添加到新的 Map。null 会被当做 undefined。</p>
<h5 id="添加数据-2">添加数据</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> keyObj = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> keyFunc = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> keyString = <span class="string">&#x27;a string&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加键</span></span><br><span class="line">map.<span class="title function_">set</span>(keyString, <span class="string">&quot;和键&#x27;a string&#x27;关联的值&quot;</span>)</span><br><span class="line">map.<span class="title function_">set</span>(keyObj, <span class="string">&#x27;和键keyObj关联的值&#x27;</span>)</span><br><span class="line">map.<span class="title function_">set</span>(keyFunc, <span class="string">&#x27;和键keyFunc关联的值&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="删除数据-2">删除数据</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除指定的数据</span></span><br><span class="line">map.<span class="title function_">delete</span>(keyObj)</span><br><span class="line"><span class="comment">// 删除所有数据</span></span><br><span class="line">map.<span class="title function_">clear</span>()</span><br></pre></td></tr></table></figure>
<h5 id="统计数据-2">统计数据</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 统计所有 key-value 的总数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>) <span class="comment">//2</span></span><br><span class="line"><span class="comment">// 判断是否有 key-value</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">has</span>(keyObj)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="查询数据">查询数据</h5>
<ul>
<li>get() 方法返回某个 Map 对象中的一个指定元素</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(keyObj)) <span class="comment">// 和键keyObj关联的值</span></span><br></pre></td></tr></table></figure>
<h5 id="遍历方式-2">遍历方式</h5>
<ul>
<li>keys() 返回一个新的 Iterator 对象。它包含按照顺序插入 Map 对象中每个元素的 key 值</li>
<li>values() 方法返回一个新的 Iterator 对象。它包含按顺序插入Map对象中每个元素的 value 值</li>
<li>entries() 方法返回一个新的包含 [key, value] 对的 Iterator ? 对象，返回的迭代器的迭代顺序与 Map 对象的插入顺序相同</li>
<li>forEach() 方法将会以插入顺序对 Map 对象中的每一个键值对执行一次参数中提供的回调函数</li>
<li>for…of 可以直接遍历每个成员</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">map.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, key</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value, key))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> map.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> map.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实 Object 也是按键值对存储和读取的，那么他俩之间除了我们之前说的区别以外还有其他的吗？</p>
<ul>
<li>
<p><strong>键的类型</strong></p>
<p>一个Object的键只能是字符串或者 Symbols，但一个 Map 的键可以是任意值，包括函数、对象、基本类型。</p>
</li>
<li>
<p><strong>键的顺序</strong></p>
<p>Map 中的键值是有序的，而添加到对象中的键则不是。因此，当对它进行遍历时，Map 对象是按插入的顺序返回键值。</p>
</li>
<li>
<p><strong>键值对的统计</strong></p>
<p>你可以通过 size 属性直接获取一个 Map 的键值对个数，而 Object 的键值对个数只能手动计算。</p>
</li>
<li>
<p><strong>键值对的遍历</strong></p>
<p>Map 可直接进行迭代，而 Object 的迭代需要先获取它的键数组，然后再进行迭代。</p>
</li>
<li>
<p><strong>性能</strong></p>
<p>Map 在涉及频繁增删键值对的场景下会有些性能优势。</p>
</li>
</ul>
<h5 id="WeakMap">WeakMap</h5>
<p>WeakMap结构与Map结构类似，也是用于生成键值对的集合。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// WeakMap 可以使用 set 方法添加成员</span></span><br><span class="line"><span class="keyword">const</span> wm1 = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">const</span> key = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">wm1.<span class="title function_">set</span>(key, <span class="number">2</span>)</span><br><span class="line">wm1.<span class="title function_">get</span>(key) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WeakMap 也可以接受一个数组，</span></span><br><span class="line"><span class="comment">// 作为构造函数的参数</span></span><br><span class="line"><span class="keyword">const</span> k1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> k2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"><span class="keyword">const</span> wm2 = <span class="keyword">new</span> <span class="title class_">WeakMap</span>([</span><br><span class="line">    [k1, <span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">    [k2, <span class="string">&#x27;bar&#x27;</span>]</span><br><span class="line">])</span><br><span class="line">wm2.<span class="title function_">get</span>(k2) <span class="comment">// &quot;bar&quot;</span></span><br></pre></td></tr></table></figure>
<p>WeakMap与Map的区别有两点。</p>
<ul>
<li>WeakMap只接受对象作为键名（null除外），不接受其他类型的值作为键名。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line">map.<span class="title function_">set</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: 1 is not an object!</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="title class_">Symbol</span>(), <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// TypeError: Invalid value used as weak map key</span></span><br></pre></td></tr></table></figure>
<ul>
<li>WeakMap的键名所指向的对象，不计入垃圾回收机制。</li>
</ul>
<h5 id="推荐阅读-11">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></li>
</ul>
<h4 id="String扩展">String扩展</h4>
<h5 id="Unicode表示法">Unicode表示法</h5>
<p>ES6 加强了对 Unicode 的支持，允许采用\uxxxx形式表示一个字符，其中xxxx表示字符的 Unicode 码点。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\u0061&quot;</span></span><br><span class="line"><span class="comment">// &quot;a&quot;</span></span><br></pre></td></tr></table></figure>
<p>但是，这种表示法只限于码点在\u0000~\uFFFF之间的字符。超出这个范围的字符，必须用两个双字节的形式表示。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\uD842\uDFB7&quot;</span></span><br><span class="line"><span class="comment">// &quot;𠮷&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;\u20BB7&quot;</span></span><br><span class="line"><span class="comment">// &quot; 7&quot;</span></span><br></pre></td></tr></table></figure>
<p>上面代码表示，如果直接在\u后面跟上超过0xFFFF的数值（比如\u20BB7），JavaScript 会理解成\u20BB+7。由于\u20BB是一个不可打印字符，所以只会显示一个空格，后面跟着一个7。</p>
<p>ES6 对这一点做出了改进，只要将码点放入大括号，就能正确解读该字符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\u&#123;20BB7&#125;&quot;</span></span><br><span class="line"><span class="comment">// &quot;𠮷&quot;</span></span><br></pre></td></tr></table></figure>
<p>有了这种表示法之后，JavaScript 共有 6 种方法可以表示一个字符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;\z&#x27;</span> === <span class="string">&#x27;z&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;\172&#x27;</span> === <span class="string">&#x27;z&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;\x7A&#x27;</span> === <span class="string">&#x27;z&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;\u007A&#x27;</span> === <span class="string">&#x27;z&#x27;</span> <span class="comment">// true</span></span><br><span class="line"><span class="string">&#x27;\u&#123;7A&#125;&#x27;</span> === <span class="string">&#x27;z&#x27;</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="遍历器接口">遍历器接口</h5>
<p>ES6 为字符串添加了遍历器接口，详见Iterator一节，使得字符串可以被for…of循环遍历。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="string">&#x27;xxx&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="模板字符串">模板字符串</h5>
<p>在 ES6 之前对字符串的处理是相当的麻烦，看如下场景：</p>
<p><strong>1. 字符串很长要换行</strong></p>
<p>字符串很长包括几种情形一个是开发时输入的文本内容，一个是接口数据返回的文本内容。如果对换行符处理不当，就会带来异常。</p>
<p><strong>2. 字符串中有变量或者表达式</strong></p>
<p>如果字符串不是静态内容，往往是需要加载变量或者表达式，这个也是很常见的需求。之前的做法是字符串拼接：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="string">&#x27;JavaScript&#x27;</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;My age is &#x27;</span> + (a + b) + <span class="string">&#x27; and I love &#x27;</span> + c</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br></pre></td></tr></table></figure>
<p>如果字符串有大量的变量和表达式，这个拼接简直是噩梦。</p>
<p><strong>3. 字符串中有逻辑运算</strong></p>
<p>我们通常写代码都是有逻辑运算的，对于字符串也是一样，它包含的内容不是静态的，通常是根据一定的规则在动态变化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> retailPrice = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> wholesalePrice = <span class="number">16</span></span><br><span class="line"><span class="keyword">var</span> type = <span class="string">&#x27;retail&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> showTxt = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (type === <span class="string">&#x27;retail&#x27;</span>) &#123;</span><br><span class="line">    showTxt += <span class="string">&#x27;您此次的购买单价是：&#x27;</span> + retailPrice</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    showTxt += <span class="string">&#x27;您此次的批发价是：&#x27;</span> + wholesalePrice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这样的代码一定会感到很熟悉，通常大家的做法是使用上述的字符串拼接+逻辑判断，或者采用字符串模板类库来操作。</p>
<h5 id="String-Literals">String Literals</h5>
<p>看了上述的应用场景，就要引入 String Literals 话题，这个是用来解决字符串拼接问题，从 ES6 开始可以这样定义字符串了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">`string text`</span> </span><br><span class="line"></span><br><span class="line"><span class="string">`string text line 1</span></span><br><span class="line"><span class="string"> string text line 2`</span></span><br><span class="line"></span><br><span class="line"><span class="string">`string text <span class="subst">$&#123;expression&#125;</span> string text`</span> </span><br></pre></td></tr></table></figure>
<p>在这里你可以任意插入变量或者表达式，只要用 ```${}` ``包起来就好。</p>
<p>注意</p>
<p>这里的符号是反引号，也就是数字键 1 左边的键，不是单引号或者双引号</p>
<p>这样就可以轻松解决字符串包含变量或者表达式的问题了，对于多行的字符串，之前是这样处理</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;string text line 1\n&#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;string text line 2&#x27;</span>)</span><br><span class="line"><span class="comment">// &quot;string text line 1</span></span><br><span class="line"><span class="comment">// string text line 2&quot;</span></span><br></pre></td></tr></table></figure>
<p>现在可以这样做了</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`string text line 1</span></span><br><span class="line"><span class="string">string text line 2`</span>)</span><br><span class="line"><span class="comment">// &quot;string text line 1</span></span><br><span class="line"><span class="comment">// string text line 2&quot;</span></span><br></pre></td></tr></table></figure>
<p>完全不需要 ```\n` ``来参与。</p>
<h5 id="Tag-Literals">Tag Literals</h5>
<p>前面的字符串字面量解决了字符串拼接的问题，对于包含复杂逻辑的字符串并不是简单的表达式能搞定的。所以需要另一种解决方案：Tag Literals，还是看上述那个例子:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> retailPrice = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> wholesalePrice = <span class="number">16</span></span><br><span class="line"><span class="keyword">var</span> type = <span class="string">&#x27;retail&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> showTxt = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (type === <span class="string">&#x27;retail&#x27;</span>) &#123;</span><br><span class="line">    showTxt += <span class="string">&#x27;您此次的购买单价是：&#x27;</span> + retailPrice</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    showTxt += <span class="string">&#x27;您此次的批发价是：&#x27;</span> + wholesalePrice</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在可以定义一个 Tag 函数，然后用这个 Tag 函数来充当一个模板引擎：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Price</span>(<span class="params">strings, type</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> s1 = strings[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">const</span> retailPrice = <span class="number">20</span></span><br><span class="line">    <span class="keyword">const</span> wholesalePrice = <span class="number">16</span></span><br><span class="line">    <span class="keyword">let</span> txt = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">&#x27;retail&#x27;</span>) &#123;</span><br><span class="line">        txt = <span class="string">`购买单价是：<span class="subst">$&#123;retailPrice&#125;</span>`</span> </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        txt = <span class="string">`批发价是：<span class="subst">$&#123;wholesalePrice&#125;</span>`</span> </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;s1&#125;</span><span class="subst">$&#123;txt&#125;</span>`</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> showTxt = <span class="title class_">Price</span> <span class="string">`您此次的<span class="subst">$&#123;<span class="string">&#x27;retail&#x27;</span>&#125;</span>`</span> </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(showTxt) <span class="comment">//您此次的购买单价是：20</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>strings 参数指的是 Tag 函数后面被变量分割开的字符串集合，type 参数是对应第一个变量，Tag 函数可以有多个 type 类似的参数</p>
</blockquote>
<h5 id="扩展方法">扩展方法</h5>
<h6 id="String-prototype-fromCodePoint">String.prototype.fromCodePoint()</h6>
<p>用于从 Unicode 码点返回对应字符，并且可以识别大于0xFFFF的字符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="number">0x20BB7</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>.<span class="title function_">fromCodePoint</span>(<span class="number">0x20BB7</span>))</span><br></pre></td></tr></table></figure>
<h6 id="String-prototype-includes">String.prototype.includes()</h6>
<p>ES5中可以使用indexOf方法来判断一个字符串是否包含在另一个字符串中，indexOf返回出现的下标位置，如果不存在则返回-1。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">indexOf</span>(<span class="string">&#x27;mo&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>ES6提供了includes方法来判断一个字符串是否包含在另一个字符串中，返回boolean类型的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">includes</span>(<span class="string">&#x27;mo&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h6 id="String-prototype-startsWith">String.prototype.startsWith()</h6>
<p>判断参数字符串是否在原字符串的头部, 返回boolean类型的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">startsWith</span>(<span class="string">&#x27;im&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h6 id="String-prototype-endsWith">String.prototype.endsWith()</h6>
<p>判断参数字符串是否在原字符串的尾部, 返回boolean类型的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">endsWith</span>(<span class="string">&#x27;mooc&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h6 id="String-prototype-repeat">String.prototype.repeat()</h6>
<p>repeat方法返回一个新字符串，表示将原字符串重复n次。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newStr = str.<span class="title function_">repeat</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newStr)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-12">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings">模板字符串</a></li>
<li><a href="https://flaviocopes.com/javascript-template-literals/">A guide to JavaScript Template Literals</a></li>
</ul>
<h4 id="RegExp">RegExp</h4>
<h5 id="y修饰符">y修饰符</h5>
<p>ES6为正则表达式添加了y修饰符，叫做“粘连”（sticky）修饰符。</p>
<p>y修饰符的作用与g修饰符类似，也是全局匹配，后一次匹配都从上一次匹配成功的下一个位置开始。不同之处在于，g修饰符只要剩余位置中存在匹配就可，而y修饰符确保匹配必须从剩余的第一个位置开始，这也就是“粘连”的涵义。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;aaa_aa_a&#x27;</span></span><br><span class="line"><span class="keyword">const</span> r1 = <span class="regexp">/a+/g</span></span><br><span class="line"><span class="keyword">const</span> r2 = <span class="regexp">/a+/y</span></span><br><span class="line"></span><br><span class="line">r1.<span class="title function_">exec</span>(s) <span class="comment">// [&quot;aaa&quot;]</span></span><br><span class="line">r2.<span class="title function_">exec</span>(s) <span class="comment">// [&quot;aaa&quot;]</span></span><br><span class="line"></span><br><span class="line">r1.<span class="title function_">exec</span>(s) <span class="comment">// [&quot;aa&quot;]</span></span><br><span class="line">r2.<span class="title function_">exec</span>(s) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>上面代码有两个正则表达式，一个使用g修饰符，另一个使用y修饰符。这两个正则表达式各执行了两次，第一次执行的时候，两者行为相同，剩余字符串都是_aa_a。由于g修饰没有位置要求，所以第二次执行会返回结果，而y修饰符要求匹配必须从头部开始，所以返回null。</p>
<p>如果改一下正则表达式，保证每次都能头部匹配，y修饰符就会返回结果了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;aaa_aa_a&#x27;</span></span><br><span class="line"><span class="keyword">const</span> r = <span class="regexp">/a+_/y</span></span><br><span class="line"></span><br><span class="line">r.<span class="title function_">exec</span>(s) <span class="comment">// [&quot;aaa_&quot;]</span></span><br><span class="line">r.<span class="title function_">exec</span>(s) <span class="comment">// [&quot;aa_&quot;]</span></span><br></pre></td></tr></table></figure>
<p>上面代码每次匹配，都是从剩余字符串的头部开始。</p>
<p>使用lastIndex属性，可以更好地说明y修饰符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="regexp">/a/g</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定从2号位置（y）开始匹配</span></span><br><span class="line">regexp.<span class="property">lastIndex</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配成功</span></span><br><span class="line"><span class="keyword">const</span> match = regexp.<span class="title function_">exec</span>(<span class="string">&#x27;xaya&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在3号位置匹配成功</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match.<span class="property">index</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下一次匹配从4号位开始</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(regexp.<span class="property">lastIndex</span>) <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4号位开始匹配失败</span></span><br><span class="line">regexp.<span class="title function_">exec</span>(<span class="string">&#x27;xaxa&#x27;</span>) <span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，lastIndex属性指定每次搜索的开始位置，g修饰符从这个位置开始向后搜索，直到发现匹配为止。</p>
<p>y修饰符同样遵守lastIndex属性，但是要求必须在lastIndex指定的位置发现匹配。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="regexp">/a/y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定从2号位置开始匹配</span></span><br><span class="line">regexp.<span class="property">lastIndex</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不是粘连，匹配失败</span></span><br><span class="line">regexp.<span class="title function_">exec</span>(<span class="string">&#x27;xaya&#x27;</span>) <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定从3号位置开始匹配</span></span><br><span class="line">regexp.<span class="property">lastIndex</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3号位置是粘连，匹配成功</span></span><br><span class="line"><span class="keyword">const</span> match = regexp.<span class="title function_">exec</span>(<span class="string">&#x27;xaxa&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(match.<span class="property">index</span>) <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(regexp.<span class="property">lastIndex</span>) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>进一步说，y修饰符号隐含了头部匹配的标志^。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/b/y</span></span><br><span class="line">reg.<span class="title function_">exec</span>(<span class="string">&#x27;aba&#x27;</span>)</span><br><span class="line"><span class="comment">// null</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(reg.<span class="property">lastIndex</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>sticky 模式在正则匹配过程中只会影响两件事：</p>
<ul>
<li>匹配必须从 re.lastIndex 开始（相当于正则表达中的 ^）</li>
<li>如果匹配到会修改 re.lastIndex（相当于 g 模式）</li>
</ul>
</blockquote>
<h5 id="u修饰符">u修饰符</h5>
<p>ES6为正则表达式添加了u修饰符，含义为“Unicode模式”，用来正确处理大于 <code>\uFFFF</code> 的Unicode字符。也就是说，会正确处理四个字节的UTF-16编码。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^\uD83D/u.<span class="title function_">test</span>(<span class="string">&#x27;\uD83D\uDC2A&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/^\uD83D/.<span class="title function_">test</span>(<span class="string">&#x27;\uD83D\uDC2A&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面代码中， <code>\uD83D\uDC2A</code> 是一个四个字节的UTF-16编码，代表一个字符 “🐪”。但是，ES5不支持四个字节的UTF-16编码，会将其识别为两个字符，导致第二行代码结果为true。加了u修饰符以后，ES6就会识别其为一个字符，所以第一行代码结果为false。</p>
<p>一旦加上u修饰符号，就会修改下面这些正则表达式的行为。</p>
<h5 id="点字符">点字符</h5>
<p>点（.）字符在正则表达式中，含义是除了换行符以外的任意单个字符。对于码点大于 0xFFFF 的 Unicode 字符，点字符不能识别，必须加上u修饰符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="string">&#x27;𠮷&#x27;</span></span><br><span class="line"></span><br><span class="line">/^.<span class="property">$</span>/.<span class="title function_">test</span>(s) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/^.<span class="property">$</span>/u.<span class="title function_">test</span>(s) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面代码表示，如果不添加u修饰符，正则表达式就会认为字符串为两个字符，从而匹配失败。</p>
<blockquote>
<p>TIP</p>
<p>'𠮷’这个字读 jí，是’吉’字的异形体，Unicode 码点 <a href="https://www.fileformat.info/info/unicode/char/20bb7/index.htm">U+20BB7</a></p>
</blockquote>
<h5 id="Unicode字符表示法">Unicode字符表示法</h5>
<p>ES6新增了使用大括号表示Unicode字符，这种表示法在正则表达式中必须加上u修饰符，才能识别。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/\u&#123;<span class="number">61</span>&#125;/.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/\u&#123;<span class="number">61</span>&#125;/u.<span class="title function_">test</span>(<span class="string">&#x27;a&#x27;</span>) / / <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">/\u&#123;20BB7&#125;/u.<span class="title function_">test</span>(<span class="string">&#x27;𠮷&#x27;</span>) / / <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>上面代码表示，如果不加u修饰符，正则表达式无法识别\u{61}这种表示法，只会认为这匹配61个连续的u。</p>
<h5 id="量词">量词</h5>
<p>使用u修饰符后，所有量词都会正确识别码点大于0xFFFF的Unicode字符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/a&#123;<span class="number">2</span>&#125;/.<span class="title function_">test</span>(<span class="string">&#x27;aa&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">/a&#123;<span class="number">2</span>&#125;/u.<span class="title function_">test</span>(<span class="string">&#x27;aa&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">/𠮷&#123;<span class="number">2</span>&#125;/.<span class="title function_">test</span>(<span class="string">&#x27;𠮷𠮷&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/𠮷&#123;<span class="number">2</span>&#125;/u.<span class="title function_">test</span>(<span class="string">&#x27;𠮷𠮷&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>另外，只有在使用u修饰符的情况下，Unicode表达式当中的大括号才会被正确解读，否则会被解读为量词。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^\u&#123;<span class="number">3</span>&#125;$/.<span class="title function_">test</span>(<span class="string">&#x27;uuu&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，由于正则表达式没有u修饰符，所以大括号被解读为量词。加上u修饰符，就会被解读为Unicode表达式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/\u&#123;20BB7&#125;&#123;<span class="number">2</span>&#125;/u.<span class="title function_">test</span>(<span class="string">&#x27;𠮷𠮷&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>使用 u 修饰符之后 Unicode 表达式+量词也是可以的。</p>
<h5 id="预定义模式">预定义模式</h5>
<p>u修饰符也影响到预定义模式，能否正确识别码点大于0xFFFF的Unicode字符。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^\S$/.<span class="title function_">test</span>(<span class="string">&#x27;𠮷&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/^\S$/u.<span class="title function_">test</span>(<span class="string">&#x27;𠮷&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面代码的\S是预定义模式，匹配所有不是空格的字符。只有加了u修饰符，它才能正确匹配码点大于0xFFFF的Unicode字符。</p>
<p>利用这一点，可以写出一个正确返回字符串长度的函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">codePointLength</span>(<span class="params">text</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = text.<span class="title function_">match</span>(<span class="regexp">/[\s\S]/gu</span>)</span><br><span class="line">    <span class="keyword">return</span> result ? result.<span class="property">length</span> : <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;𠮷𠮷&#x27;</span></span><br><span class="line"></span><br><span class="line">s.<span class="property">length</span> <span class="comment">// 4</span></span><br><span class="line"><span class="title function_">codePointLength</span>(s) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<h5 id="i修饰符">i修饰符</h5>
<p>有些Unicode字符的编码不同，但是字型很相近，比如，\u004B与\u212A都是大写的K。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/[a-z]/i.<span class="title function_">test</span>(<span class="string">&#x27;\u212A&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">/[a-z]/iu.<span class="title function_">test</span>(<span class="string">&#x27;\u212A&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面代码中，不加u修饰符，就无法识别非规范的K字符。</p>
<h5 id="推荐阅读-13">推荐阅读</h5>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2014/12/unicode.html">Unicode与JavaScript详解</a></li>
<li><a href="http://2ality.com/2015/07/regexp-es6.html">New regular expression features in ECMAScript 6</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky">sticky</a></li>
</ul>
<h4 id="Number-3">Number</h4>
<h5 id="二进制与八进制">二进制与八进制</h5>
<p>请大家思考在JS中如何把十进制转化为二进制？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">5</span> <span class="comment">// 101</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="title function_">toString</span>(<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>如何把二进制转化为十进制？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="number">101</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">parseInt</span>(b, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>ES6 提供了二进制和八进制数值的新的写法，分别用前缀0b（或0B）和0o（或0O）表示。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">0B0101</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="number">0O777</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br></pre></td></tr></table></figure>
<h5 id="新增方法">新增方法</h5>
<h6 id="Number-isFinite">Number.isFinite()</h6>
<p>用来检查一个数值是否为有限的（finite），即不是Infinity。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="number">15</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="number">0.8</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="title class_">NaN</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="title class_">Infinity</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(-<span class="title class_">Infinity</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="string">&#x27;foo&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="string">&#x27;15&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isFinite</span>(<span class="literal">true</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-isNaN">Number.isNaN()</h6>
<p>用来检查一个值是否为NaN。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="title class_">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="number">15</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="string">&#x27;15&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="literal">true</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="number">9</span> / <span class="title class_">NaN</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="string">&#x27;true&#x27;</span> / <span class="number">0</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="string">&#x27;true&#x27;</span> / <span class="string">&#x27;true&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-parseInt">Number.parseInt()</h6>
<p>ES6 将全局方法parseInt()移植到Number对象上面，行为完全保持不变。 这样做的目的，是逐步减少全局性方法，使得语言逐步模块化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="string">&#x27;12.34&#x27;</span>) <span class="comment">// 12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">parseInt</span>(<span class="string">&#x27;12.34&#x27;</span>) <span class="comment">// 12</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-parseFloat">Number.parseFloat()</h6>
<p>ES6 将全局方法parseFloat()移植到Number对象上面，行为完全保持不变。这样做的目的，是逐步减少全局性方法，使得语言逐步模块化。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ES5的写法</span></span><br><span class="line"><span class="built_in">parseFloat</span>(<span class="string">&#x27;123.45#&#x27;</span>) <span class="comment">// 123.45</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的写法</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="built_in">parseFloat</span>(<span class="string">&#x27;123.45#&#x27;</span>) <span class="comment">// 123.45</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-isInteger">Number.isInteger()</h6>
<p>用来判断一个数值是否为整数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="number">25</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="number">25.1</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>() <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="literal">null</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="string">&#x27;15&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="literal">true</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-MAX-SAFE-INTEGER">Number.MAX_SAFE_INTEGER</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span> === <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span> === <span class="number">9007199254740991</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-MIN-SAFE-INTEGER">Number.MIN_SAFE_INTEGER</h6>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Number</span>.<span class="property">MIN_SAFE_INTEGER</span> === -<span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="property">MIN_SAFE_INTEGER</span> === -<span class="number">9007199254740991</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h6 id="Number-isSafeInteger">Number.isSafeInteger()</h6>
<p>JavaScript 能够准确表示的整数范围在-2^53到2^53之间（不含两个端点），超过这个范围，无法精确表示这个值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">53</span>) <span class="comment">// 9007199254740992</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">53</span>) === <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">53</span>) + <span class="number">1</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="Math扩展">Math扩展</h5>
<h6 id="Math-trunc">Math.trunc()</h6>
<p>方法用于去除一个数的小数部分，返回整数部分。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(<span class="number">5.5</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(-<span class="number">5.5</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(<span class="literal">true</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(<span class="literal">false</span>)) <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(<span class="title class_">NaN</span>)) <span class="comment">// NaN</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>(<span class="literal">undefined</span>)) <span class="comment">// NaN</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">trunc</span>()) <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<h6 id="Math-sign">Math.sign()</h6>
<p>方法用来判断一个数到底是正数、负数、还是零。对于非数值，会先将其转换为数值。</p>
<p>它会返回五种值。</p>
<ul>
<li>参数为正数，返回+1</li>
<li>参数为负数，返回-1</li>
<li>参数为 0，返回0</li>
<li>参数为-0，返回-0</li>
<li>其他值，返回NaN</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(<span class="number">5</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(-<span class="number">5</span>)) <span class="comment">// -1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(<span class="number">0</span>)) <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(<span class="title class_">NaN</span>)) <span class="comment">// NaN</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(<span class="literal">true</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">sign</span>(<span class="literal">false</span>)) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<h6 id="Math-cbrt">Math.cbrt()</h6>
<p>方法用于计算一个数的立方根。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">cbrt</span>(<span class="number">8</span>)) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">cbrt</span>(<span class="string">&#x27;xxx&#x27;</span>)) <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<h6 id="推荐阅读-14">推荐阅读</h6>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number">Number</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math">Math</a></li>
</ul>
<h4 id="Proxy">Proxy</h4>
<p>在 ES6 标准中新增的一个非常强大的功能是 Proxy，它可以自定义一些常用行为如查找、赋值、枚举、函数调用等。通过 Proxy 这个名称也可以看出来它包含了“代理”的含义，只要有“代理”的诉求都可以考虑使用 Proxy 来实现。</p>
<h5 id="基本语法">基本语法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler)</span><br></pre></td></tr></table></figure>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">用 Proxy 包装的目标对象（可以是任何类型的对象，包括原生数组，函数，甚至另一个代理）</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">handler</td>
<td style="text-align:center">一个对象，其属性是当执行一个操作时定义代理的行为的函数</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p>MDN 给出的解释偏官方，通俗的讲第一个参数 target 就是用来代理的“对象”，被代理之后它是不能直接被访问的，而 handler 就是实现代理的过程。</p>
<h5 id="拦截操作场景">拦截操作场景</h5>
<p><strong>场景</strong></p>
<p>我们经常读取一个对象的 key-value：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiaoming&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o.<span class="property">name</span>) <span class="comment">// xiaoming</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o.<span class="property">age</span>) <span class="comment">// 20</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o.<span class="property">from</span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>当我们读取 from 的时候返回的是 undefined，因为 o 这个对象中没有这个 key-value。想想看我们在读取数据的时候，这个数据经常是聚合的，当大家没有按照规范来的时候或者数据缺失的情况下，经常会出现这种“乌龙”现象。</p>
<p>如果我们不想在调用 key 的时候返回 undefined，之前的做法是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o.<span class="property">from</span> || <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>如果我们对所有代码都是这种写法，那阅读性和观赏性就不得而知了。值得庆幸的是，ES6 的 Proxy 可以让我们轻松的解决这一问题：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiaoming&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handler = &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">obj, key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">has</span>(obj, key) ? obj[key] : <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(o, handler)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">from</span>)</span><br></pre></td></tr></table></figure>
<p>这个代码是想表达如果 o 对象有这个 key-value 则直接返回，如果没有一律返回 <code>''</code> ，当然这里是自定义，大家可以根据自己的需要来写适合自己业务的规则。</p>
<p>刚才对数据的“读操作”进行了拦截，接下来我们描述下“写操作”进行拦截。</p>
<p><strong>场景 1</strong></p>
<p>从服务端获取的数据希望是只读，不允许在任何一个环节被修改。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// response.data 是 JSON 格式的数据，来自服务端的响应</span></span><br><span class="line"><span class="comment">// 在 ES5 中只能通过遍历把所有的属性设置为只读</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(response.<span class="property">data</span>)) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(response.<span class="property">data</span>, key, &#123;</span><br><span class="line">        <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们使用 Proxy 就简单很多了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="title class_">Proxy</span>(response.<span class="property">data</span>, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>场景 2</strong></p>
<p>对于数据交互而言，校验是不可或缺的一个环境，传统的做法是将校验写在了业务逻辑里，导致代码耦合度较高。如果大家使用 Proxy 就可以将代码设计的非常灵活。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Validator.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (obj, key, value) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Reflect</span>.<span class="title function_">has</span>(key) &amp;&amp; value &gt; <span class="number">20</span>) &#123;</span><br><span class="line">        obj[key] = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Validator</span> <span class="keyword">from</span> <span class="string">&#x27;./Validator&#x27;</span></span><br><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="title class_">Proxy</span>(response.<span class="property">data</span>, &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="title class_">Validator</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>场景 3</strong></p>
<p>如果对读写进行监控，可以这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> validator = &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;age&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value !== <span class="string">&#x27;number&#x27;</span> || <span class="title class_">Number</span>.<span class="built_in">isNaN</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Age must be a number&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (value &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Age must be a positive number&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">27</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(person, validator)</span><br><span class="line">proxy.<span class="property">age</span> = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"><span class="comment">// &lt;- TypeError: Age must be a number</span></span><br><span class="line">proxy.<span class="property">age</span> = <span class="title class_">NaN</span></span><br><span class="line"><span class="comment">// &lt;- TypeError: Age must be a number</span></span><br><span class="line">proxy.<span class="property">age</span> = <span class="number">0</span></span><br><span class="line"><span class="comment">// &lt;- TypeError: Age must be a positive number</span></span><br><span class="line">proxy.<span class="property">age</span> = <span class="number">28</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="property">age</span>)</span><br><span class="line"><span class="comment">// &lt;- 28</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加监控</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>,<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>) <span class="comment">// Uncaught TypeError: Age must be a number</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>场景 4</strong></p>
<p>什么实例一个对象，每个对象都有一个自己的 id 而且只读。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">proxy</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">slice</span>(-<span class="number">8</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">id</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">proxy</span>.<span class="property">id</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="常用拦截操作">常用拦截操作</h5>
<h6 id="get-2">get</h6>
<p>拦截对象属性的读取，比如proxy.foo和proxy[‘foo’]。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line">arr = <span class="keyword">new</span> <span class="title class_">Proxy</span>(arr, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(target, prop)</span></span><br><span class="line">        <span class="keyword">return</span> prop <span class="keyword">in</span> target ? target[prop] : <span class="string">&#x27;error&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">1</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">10</span>])</span><br><span class="line"><span class="keyword">let</span> dict = &#123;</span><br><span class="line">    <span class="string">&#x27;hello&#x27;</span>: <span class="string">&#x27;你好&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;world&#x27;</span>: <span class="string">&#x27;世界&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">dict = <span class="keyword">new</span> <span class="title class_">Proxy</span>(dict, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> prop <span class="keyword">in</span> target ? target[prop] : prop</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dict[<span class="string">&#x27;world&#x27;</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dict[<span class="string">&#x27;xxx&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h6 id="set">set</h6>
<p>拦截对象属性的设置，比如proxy.foo = v或proxy[‘foo’] = v，返回一个布尔值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = []</span><br><span class="line">arr = <span class="keyword">new</span> <span class="title class_">Proxy</span>(arr, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">            target[prop] = val</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">arr.<span class="title function_">push</span>(<span class="number">5</span>)</span><br><span class="line">arr.<span class="title function_">push</span>(<span class="number">6</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">0</span>], arr[<span class="number">1</span>], arr.<span class="property">length</span>)</span><br></pre></td></tr></table></figure>
<h6 id="has">has</h6>
<p>拦截propKey in proxy的操作，返回一个布尔值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> range = &#123;</span><br><span class="line">    <span class="attr">start</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">end</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">range = <span class="keyword">new</span> <span class="title class_">Proxy</span>(range, &#123;</span><br><span class="line">    <span class="title function_">has</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> prop &gt;= target.<span class="property">start</span> &amp;&amp; prop &lt;= target.<span class="property">end</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span> <span class="keyword">in</span> range)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">9</span> <span class="keyword">in</span> range)</span><br></pre></td></tr></table></figure>
<h6 id="ownKeys">ownKeys</h6>
<p>拦截Object.getOwnPropertyNames(proxy)、Object.getOwnPropertySymbols(proxy)、Object.keys(proxy)、for…in循环，返回一个数组。该方法返回目标对象所有自身的属性的属性名，而Object.keys()的返回结果仅包括目标对象自身的可遍历属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    [<span class="title class_">Symbol</span>(<span class="string">&#x27;es&#x27;</span>)]: <span class="string">&#x27;es6&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(obj))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(obj))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj))</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> userinfo = &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span>,</span><br><span class="line">    <span class="attr">_password</span>: <span class="string">&#x27;***&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">userinfo = <span class="keyword">new</span> <span class="title class_">Proxy</span>(userinfo, &#123;</span><br><span class="line">    <span class="title function_">ownKeys</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">filter</span>(<span class="function"><span class="params">key</span> =&gt;</span> !key.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// for (let key in userinfo) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(key)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(userinfo))</span><br></pre></td></tr></table></figure>
<h6 id="deleteProperty">deleteProperty</h6>
<p>拦截delete proxy[propKey]的操作，返回一个布尔值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xiecheng&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">34</span>,</span><br><span class="line">    <span class="attr">_password</span>: <span class="string">&#x27;***&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(user, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;不可访问&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;不可访问&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[prop] = val</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123; <span class="comment">// 拦截删除</span></span><br><span class="line">        <span class="keyword">if</span> (prop.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;不可删除&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">delete</span> target[prop]</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">ownKeys</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">filter</span>(<span class="function"><span class="params">key</span> =&gt;</span> !key.<span class="title function_">startsWith</span>(<span class="string">&#x27;_&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">age</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">_password</span>)</span><br><span class="line">user.<span class="property">age</span> = <span class="number">18</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">age</span>)</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    user.<span class="property">_password</span> = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// delete user.age</span></span><br><span class="line">    <span class="keyword">delete</span> user.<span class="property">_password</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">age</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> user) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="apply-2">apply</h6>
<p>拦截 Proxy 实例作为函数调用的操作，比如proxy(…args)、proxy.call(object, …args)、proxy.apply(…)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">sum</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span></span><br><span class="line">    args.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        num += item</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum = <span class="keyword">new</span> <span class="title class_">Proxy</span>(sum, &#123;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">target, ctx, args</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">target</span>(...args) * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum.<span class="title function_">call</span>(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum.<span class="title function_">apply</span>(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br></pre></td></tr></table></figure>
<h6 id="construct">construct</h6>
<p>拦截 Proxy 实例作为构造函数调用的操作，比如new proxy(…args)。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title class_">User</span> = <span class="keyword">class</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">User</span> = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="title class_">User</span>, &#123;</span><br><span class="line">    <span class="title function_">construct</span>(<span class="params">target, args, newTarget</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;construct&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">target</span>(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&#x27;xxx&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-15">推荐阅读</h5>
<ul>
<li><a href="https://ponyfoo.com/articles/es6-proxies-in-depth">ES6 Proxies in Depth</a></li>
<li><a href="https://lucasfcosta.com/2016/11/15/Meta-Programming-in-JavaScript-Part-Three.html">Meta Programming In JavaScript - Part Three: Proxies and Reflection</a></li>
<li><a href="https://www.sitepoint.com/es6-proxies/">How to Use Proxies</a></li>
<li><a href="https://habr.com/en/post/448214/">ES6 Proxies in practice</a></li>
</ul>
<h4 id="Reflect">Reflect</h4>
<p>Reflect对象与Proxy对象一样，也是 ES6 为了操作对象而提供的新 API。</p>
<h5 id="设计目的">设计目的</h5>
<ul>
<li>将Object属于语言内部的方法放到Reflect上</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> newVal = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;set&#x27;</span>)</span><br><span class="line">        <span class="comment">// this.name = val</span></span><br><span class="line">        newVal = val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">name</span> = <span class="string">&#x27;es&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>修改某些Object方法的返回结果，让其变得更合理</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 老写法</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, property, attributes)</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// failure</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新写法</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(target, property, attributes)) &#123;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// failure</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>让Object操作变成函数行为</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 老写法</span></span><br><span class="line"><span class="string">&#x27;assign&#x27;</span> <span class="keyword">in</span> <span class="title class_">Object</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新写法</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">has</span>(<span class="title class_">Object</span>, <span class="string">&#x27;assign&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Reflect对象的方法与Proxy对象的方法一一对应，只要是Proxy对象的方法，就能在Reflect对象上找到对应的方法。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Proxy</span>(target, &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">target, name, value, receiver</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> success = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, name, value, receiver)</span><br><span class="line">        <span class="keyword">if</span> (success) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;property &#x27;</span> + name + <span class="string">&#x27; on &#x27;</span> + target + <span class="string">&#x27; set to &#x27;</span> + value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> success</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Reflect 是一个内置的对象，它提供拦截 JavaScript 操作的方法，这些方法与处理器对象的方法相同。Reflect不是一个函数对象，因此它是不可构造的。</p>
<p>TIP</p>
<p>与大多数全局对象不同，Reflect没有构造函数。你不能将其与一个new运算符一起使用，或者将Reflect对象作为一个函数来调用。Reflect的所有属性和方法都是静态的（就像Math对象）</p>
<h5 id="常用方法">常用方法</h5>
<h6 id="Reflect-apply">Reflect.apply()</h6>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.apply(target, thisArgument, argumentsList)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">目标函数</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">thisArgument</td>
<td style="text-align:center">target函数调用时绑定的this对象</td>
<td style="text-align:center">N</td>
</tr>
<tr>
<td style="text-align:center">argumentsList</td>
<td style="text-align:center">target函数调用时传入的实参列表，该参数应该是一个类数组的对象</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="title class_">Math</span>.<span class="property">floor</span>, <span class="literal">undefined</span>, [<span class="number">1.75</span>])</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="title class_">String</span>.<span class="property">fromCharCode</span>, <span class="literal">undefined</span>, [<span class="number">104</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>])</span><br><span class="line"><span class="comment">// &quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="title class_">RegExp</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">exec</span>, <span class="regexp">/ab/</span>, [<span class="string">&#x27;confabulation&#x27;</span>]).<span class="property">index</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="string">&#x27;&#x27;</span>.<span class="property">charAt</span>, <span class="string">&#x27;ponies&#x27;</span>, [<span class="number">3</span>])</span><br><span class="line"><span class="comment">// &quot;i&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>ES5 对比</strong></p>
<p>该方法与ES5中Function.prototype.apply()方法类似：调用一个方法并且显式地指定this变量和参数列表(arguments) ，参数列表可以是数组，或类似数组的对象。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">apply</span>.<span class="title function_">call</span>(<span class="title class_">Math</span>.<span class="property">floor</span>, <span class="literal">undefined</span>, [<span class="number">1.75</span>])</span><br></pre></td></tr></table></figure>
<h6 id="Reflect-construct">Reflect.construct()</h6>
<p>Reflect.construct() 方法的行为有点像 new 操作符 构造函数 ， 相当于运行 new target(…args).</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.construct(target, argumentsList[, newTarget])</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">被运行的目标函数</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">argumentsList</td>
<td style="text-align:center">调用构造函数的数组或者伪数组</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">newTarget</td>
<td style="text-align:center">该参数为构造函数， 参考 new.target 操作符，如果没有newTarget参数， 默认和target一样</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<blockquote>
<p>[! WARNING] 如果target或者newTarget不是构造函数，抛出TypeError</p>
</blockquote>
<p>Reflect.construct允许你使用可变的参数来调用构造函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Foo</span>(...args)</span><br><span class="line"><span class="keyword">var</span> obj = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Foo</span>, args)</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> d = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Date</span>, [<span class="number">1776</span>, <span class="number">6</span>, <span class="number">4</span>])</span><br><span class="line">d <span class="keyword">instanceof</span> <span class="title class_">Date</span> <span class="comment">// true</span></span><br><span class="line">d.<span class="title function_">getFullYear</span>() <span class="comment">// 1776</span></span><br></pre></td></tr></table></figure>
<p>如果使用 newTarget 参数，则表示继承了 newTarget 这个超类：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">someConstructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> result = <span class="title class_">Reflect</span>.<span class="title function_">construct</span>(<span class="title class_">Array</span>, [], someConstructor)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getPrototypeOf</span>(result) <span class="comment">// 输出：someConstructor.prototype</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="title function_">isArray</span>(result) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-defineProperty">Reflect.defineProperty()</h6>
<p>静态方法 Reflect.defineProperty() 基本等同于 Object.defineProperty() 方法，唯一不同是返回 Boolean 值。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.defineProperty(target, propertyKey, attributes)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">要定义或修改的属性的名称</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">attributes</td>
<td style="text-align:center">要定义或修改的属性的描述</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> student = &#123;&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(student, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;Mike&#x27;</span></span><br><span class="line">&#125;) <span class="comment">// true</span></span><br><span class="line">student.<span class="property">name</span> <span class="comment">// &quot;Mike&quot;</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-deleteProperty">Reflect.deleteProperty()</h6>
<p>Reflect.deleteProperty 允许你删除一个对象上的属性。返回一个 Boolean 值表示该属性是否被成功删除。它几乎与非严格的 delete operator 相同。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.deleteProperty(target, propertyKey)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">删除属性的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">将被删除的属性的名称</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(obj, <span class="string">&quot;x&quot;</span>) <span class="comment">// true</span></span><br><span class="line">obj <span class="comment">// &#123; y: 2 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(arr, <span class="string">&quot;3&quot;</span>) <span class="comment">// true</span></span><br><span class="line">arr <span class="comment">// [1, 2, 3, , 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果属性不存在，返回 true</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(&#123;&#125;, <span class="string">&quot;foo&quot;</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果属性不可配置，返回 false</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(<span class="title class_">Object</span>.<span class="title function_">freeze</span>(&#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="number">1</span></span><br><span class="line">&#125;), <span class="string">&quot;foo&quot;</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-get">Reflect.get()</h6>
<p>Reflect.get() 方法的工作方式，就像从 object (target[propertyKey]) 中获取属性，但它是作为一个函数执行的。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.get(target, propertyKey[, receiver])</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">需要取值的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">需要获取的值的键值</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">receiver</td>
<td style="text-align:center">如果遇到 getter，此值将提供给目标调用</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Object</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">get</span>(obj, <span class="string">&#x27;x&#x27;</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">get</span>([<span class="string">&#x27;zero&#x27;</span>, <span class="string">&#x27;one&#x27;</span>], <span class="number">1</span>) <span class="comment">// &quot;one&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Proxy with a get handler</span></span><br><span class="line"><span class="keyword">var</span> x = &#123;</span><br><span class="line">    <span class="attr">p</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(x, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">t, k, r</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> k + <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">get</span>(obj, <span class="string">&#x27;foo&#x27;</span>) <span class="comment">// &quot;foobar&quot;</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-getOwnPropertyDescriptor">Reflect.getOwnPropertyDescriptor()</h6>
<p>静态方法 Reflect.getOwnPropertyDescriptor() 与 Object.getOwnPropertyDescriptor() 方法相似。如果在对象中存在，则返回给定的属性的属性描述符，否则返回 undefined。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.getOwnPropertyDescriptor(target, propertyKey)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">需要寻找属性的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">获取自己的属性描述符的属性的名称</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;, <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"><span class="comment">// &#123;value: &quot;hello&quot;, writable: true, enumerable: true, configurable: true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>([], <span class="string">&#x27;length&#x27;</span>)</span><br><span class="line"><span class="comment">// &#123;value: 0, writable: true, enumerable: false, configurable: false&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>对比</strong></p>
<p>如果该方法的第一个参数不是一个对象（一个原始值），那么将造成 TypeError 错误。而对于 Object.getOwnPropertyDescriptor，非对象的第一个参数将被强制转换为一个对象处理。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>(<span class="string">&quot;foo&quot;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// TypeError: &quot;foo&quot; is not non-null object</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(<span class="string">&quot;foo&quot;</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// &#123; value: &quot;f&quot;, writable: false, enumerable: true, configurable: false &#125;</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-getPrototypeOf">Reflect.getPrototypeOf()</h6>
<p>静态方法 Reflect.getPrototypeOf() 与 Object.getPrototypeOf() 方法是一样的。都是返回指定对象的原型（即，内部的 [[Prototype]] 属性的值）。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.getPrototypeOf(target)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<h6 id="Reflect-has">Reflect.has()</h6>
<p>Reflect.has 用于检查一个对象是否拥有某个属性， 相当于in 操作符</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.has(target, propertyKey)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">属性名，需要检查目标对象是否存在此属性</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<h6 id="Reflect-isExtensible">Reflect.isExtensible()</h6>
<p>Reflect.isExtensible 判断一个对象是否可扩展 （即是否能够添加新的属性），它与 Object.isExtensible() 方法一样。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.isExtensible(target)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<h6 id="Reflect-ownKeys">Reflect.ownKeys()</h6>
<p>Reflect.ownKeys 方法返回一个由目标对象自身的属性键组成的数组。它的返回值等同于 Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.ownKeys(target)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(&#123;</span><br><span class="line">    <span class="attr">z</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">x</span>: <span class="number">1</span></span><br><span class="line">&#125;) <span class="comment">// [ &quot;z&quot;, &quot;y&quot;, &quot;x&quot; ]</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>([]) <span class="comment">// [&quot;length&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sym = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;comet&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> sym2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;meteor&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    [sym]: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;str&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;773&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    [sym2]: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;-1&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;8&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;second str&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(obj)</span><br><span class="line"><span class="comment">// [ &quot;0&quot;, &quot;8&quot;, &quot;773&quot;, &quot;str&quot;, &quot;-1&quot;, &quot;second str&quot;, Symbol(comet), Symbol(meteor) ]</span></span><br><span class="line"><span class="comment">// Indexes in numeric order,</span></span><br><span class="line"><span class="comment">// strings in insertion order,</span></span><br><span class="line"><span class="comment">// symbols in insertion order</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-preventExtensions">Reflect.preventExtensions()</h6>
<p>Reflect.preventExtensions 方法阻止新属性添加到对象 例如：防止将来对对象的扩展被添加到对象中)。该方法与 Object.preventExtensions() 方法一致</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.preventExtensions(target)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects are extensible by default.</span></span><br><span class="line"><span class="keyword">var</span> empty = &#123;&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">isExtensible</span>(empty) <span class="comment">// === true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...but that can be changed.</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">preventExtensions</span>(empty)</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">isExtensible</span>(empty) <span class="comment">// === false</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">preventExtensions</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// TypeError: 1 is not an object</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-set">Reflect.set()</h6>
<p>Reflect.set 方法允许你在对象上设置属性。它的作用是给属性赋值并且就像 property accessor 语法一样，但是它是以函数的方式。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.set(target, propertyKey, value[, receiver])</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">propertyKey</td>
<td style="text-align:center">设置的属性的名称</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">value</td>
<td style="text-align:center">设置的值</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">receiver</td>
<td style="text-align:center">如果遇到 setter，this 将提供给目标调用</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Object</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(obj, <span class="string">&quot;prop&quot;</span>, <span class="string">&quot;value&quot;</span>) <span class="comment">// true</span></span><br><span class="line">obj.<span class="property">prop</span> <span class="comment">// &quot;value&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="string">&quot;duck&quot;</span>, <span class="string">&quot;duck&quot;</span>, <span class="string">&quot;duck&quot;</span>]</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(arr, <span class="number">2</span>, <span class="string">&quot;goose&quot;</span>) <span class="comment">// true</span></span><br><span class="line">arr[<span class="number">2</span>] <span class="comment">// &quot;goose&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// It can truncate an array.</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(arr, <span class="string">&quot;length&quot;</span>, <span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line">arr <span class="comment">// [&quot;duck&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// With just one argument, propertyKey and value are &quot;undefined&quot;.</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(obj) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&quot;undefined&quot;</span>)</span><br><span class="line"><span class="comment">// &#123; value: undefined, writable: true, enumerable: true, configurable: true &#125;</span></span><br></pre></td></tr></table></figure>
<h6 id="Reflect-setPrototypeOf">Reflect.setPrototypeOf()</h6>
<p>Reflect.setPrototypeOf 方法改变指定对象的原型 （即，内部的 [[Prototype]] 属性值）</p>
<p><strong>语法</strong></p>
<blockquote>
<p>Reflect.setPrototypeOf(target, prototype)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">target</td>
<td style="text-align:center">获取原型的目标对象</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">prototype</td>
<td style="text-align:center">对象的新原型 （一个对象或 null）</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(&#123;&#125;, <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// It can change an object&#x27;s [[Prototype]] to null.</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(&#123;&#125;, <span class="literal">null</span>) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns false if target is not extensible.</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Object</span>.<span class="title function_">freeze</span>(&#123;&#125;), <span class="literal">null</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns false if it cause a prototype chain cycle.</span></span><br><span class="line"><span class="keyword">var</span> target = &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> proto = <span class="title class_">Object</span>.<span class="title function_">create</span>(target)</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">setPrototypeOf</span>(target, proto) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>对于以上所有 API 第一个参数是 Object 的，如果给定的不是 Object 则抛出一个 TypeError 异常</p>
<h5 id="推荐阅读-16">推荐阅读</h5>
<ul>
<li><a href="https://ponyfoo.com/articles/es6-reflection-in-depth">ES6 Reflection in Depth</a></li>
<li><a href="https://www.stefanjudis.com/today-i-learned/the-global-reflect-object-its-use-cases-and-things-to-watch-out-for/">Reflect Usage</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect">Reflect</a></li>
</ul>
<h4 id="Promise">Promise</h4>
<h5 id="异步操作前置知识">异步操作前置知识</h5>
<h5 id="JS是单线程的">JS是单线程的</h5>
<p>就是同一个时间只能处理一个任务。就类似生活中的去超市排队结账，正常情况下，一位收银员只能为一位顾客结账，其他顾客需要在后面排队等候。</p>
<p>为什么 JS 是单线程的？作为浏览器脚本语言，JavaScript 的主要用途是与用户互动，以及操作 DOM 。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定 JavaScript同时有两个线程，一个线程在某个 DOM 节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</p>
<p>单线程就意味着，所有任务都需要排队，前一个任务结束，才能执行后一个任务。如果前一个任务耗时很长，那么后一个任务就不得不一直等待，于是乎，JS 设计者们把所有任分成两类，同步和异步。</p>
<ul>
<li>同步：只有前一个任务执行完毕，才能执行后一个任务</li>
<li>异步：当同步任务执行到某个 WebAPI 时，就会触发异步操作，此时浏览器会单独开线程去处理这些异步任务。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 同步</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">2</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="number">3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a + b)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a + b)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>请思考下面的输出结果是什么？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 异步任务，放入任务队列中</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、3、2</span></span><br></pre></td></tr></table></figure>
<p>下图说明了同步任务和异步任务的执行过程：</p>
<p><img data-src="image-20230411085214594.png" alt=""></p>
<h5 id="Ajax原理">Ajax原理</h5>
<p>Ajax 即“Asynchronous Javascript And XML”（异步 JavaScript 和 XML），是指一种创建交互式、快速动态网页应用的网页开发技术，无需重新加载整个网页的情况下，能够更新部分网页的技术。通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建 XMLHttpRequest 对象</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;http://jsonplaceholder.typicode.com/users&#x27;</span></span><br><span class="line"><span class="keyword">let</span> xmlhttp</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123; <span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">    xmlhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xmlhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>)</span><br><span class="line">xmlhttp.<span class="title function_">send</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端响应</span></span><br><span class="line">xmlhttp.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xmlhttp.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">//    console.log(xmlhttp.responseText)</span></span><br><span class="line">        <span class="keyword">let</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xmlhttp.<span class="property">responseText</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Callback-Hell">Callback Hell</h5>
<p>JavaScipt 中的许多操作都是异步的，我们把上面的Ajax封装成一个函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">url, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> xmlhttp</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>) &#123; <span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">        xmlhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// code for IE6, IE5</span></span><br><span class="line">        xmlhttp = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    xmlhttp.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>)</span><br><span class="line">    xmlhttp.<span class="title function_">send</span>()</span><br><span class="line">    <span class="comment">// 服务端响应</span></span><br><span class="line">    xmlhttp.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xmlhttp.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="comment">//    console.log(xmlhttp.responseText)</span></span><br><span class="line">            <span class="keyword">let</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xmlhttp.<span class="property">responseText</span>)</span><br><span class="line">            <span class="title function_">callback</span>(obj)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在static文件夹下放入三个json文件：</p>
<p>a.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;a&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是A&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>b.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是B&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>c.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;c&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是C&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们可以像这样使用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 加载并执行脚本</span></span><br><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;/static/a.json&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>函数是异步调用的，因为操作不是立即完成的，而是之后才会完成。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;/static/a.json&#x27;</span>)</span><br><span class="line"><span class="comment">// 下面的代码不会等到ajax执行完才执行</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>这个过程大家并不陌生，可是如果在回调之后再回调呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">ajax</span>(<span class="string">&#x27;static/a.json&#x27;</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    <span class="title function_">ajax</span>(<span class="string">&#x27;static/b.json&#x27;</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="title function_">ajax</span>(<span class="string">&#x27;static/c.json&#x27;</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果嵌套变多，代码层次就会变深，维护难度也随之增加。</p>
<p>这就被称为 “回调地狱” 或者“回调深渊”。</p>
<h5 id="基本语法-2">基本语法</h5>
<p>Promise 就是为了解决“回调地狱”问题的，它可以将异步操作的处理变得很优雅。回调地狱，代码难以维护， 常常第一个的函数的输出是第二个函数的输入这种现象promise可以支持多个并发的请求，获取并发请求中的数据这个promise可以解决异步的问题，本身不能说promise是异步的。</p>
<p>创建Promise实例。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="comment">/* 异步操作成功 */</span> ) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise构造函数接受一个函数作为参数，该函数的两个参数分别是resolve和reject。它们是两个函数，由 JavaScript 引擎提供，不用自己部署。</p>
<ul>
<li>处理结果正常的话，调用resolve(处理结果值)，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去</li>
<li>处理结果错误的话，调用reject(Error对象)，将Promise对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</li>
</ul>
<p>Promise实例生成以后，可以用then方法分别指定resolved状态和rejected状态的回调函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">// failure</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>TIP</p>
<p>实际上 Promise 用起来还是比较简单的，是不是可以动手试一试去封装自己业务中应用到的异步操作了（之前用回调写的）？</p>
<p>在这里必须说明下 Promise 内部是有状态的(pending、fulfilled、rejected)，Promise 对象根据状态来确定执行哪个方法。Promise 在实例化的时候状态是默认 pending 的，当异步操作是完成的，状态会被修改为 fulfilled，如果异步操作遇到异常，状态会被修改为 rejected，可以通过下图来看下状态的走向：</p>
<p><img data-src="image-20230411085323950.png" alt=""></p>
<blockquote>
<p>注意</p>
<p>状态转化是单向的，不可逆转，已经确定的状态（fulfilled/rejected）无法转回初始状态（pending），而且只能是从 pending 到 fulfilled 或者 rejected</p>
</blockquote>
<h6 id="Promise-prototype-then">Promise.prototype.then()</h6>
<p><strong>基本语法</strong></p>
<blockquote>
<p>promise.then(onFulfilled, onRejected)</p>
</blockquote>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;传递给then的值&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">promise.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这段代码创建一个 Promise 对象，定义了处理 onFulfilled 和 onRejected 的函数（handler），然后返回这个 Promise 对象。</p>
<p>这个 Promise 对象会在变为 resolve 或者 reject 的时候分别调用相应注册的回调函数。</p>
<ul>
<li>当 handler 返回一个正常值的时候，这个值会传递给 Promise 对象的 onFulfilled 方法。</li>
<li>定义的 handler 中产生异常的时候，这个值则会传递给 Promise 对象的 onRejected 方法。</li>
</ul>
<h6 id="Promise-prototype-catch">Promise.prototype.catch()</h6>
<p>捕获异常是程序质量保障最基本的要求，可以使用 Promise 对象的 catch 方法来捕获异步操作过程中出现的任何异常。</p>
<p><strong>基本语法</strong></p>
<p><strong>p.catch(onRejected)</strong><br>
<strong>p.catch(function(reason) { rejection })</strong></p>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;es&#x27;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>().<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>) <span class="comment">// es</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这个代码展示了如何使用 catch 捕获 Promise 对象中的异常，有的同学会问 catch 捕获的是 Promise 内部的 Error 还是 Reject？上面的示例既用了 reject 也用了 Error，到底是哪个触发的这个捕获呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;wrong&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>().<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>) <span class="comment">// wrong</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这个代码对比着上个代码就能明显感受出来的，throw Error 和 reject 都触发了 catch 的捕获，而第一个用法中虽然也有 Error 但是它不是 throw，只是 reject 的参数是 Error 对象，换句话说 new Error 不会触发 catch，而是 reject。</p>
<blockquote>
<p>注意</p>
<p>不建议在 Promise 内部使用 throw 来触发异常，而是使用 <code>reject(new Error())</code> 的方式来做，因为 throw 的方式并没有改变 Pronise 的状态</p>
</blockquote>
<h6 id="Promise-resolve">Promise.resolve()</h6>
<p>一般情况下我们都会使用 ```new Promise()` ``来创建 Promise 对象，但是除此之外我们也可以使用其他方法。</p>
<p>在这里，我们将会学习如何使用 Promise.resolve 和 Promise.reject 这两个方法。</p>
<p>静态方法 Promise.resolve(value) 可以认为是 new Promise() 方法的快捷方式。</p>
<p>比如 Promise.resolve(42) 可以认为是以下代码的语法糖。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">42</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在这段代码中的 resolve(42) 会让这个 Promise 对象立即进入确定（即resolved）状态，并将 42 传递给后面 then 里所指定的 onFulfilled 函数。</p>
<p>方法 Promise.resolve(value) 的返回值也是一个 Promise 对象，所以我们可以像下面那样接着对其返回值进行 .then 调用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">42</span>).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise.resolve 作为 new Promise() 的快捷方式，在进行 Promise 对象的初始化或者编写测试代码的时候都非常方便。</p>
<h6 id="Promise-reject">Promise.reject()</h6>
<p>Promise.reject(error) 是和 Promise.resolve(value) 类似的静态方法，是 new Promise() 方法的快捷方式。</p>
<p>比如 Promise.reject(new Error(“出错了”)) 就是下面代码的语法糖形式。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;出错了&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这段代码的功能是调用该Promise 对象通过then指定的 onRejected 函数，并将错误（Error）对象传递给这个 onRejected 函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;BOOM!&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h6 id="Promise-all">Promise.all()</h6>
<p><strong>基本语法</strong></p>
<blockquote>
<p>Promise.all(promiseArray)</p>
</blockquote>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">results</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(results) <span class="comment">// [1, 2, 3]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise.all 生成并返回一个新的 Promise 对象，所以它可以使用 Promise 实例的所有方法。参数传递promise数组中所有的 Promise 对象都变为resolve的时候，该方法才会返回， 新创建的 Promise 则会使用这些 promise 的值。</p>
<p>如果参数中的任何一个promise为reject的话，则整个Promise.all调用会立即终止，并返回一个reject的新的 Promise 对象。</p>
<p>由于参数数组中的每个元素都是由 Promise.resolve 包装（wrap）的，所以Promise.all 可以处理不同类型的 Promise 对象。</p>
<h6 id="Promise-race">Promise.race()</h6>
<p><strong>基本语法</strong></p>
<blockquote>
<p>Promise.race(promiseArray)</p>
</blockquote>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">var</span> p3 = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2, p3]).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// 1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Promise.race 生成并返回一个新的 Promise 对象。</p>
<p>参数 promise 数组中的任何一个 Promise 对象如果变为 resolve 或者 reject 的话， 该函数就会返回，并使用这个 Promise 对象的值进行 resolve 或者 reject。</p>
<h6 id="练习-3">练习</h6>
<p>如何把前面Callback Hell的代码改写成promise的写法呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPromise</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">ajax</span>(url, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getPromise</span>(<span class="string">&#x27;static/a.json&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getPromise</span>(<span class="string">&#x27;static/b.json&#x27;</span>)</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getPromise</span>(<span class="string">&#x27;static/c.json&#x27;</span>)</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-17">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">fetch</a></li>
<li><a href="https://ponyfoo.com/articles/es6-promises-in-depth">ES6 Promises in Depth</a></li>
<li><a href="https://scotch.io/tutorials/javascript-promises-for-dummies">JavaScript Promises for Dummies</a></li>
</ul>
<h4 id="Generator">Generator</h4>
<p>什么是 JavaScript Generators 呢？通俗的讲 Generators 是可以用来控制迭代器的函数。它们可以暂停，然后在任何时候恢复。如果这句话不好理解，可以看下接下来的示例。</p>
<h5 id="1-常规循环"><strong>1. 常规循环</strong></h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// this will return immediately 0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; 4</span></span><br></pre></td></tr></table></figure>
<h5 id="2-利用-Generator"><strong>2. 利用 Generator</strong></h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">generatorForLoop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> genForLoop = <span class="title function_">generatorForLoop</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(genForLoop.<span class="title function_">next</span>()) <span class="comment">// first console.log - 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(genForLoop.<span class="title function_">next</span>()) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(genForLoop.<span class="title function_">next</span>()) <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(genForLoop.<span class="title function_">next</span>()) <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(genForLoop.<span class="title function_">next</span>()) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<p>对比下代码，常规的循环只能一次遍历完所有值，Generator 可以通过调用 next 方法拿到依次遍历的值，让遍历的执行变得“可控”。</p>
<h5 id="基本语法-3">基本语法</h5>
<h5 id="定义">定义</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> g = <span class="title function_">gen</span>()</span><br><span class="line"><span class="comment">// &quot;Generator &#123; &#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>这个是 Generator 的定义方法，有几个点值得注意：</p>
<ol>
<li>比普通函数多一个 *</li>
<li>函数内部用 yield 来控制程序的执行的“暂停”</li>
<li>函数的返回值通过调用 next 来“恢复”程序执行</li>
</ol>
<blockquote>
<p>注意</p>
<p>Generator 函数的定义不能使用箭头函数，否则会触发 SyntaxError 错误</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = * <span class="function">() =&gt;</span> &#123;&#125; <span class="comment">// SyntaxError</span></span><br><span class="line"><span class="keyword">let</span> generator = () * =&gt; &#123;&#125; <span class="comment">// SyntaxError</span></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">generator</span> = (<span class="params"> * </span>) =&gt; &#123;&#125; <span class="comment">// SyntaxError</span></span><br></pre></td></tr></table></figure>
<p>这些做法都是错误的❌。</p>
<h6 id="yield-表达式">yield 表达式</h6>
<blockquote>
<p>yield 关键字用来暂停和恢复一个生成器函数</p>
</blockquote>
<p>关于 yield 表达式，要熟记几个知识点：</p>
<ol>
<li>yield 表达式的返回值是 undefined，但是遍历器对象的 next 方法可以修改这个默认值。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> val</span><br><span class="line">    val = <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`1:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 1:undefined</span></span><br><span class="line">    val = <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`2:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 2:undefined</span></span><br><span class="line">    val = <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`3:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 3:undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>从这个代码可以看出来，yield 表达式的返回值是 undefined。</p>
<ol>
<li>yeild * 是委托给另一个遍历器对象或者可遍历对象</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> val</span><br><span class="line">    val = <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`1:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 1:undefined</span></span><br><span class="line">    val = <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`2:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 2:undefined</span></span><br><span class="line">    val = <span class="keyword">yield</span> [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`3:<span class="subst">$&#123;val&#125;</span>`</span> ) <span class="comment">// 3:undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Generator 对象的 next 方法，遇到 yield 就暂停，并返回一个对象，这个对象包括两个属性：value 和 done。</li>
</ol>
<p>参考步骤1 的代码可以明确看出来，执行第一句 ```g.next` ``gen 代码执行到 yield 1，程序暂停，此时返回了一个对象：{value: 1, done: false}</p>
<h5 id="方法">方法</h5>
<p>Generator 对象有几个方法，next、return、throw。</p>
<h6 id="next-value"><strong>- next([value])</strong></h6>
<p>前面我们讲了，Generator 对象通过 next 方法来获取每一次遍历的结果，这个方法返回一个对象，这个对象包含两个属性：value 和 done。value 是指当前程序的运行结果，done 表示遍历是否结束。</p>
<p>其实 next 是可以接受参数的，这个参数可以让你在 Generator 外部给内部传递数据，而这个参数就是作为 yield 的返回值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="number">100</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`before <span class="subst">$&#123;val&#125;</span>`</span> )</span><br><span class="line">        val = <span class="keyword">yield</span> val</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`return <span class="subst">$&#123;val&#125;</span>`</span> )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>(<span class="number">20</span>).<span class="property">value</span>)</span><br><span class="line"><span class="comment">// before 100</span></span><br><span class="line"><span class="comment">// 100</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>(<span class="number">30</span>).<span class="property">value</span>)</span><br><span class="line"><span class="comment">// return 30</span></span><br><span class="line"><span class="comment">// before 30</span></span><br><span class="line"><span class="comment">// 30</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>(<span class="number">40</span>).<span class="property">value</span>)</span><br><span class="line"><span class="comment">// return 40</span></span><br><span class="line"><span class="comment">// before 40</span></span><br><span class="line"><span class="comment">// 40</span></span><br></pre></td></tr></table></figure>
<p>如果对上面的话和代码不理解，可以把 <code>console.log(g.next(30).value)` ``和 </code>console.log(g.next(40).value)` ``注释掉。你会发现 只输出了 before 100 和 100，这是为什么呢？下面我们来还原下这段代码的执行过程：</p>
<ol>
<li>g.next(20) 这句代码会执行 gen 内部的代码，遇到第一个 yield 暂停。所以 <code>console.log(` before $&#123;val&#125; `)` ``执行输出了 </code>before 100<code> ``，此时的 val 是 100，所以执行到 yield val 返回了 100，注意 ```yield val</code> ``并没有赋值给 val。</li>
<li>g.next(30) 这句代码会继续执行 gen 内部的代码，也就是 <code>val = yield val` ``这句，因为 next 传入了 30，所以 yield val 这个返回值就是 30，因此 val 被赋值 30，执行到 </code>console.log(<code>return $&#123;val&#125;</code>)<code> ``输出了 30，此时没有遇到 yield 代码继续执行，也就是 while 的判断，继续执行 ```console.log(</code> before ${val} <code>)</code> <code>输出了 ```before 30` </code>，再执行遇到了 ```yield val` ``程序暂停。</li>
<li>g.next(40) 重复步骤 2。</li>
</ol>
<h6 id="return"><strong>- return()</strong></h6>
<p>return 方法可以让 Generator 遍历终止，有点类似 for 循环的 break。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">return</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>从 done 可以看出代码执行已经结束。</p>
<p>当然 return 也可以传入参数，作为返回的 value 值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = <span class="title function_">gen</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="keyword">return</span>(<span class="number">100</span>)) <span class="comment">// &#123;value: 100, done: true&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<h6 id="throw"><strong>- throw()</strong></h6>
<p>可以通过 throw 方法在 Generator 外部控制内部执行的“终断”。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="number">42</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">message</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> g = <span class="title function_">gen</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value: 42, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value: 42, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123; value: 42, done: false &#125;</span></span><br><span class="line"><span class="comment">// 中断操作</span></span><br><span class="line">g.<span class="keyword">throw</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;break&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(g.<span class="title function_">next</span>()) <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>如果想退出遍历 catch 之后可以配合 ```return false` ``使用，能起到 “break” 的作用</p>
</blockquote>
<h5 id="应用场景">应用场景</h5>
<h6 id="场景1">场景1</h6>
<p>还是前面的异步操作，按顺序读取a.json、b.json、c.json，如果使用Generator该如何实现呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="title function_">ajax</span>(url, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        getData.<span class="title function_">next</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res1 = <span class="keyword">yield</span> <span class="title function_">request</span>(<span class="string">&#x27;static/a.json&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res1)</span><br><span class="line">    <span class="keyword">let</span> res2 = <span class="keyword">yield</span> <span class="title function_">request</span>(<span class="string">&#x27;static/b.json&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res2)</span><br><span class="line">    <span class="keyword">let</span> res3 = <span class="keyword">yield</span> <span class="title function_">request</span>(<span class="string">&#x27;static/c.json&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res3)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> getData = <span class="title function_">gen</span>()</span><br><span class="line">getData.<span class="title function_">next</span>()</span><br></pre></td></tr></table></figure>
<h6 id="场景2">场景2</h6>
<p>我们经常玩一些小游戏，比如数数字，敲7，到7和7的倍数，无限循环转圈去数数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">count</span>(<span class="params">x = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x % <span class="number">7</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> x</span><br><span class="line">        &#125;</span><br><span class="line">        x++</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// es5中就是个死循环 因为es5的循环需要有个终止值，但我们这个需求没有终止，一直在数数</span></span><br><span class="line"><span class="keyword">let</span> n = <span class="title function_">count</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n.<span class="title function_">next</span>().<span class="property">value</span>)</span><br></pre></td></tr></table></figure>
<p>通过 Generator 我们就能轻松实现，只要调用 n.next 我们就知道下一个数是什么了，而使用普通函数却没法做到。不信你试试看？</p>
<h5 id="推荐阅读-18">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Generator">Generator</a></li>
<li><a href="https://davidwalsh.name/es6-generators">The Basics Of ES6 Generators</a></li>
<li><a href="https://davidtang.io/2016/10/15/a-practical-introduction-to-es6-generator-functions.html">A Practical Introduction to ES6 Generator Functions</a></li>
<li><a href="https://exploringjs.com/es6/ch_generators.html">Generators</a></li>
</ul>
<h4 id="Iterator">Iterator</h4>
<blockquote>
<p>处理集合中的每个项是很常见的操作。JavaScript 提供了许多迭代集合的方法，从简单的for循环到map()和filter()。迭代器和生成器将迭代的概念直接带入核心语言，并提供了一种机制来自定义for…of循环的行为。</p>
</blockquote>
<p>如果对 MDN 这个描述理解不是很到位的话，可以看下接下来这个小示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> authors = &#123;</span><br><span class="line">    <span class="attr">allAuthors</span>: &#123;</span><br><span class="line">        <span class="attr">fiction</span>: [</span><br><span class="line">            <span class="string">&#x27;Agatha Christie&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;J. K. Rowling&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Dr. Seuss&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">scienceFiction</span>: [</span><br><span class="line">            <span class="string">&#x27;Neal Stephenson&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Arthur Clarke&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Isaac Asimov&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Robert Heinlein&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">fantasy</span>: [</span><br><span class="line">            <span class="string">&#x27;J. R. R. Tolkien&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;J. K. Rowling&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Terry Pratchett&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个数据结构是汇总了所有作者，每个作者按创作性质进行了分类。如果我们想获取所有作者的名单，该怎么做呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> author <span class="keyword">of</span> authors) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(author)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WARNING</p>
<p>你发现这个遍历遇到了报错：Uncaught TypeError: authors is not iterable</p>
<p>有的同学会说可以这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> authors) &#123;</span><br><span class="line">    <span class="keyword">let</span> r = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> authors[key]) &#123;</span><br><span class="line">        r = r.<span class="title function_">concat</span>(authors[key][k])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(r)</span><br><span class="line">    <span class="comment">// [&quot;Agatha Christie&quot;, &quot;J. K. Rowling&quot;, &quot;Dr. Seuss&quot;, &quot;Neal Stephenson&quot;, &quot;Arthur Clarke&quot;, &quot;Isaac Asimov&quot;, &quot;Robert Heinlein&quot;, &quot;J. R. R. Tolkien&quot;, &quot;J. K. Rowling&quot;, &quot;Terry Pratchett&quot;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个做法确实可以，实际上也是手动实现的遍历加数据合并，这其实不算是遍历。这个小节就是讲述如何给这种自定义的数据结构进行遍历。</p>
<h5 id="基本语法-4">基本语法</h5>
<p>Iterator 就是 ES6 中用来实现自定义遍历的接口，按照上述的示例，我们来实现下这个接口：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">authors[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> allAuthors = <span class="variable language_">this</span>.<span class="property">allAuthors</span></span><br><span class="line">    <span class="keyword">let</span> keys = <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(allAuthors)</span><br><span class="line">    <span class="keyword">let</span> values = []</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!values.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (keys.<span class="property">length</span>) &#123;</span><br><span class="line">                    values = allAuthors[keys[<span class="number">0</span>]]</span><br><span class="line">                    keys.<span class="title function_">shift</span>()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">done</span>: !values.<span class="property">length</span>,</span><br><span class="line">                <span class="attr">value</span>: values.<span class="title function_">shift</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码在数据结构上部署了 Iterator 接口，我们就可以用 for…of 来遍历代码了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> authors) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`<span class="subst">$&#123;value&#125;</span>`</span> )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码上我们看到了自定义遍历器的强大，但是我们怎么理解 Iterator 呢？首先，要理解几个概念：可迭代协议和迭代器协议。</p>
<h6 id="1-迭代器协议"><strong>1. 迭代器协议</strong></h6>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">值</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">next</td>
<td style="text-align:center">返回一个对象的无参函数，被返回对象拥有两个属性：done 和 value</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p>这是两个概念：可迭代协议、迭代器协议。通俗的讲，迭代器协议要求符合以下条件：</p>
<ul>
<li>首先，它是一个对象</li>
<li>其次，这个对象包含一个无参函数 next</li>
<li>最后，next 返回一个对象，对象包含 done 和 value 属性。其中 done 表示遍历是否结束，value 返回当前遍历的值。</li>
</ul>
<p>WARNING</p>
<p>如果 next 函数返回一个非对象值（比如false和undefined) 会展示一个 TypeError (“iterator.next() returned a non-object value”) 的错误</p>
<h6 id="2-可迭代协议"><strong>2. 可迭代协议</strong></h6>
<p>可迭代协议允许 JavaScript 对象去定义或定制它们的迭代行为, 例如（定义）在一个 for…of 结构中什么值可以被循环（得到）。一些内置类型都是内置的可迭代类型并且有默认的迭代行为, 比如 Array or Map, 另一些类型则不是 (比如Object) 。</p>
<p>为了变成可迭代对象， 一个对象必须实现 @@iterator 方法, 意思是这个对象（或者它原型链 prototype chain 上的某个对象）必须有一个名字是 Symbol.iterator 的属性:</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">值</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">[Symbol.iterator]</td>
<td style="text-align:center">返回一个对象的无参函数，被返回对象符合迭代器协议</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p>如果让一个对象是可遍历的，就要遵守可迭代协议，该协议要求对象要部署一个以 Symbol.iterator 为 key 的键值对，而 value 就是一个无参函数，这个函数返回的对象要遵守迭代器协议。</p>
<h5 id="Generator-2">Generator</h5>
<p>熟悉了 Generator 之后，发现它是天然满足可迭代协议的。上述的代码我们可以用 Generator 来实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">authors[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span>*() &#123;</span><br><span class="line">    <span class="keyword">let</span> allAuthors = <span class="variable language_">this</span>.<span class="property">allAuthors</span></span><br><span class="line">    <span class="keyword">let</span> keys = <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(allAuthors)</span><br><span class="line">    <span class="keyword">let</span> values = []</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!values.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (keys.<span class="property">length</span>) &#123;</span><br><span class="line">                values = allAuthors[keys[<span class="number">0</span>]]</span><br><span class="line">                keys.<span class="title function_">shift</span>()</span><br><span class="line">                <span class="keyword">yield</span> values.<span class="title function_">shift</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">yield</span> values.<span class="title function_">shift</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同一个场景，同一个数据结构，写法确实不同的，利用 Generator 就不再需要显示的写迭代协议了（next方法和包含 done、value 属性的返回对象）。</p>
<h5 id="推荐阅读-19">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Iterator">Iterator</a></li>
<li><a href="https://harttle.land/2018/09/29/es6-iterators.html">ES6 迭代器：Iterator, Iterable 和 Generator</a></li>
<li><a href="https://www.sitepoint.com/ecmascript-2015-generators-and-iterators/">ES6 Generators and Iterators: a Developer’s Guide</a></li>
</ul>
<h4 id="Module">Module</h4>
<h5 id="模块化的发展">模块化的发展</h5>
<p>技术的诞生是为了解决某个问题，模块化也是。 随着前端的发展，web技术日趋成熟，js功能越来越多，代码量也越来越大。之前一个项目通常各个页面公用一个js，但是js逐渐拆分，项目中引入的js越来越多. 在js模块化诞生之前，开发者面临很多问题:</p>
<ul>
<li>全局变量污染：各个文件的变量都是挂载到window对象上，污染全局变量。</li>
<li>变量重名：不同文件中的变量如果重名，后面的会覆盖前面的，造成程序运行错误。</li>
<li>文件依赖顺序：多个文件之间存在依赖关系，需要保证一定加载顺序问题严重。</li>
</ul>
<p>模块化是指解决一个复杂问题时自顶向下逐层把系统划分成若干模块的过程， 有多种属性，分别反映其内部特性。百度百科中，模块化的定义是： 模块化是一种处理复杂系统分解为更好的可管理模块的方式。 简单的说，把一个复杂的东西分解成多个甚至多层次的组成部分，以一种良好的机制管理起来，就可以认为是模块化。而对于软件开发来说，函数（过程）就是最常见也是最基本的模块之一。</p>
<p>我觉得用乐高积木来比喻模块化再好不过了。每个积木都是固定的颜色形状，想要组合积木必须使用积木凸起和凹陷的部分进行连接，最后多个积木累积成你想要的形状。</p>
<p>模块化其实是一种规范，一种约束，这种约束会大大提升开发效率。将每个js文件看作是一个模块，每个模块通过固定的方式引入，并且通过固定的方式向外暴露指定的内容。 按照js模块化的设想，一个个模块按照其依赖关系组合，最终插入到主程序中。</p>
<p>我们梳理一下模块化的发展情况：</p>
<p>无模块化–&gt;CommonJS规范–&gt;AMD规范–&gt;CMD规范–&gt;ES6模块化</p>
<p>1、CommonJS规范 Node中模块化规范</p>
<p>Commonjs的诞生给js模块化发展有了重要的启发，Commonjs非常受欢迎， 但是局限性很明显：Commonjs基于Node原生api在服务端可以实现模块同步加载， 但是仅仅局限于服务端，客户端如果同步加载依赖的话时间消耗非常大，所以需要一个 在客户端上基于Commonjs但是对于加载模块做改进的方案，于是AMD规范诞生了。</p>
<p>2、AMD规范, 异步模块定义, 允许指定回调函数，AMD 是 RequireJS 在推广过程中对模块定义的规范化产出。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到所有依赖加载完成之后（前置依赖），这个回调函数才会运行。</p>
<p>3、CMD规范，同样是受到Commonjs的启发，国内（阿里）诞生了一个CMD（Common Module Definition）规范。该规范借鉴了Commonjs的规范与AMD规范，在两者基础上做了改进。</p>
<p>CMD 是 SeaJS 在推广过程中对模块定义的规范化产出。</p>
<p>AMD 推崇依赖前置、提前执行 CMD推崇依赖就近、延迟执行。</p>
<p>4、 到了2015年，ES6规范中，终于将模块化纳入JavaScript标准，从此js模块化被官方扶正，也是未来js的标准. 在ES6中，我们可以使用 import 关键字引入模块，通过 exprot 关键字导出模块，功能较之于前几个方案更为强大，也是我们所推崇的， 但是由于ES6目前无法在浏览器中执行，所以，我们只能通过babel将不被支持的import编译为当前受到广泛支持的 require。</p>
<h5 id="export">export</h5>
<p>模块功能主要由两个命令构成：export和import。export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。</p>
<p>一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。如果你希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>
<ol>
<li>导出变量或者常量</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> addr = <span class="string">&#x27;BeiJing City&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> addr = <span class="string">&#x27;BeiJing City&#x27;</span></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    name,</span><br><span class="line">    addr,</span><br><span class="line">    list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>导出函数</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">say</span>(<span class="params">content</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">say</span> = (<span class="params">content</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(content)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">run</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    say,</span><br><span class="line">    run</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>导出 Object</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> (&#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>导出 Class</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    <span class="title class_">Test</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="as">as</h5>
<p>如果想为输入的变量重新取一个名字，import命令要使用as关键字，将输入的变量重命名。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> addr = <span class="string">&#x27;BeiJing City&#x27;</span></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    name <span class="keyword">as</span> cname,</span><br><span class="line">    addr <span class="keyword">as</span> caddr,</span><br><span class="line">    list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="export-default">export default</h5>
<p>使用import命令的时候，用户需要知道所要加载的变量名或函数名，否则无法加载。但是，用户肯定希望快速上手，未必愿意阅读文档，去了解模块有哪些属性和方法。</p>
<p>为了给用户提供方便，让他们不用阅读文档就能加载模块，就要用到export default命令，为模块指定默认输出。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> addr = <span class="string">&#x27;BeiJing City&#x27;</span></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    name <span class="keyword">as</span> cname,</span><br><span class="line">    addr <span class="keyword">as</span> caddr</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> list</span><br></pre></td></tr></table></figure>
<h5 id="import">import</h5>
<p>使用export命令定义了模块的对外接口以后，其他 JS 文件就可以通过import命令加载这个模块。</p>
<ol>
<li>直接导入</li>
</ol>
<p>假设导出模块 A 是这样的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">let</span> addr = <span class="string">&#x27;BeiJing City&#x27;</span></span><br><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    name <span class="keyword">as</span> cname,</span><br><span class="line">    addr <span class="keyword">as</span> caddr</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> list</span><br></pre></td></tr></table></figure>
<p>则导入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> list, &#123;</span><br><span class="line">    cname,</span><br><span class="line">    caddr</span><br><span class="line">&#125; <span class="keyword">from</span> A</span><br></pre></td></tr></table></figure>
<ol>
<li>修改导入名称</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> list, &#123;</span><br><span class="line">    cname <span class="keyword">as</span> name,</span><br><span class="line">    caddr</span><br><span class="line">&#125; <span class="keyword">from</span> A</span><br></pre></td></tr></table></figure>
<ol>
<li>批量导入</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> list, * <span class="keyword">as</span> mod <span class="keyword">from</span> A</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(list)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mod.<span class="property">cname</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mod.<span class="property">caddr</span>)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-20">推荐阅读</h5>
<ul>
<li><a href="https://exploringjs.com/es6/ch_modules.html">Modules</a></li>
<li><a href="https://hackernoon.com/import-export-default-require-commandjs-javascript-nodejs-es6-vs-cheatsheet-different-tutorial-example-5a321738b50f">import, export, default cheatsheet</a></li>
<li><a href="https://2ality.com/2014/09/es6-modules-final.html">ECMAScript 6 modules: the final syntax</a></li>
</ul>
<h3 id="ES7（ES2016）">ES7（ES2016）</h3>
<h4 id="Array-prototype-includes">Array.prototype.includes()</h4>
<p>在 ES7 之前想判断数组中是否包含一个元素，基本可以这样写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array1.<span class="title function_">find</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> item === <span class="number">2</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(array1.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> item === <span class="number">2</span></span><br><span class="line">&#125;).<span class="property">length</span> &gt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>ES7引入的Array.prototype.includes() 方法用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。</p>
<h5 id="基本用法">基本用法</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;es6&#x27;</span>, <span class="string">&#x27;es7&#x27;</span>, <span class="string">&#x27;es8&#x27;</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es6&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es9&#x27;</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h5 id="接收俩个参数">接收俩个参数</h5>
<p>要搜索的值和搜索的开始索引。第二个参数可选。从该索引处开始查找 searchElement。如果为负值，</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;es6&#x27;</span>, <span class="string">&#x27;es7&#x27;</span>, <span class="string">&#x27;es8&#x27;</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es7&#x27;</span>, <span class="number">1</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es7&#x27;</span>, <span class="number">2</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es7&#x27;</span>, -<span class="number">1</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">includes</span>(<span class="string">&#x27;es7&#x27;</span>, -<span class="number">2</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h5 id="与indexOf-比较">与indexOf()比较</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>].<span class="title function_">includes</span>(<span class="string">&#x27;a&#x27;</span>) <span class="comment">//true</span></span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>].<span class="title function_">indexOf</span>(<span class="string">&#x27;a&#x27;</span>) &gt; -<span class="number">1</span> <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">indexOf</span>(<span class="string">&#x27;es7&#x27;</span>)) <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="title function_">indexOf</span>(<span class="string">&#x27;es7&#x27;</span>) &gt; -<span class="number">1</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>只能判断简单类型的数据，对于复杂类型的数据，比如对象类型的数组，二维数组，这些是无法判断的.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>], <span class="number">4</span>]</span><br><span class="line">arr.<span class="title function_">includes</span>([<span class="number">2</span>, <span class="number">3</span>]) <span class="comment">//false</span></span><br><span class="line">arr.<span class="title function_">indexOf</span>([<span class="number">2</span>, <span class="number">3</span>]) <span class="comment">//-1</span></span><br></pre></td></tr></table></figure>
<h5 id="优缺点比较">优缺点比较</h5>
<p>两者都是采用===的操作符来作比较的，不同之处在于：对于NaN的处理结果不同。我们知道js中 NaN === NaN 的结果是false, indexOf()也是这样处理的，但是includes()不是这样的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> demo = [<span class="number">1</span>, <span class="title class_">NaN</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">demo.<span class="title function_">indexOf</span>(<span class="title class_">NaN</span>) <span class="comment">//-1</span></span><br><span class="line">demo.<span class="title function_">includes</span>(<span class="title class_">NaN</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>总结</p>
<p>如果只想知道某个值是否在数组中存在，而并不关心它的索引位置，建议使用includes()。如果想获取一个值在数组中的位置，那么只能使用indexOf方法。</p>
<h5 id="推荐阅读-21">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/includes">Array.prototype.includes()</a></li>
</ul>
<h4 id="幂运算符">幂运算符</h4>
<p>如果不使用任何函数，如何实现一个数的求幂运算？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pow</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; y; i++) &#123;</span><br><span class="line">        res *= x</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// 1024</span></span><br></pre></td></tr></table></figure>
<p>除了自己封装函数来实现，也可是使用 <code>Math.pow()</code> 来完成。</p>
<blockquote>
<p>Math.pow() 函数返回基数（base）的指数（exponent）次幂。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">10</span>)) <span class="comment">// 1024</span></span><br></pre></td></tr></table></figure>
<p>在 ES7 可以这样写了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span> ** <span class="number">10</span>) <span class="comment">// 1024</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>幂运算符的两个*号之间不能出现空格，否则语法会报错。</p>
<h3 id="ES8（ES2017）">ES8（ES2017）</h3>
<h4 id="async-await">async / await</h4>
<p>async 和 await 是一种更加优雅的异步编程解决方案，是Promise 的拓展，如果对 Promise 还不了解的话，请移步 [Promise] 章节进行学习。</p>
<p>在我们处理异步的时候，比起回调函数，Promise的then方法会显得较为简洁和清晰，但是在处理多个彼此之间相互依赖的请求的时候，就会显的有些繁琐。这时候，用async/await更加优雅。</p>
<p>我们知道 JavaScript 是单线程的，使用 Promise 之后可以让我们书写异步操作更加简单，而 async 是让我们写起 Promise 像同步操作。看下示例：</p>
<h5 id="基本语法-5">基本语法</h5>
<p>前面添加了async的函数在执行后都会自动返回一个Promise对象:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">foo</span>()) <span class="comment">// &#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure>
<p>相当于</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;xxx&#x27;</span> <span class="comment">// Promise.resolve(&#x27;xxx&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// let res =  Promise.resolve(&#x27;xxx&#x27;)</span></span><br><span class="line">    <span class="comment">// console.log(res)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">foo</span>()) <span class="comment">// Promise</span></span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure>
<p>await后面需要跟异步操作，不然就没有意义，而且await后面的Promise对象不必写then，因为await的作用之一就是获取后面Promise对象成功状态传递出来的参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">            <span class="title function_">resolve</span>() <span class="comment">// resolve(&#x27;success&#x27;)</span></span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不加async和await是2、1   加了是1、2</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">timeout</span>() <span class="comment">// let res = await timeout() res是success</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure>
<h5 id="对于失败的处理">对于失败的处理</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// resolve(&#x27;success&#x27;)</span></span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">timeout</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在async函数中使用await，那么await这里的代码就会变成同步的了，意思就是说只有等await后面的Promise执行完成得到结果才会继续下去，await就是等待。</p>
<h5 id="应用">应用</h5>
<p>还是前面案例中的异步操作，我们需要发送多个请求，而后面请求的发送总是需要依赖上一个请求返回的数据。对于这个问题，我们既可以用的Promise的链式调用来解决，也可以用async/await来解决，然而后者会更简洁些。</p>
<p>按顺序读取a.json、b.json、c.json，如果使用async/await该如何实现呢？</p>
<p>我们在static文件夹下放入三个json文件：</p>
<p>a.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;a&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是A&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>b.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是B&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>c.json:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;c&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是C&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 把ajax封装成模块</span></span><br><span class="line">import ajax from &#x27;./ajax&#x27;</span><br><span class="line"></span><br><span class="line">function request(url) <span class="punctuation">&#123;</span></span><br><span class="line">    return new Promise(resolve =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">        ajax(url<span class="punctuation">,</span> res =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">            resolve(res)</span><br><span class="line">        <span class="punctuation">&#125;</span>)</span><br><span class="line">    <span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">async function getData() <span class="punctuation">&#123;</span></span><br><span class="line">    let res1 = await request(&#x27;static/a.json&#x27;)</span><br><span class="line">    console.log(res1)</span><br><span class="line">    let res2 = await request(&#x27;static/b.json&#x27;)</span><br><span class="line">    console.log(res2)</span><br><span class="line">    let res3 = await request(&#x27;static/c.json&#x27;)</span><br><span class="line">    console.log(res3)</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">getData()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>await 只能在 async 标记的函数内部使用，单独使用会触发 Syntax error。</p>
</blockquote>
<h5 id="推荐阅读-22">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function">async function</a></li>
<li><a href="https://javascript.info/async-await">Async/await</a></li>
</ul>
<h4 id="Object-扩展">Object 扩展</h4>
<p>之前的语法如何获取对象的每一个属性值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    <span class="attr">web</span>: <span class="string">&#x27;www.xxx.com&#x27;</span>,</span><br><span class="line">    <span class="attr">course</span>: <span class="string">&#x27;es&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(obj))</span><br><span class="line"><span class="keyword">const</span> res = <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> obj[key])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line"><span class="comment">// [&quot;xxx&quot;, &quot;www.xxx.com&quot;, &quot;es&quot;]</span></span><br></pre></td></tr></table></figure>
<p>ES8中对象扩展补充了两个静态方法，用于遍历对象：Object.values()，Object.entries()</p>
<h5 id="Object-values">Object.values()</h5>
<blockquote>
<p>Object.values() 返回一个数组，其元素是在对象上找到的可枚举属性值。属性的顺序与通过手动循环对象的属性值所给出的顺序相同(for…in，但是for…in还会遍历原型上的属性值)。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    <span class="attr">web</span>: <span class="string">&#x27;www.xxx.com&#x27;</span>,</span><br><span class="line">    <span class="attr">course</span>: <span class="string">&#x27;es&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(obj))</span><br><span class="line"><span class="comment">// [&quot;xxx&quot;, &quot;www.xxx.com&quot;, &quot;es&quot;]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>Object.values 是在对象上找到可枚举的属性的值，所以只要这个对象是可枚举的就可以，不只是 {} 这种形式。</p>
</blockquote>
<h5 id="Object-entries">Object.entries()</h5>
<blockquote>
<p>Object.entries()方法返回一个给定对象自身可枚举属性的键值对数组，其排列与使用 for…in 循环遍历该对象时返回的顺序一致。（区别在于 for-in 循环也枚举原型链中的属性）</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> grade = &#123;</span><br><span class="line">    <span class="string">&#x27;lilei&#x27;</span>: <span class="number">98</span>,</span><br><span class="line">    <span class="string">&#x27;hanmei&#x27;</span>: <span class="number">87</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> grade) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key, value) <span class="comment">// Uncaught TypeError: grade is not iterable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们知道 Object 是不可直接遍历的，上述代码足以说明直接遍历触发了错误。如果使用 Object.entries() 则可以完成遍历任务。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> grade = &#123;</span><br><span class="line">    <span class="string">&#x27;lilei&#x27;</span>: <span class="number">98</span>,</span><br><span class="line">    <span class="string">&#x27;hanmei&#x27;</span>: <span class="number">87</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k, v] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(grade)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, v)</span><br><span class="line">    <span class="comment">// lilei 98</span></span><br><span class="line">    <span class="comment">// hanmei 87</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码确实成功的遍历了出来，但是上边说过 Object.entries 返回的是数组，这里面还用了数组的解构赋值，很多同学不明白是怎么结合的，其实很简单，看下 Object.entries 的返回值就好了：</p>
<p><img data-src="image-20230411091146674.png" alt=""></p>
<p>结合这个图还有解构赋值的原理，就明白上述的代码是怎么工作的了。</p>
<h5 id="Object-getOwnPropertyDescriptors">Object.getOwnPropertyDescriptors()</h5>
<p>想理解 Object.getOwnPropertyDescriptors 这个方法之前，首先要弄懂什么是描述符(descriptor)？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="title class_">Portland</span>: <span class="string">&#x27;78/50&#x27;</span>,</span><br><span class="line">    <span class="title class_">Dublin</span>: <span class="string">&#x27;88/52&#x27;</span>,</span><br><span class="line">    <span class="title class_">Lima</span>: <span class="string">&#x27;58/40&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还是上述那个对象，这里有 key 和 value，上边的代码把所有的 key、value 遍历出来，如果我们不想让 Lima 这个属性和值被枚举怎么办？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, <span class="string">&#x27;Lima&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">entries</span>(data).<span class="title function_">map</span>(<span class="function">(<span class="params">[city, temp]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`City: <span class="subst">$&#123;city.padEnd(<span class="number">16</span>)&#125;</span> Weather: <span class="subst">$&#123;temp&#125;</span>`</span> )</span><br><span class="line">    <span class="comment">// City: Portland         Weather: 78/50</span></span><br><span class="line">    <span class="comment">// City: Dublin           Weather: 88/52</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>很成功，Lima 没有被遍历出来，那么 defineProperty 的第三个参数就是描述符(descriptor)。这个描述符包括几个属性：</p>
<ul>
<li>value [属性的值]</li>
<li>writable [属性的值是否可被改变]</li>
<li>enumerable [属性的值是否可被枚举]</li>
<li>configurable [描述符本身是否可被修改，属性是否可被删除]</li>
</ul>
<p>如果想查看更多细节，访问 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(data, <span class="string">&#x27;Lima&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123;value: &quot;58/40&quot;, writable: true, enumerable: false, configurable: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>这个是获取对象指定属性的描述符，如果想获取对象的所有属性的描述符：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptors</span>(data))</span><br></pre></td></tr></table></figure>
<p>返回数据：</p>
<p><img data-src="image-20230411091223524.png" alt=""></p>
<h5 id="推荐阅读-23">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/values">Object.values()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">Object.entries()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptors">Object.getOwnPropertyDescriptors()</a></li>
</ul>
<h4 id="String-扩展">String 扩展</h4>
<p>在 ES8 中 String 新增了两个实例函数 String.prototype.padStart 和 String.prototype.padEnd，允许将空字符串或其他字符串添加到原始字符串的开头或结尾。</p>
<h5 id="String-prototype-padStart">String.prototype.padStart()</h5>
<p>把指定字符串填充到字符串头部，返回新字符串。</p>
<p>语法：</p>
<blockquote>
<p>str.padStart(targetLength [, padString])</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">targetLength</td>
<td style="text-align:center">目标字符要保持的长度值</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">padString</td>
<td style="text-align:center">如果目标字符的长度不够需要的补白字符，默认为空</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">padStart</span>(<span class="number">8</span>, <span class="string">&#x27;x&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">padEnd</span>(<span class="number">8</span>, <span class="string">&#x27;y&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">padStart</span>(<span class="number">8</span>))</span><br></pre></td></tr></table></figure>
<h5 id="场景1：日期格式化">场景1：日期格式化</h5>
<p>希望把当前日期格式化城：yyyy-mm-dd的格式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line"><span class="keyword">const</span> year = now.<span class="title function_">getFullYear</span>()</span><br><span class="line"><span class="keyword">const</span> month = (now.<span class="title function_">getMonth</span>() + <span class="number">1</span>).<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> day = (now.<span class="title function_">getDate</span>()).<span class="title function_">toString</span>().<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(year, month, day)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">`<span class="subst">$&#123;year&#125;</span>-<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span>`</span> )</span><br></pre></td></tr></table></figure>
<h5 id="场景2：数字替换">场景2：数字替换</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数字替换，比如手机号，身份证号</span></span><br><span class="line"><span class="keyword">const</span> tel = <span class="string">&#x27;13012345678&#x27;</span></span><br><span class="line"><span class="keyword">const</span> newTel = tel.<span class="title function_">slice</span>(-<span class="number">4</span>).<span class="title function_">padStart</span>(tel.<span class="property">length</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newTel) <span class="comment">// *******5678</span></span><br></pre></td></tr></table></figure>
<h5 id="String-prototype-padEnd">String.prototype.padEnd()</h5>
<p>方法会用一个字符串填充当前字符串（如果需要的话则重复填充），返回填充后达到指定长度的字符串。从当前字符串的末尾（右侧）开始填充。 语法：</p>
<blockquote>
<p>str.padEnd(targetLength [, padString])</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">targetLength</td>
<td style="text-align:center">目标字符要保持的长度值</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">padString</td>
<td style="text-align:center">如果目标字符的长度不够需要的补白字符，默认为空</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str1 = <span class="string">&#x27;I am learning es in xxx&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str1.<span class="title function_">padEnd</span>(<span class="number">30</span>, <span class="string">&#x27;.&#x27;</span>))</span><br><span class="line"><span class="comment">// I am learning es in xxx.....</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">&#x27;200&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str2.<span class="title function_">padEnd</span>(<span class="number">5</span>))</span><br><span class="line"><span class="comment">// &quot;200  &quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="场景：时间戳统一长度">场景：时间戳统一长度</h5>
<p>在JS前端我们处理时间戳的时候单位都是ms毫秒，但是，后端同学返回的时间戳则不一样是毫秒，可能只有10位，以s秒为单位。所以，我们在前端处理这个时间戳的时候，保险起见，要先做一个13位的补全，保证单位是毫秒。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()) <span class="comment">// 时间戳 13位的</span></span><br><span class="line">timestamp = +<span class="title class_">String</span>(timestamp).<span class="title function_">padEnd</span>(<span class="number">13</span>, <span class="string">&#x27;0&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-24">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/padStart">String.prototype.padStart()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd">String.prototype.padEnd()</a></li>
</ul>
<h4 id="尾逗号-Trailing-commas">尾逗号 Trailing commas</h4>
<p>ES8 允许函数的最后一个参数有尾逗号（Trailing comma）。</p>
<p>此前，函数定义和调用时，都不允许最后一个参数后面出现逗号。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clownsEverywhere</span>(<span class="params"></span></span><br><span class="line"><span class="params">    param1,</span></span><br><span class="line"><span class="params">    param2</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">clownsEverywhere</span>(</span><br><span class="line">    <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>上面代码中，如果在param2或bar后面加一个逗号，就会报错。</p>
<p>如果像上面这样，将参数写成多行（即每个参数占据一行），以后修改代码的时候，想为函数clownsEverywhere添加第三个参数，或者调整参数的次序，就势必要在原来最后一个参数后面添加一个逗号。这对于版本管理系统来说，就会显示添加逗号的那一行也发生了变动。这看上去有点冗余，因此新的语法允许定义和调用时，尾部直接有一个逗号。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clownsEverywhere</span>(<span class="params"></span></span><br><span class="line"><span class="params">    param1,</span></span><br><span class="line"><span class="params">    param2,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">clownsEverywhere</span>(</span><br><span class="line">    <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这样的规定也使得，函数参数与数组和对象的尾逗号规则，保持一致了。</p>
<h5 id="推荐阅读-25">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Trailing_commas">Trailing_commas</a></li>
</ul>
<h3 id="ES9（ES2018）">ES9（ES2018）</h3>
<h4 id="for-await-of">for await of</h4>
<p>异步迭代器(for-await-of)：循环等待每个Promise对象变为resolved状态才进入下一步。</p>
<p>我们知道 for…of 是同步运行的，有时候一些任务集合是异步的，那这种遍历怎么办呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Gen</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(time)</span><br><span class="line">        &#125;, time)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="title class_">Gen</span>(<span class="number">2000</span>), <span class="title class_">Gen</span>(<span class="number">100</span>), <span class="title class_">Gen</span>(<span class="number">3000</span>)]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>(), item.<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>()</span><br><span class="line"><span class="comment">// 1560090138232 Promise &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">// 1560090138234 Promise &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">// 1560090138235 Promise &#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">// 100</span></span><br><span class="line"><span class="comment">// 2000</span></span><br><span class="line"><span class="comment">// 3000</span></span><br></pre></td></tr></table></figure>
<p>这里写了几个小任务，分别是 2000ms 、100ms、3000ms后任务结束。在上述遍历的过程中可以看到三个任务是同步启动的，然后输出上也不是按任务的执行顺序输出的，这显然不太符合我们的要求。</p>
<p>聪明的同学一定能想起来 await 的作用，它可以中断程序的执行直到这个 Promise 对象的状态发生改变，我们修改上面的代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Gen</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(time)</span><br><span class="line">        &#125;, time)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="title class_">Gen</span>(<span class="number">2000</span>), <span class="title class_">Gen</span>(<span class="number">100</span>), <span class="title class_">Gen</span>(<span class="number">3000</span>)]</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>(), <span class="keyword">await</span> item.<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>()</span><br><span class="line"><span class="comment">// 2000</span></span><br><span class="line"><span class="comment">// 1560091834772 undefined</span></span><br><span class="line"><span class="comment">// 100</span></span><br><span class="line"><span class="comment">// 1560091836774 undefined</span></span><br><span class="line"><span class="comment">// 3000</span></span><br><span class="line"><span class="comment">// 1560091836775 undefined</span></span><br></pre></td></tr></table></figure>
<p>从返回值看确实是按照任务的先后顺序进行的，其中原理也有说明是利用了 await 中断程序的功能。</p>
<p>在 ES9 中也可以用 for…await…of 的语法来操作：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Gen</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(time)</span><br><span class="line">        &#125;, time)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [<span class="title class_">Gen</span>(<span class="number">2000</span>), <span class="title class_">Gen</span>(<span class="number">100</span>), <span class="title class_">Gen</span>(<span class="number">3000</span>)]</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>(), item)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>()</span><br><span class="line"><span class="comment">// 1560092345730 2000</span></span><br><span class="line"><span class="comment">// 1560092345730 100</span></span><br><span class="line"><span class="comment">// 1560092346336 3000</span></span><br></pre></td></tr></table></figure>
<p>从这个结果来看和第二种写法效果差不多，但是工作原理确完全不同，重点观察下输出的时间（Chrome Console）, 第二种写法是代码块中有 await 导致等待 Promise 的状态而不再继续执行；第三种写法是整个代码块都不执行，等待 arr 当前的值（Promise状态）发生变化之后，才执行代码块的内容。</p>
<p>回想我们之前给数据结构自定义遍历器是同步的，如果想定义适合 for…await…of 的异步遍历器该怎么做呢？答案是 Symbol.asyncIterator。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>, </span><br><span class="line">  <span class="title class_">Gen</span> (time) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123; <span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: time &#125;)</span><br><span class="line">      &#125;, time)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;, </span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">asyncIterator</span>] () &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> self = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      next () &#123;</span><br><span class="line">        self.<span class="property">count</span>++</span><br><span class="line">        <span class="keyword">if</span> (self.<span class="property">count</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> self.<span class="title class_">Gen</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">1000</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span> () &#123;</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>(), item)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1560093560200 649.3946561938179</span></span><br><span class="line"><span class="comment">// 1560093560828 624.6310222512955</span></span><br><span class="line"><span class="comment">// 1560093561733 901.9497480464518</span></span><br></pre></td></tr></table></figure>
<h4 id="推荐阅读-26">推荐阅读</h4>
<ul>
<li><a href="https://exploringjs.com/es2018-es2019/ch_asynchronous-iteration.html#for-await-of-and-rejections">Asynchronous iteration</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for-await...of">for await…of</a></li>
</ul>
<h4 id="RegExp-Updates">RegExp Updates</h4>
<h5 id="dotAll-模式">dotAll 模式</h5>
<p>正则表达式中，点（.）是一个特殊字符，代表任意的单个字符，但是有两个例外。一个是四个字节的 UTF-16 字符，这个可以用u修饰符解决；另一个是行终止符（line terminator character）。</p>
<ul>
<li>U+000A 换行符（\n）</li>
<li>U+000D 回车符（\r）</li>
<li>U+2028 行分隔符（line separator）</li>
<li>U+2029 段分隔符（paragraph separator）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="regexp">/foo.bar/</span>.<span class="title function_">test</span>(<span class="string">&#x27;foo\nbar&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="regexp">/foo.bar/</span>s.<span class="title function_">test</span>(<span class="string">&#x27;foo\nbar&#x27;</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>在 ES5 中我们都是这么解决的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="regexp">/foo[^]bar/</span>.<span class="title function_">test</span>(<span class="string">&#x27;foo\nbar&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="regexp">/foo[\s\S]bar/</span>.<span class="title function_">test</span>(<span class="string">&#x27;foo\nbar&#x27;</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>那如何判断当前正则是否使用了 dotAll 模式呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> re = <span class="regexp">/foo.bar/</span>s <span class="comment">// Or, `const re = new RegExp(&#x27;foo.bar&#x27;, &#x27;s&#x27;)` .</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(re.<span class="title function_">test</span>(<span class="string">&#x27;foo\nbar&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(re.<span class="property">dotAll</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(re.<span class="property">flags</span>) <span class="comment">// &#x27;s&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>记住一句话就可以理解 dotAll 模式：它让 . 名副其实。</p>
</blockquote>
<h5 id="具名组匹配">具名组匹配</h5>
<p>我们在写正则表达式的时候，可以把一部分用()包裹起来，被包裹起来的这部分称作“分组捕获”。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2020-05-01&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>))</span><br><span class="line"><span class="comment">// [&quot;2020-05-01&quot;, &quot;2020&quot;, &quot;05&quot;, &quot;01&quot;, index: 0, input: &quot;2020-05-01&quot;, groups: undefined]</span></span><br></pre></td></tr></table></figure>
<p>这个正则匹配很简单，按照 match 的语法，没有使用 g 标识符，所以返回值第一个数值是正则表达式的完整匹配，接下来的第二个值到第四个值是分组匹配（2020, 05, 01）。</p>
<p>此外 match 返回值还有几个属性，分别是 index、input、groups。</p>
<blockquote>
<p>TIP</p>
<ol>
<li>index [匹配的结果的开始位置]</li>
<li>input [搜索的字符串]</li>
<li>groups [一个捕获组数组 或 undefined（如果没有定义命名捕获组）]</li>
</ol>
</blockquote>
<p>我们通过数组来获取这些捕获：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> t = <span class="string">&#x27;2020-05-01&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t[<span class="number">1</span>]) <span class="comment">// 2020</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t[<span class="number">2</span>]) <span class="comment">// 05</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t[<span class="number">3</span>]) <span class="comment">// 01</span></span><br></pre></td></tr></table></figure>
<p>上文中重点看下 groups 的解释，这里提到了命名捕获组的概念，如果没有定义 groups 就是 undefined。很明显，我们上述的返回值就是 undefined 间接说明没有定义命名捕获分组。那什么是命名捕获分组呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2020-05-01&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)/</span>))</span><br><span class="line"><span class="comment">// [&quot;2020-05-01&quot;, &quot;2020&quot;, &quot;05&quot;, &quot;01&quot;, index: 0, input: &quot;2020-05-01&quot;, groups: &#123;…&#125;]</span></span><br></pre></td></tr></table></figure>
<p>这段代码的返回值 groups 已经是 Object 了，具体的值是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">groups</span>: &#123;</span><br><span class="line">    <span class="attr">year</span>: <span class="string">&quot;2020&quot;</span>,</span><br><span class="line">    <span class="attr">month</span>: <span class="string">&quot;05&quot;</span>,</span><br><span class="line">    <span class="attr">day</span>: <span class="string">&quot;01&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 Object 的 key 就是正则表达式中定义的，也就是把捕获分组进行了命名。想获取这些捕获可以这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> t = <span class="string">&#x27;2020-05-01&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(?&lt;year&gt;\d&#123;4&#125;)-(?&lt;month&gt;\d&#123;2&#125;)-(?&lt;day&gt;\d&#123;2&#125;)/</span>)</span><br><span class="line"><span class="comment">// [&quot;2020-05-01&quot;, &quot;2020&quot;, &quot;05&quot;, &quot;01&quot;, index: 0, input: &quot;2020-05-01&quot;, groups: &#123;…&#125;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t.<span class="property">groups</span>.<span class="property">year</span>) <span class="comment">// 2020</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t.<span class="property">groups</span>.<span class="property">month</span>) <span class="comment">// 05</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(t.<span class="property">groups</span>.<span class="property">day</span>) <span class="comment">// 01</span></span><br></pre></td></tr></table></figure>
<h5 id="后行断言">后行断言</h5>
<p>在 ES9 之前 JavaScript 正则只支持先行断言，不支持后行断言。简单复习下先行断言的知识：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> test = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">match</span>(<span class="regexp">/hello(?=\sworld)/</span>))</span><br><span class="line"><span class="comment">// [&quot;hello&quot;, index: 0, input: &quot;hello world&quot;, groups: undefined]</span></span><br></pre></td></tr></table></figure>
<p>这段代码要匹配后面是 world 的 hello，但是反过来就不成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> test = <span class="string">&#x27;world hello&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">match</span>(<span class="regexp">/hello(?=\sworld)/</span>))</span><br><span class="line"><span class="comment">// null</span></span><br></pre></td></tr></table></figure>
<p>比如我们想判断前面是 world 的 hello，这个代码是实现不了的。在 ES9 就支持这个后行断言了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> test = <span class="string">&#x27;world hello&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">match</span>(<span class="regexp">/(?&lt;=world\s)hello/</span>))</span><br><span class="line"><span class="comment">// [&quot;hello&quot;, index: 6, input: &quot;world hello&quot;, groups: undefined]</span></span><br></pre></td></tr></table></figure>
<p>(?&lt;…)是后行断言的符号，(?..)是先行断言的符号，然后结合 =(等于)、!(不等)、\1(捕获匹配)。</p>
<h4 id="Object-Rest-Spread">Object Rest &amp; Spread</h4>
<p>前面在讲 function 的 Rest &amp; Spread 方法，忘记的同学可以去复习下。</p>
<p>在 ES9 新增 Object 的 Rest &amp; Spread 方法，直接看下示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> input = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = &#123;</span><br><span class="line">  ...input,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(output) <span class="comment">// &#123;a: 1, b: 2, c: 3&#125;</span></span><br></pre></td></tr></table></figure>
<p>这块代码展示了 spread 语法，可以把 input 对象的数据都拓展到 output 对象，这个功能很实用。</p>
<p>我们再来看下 Object rest 的示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> input = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; a, ...rest &#125; = input</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a, rest) <span class="comment">// 1 &#123;b: 2, c: 3&#125;</span></span><br></pre></td></tr></table></figure>
<p>当对象 key-value 不确定的时候，把必选的 key 赋值给变量，用一个变量收敛其他可选的 key 数据，这在之前是做不到的。</p>
<h4 id="Promise-prototype-finally">Promise.prototype.finally()</h4>
<p>指定不管最后状态如何都会执行的回调函数。</p>
<p>Promise.prototype.finally() 方法返回一个Promise，在promise执行结束时，无论结果是fulfilled或者是rejected，在执行then()和catch()后，都会执行finally指定的回调函数。这为指定执行完promise后，无论结果是fulfilled还是rejected都需要执行的代码提供了一种方式，避免同样的语句需要在then()和catch()中各写一次的情况。</p>
<h5 id="基本语法-6"><strong>基本语法</strong></h5>
<blockquote>
<p>p.finally(onFinally)</p>
</blockquote>
<h5 id="示例"><strong>示例</strong></h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="comment">// reject(&#x27;fail&#x27;)</span></span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;).<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;finally&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="场景1：loading关闭">场景1：loading关闭</h5>
<p>需要每次发送请求，都会有loading提示，请求发送完毕，就需要关闭loading提示框，不然界面就无法被点击。不管请求成功或是失败，这个loading都需要关闭掉，这时把关闭loading的代码写在finally里再合适不过了。</p>
<h5 id="场景2：数据库断开链接">场景2：数据库断开链接</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> connection</span><br><span class="line">db.<span class="title function_">open</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">conn</span> =&gt;</span> &#123;</span><br><span class="line">        connection = conn</span><br><span class="line">        <span class="keyword">return</span> connection.<span class="title function_">select</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;Jane&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Process result</span></span><br><span class="line">        <span class="comment">// Use `connection` to make more queries</span></span><br><span class="line">    &#125;)···</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// handle errors</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">finally</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        connection.<span class="title function_">close</span>()</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-27">推荐阅读</h5>
<ul>
<li><a href="http://2ality.com/2017/07/promise-prototype-finally.html">Promise.prototype.finally()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally">finally()</a></li>
</ul>
<h4 id="字符串扩展">字符串扩展</h4>
<p>放松对标签模板里字符串转义的限制, 遇到不合法的字符串转义返回undefined，并且从raw上可获取原字符串。</p>
<p>ES9开始，模板字符串允许嵌套支持常见转义序列，移除对ECMAScript在带标签的模版字符串中转义序列的语法限制。</p>
<p>// 带标签的模板字符串</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">foo</span> = (<span class="params">a, b, c, d</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(c)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(d)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// foo(1, 2, 3, 4)</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;xiecheng&#x27;</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">34</span></span><br><span class="line">foo <span class="string">`这是<span class="subst">$&#123;name&#125;</span>,他的年龄是<span class="subst">$&#123;age&#125;</span>岁`</span> </span><br></pre></td></tr></table></figure>
<p>ES9 标准移除了对 ECMAScript带标签的模板字符串 中转义序列的语法限制。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tag</span>(<span class="params">strs</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(strs)</span><br><span class="line">    <span class="comment">// strs[0] === undefined</span></span><br><span class="line">    <span class="comment">// strs.raw[0] === &quot;\\unicode and \\u&#123;55&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在标签函数中使用</span></span><br><span class="line">tag <span class="string">`\u&#123;61&#125; and \u&#123;62&#125;`</span>  <span class="comment">//</span></span><br><span class="line">tag <span class="string">`\u&#123;61&#125; and \unicode`</span>  <span class="comment">// 结果是 undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 之前的版本会报错：Invalid Unicode escape sequence</span></span><br><span class="line"><span class="comment">// 无效的Unicode转义序列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 报错：</span></span><br><span class="line"><span class="keyword">let</span> bad = <span class="string">`bad escape sequence: \unicode`</span> </span><br></pre></td></tr></table></figure>
<h3 id="ES10-ES2019">ES10(ES2019)</h3>
<h4 id="Object-fromEntries">Object.fromEntries()</h4>
<p>方法 Object.fromEntries() 把键值对列表转换为一个对象，这个方法是和 Object.entries() 相对的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">fromEntries</span>([</span><br><span class="line">    [<span class="string">&#x27;foo&#x27;</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="string">&#x27;bar&#x27;</span>, <span class="number">2</span>]</span><br><span class="line">])</span><br><span class="line"><span class="comment">// &#123;foo: 1, bar: 2&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="案例1：Object-转换操作">案例1：Object 转换操作</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    <span class="attr">course</span>: <span class="string">&#x27;es&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> entries = <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(entries)</span><br><span class="line"><span class="comment">// [Array(2), Array(2)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES10</span></span><br><span class="line"><span class="keyword">const</span> fromEntries = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(entries)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fromEntries)</span><br><span class="line"><span class="comment">// &#123;name: &quot;xxx&quot;, course: &quot;es&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="案例2：Map-转-Object">案例2：Map 转 Object</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;course&#x27;</span>, <span class="string">&#x27;es&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(map)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"><span class="comment">// &#123;name: &quot;xxx&quot;, course: &quot;es&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="案例2：过滤">案例2：过滤</h5>
<p>course表示所有课程，想请求课程分数大于80的课程组成的对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> course = &#123;</span><br><span class="line">    <span class="attr">math</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">english</span>: <span class="number">85</span>,</span><br><span class="line">    <span class="attr">chinese</span>: <span class="number">90</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> res = <span class="title class_">Object</span>.<span class="title function_">entries</span>(course).<span class="title function_">filter</span>(<span class="function">(<span class="params">[key, val]</span>) =&gt;</span> val &gt; <span class="number">80</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">fromEntries</span>(res))</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-28">推荐阅读</h5>
<ul>
<li><a href="https://github.com/tc39/proposal-object-from-entries">proposal-object-from-entries</a></li>
</ul>
<h4 id="String-扩展-2">String 扩展</h4>
<h5 id="String-prototype-trimStart">String.prototype.trimStart()</h5>
<p>trimStart() 方法从字符串的开头删除空格，trimLeft()是此方法的别名。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>str.trimStart() 或 str.trimLeft()</p>
<p>注意：虽然 trimLeft 是 trimStart 的别名，但是你会发现 <a href="http://String.prototype.trimLeft.name">String.prototype.trimLeft.name</a> === ‘trimStart’，一定要记住</p>
</blockquote>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;   foo  &#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>) <span class="comment">// 8</span></span><br><span class="line">str = str.<span class="title function_">trimStart</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<h5 id="String-prototype-trimEnd">String.prototype.trimEnd()</h5>
<p>trimEnd() 方法从一个字符串的右端移除空白字符，trimRight 是 trimEnd 的别名。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>str.trimEnd()</p>
</blockquote>
<p>或 str.trimRight()</p>
<p>注意</p>
<p>虽然 trimRight 是 trimEnd 的别名，但是你会发现 <a href="http://String.prototype.trimRight.name">String.prototype.trimRight.name</a> === ‘trimEnd’，一定要记住</p>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;   foo  &#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>) <span class="comment">// 8</span></span><br><span class="line">str = str.<span class="title function_">trimEnd</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="property">length</span>) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
<h4 id="Array-扩展">Array 扩展</h4>
<h5 id="Array-prototype-flat">Array.prototype.flat()</h5>
<p>flat() 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>const newArray = arr.flat(depth)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">depth</td>
<td style="text-align:center">指定要提取嵌套数组的结构深度，默认值为 1</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numbers.<span class="title function_">flat</span>())</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, [5, 6]]</span></span><br></pre></td></tr></table></figure>
<p>注意</p>
<p>此时 flat 的参数没有设置，取默认值 1，也就是说只扁平化向下一级，遇到 [3, 4, [5, 6]] 这个数组会扁平会处理，不会再继续遍历内部的元素是否还有数组</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>]]]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numbers.<span class="title function_">flat</span>(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<p>当 flat 的参数大于等于 2，返回值就是 [1, 2, 3, 4, 5, 6] 了。</p>
<h5 id="Array-prototype-flatMap">Array.prototype.flatMap()</h5>
<p>flatMap() 方法首先使用映射函数映射每个元素，然后将结果压缩成一个新数组。从方法的名字上也可以看出来它包含两部分功能一个是 map，一个是 flat（深度为1）。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>const new_array = arr.flatMap(function callback(currentValue[, index[, array]]) {// 返回新数组的元素 }[, thisArg])</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">callback</td>
<td style="text-align:center">可以生成一个新数组中的元素的函数，可以传入三个参数：currentValue、index、array</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td style="text-align:center">thisArg</td>
<td style="text-align:center">遍历函数 this 的指向</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<p><strong>示例</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">numbers.<span class="title function_">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]) <span class="comment">// [[2], [4], [6]]</span></span><br><span class="line">numbers.<span class="title function_">flatMap</span>(<span class="function"><span class="params">x</span> =&gt;</span> [x * <span class="number">2</span>]) <span class="comment">// [2, 4, 6]</span></span><br></pre></td></tr></table></figure>
<p>这个示例可以简单对比下 map 和 flatMap 的区别。当然还可以看下下面的示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;今天天气不错&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;早上好&#x27;</span>]</span><br><span class="line">arr.<span class="title function_">map</span>(<span class="function"><span class="params">s</span> =&gt;</span> s.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"><span class="comment">// [[&quot;今&quot;, &quot;天&quot;, &quot;天&quot;, &quot;气&quot;, &quot;不&quot;, &quot;错&quot;],[&quot;&quot;],[&quot;早&quot;, &quot;上&quot;, &quot;好&quot;]]</span></span><br><span class="line">arr.<span class="title function_">flatMap</span>(<span class="function"><span class="params">s</span> =&gt;</span> s.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"><span class="comment">// [&quot;今&quot;, &quot;天&quot;, &quot;天&quot;, &quot;气&quot;, &quot;不&quot;, &quot;错&quot;, &quot;&quot;, &quot;早&quot;, &quot;上&quot;, &quot;好&quot;]</span></span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-29">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flat">Array.prototype.flat()</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/flatMap">Array.prototype.flatMap()</a></li>
</ul>
<h4 id="Function-2">Function</h4>
<h5 id="修订-Function-prototype-toString">修订 Function.prototype.toString()</h5>
<p>函数是对象，并且每个对象都有一个 .toString() 方法，因为它最初存在于Object.prototype.toString() 上。所有对象（包括函数）都是通过基于原型的类继承从它继承的。这意味着我们以前已经有 funcion.toString() 方法了。</p>
<p>Function.prototype.toString() 方法返回一个表示当前函数源代码的字符串。</p>
<p>这意味着还将返回注释、空格和语法详细信息。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// es10新特性</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="title function_">toString</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接在方法名toString()</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>.<span class="property">parseInt</span>.<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure>
<h4 id="可选的Catch-Binding">可选的Catch Binding</h4>
<p>在 ES10 之前我们都是这样捕获异常的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// tryCode</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="comment">// catchCode</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里 err 是必须的参数，在 ES10 可以省略这个参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Foobar&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Bar&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="案例：验证参数是否为json格式">案例：验证参数是否为json格式</h5>
<p>这个需求我们只需要返回true或false，并不关心catch的参数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">validJSON</span> = json =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> json = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;xxx&quot;, &quot;course&quot;: &quot;es&quot;&#125;&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">validJSON</span>(json))</span><br></pre></td></tr></table></figure>
<h4 id="JSON扩展">JSON扩展</h4>
<h5 id="JSON-superset">JSON superset</h5>
<p>什么是 JSON 超集？，简而言之就是让 ECMAScript 兼容所有JSON支持的文本。 ECMAScript 曾在标准 JSON.parse 部分阐明 JSON 确为其一个子集，但由于 JSON 内容可以正常包含 U+2028行分隔符 与 U+2029段分隔符，而ECMAScript 却不行。</p>
<h5 id="JSON-stringify-增强能力">JSON.stringify() 增强能力</h5>
<p>JSON.stringify 在 ES10 修复了对于一些超出范围的 Unicode 展示错误的问题。因为 JSON 都是被编码成 UTF-8，所以遇到 0xD800–0xDFFF 之内的字符会因为无法编码成 UTF-8 进而导致显示错误。在 ES10 它会用转义字符的方式来处理这部分字符而非编码的方式，这样就会正常显示了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// \uD83D\uDE0E  emoji 多字节的一个字符</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;\uD83D\uDE0E&#x27;</span>)) <span class="comment">// 笑脸</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果我们只去其中的一部分  \uD83D 这其实是个无效的字符串</span></span><br><span class="line"><span class="comment">// 之前的版本 ，这些字符将替换为特殊字符，而现在将未配对的代理代码点表示为JSON转义序列</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="string">&#x27;\uD83D&#x27;</span>)) <span class="comment">// &quot;\ud83d&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-30">推荐阅读</h5>
<ul>
<li><a href="http://2ality.com/2019/01/well-formed-stringify.html">Well-formed JSON.stringify</a></li>
</ul>
<h4 id="Symbol-扩展">Symbol 扩展</h4>
<h5 id="Symbol-prototype-description">Symbol.prototype.description</h5>
<p>我们知道，Symbol 的描述只被存储在内部的 <code>Description</code> ，没有直接对外暴露，我们只有调用 Symbol 的 toString() 时才可以读取这个属性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;es&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="title function_">toString</span>()) <span class="comment">// Symbol(es)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name) <span class="comment">// Symbol(es)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name === <span class="string">&#x27;Symbol(es)&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="title function_">toString</span>() === <span class="string">&#x27;Symbol(es)&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>现在可以通过 description 方法获取 Symbol 的描述:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;es&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="property">description</span>) <span class="comment">// es</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name.<span class="property">description</span> === <span class="string">&#x27;es&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="ES11（ES2020）">ES11（ES2020）</h3>
<h4 id="String-扩展-3">String 扩展</h4>
<h4 id="String-prototype-matchAll">String.prototype.matchAll()</h4>
<p>matchAll() 方法返回一个包含所有匹配正则表达式及分组捕获结果的迭代器</p>
<p><strong>语法</strong></p>
<blockquote>
<p>str.matchAll(regexp)</p>
</blockquote>
<p><strong>解释</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">含义</th>
<th style="text-align:center">必选</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">regexp</td>
<td style="text-align:center">正则表达式对象</td>
<td style="text-align:center">Y</td>
</tr>
</tbody>
</table>
<p>注意</p>
<ol>
<li>如果所传参数不是一个正则表达式对象，则会隐式地使用 new RegExp(obj) 将其转换为一个 RegExp</li>
<li>返回值一个迭代器，但是不可重用，结果耗尽需要再次调用方法，获取一个新的迭代器</li>
</ol>
<p><strong>示例</strong></p>
<p>在了解 matchAll 之前，我们回顾下 ES10 之前一共有多少种正则全部遍历的方法。</p>
<h4 id="RegExp-prototype-exec-with-g"><strong>RegExp.prototype.exec() with /g</strong></h4>
<p>如何用一个正则表达式来得到所有匹配项，可以使用exec与g修饰符，如果正则表达式有/g标志，那么多次调用.exec()就会得到所有匹配的结果。 如果没有匹配的结果，.exec()就会返回null。在这之前会返回每个匹配的匹配对象。 这个对象包含捕获的子字符串和更多信息。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;第一个div&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;p&gt;这是一个p&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;span&gt;span&lt;/span&gt;</span></span><br><span class="line"><span class="string">      &lt;div&gt;第二个div&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>
<p>请找出所有的div元素。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">selectDiv</span>(<span class="params">regExp, str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> matches = []</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(regExp.lastIndex)</span></span><br><span class="line">        <span class="keyword">const</span> match = regExp.<span class="title function_">exec</span>(str)</span><br><span class="line">        <span class="comment">// console.log(match)</span></span><br><span class="line">        <span class="keyword">if</span> (match == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        matches.<span class="title function_">push</span>(match[<span class="number">1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> matches</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> regExp = <span class="regexp">/&lt;div&gt;(.*)&lt;\/div&gt;/g</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">selectDiv</span>(regExp, str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>
<h4 id="String-prototype-match-with-g"><strong>String.prototype.match() with /g</strong></h4>
<p>如果用 .match 方法结合 /g 的正则模式，将会把所有的匹配打包成一个数组返回，换句话说所有的捕获被忽略。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">match</span>(regExp))</span><br></pre></td></tr></table></figure>
<h4 id="g作用">/g作用</h4>
<p>因为正则表达式有一个lastIndex(初始值为0)属性，每次.exec()前，都会根据lastIndex属性的值来决定开始匹配的位置。如果正则表达式没有/g标志，那么运行一次.exec()时，不会改变lastIndex的值，导致下一次运行exec()时，匹配仍旧是从字符串0的位置开始。当正则表达式加了/g标志后，运行一次exec()，正则表达式的lastIndex就会改变，下次运行exec()就会从前一次的结果之后开始匹配。</p>
<p>不过如果没有使用 /g 的正则模式，.match 的效果和 RegExp.prototype.exec() 是一致的。</p>
<h4 id="String-prototype-replace"><strong>String.prototype.replace()</strong></h4>
<p>您可以使用一个技巧通过 .replace() 收集捕获，我们使用一个函数来计算替换值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">selectDiv</span>(<span class="params">regExp, str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> matches = []</span><br><span class="line">    str.<span class="title function_">replace</span>(regExp, <span class="function">(<span class="params">all, first</span>) =&gt;</span> &#123;</span><br><span class="line">        matches.<span class="title function_">push</span>(first)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> matches</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">selectDiv</span>(regExp, str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>
<p>现在看下 .matchAll 方法，可以这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">selectDiv</span>(<span class="params">regExp, str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> matches = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> match <span class="keyword">of</span> str.<span class="title function_">matchAll</span>(regExp)) &#123;</span><br><span class="line">        matches.<span class="title function_">push</span>(match[<span class="number">1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> matches</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> res = <span class="title function_">selectDiv</span>(regExp, str)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br></pre></td></tr></table></figure>
<h4 id="推荐阅读-31">推荐阅读</h4>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll">String.prototype.matchAll()</a></li>
</ul>
<h4 id="Dynamic-Import">Dynamic Import</h4>
<p>按需 import 提案几年前就已提出，如今终于能进入ES正式规范。这里个人理解成“按需”更为贴切。现代前端打包资源越来越大，打包成几M的JS资源已成常态，而往往前端应用初始化时根本不需要全量加载逻辑资源，为了首屏渲染速度更快，很多时候都是按需加载，比如懒加载图片等。而这些按需执行逻辑资源都体现在某一个事件回调中去加载。</p>
<h5 id="案例">案例</h5>
<p>页面上有一个按钮，点击按钮才去加载ajax模块。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> oBtn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#btn&#x27;</span>)</span><br><span class="line">oBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">import</span>(<span class="string">&#x27;./ajax&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">mod</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(mod)</span></span><br><span class="line">        mod.<span class="title function_">default</span>(<span class="string">&#x27;static/a.json&#x27;</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当然，webpack目前已很好的支持了该特性。</p>
<p>Vue中也已使用Dynamic Import实现组件的动态导入，这个我们会在后面的实战项目中讲到。</p>
<h4 id="BigInt">BigInt</h4>
<p>在 ES10 增加了新的原始数据类型：BigInt，表示一个任意精度的整数，可以表示超长数据，可以超出2的53次方。</p>
<p>Js 中 Number类型只能安全的表示-(2^53-1)至 2^53-1 范的值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span> ** <span class="number">53</span>) <span class="comment">// es7 幂运算符</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>.<span class="property">MAX_SAFE_INTEGER</span>) <span class="comment">// 最大值-1</span></span><br></pre></td></tr></table></figure>
<p>使用 BigInt 有两种方式：</p>
<h5 id="方式一：数字后面增加n">方式一：数字后面增加n</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bigInt = <span class="number">9007199254740993n</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigInt)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> bigInt) <span class="comment">// bigint</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1n</span> == <span class="number">1</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1n</span> === <span class="number">1</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：使用-BigInt-函数">方式二：使用 BigInt 函数</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> bigIntNum = <span class="title class_">BigInt</span>(<span class="number">9007199254740993n</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bigIntNum)</span><br></pre></td></tr></table></figure>
<h4 id="推荐阅读-32">推荐阅读</h4>
<ul>
<li><a href="https://v8.dev/features/bigint">BigInt: arbitrary-precision integers in JavaScript</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/BigInt">BigInt</a></li>
</ul>
<h4 id="Promise-allSettled">Promise.allSettled()</h4>
<p>学习了ES新特性，我们都知道 Promise.all() 具有并发执行异步任务的能力。但它的最大问题就是如果其中某个任务出现异常(reject)，所有任务都会挂掉，Promise直接进入 reject 状态。</p>
<p>场景：现在页面上有三个请求，分别请求不同的数据，如果一个接口服务异常，整个都是失败的，都无法渲染出数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">reject</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;服务异常&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功&#x27;</span>)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我们需要一种机制，如果并发任务中，无论一个任务正常或者异常，都会返回对应的的状态</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">reject</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;服务异常&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    <span class="comment">// console.log(&#x27;成功&#x27;)</span></span><br><span class="line">    <span class="keyword">const</span> data = res.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">status</span> === <span class="string">&#x27;fulfilled&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;失败&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-33">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled">Promise.allSettled()</a></li>
</ul>
<h4 id="globalThis">globalThis</h4>
<p>Javascript 在不同的环境获取全局对象有不通的方式：</p>
<ul>
<li>node 中通过 global</li>
<li>web 中通过 window, self 等.</li>
</ul>
<blockquote>
<p>TIP</p>
<p>self：打开任何一个网页，浏览器会首先创建一个窗口，这个窗口就是一个window对象，也是js运行所依附的全局环境对象和全局作用域对象。self 指窗口本身，它返回的对象跟window对象是一模一样的。也正因为如此，window对象的常用方法和函数都可以用self代替window。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">self.<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>以前想要获取全局对象，可通过一个全局函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getGlobal</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> self !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">window</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">global</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;无法找到全局对象&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> globals = <span class="title function_">getGlobal</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(globals)</span><br></pre></td></tr></table></figure>
<p>globalThis 提供了一个标准的方式来获取不同环境下的全局 this 对象（也就是全局对象自身）。不像 window 或者 self 这些属性，它确保可以在有无窗口的各种环境下正常工作。所以，你可以安心的使用 globalThis，不必担心它的运行环境。为便于记忆，你只需要记住，全局作用域中的 this 就是 globalThis。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(globalThis)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-34">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/globalThis">globalThis</a></li>
</ul>
<h4 id="可选链-Optional-chaining">可选链 Optional chaining</h4>
<p>可让我们在查询具有多层级的对象时，不再需要进行冗余的各种前置校验。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">        <span class="attr">street</span>: <span class="string">&#x27;xx街道&#x27;</span>。,</span><br><span class="line">        <span class="title function_">getNum</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;80号&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在之前的语法中，想获取到深层属性或方法，不得不做的前置校验，否则很容易命中 <code>Uncaught TypeError: Cannot read property...</code> 这种错误，这极有可能让你整个应用挂掉。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> street = user &amp;&amp; user.<span class="property">address</span> &amp;&amp; user.<span class="property">address</span>.<span class="property">street</span></span><br><span class="line"><span class="keyword">const</span> num = user &amp;&amp; user.<span class="property">address</span> &amp;&amp; user.<span class="property">address</span>.<span class="property">getNum</span> &amp;&amp; user.<span class="property">address</span>.<span class="title function_">getNum</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(street, num)</span><br></pre></td></tr></table></figure>
<p>用了 Optional Chaining ，上面代码会变成</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> street2 = user?.<span class="property">address</span>?.<span class="property">street</span></span><br><span class="line"><span class="keyword">const</span> num2 = user?.<span class="property">address</span>?.<span class="property">getNum</span>?.()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(street2, num2)</span><br></pre></td></tr></table></figure>
<p>可选链中的 ? 表示如果问号左边表达式有值, 就会继续查询问号后面的字段。根据上面可以看出，用可选链可以大量简化类似繁琐的前置校验操作，而且更安全。</p>
<h5 id="推荐阅读-35">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE">Optional chaining</a></li>
</ul>
<h4 id="空值合并运算符（Nullish-coalescing-Operator）">空值合并运算符（Nullish coalescing Operator）</h4>
<p>空值合并运算符（??）是一个逻辑运算符。当左侧操作数为 null 或 undefined 时，其返回右侧的操作数。否则返回左侧的操作数。</p>
<p>当我们查询某个属性时，经常会遇到，如果没有该属性就会设置一个默认的值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> b = <span class="number">0</span> <span class="comment">// 或者null undefined false</span></span><br><span class="line"><span class="keyword">const</span> a = b || <span class="number">5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure>
<p>空值合并运算符 ?? 我们仅在第一项为 null 或 undefined 时设置默认值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// false 0  无效</span></span><br><span class="line"><span class="keyword">const</span> a = b ?? <span class="number">123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br></pre></td></tr></table></figure>
<h5 id="推荐阅读-36">推荐阅读</h5>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator">Nullish coalescing operator</a></li>
</ul>
<h3 id="环境构建">环境构建</h3>
<h4 id="Webpack">Webpack</h4>
<p>现如今前端主流的三大框架VueJs、ReactJs、AngularJs都推荐与webpack共同使用，所以不管使用哪种技术路线都不得不去学习了解webpack。那么webpack到底是何方神圣？</p>
<p>官方说法是webpack是一个模块打包机，我个人理解是它可以把我们在开发环境下的代码以及依赖文件等打包成在生产环境下可以直接使用的文件。也可以把一些浏览器不能直接运行的文件进行转化，比如是ts、vue、less、scss等。同时webpack也可以对代码进行优化，比如压缩、合并、文件缓存等等。在项目中我们只需要把相应的配置文件配置好，那么接下来的工作就都可以交给webpack这个全能大神去完成了。</p>
<h4 id="官方网站">官方网站</h4>
<p>英文： <a href="https://webpack.js.org/">https://webpack.js.org/</a></p>
<p>中文：<a href="https://webpack.docschina.org/">https://webpack.docschina.org/</a></p>
<p>Github：<a href="https://github.com/webpack/webpack">https://github.com/webpack/webpack</a></p>
<h4 id="核心概念">核心概念</h4>
<h5 id="入口-entry">入口(entry)</h5>
<p>入口起点(entry point)指示 webpack 应该使用哪个模块，来作为构建其内部 依赖图(dependency graph) 的开始。进入入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的。</p>
<p>默认值是 ./src/index.js，但可以通过在 webpack configuration 中配置 entry 属性，来指定一个（或多个）不同的入口起点。例如：</p>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./path/to/my/entry/file.js&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="输出-output">输出(output)</h5>
<p>output 属性告诉 webpack 在哪里输出它所创建的 bundle，以及如何命名这些文件。主要输出文件的默认值是 ./dist/main.js，其他生成文件默认放置在 ./dist 文件夹中。</p>
<p>可以通过在配置中指定一个 output 字段，来配置这些处理过程：</p>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./path/to/my/entry/file.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;my-first-webpack.bundle.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="loader">loader</h5>
<p>webpack 只能理解 JavaScript 和 JSON 文件。loader 让 webpack 能够去处理其他类型的文件，并将它们转换为有效 模块，以供应用程序使用，以及被添加到依赖图中。</p>
<p>注意</p>
<p>loader 能够 import 导入任何类型的模块（例如 .css 文件），这是 webpack 特有的功能，其他打包程序或任务执行器的可能并不支持。我们认为这种语言扩展是很有必要的，因为这可以使开发人员创建出更准确的依赖关系图。</p>
<p>在更高层面，在 webpack 的配置中 loader 有两个属性：</p>
<ul>
<li>test 属性，用于标识出应该被对应的 loader 进行转换的某个或某些文件。</li>
<li>use 属性，表示进行转换时，应该使用哪个 loader。</li>
</ul>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;my-first-webpack.bundle.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [&#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#x27;raw-loader&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="插件-plugin">插件(plugin)</h5>
<p>loader 用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。</p>
<p>想要使用一个插件，只需要 require() 它，然后把它添加到 plugins 数组中。多数插件可以通过选项(option)自定义。也可以在一个配置文件中因为不同目的而多次使用同一个插件，这时需要通过使用 new 操作符来创建它的一个实例。</p>
<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>); <span class="comment">// 通过 npm 安装</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>); <span class="comment">// 用于访问内置插件</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [&#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#x27;raw-loader&#x27;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="模式-mode">模式(mode)</h5>
<p>通过选择 development, production 或 none 之中的一个，来设置 mode 参数，可以启用 webpack 内置在相应环境下的优化。其默认值为 production。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="开发环境与生产环境">开发环境与生产环境</h4>
<p>初学者会有一个疑问，为什么有的时候安装依赖包的时候是 <code>--save-dev</code> ，而有的时候是 <code>--save</code> ，这两个有什么区别呢？什么时候包含 <code>dev</code> 呢？ 这就需要搞清楚一个概念： <code>开发模式</code> 和 <code>生产模式</code> 。</p>
<h5 id="开发模式-save-dev">开发模式 --save-dev</h5>
<p>项目在开发编码过程中还未上线使用就属于开发模式，该模式下代码不需要压缩、合并等。比如编写可以使用sass进行css预处理，使用ES6的语法来编写js代码。在开发模式下依赖的包安装的时候就需要使用 <code>--save-dev</code> ， <code>dev</code> 表示开发的意思，使用 <code>--save-dev</code> 安装的依赖包，会安装在 <code>package.json</code> 的 <code>devDependencies</code> 中，这些依赖包只在开发时候会使用到，在上线生成环境下就不需要了。</p>
<h5 id="生产模式-save">生产模式 --save</h5>
<p>项目已经开发测试完成需要打包上线进行运营了，这时候就属于生产模式，改模式下的文件需要是最终浏览器可以直接解析的文件，不能再用如 <code>.scss</code> 、 <code>.vue</code> 、 <code>.jsx</code> 等这样的文件了。在生产模式下依赖的包安装的时候就需要使用 <code>--save</code> ，使用 <code>--save</code> 安装的依赖包，会安装在 <code>package.json</code> 的 <code>dependencies</code> 中，这些依赖包是最终在上线时候使用到的，比如 <code>jquery.js</code> 、 <code>vue.js</code> 等。</p>
<p>TIP</p>
<p>大家在开发过程中安装每个依赖包的时候，都一定先考虑这个包是只有开发模式下能用到，还是在生产模式下也需要用到，其实大家按照这个思路把下面的文章都看完，应该就可以对 <code>--save-dev</code> 和 <code>--save</code> 有一个自己的理解了</p>
<h4 id="配置">配置</h4>
<ol>
<li>初始化package.json</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm init </span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>目的是生成 <code>package.json</code> 文件。 也可以使用 <code>npm init -y</code> 所有配置都选择默认。</p>
</blockquote>
<ol>
<li>项目安装webpack</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i webpack webpack-cli webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意</p>
<p>安装webpack有两种方式：项目安装 和 全局安装。</p>
<p>上面的命令是在本项目安装webpack，不推荐全局安装webpack，因为全局安装以后版本就固定了，比如当前电脑中全局安装了V4.43.0这个版本的webpack，如果需要运行一个比较早期版本的项目，比如webpack3.X的项目，就会有问题。另外，如果当前项目是使用V4.43.0版本写的，如果有一天webpack的版本升级了，比如升级到了V5. X，那么之前的项目很有可能就跑不起来了。所以并不建议全局安装，而是建议项目安装。</p>
</blockquote>
<ol>
<li>项目根目录下创建 <code>webpack.config.js</code> 文件</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>编译</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TIP</p>
<p>npx 的作用就是调用项目内部安装的模块，因为我们的webpack选择的是项目安装，而不是全局安装。如果是全局安装直接使用 <code>webpack</code> 命令即可。</p>
</blockquote>
<ol>
<li>配置html-webpack-plugin</li>
</ol>
<p><code>html-webpack-plugin</code> 主要有两个作用</p>
<ul>
<li>为html文件中引入的外部资源如script、link动态添加每次compile后的hash，防止引用缓存的外部文件问题</li>
<li>可以生成创建html入口文件</li>
</ul>
<p>安装：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置模板：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>配置copy-webpack-plugin</li>
</ol>
<p><code>copy-webpack-plugin</code> 的作用就是拷贝文件，或者文件夹。</p>
<p>安装：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install copy-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>([&#123;</span><br><span class="line">            <span class="attr">from</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">            <span class="attr">to</span>: <span class="string">&#x27;static&#x27;</span></span><br><span class="line">        &#125;, ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>配置文件拆分</li>
</ol>
<p>大型项目的 <code>webpack.config.js</code> 文件的配置会非常复杂，所以一般会拆分为多个文件。</p>
<p>创建build文件夹，在build中把 <code>webpack.config.js</code> 拆分为四个文件：</p>
<ul>
<li>webpack.base.config.js 基础配置文件</li>
<li>webpack.dev.config.js 开发环境下的配置文件</li>
<li>webpack.pro.config.js 生成环境下的配置文件</li>
<li>webpack.config.js 总的配置文件</li>
</ul>
<h5 id="webpack-base-config-js">webpack.base.config.js</h5>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;copy-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;index.js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>([&#123;</span><br><span class="line">            <span class="attr">from</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">            <span class="attr">to</span>: <span class="string">&#x27;static&#x27;</span></span><br><span class="line">        &#125;, ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="webpack-dev-config-js">webpack.dev.config.js</h5>
<p>安装 <code>cheap-module-eval-source-map</code> 使用 cheap 模式可以大幅提高 souremap 生成的效率</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">devtool</span>: <span class="string">&#x27;cheap-module-eval-source-map&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="webpack-pro-config-js">webpack.pro.config.js</h5>
<p>安装 <code>clean-webpack-plugin</code> 自动删除webpack里的dist目录。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i clean-webpack-plugin -D</span><br><span class="line">const &#123;</span><br><span class="line">    CleanWebpackPlugin</span><br><span class="line">&#125; = require(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new CleanWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="webpack-config-js">webpack.config.js</h5>
<p>安装 <code>webpack-merge</code> 把配置文件合并</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i webpack-merge -D</span><br><span class="line">const merge = require(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line">const baseConfig = require(<span class="string">&#x27;./webpack.base.config&#x27;</span>)</span><br><span class="line">const devConfig = require(<span class="string">&#x27;./webpack.dev.config&#x27;</span>)</span><br><span class="line">const proConfig = require(<span class="string">&#x27;./webpack.pro.config&#x27;</span>)</span><br><span class="line"></span><br><span class="line">module.exports = (<span class="built_in">env</span>, argv) =&gt; &#123;</span><br><span class="line">    <span class="built_in">let</span> config = argv.mode === <span class="string">&#x27;development&#x27;</span> ? devConfig : proConfig;</span><br><span class="line">    <span class="built_in">return</span> merge(baseConfig, config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>配置启动命令</li>
</ol>
<p>修改 <code>package.json</code> 中的 <code>scripts</code> 配置：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server --mode=development --config ./build/webpack.config.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --mode=production --config ./build/webpack.config.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="babel">babel</h4>
<p>Babel 是一个编译器（输入源码 =&gt; 输出编译后的代码）。</p>
<p>官网 <a href="https://www.babeljs.cn/">https://www.babeljs.cn/</a></p>
<p>安装：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">npm i -D babel-loader @babel/core @babel/preset-env </span><br></pre></td></tr></table></figure>
<p>配置：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [&#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">presets</span>: [</span><br><span class="line">                    [<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;</span><br><span class="line">                        <span class="string">&#x27;useBuiltIns&#x27;</span>: <span class="string">&#x27;entry&#x27;</span></span><br><span class="line">                    &#125;]</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>es6</category>
      </categories>
      <tags>
        <tag>es6</tag>
      </tags>
  </entry>
</search>
